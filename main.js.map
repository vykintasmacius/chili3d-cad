{"version":3,"file":"main.js","sources":["webpack://chili3d/./packages/chili-controls/src/converters/urlConverter.ts","webpack://chili3d/./packages/chili-controls/src/controls.ts","webpack://chili3d/./packages/chili-controls/src/collection.ts","webpack://chili3d/./packages/chili-controls/src/converters/colorConverter.ts","webpack://chili3d/./packages/chili-controls/src/converters/numberConverter.ts","webpack://chili3d/./packages/chili-controls/src/converters/stringConverter.ts","webpack://chili3d/./packages/chili-controls/src/converters/xyzConverter.ts","webpack://chili3d/./packages/chili-controls/src/expander/expander.ts","webpack://chili3d/./packages/chili-controls/src/radioGroup.ts","webpack://chili3d/./packages/chili-core/src/foundation/asyncController.ts","webpack://chili3d/./packages/chili-core/src/foundation/binding.ts","webpack://chili3d/./packages/chili-core/src/foundation/collection.ts","webpack://chili3d/./packages/chili-core/src/foundation/history.ts","webpack://chili3d/./packages/chili-core/src/serialize/classMap.ts","webpack://chili3d/./packages/chili-core/src/serialize/serializer.ts","webpack://chili3d/./packages/chili-core/src/foundation/messageType.ts","webpack://chili3d/./packages/chili-core/src/foundation/precision.ts","webpack://chili3d/./packages/chili-core/src/command/decarator.ts","webpack://chili3d/./packages/chili-core/src/snapType.ts","webpack://chili3d/./packages/chili-core/src/shape/curve.ts","webpack://chili3d/./packages/chili-core/src/shape/geometry.ts","webpack://chili3d/./packages/chili-core/src/shape/lineType.ts","webpack://chili3d/./packages/chili-core/src/shape/meshData.ts","webpack://chili3d/./packages/chili-core/src/shape/shape.ts","webpack://chili3d/./packages/chili-core/src/shape/shapeType.ts","webpack://chili3d/./packages/chili-core/src/shape/surface.ts","webpack://chili3d/./packages/chili-core/src/ui/button.ts","webpack://chili3d/./packages/chili-core/src/ui/dialog.ts","webpack://chili3d/./packages/chili-core/src/visual/view.ts","webpack://chili3d/./packages/chili-core/src/visual/visualShape.ts","webpack://chili3d/./packages/chili-core/src/foundation/logger.ts","webpack://chili3d/./packages/chili-core/src/foundation/transaction.ts","webpack://chili3d/./packages/chili-core/src/foundation/observer.ts","webpack://chili3d/./packages/chili-core/src/foundation/result.ts","webpack://chili3d/./packages/chili-core/src/foundation/deepObserver.ts","webpack://chili3d/./packages/chili-core/src/foundation/disposable.ts","webpack://chili3d/./packages/chili-core/src/foundation/gc.ts","webpack://chili3d/./packages/chili-core/src/foundation/id.ts","webpack://chili3d/./packages/chili-core/src/foundation/pubsub.ts","webpack://chili3d/./packages/chili-core/src/foundation/utils/debounce.ts","webpack://chili3d/./packages/chili-core/src/foundation/utils/download.ts","webpack://chili3d/./packages/chili-core/src/foundation/utils/readFileAsync.ts","webpack://chili3d/./packages/chili-core/src/property.ts","webpack://chili3d/./packages/chili-core/src/command/command.ts","webpack://chili3d/./packages/chili-core/src/config.ts","webpack://chili3d/./packages/chili-core/src/constants.ts","webpack://chili3d/./packages/chili-core/src/document.ts","webpack://chili3d/./packages/chili-core/src/i18n/en.ts","webpack://chili3d/./packages/chili-core/src/i18n/zh-cn.ts","webpack://chili3d/./packages/chili-core/src/i18n/i18n.ts","webpack://chili3d/./packages/chili-core/src/math/mathUtils.ts","webpack://chili3d/./packages/chili-core/src/math/xyz.ts","webpack://chili3d/./packages/chili-core/src/math/boundingBox.ts","webpack://chili3d/./packages/chili-core/src/math/quaternion.ts","webpack://chili3d/./packages/chili-core/src/math/matrix4.ts","webpack://chili3d/./packages/chili-core/src/math/plane.ts","webpack://chili3d/./packages/chili-core/src/math/planeAngle.ts","webpack://chili3d/./packages/chili-core/src/math/ray.ts","webpack://chili3d/./packages/chili-core/src/math/xy.ts","webpack://chili3d/./packages/chili-core/src/material.ts","webpack://chili3d/./packages/chili-core/src/model/node.ts","webpack://chili3d/./packages/chili-core/src/model/visualNode.ts","webpack://chili3d/./packages/chili-core/src/model/meshNode.ts","webpack://chili3d/./packages/chili-core/src/model/geometryNode.ts","webpack://chili3d/./packages/chili-core/src/model/shapeNode.ts","webpack://chili3d/./packages/chili-core/src/model/component.ts","webpack://chili3d/./packages/chili-core/src/model/facebaseNode.ts","webpack://chili3d/./packages/chili-core/src/model/folderNode.ts","webpack://chili3d/./packages/chili-core/src/model/groupNode.ts","webpack://chili3d/./packages/chili-core/src/selectionFilter.ts","webpack://chili3d/./packages/chili-core/src/ui/combobox.ts","webpack://chili3d/./packages/chili-core/src/visual/act.ts","webpack://chili3d/./packages/chili-core/src/visual/visualObject.ts","webpack://chili3d/./packages/chili-geo/src/mesh.ts","webpack://chili3d/./packages/chili-geo/src/utils.ts","webpack://chili3d/./packages/chili-vis/src/selectionEventHandler.ts","webpack://chili3d/./packages/chili-vis/src/nodeSelectionEventHandler.ts","webpack://chili3d/./packages/chili-vis/src/shapeSelectionEventHandler.ts","webpack://chili3d/./packages/chili-vis/src/viewUtils.ts","webpack://chili3d/./packages/chili/src/application.ts","webpack://chili3d/./packages/chili/src/snap/dimension.ts","webpack://chili3d/./packages/chili/src/selection.ts","webpack://chili3d/./packages/chili/src/document.ts","webpack://chili3d/./packages/chili/src/utils.ts","webpack://chili3d/./packages/chili/src/bodys/box.ts","webpack://chili3d/./packages/chili/src/bodys/circle.ts","webpack://chili3d/./packages/chili/src/bodys/cone.ts","webpack://chili3d/./packages/chili/src/bodys/cylinder.ts","webpack://chili3d/./packages/chili/src/bodys/ellipse.ts","webpack://chili3d/./packages/chili/src/bodys/line.ts","webpack://chili3d/./packages/chili/src/bodys/polygon.ts","webpack://chili3d/./packages/chili/src/bodys/prism.ts","webpack://chili3d/./packages/chili/src/bodys/pyramid.ts","webpack://chili3d/./packages/chili/src/bodys/rect.ts","webpack://chili3d/./packages/chili/src/bodys/revolve.ts","webpack://chili3d/./packages/chili/src/bodys/sphere.ts","webpack://chili3d/./packages/chili/src/bodys/sweep.ts","webpack://chili3d/./packages/chili/src/commands/application/newDocument.ts","webpack://chili3d/./packages/chili/src/commands/application/openDocument.ts","webpack://chili3d/./packages/chili/src/commands/application/performanceTest.ts","webpack://chili3d/./packages/chili/src/commands/application/saveDocument.ts","webpack://chili3d/./packages/chili/src/commands/application/toFile.ts","webpack://chili3d/./packages/chili/src/commands/application/toggleDynamicWorkplane.ts","webpack://chili3d/./packages/chili/src/commands/application/wechatGroup.ts","webpack://chili3d/./packages/chili/src/bodys/boolean.ts","webpack://chili3d/./packages/chili/src/snap/snaps/axisSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/baseSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/featurePointStrategy.ts","webpack://chili3d/./packages/chili/src/snap/snaps/objectSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/planeSnap.ts","webpack://chili3d/./packages/chili/src/snap/snaps/pointOnCurveSnap.ts","webpack://chili3d/./packages/chili/src/snap/tracking/axis.ts","webpack://chili3d/./packages/chili/src/snap/tracking/trackingBase.ts","webpack://chili3d/./packages/chili/src/snap/tracking/axisTracking.ts","webpack://chili3d/./packages/chili/src/snap/tracking/objectTracking.ts","webpack://chili3d/./packages/chili/src/snap/tracking/trackingSnap.ts","webpack://chili3d/./packages/chili/src/snap/handlers/snapEventHandler.ts","webpack://chili3d/./packages/chili/src/snap/handlers/angleSnapEventHandler.ts","webpack://chili3d/./packages/chili/src/snap/handlers/lengthSnapEventHandler.ts","webpack://chili3d/./packages/chili/src/snap/handlers/pointSnapEventHandler.ts","webpack://chili3d/./packages/chili/src/step/step.ts","webpack://chili3d/./packages/chili/src/step/angleStep.ts","webpack://chili3d/./packages/chili/src/step/lengthStep.ts","webpack://chili3d/./packages/chili/src/step/pointStep.ts","webpack://chili3d/./packages/chili/src/step/selectStep.ts","webpack://chili3d/./packages/chili/src/commands/multistepCommand.ts","webpack://chili3d/./packages/chili/src/commands/boolean.ts","webpack://chili3d/./packages/chili/src/bodys/arc.ts","webpack://chili3d/./packages/chili/src/commands/createCommand.ts","webpack://chili3d/./packages/chili/src/commands/create/arc.ts","webpack://chili3d/./packages/chili/src/commands/create/bezier.ts","webpack://chili3d/./packages/chili/src/commands/create/rect.ts","webpack://chili3d/./packages/chili/src/commands/create/box.ts","webpack://chili3d/./packages/chili/src/commands/create/circle.ts","webpack://chili3d/./packages/chili/src/commands/create/cone.ts","webpack://chili3d/./packages/chili/src/bodys/face.ts","webpack://chili3d/./packages/chili/src/bodys/wire.ts","webpack://chili3d/./packages/chili/src/commands/create/converter.ts","webpack://chili3d/./packages/chili/src/commands/create/copySubShape.ts","webpack://chili3d/./packages/chili/src/commands/create/cylinder.ts","webpack://chili3d/./packages/chili/src/commands/create/ellipse.ts","webpack://chili3d/./packages/chili/src/commands/create/fuse.ts","webpack://chili3d/./packages/chili/src/commands/create/group.ts","webpack://chili3d/./packages/chili/src/commands/create/line.ts","webpack://chili3d/./packages/chili/src/commands/create/offset.ts","webpack://chili3d/./packages/chili/src/commands/create/polygon.ts","webpack://chili3d/./packages/chili/src/commands/create/prism.ts","webpack://chili3d/./packages/chili/src/commands/create/pyramid.ts","webpack://chili3d/./packages/chili/src/commands/create/revolve.ts","webpack://chili3d/./packages/chili/src/commands/create/section.ts","webpack://chili3d/./packages/chili/src/commands/create/sphere.ts","webpack://chili3d/./packages/chili/src/commands/create/sweep.ts","webpack://chili3d/./packages/chili/src/commands/create/thickSolid.ts","webpack://chili3d/./packages/chili/src/commands/createActCommand.ts","webpack://chili3d/./packages/chili/src/commands/delete.ts","webpack://chili3d/./packages/chili/src/commands/folder.ts","webpack://chili3d/./packages/chili/src/commands/importExport.ts","webpack://chili3d/./packages/chili/src/commands/measure/angle.ts","webpack://chili3d/./packages/chili/src/commands/measure/length.ts","webpack://chili3d/./packages/chili/src/commands/measure/select.ts","webpack://chili3d/./packages/chili/src/commands/modify/break.ts","webpack://chili3d/./packages/chili/src/commands/modify/brush.ts","webpack://chili3d/./packages/chili/src/commands/modify/chamfer.ts","webpack://chili3d/./packages/chili/src/commands/modify/explode.ts","webpack://chili3d/./packages/chili/src/commands/modify/fillet.ts","webpack://chili3d/./packages/chili/src/commands/modify/transformedCommand.ts","webpack://chili3d/./packages/chili/src/commands/modify/mirror.ts","webpack://chili3d/./packages/chili/src/commands/modify/move.ts","webpack://chili3d/./packages/chili/src/commands/modify/removeFeature.ts","webpack://chili3d/./packages/chili/src/commands/modify/removeSubShapes.ts","webpack://chili3d/./packages/chili/src/commands/modify/rotate.ts","webpack://chili3d/./packages/chili/src/commands/modify/split.ts","webpack://chili3d/./packages/chili/src/commands/modify/trim.ts","webpack://chili3d/./packages/chili/src/commands/redo.ts","webpack://chili3d/./packages/chili/src/commands/undo.ts","webpack://chili3d/./packages/chili/src/commands/workingPlane.ts","webpack://chili3d/./packages/chili/src/editEventHandler.ts","webpack://chili3d/./packages/chili/src/services/commandService.ts","webpack://chili3d/./packages/chili/src/services/editorService.ts","webpack://chili3d/./packages/chili/src/services/hotkeyService.ts","webpack://chili3d/./packages/chili-builder/src/defaultDataExchange.ts","webpack://chili3d/./packages/chili-builder/src/appBuilder.ts","webpack://chili3d/./packages/chili-web/src/loading.ts","webpack://chili3d/./packages/chili-web/src/index.ts"],"sourcesContent":["// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter, Result } from \"chili-core\";\r\n\r\nexport class UrlStringConverter implements IConverter<string> {\r\n    convert(value: string): Result<string> {\r\n        return Result.ok(`url('${value}')`);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Localize, PathBinding } from \"chili-core\";\r\nimport { Collection, CollectionProps } from \"./collection\";\r\nimport { HTMLProps } from \"./htmlProps\";\r\n\r\nexport function createControl<K extends keyof HTMLElementTagNameMap>(tag: K) {\r\n    return (\r\n        props?: HTMLProps<HTMLElementTagNameMap[K]> | string | Node,\r\n        ...children: (Node | string)[]\r\n    ): HTMLElementTagNameMap[K] => {\r\n        const e: HTMLElementTagNameMap[K] = document.createElement(tag);\r\n        if (props) {\r\n            if (typeof props === \"string\" || props instanceof Node) {\r\n                e.append(props);\r\n            } else {\r\n                setProperties(e, props);\r\n            }\r\n        }\r\n        children.forEach((c) => e.append(c));\r\n        return e;\r\n    };\r\n}\r\n\r\nexport function setProperties<T extends { [K: string]: any }>(left: T, prop: HTMLProps<T>) {\r\n    for (const key in prop) {\r\n        const value = prop[key];\r\n        if (value instanceof Localize && (key === \"textContent\" || key === \"title\")) {\r\n            value.set(left, key);\r\n        } else if (value instanceof PathBinding) {\r\n            value.setBinding(left, key);\r\n        } else if (typeof value === \"object\" && typeof left[key] === \"object\") {\r\n            setProperties(left[key], value);\r\n        } else {\r\n            (left as any)[key] = value;\r\n        }\r\n    }\r\n}\r\n\r\nexport const div = createControl(\"div\");\r\nexport const span = createControl(\"span\");\r\nexport const input = createControl(\"input\");\r\nexport const button = createControl(\"button\");\r\nexport const label = createControl(\"label\");\r\nexport const textarea = createControl(\"textarea\");\r\nexport const select = createControl(\"select\");\r\nexport const option = createControl(\"option\");\r\nexport const a = createControl(\"a\");\r\nexport const h1 = createControl(\"h1\");\r\nexport const h2 = createControl(\"h2\");\r\nexport const h3 = createControl(\"h3\");\r\nexport const p = createControl(\"p\");\r\nexport const ul = createControl(\"ul\");\r\nexport const li = createControl(\"li\");\r\nexport const img = createControl(\"img\");\r\nexport const dialog = createControl(\"dialog\");\r\nexport const canvas = createControl(\"canvas\");\r\nexport const sup = createControl(\"sup\");\r\nexport const form = createControl(\"form\");\r\n\r\nexport function svg(props: HTMLProps<HTMLElement> & { icon: string }) {\r\n    const ns = \"http://www.w3.org/2000/svg\";\r\n    const child = document.createElementNS(ns, \"use\");\r\n    child.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", `#${props.icon}`);\r\n    const svg = document.createElementNS(ns, \"svg\");\r\n    svg.append(child);\r\n    const className = String(props.className);\r\n    delete props.className;\r\n    setProperties(svg, props);\r\n    svg.classList.add(className);\r\n    if (props.title) {\r\n        addTitle(props, svg);\r\n    }\r\n    return svg;\r\n}\r\n\r\nexport function setSVGIcon(svg: SVGSVGElement, newIcon: string) {\r\n    const child = svg.firstChild as SVGUseElement;\r\n    child?.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", `#${newIcon}`);\r\n}\r\n\r\nfunction addTitle(props: HTMLProps<HTMLElement> & { icon: string }, svg: SVGSVGElement) {\r\n    const title = document.createElementNS(\"http://www.w3.org/2000/svg\", \"title\");\r\n    if (props.title instanceof Localize) {\r\n        props.title.set(title as any, \"textContent\");\r\n    } else if (typeof props.title === \"string\") {\r\n        title.textContent = props.title;\r\n    } else {\r\n        props.title?.setBinding(title, \"textContent\");\r\n    }\r\n\r\n    svg.appendChild(title);\r\n}\r\n\r\nexport const collection = <T>(options: CollectionProps<T>) => new Collection(options);\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { CollectionAction, CollectionChangedArgs, ObservableCollection } from \"chili-core\";\r\nimport { setProperties } from \"./controls\";\r\nimport { HTMLProps } from \"./htmlProps\";\r\n\r\nexport type CollectionProps<T> = HTMLProps<Collection<T>> & {\r\n    sources: ObservableCollection<T> | Array<T>;\r\n    template: (item: T, index: number) => HTMLElement | SVGSVGElement;\r\n};\r\n\r\nexport class Collection<T> extends HTMLElement {\r\n    private readonly _itemMap = new Map<T, HTMLElement | SVGSVGElement>();\r\n    constructor(readonly props: CollectionProps<T>) {\r\n        super();\r\n        setProperties(this, props as any);\r\n    }\r\n\r\n    getItem(item: T): HTMLElement | SVGSVGElement | undefined {\r\n        return this._itemMap.get(item);\r\n    }\r\n\r\n    connectedCallback() {\r\n        const items = Array.isArray(this.props.sources) ? this.props.sources : this.props.sources.items;\r\n        this.append(...this._mapItems(items));\r\n        if (this.props.sources instanceof ObservableCollection)\r\n            this.props.sources.onCollectionChanged(this._onCollectionChanged);\r\n    }\r\n\r\n    disconnectedCallback() {\r\n        this._itemMap.forEach((x) => x.remove());\r\n        this._itemMap.clear();\r\n        if (this.props.sources instanceof ObservableCollection)\r\n            this.props.sources.removeCollectionChanged(this._onCollectionChanged);\r\n    }\r\n\r\n    private readonly _onCollectionChanged = (args: CollectionChangedArgs) => {\r\n        switch (args.action) {\r\n            case CollectionAction.add:\r\n                this.append(...this._mapItems(args.items));\r\n                break;\r\n            case CollectionAction.remove:\r\n                this._removeItem(args.items);\r\n                break;\r\n            case CollectionAction.move:\r\n                this._moveItem(args.from, args.to);\r\n                break;\r\n            case CollectionAction.replace:\r\n                this._replaceItem(args.index, args.item, args.items);\r\n                break;\r\n            default:\r\n                throw new Error(\"Unknown collection action\");\r\n        }\r\n    };\r\n\r\n    private _moveItem(from: number, to: number) {\r\n        const item1 = this.children.item(from);\r\n        const item2 = this.children.item(to);\r\n        if (item1 && item2) this.insertBefore(item1, item2);\r\n    }\r\n\r\n    private _replaceItem(index: number, item: T, items: T[]) {\r\n        const child = this._itemMap.get(item);\r\n        if (child) {\r\n            items.forEach((item, i) => {\r\n                const e = this.props.template(item, index + i);\r\n                this._itemMap.set(item, e);\r\n                this.insertBefore(e, child);\r\n            });\r\n            this._removeItem([item]);\r\n        }\r\n    }\r\n\r\n    private _mapItems(items: T[]) {\r\n        const index = this._itemMap.size;\r\n        return items.map((item, i) => {\r\n            if (this._itemMap.has(item)) return this._itemMap.get(item)!;\r\n            const e = this.props.template(item, index + i);\r\n            this._itemMap.set(item, e);\r\n            return e;\r\n        });\r\n    }\r\n\r\n    private _removeItem(items: T[]) {\r\n        items.forEach((item) => {\r\n            const child = this._itemMap.get(item);\r\n            if (child) {\r\n                child.remove();\r\n                this._itemMap.delete(item);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\ncustomElements.define(\"chili-collection\", Collection);\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter, Result } from \"chili-core\";\r\n\r\nexport class ColorConverter implements IConverter<number | string> {\r\n    convert(value: number | string): Result<string> {\r\n        return Result.ok(typeof value === \"string\" ? value : `#${value.toString(16).padStart(6, \"0\")}`);\r\n    }\r\n\r\n    convertBack(value: string): Result<number> {\r\n        const hexValue = value.startsWith(\"#\") ? value.substring(1) : value;\r\n        const result = parseInt(hexValue, 16);\r\n        return Number.isNaN(result) ? Result.err(`Invalid hex string: ${value}`) : Result.ok(result);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter, Result } from \"chili-core\";\r\n\r\nexport class NumberConverter implements IConverter<number> {\r\n    convert(value: number): Result<string> {\r\n        return Number.isNaN(value) ? Result.err(\"Number is NaN\") : Result.ok(String(value));\r\n    }\r\n\r\n    convertBack(value: string): Result<number> {\r\n        const n = Number(value);\r\n        return Number.isNaN(n) ? Result.err(`${value} can not convert to number`) : Result.ok(n);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter, Result } from \"chili-core\";\r\n\r\nexport class StringConverter implements IConverter<string> {\r\n    convert(value: string): Result<string> {\r\n        return Result.ok(value);\r\n    }\r\n    convertBack(value: string): Result<string> {\r\n        return Result.ok(value);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter, Result, XY, XYZ } from \"chili-core\";\r\n\r\nexport class XYConverter implements IConverter<XY> {\r\n    convert(value: XY) {\r\n        return Result.ok(`${value.x},${value.y}`);\r\n    }\r\n\r\n    convertBack(value: string): Result<XY> {\r\n        const vs = value.split(\",\").map(Number).filter(isFinite);\r\n        return vs.length === 2\r\n            ? Result.ok(new XY(vs[0], vs[1]))\r\n            : Result.err(`${value} convert to XY error`);\r\n    }\r\n}\r\n\r\nexport class XYZConverter implements IConverter<XYZ> {\r\n    convert(value: XYZ) {\r\n        return Result.ok(`${value.x},${value.y},${value.z}`);\r\n    }\r\n\r\n    convertBack(value: string): Result<XYZ> {\r\n        const vs = value.split(\",\").map(Number).filter(isFinite);\r\n        return vs.length === 3\r\n            ? Result.ok(new XYZ(vs[0], vs[1], vs[2]))\r\n            : Result.err(`${value} convert to XYZ error`);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys, Localize } from \"chili-core\";\r\nimport style from \"./expander.module.css\";\r\nimport { div, label, setSVGIcon, svg } from \"../controls\";\r\n\r\nexport class Expander extends HTMLElement {\r\n    private _isExpanded = true;\r\n    private readonly expanderIcon: SVGSVGElement;\r\n    private readonly headerPanel = div({ className: style.headerPanel });\r\n    readonly contenxtPanel = div({ className: style.contextPanel });\r\n\r\n    constructor(header: I18nKeys) {\r\n        super();\r\n        this.className = style.rootPanel;\r\n        this.expanderIcon = svg({\r\n            icon: this.getExpanderIcon(),\r\n            className: style.expanderIcon,\r\n            onclick: this._handleExpanderClick,\r\n        });\r\n        const text = label({\r\n            textContent: new Localize(header),\r\n            className: style.headerText,\r\n        });\r\n        this.headerPanel.append(this.expanderIcon, text);\r\n        super.append(this.headerPanel, this.contenxtPanel);\r\n    }\r\n\r\n    override appendChild<T extends Node>(node: T): T {\r\n        return this.contenxtPanel.appendChild(node);\r\n    }\r\n\r\n    override append(...nodes: Node[]): void {\r\n        this.contenxtPanel.append(...nodes);\r\n    }\r\n\r\n    override removeChild<T extends Node>(child: T): T {\r\n        return this.contenxtPanel.removeChild(child);\r\n    }\r\n\r\n    addItem(...nodes: Node[]) {\r\n        this.append(...nodes);\r\n        return this;\r\n    }\r\n\r\n    private getExpanderIcon() {\r\n        return this._isExpanded ? \"icon-angle-down\" : \"icon-angle-right\";\r\n    }\r\n\r\n    private readonly _handleExpanderClick = (e: MouseEvent) => {\r\n        e.stopPropagation();\r\n        this._isExpanded = !this._isExpanded;\r\n        setSVGIcon(this.expanderIcon, this.getExpanderIcon());\r\n        this.contenxtPanel.classList.toggle(style.hidden, !this._isExpanded);\r\n    };\r\n}\r\n\r\ncustomElements.define(\"chili-expander\", Expander);\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { SelectableItems } from \"chili-core\";\r\nimport { div, input, label } from \"./controls\";\r\nimport style from \"./radioGroup.module.css\";\r\n\r\nexport class RadioGroup extends HTMLElement {\r\n    constructor(\r\n        readonly header: string,\r\n        readonly context: SelectableItems<any>,\r\n    ) {\r\n        super();\r\n        this.appendChild(this.render());\r\n    }\r\n\r\n    render() {\r\n        return div(\r\n            { className: style.radioGroup },\r\n            ...this.context.items.flatMap((x, i) => [\r\n                input({\r\n                    type: \"radio\",\r\n                    value: x,\r\n                    checked: this.context.selectedItems.has(x),\r\n                    id: `radio-${i}`,\r\n                }),\r\n                label({\r\n                    htmlFor: `radio-${i}`,\r\n                    textContent: x,\r\n                }),\r\n            ]),\r\n        );\r\n    }\r\n\r\n    connectedCallback() {\r\n        this.addEventListener(\"click\", this._onClick);\r\n    }\r\n\r\n    disconnectedCallback() {\r\n        this.removeEventListener(\"click\", this._onClick);\r\n    }\r\n\r\n    private readonly _onClick = (e: MouseEvent) => {\r\n        const target = e.target as HTMLInputElement;\r\n        if (target?.type === \"radio\") {\r\n            this.querySelectorAll(\"input\").forEach((x) => (x.checked = x === target));\r\n            this.context.selectedItems = new Set([target.value]);\r\n        }\r\n    };\r\n}\r\n\r\ncustomElements.define(\"chili-radios\", RadioGroup);\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDisposable } from \"./disposable\";\r\n\r\nexport interface AsyncResult {\r\n    status: \"success\" | \"fail\" | \"cancel\";\r\n    message?: string;\r\n}\r\n\r\nexport class AsyncController implements IDisposable {\r\n    private readonly _failListeners = new Set<(state: AsyncResult) => void>();\r\n    private readonly _successListeners = new Set<(state: AsyncResult) => void>();\r\n    private _result: AsyncResult | undefined;\r\n\r\n    get result() {\r\n        return this._result;\r\n    }\r\n\r\n    readonly fail = (message?: string) => {\r\n        this.notifyListeners(this._failListeners, \"fail\", message);\r\n    };\r\n\r\n    readonly cancel = (message?: string) => {\r\n        this.notifyListeners(this._failListeners, \"cancel\", message);\r\n    };\r\n\r\n    readonly success = (message?: string) => {\r\n        this.notifyListeners(this._successListeners, \"success\", message);\r\n    };\r\n\r\n    private notifyListeners(\r\n        listeners: Set<(result: AsyncResult) => void>,\r\n        status: AsyncResult[\"status\"],\r\n        message?: string,\r\n    ) {\r\n        if (this._result === undefined) {\r\n            this._result = { status, message };\r\n            listeners.forEach((listener) => listener(this._result!));\r\n        }\r\n    }\r\n\r\n    onCancelled(listener: (result: AsyncResult) => void): void {\r\n        this._failListeners.add(listener);\r\n    }\r\n\r\n    onCompleted(listener: (result: AsyncResult) => void): void {\r\n        this._successListeners.add(listener);\r\n    }\r\n\r\n    dispose() {\r\n        this._failListeners.clear();\r\n        this._successListeners.clear();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter } from \"./converter\";\r\nimport { IPropertyChanged } from \"./observer\";\r\n\r\nconst registry = new FinalizationRegistry((binding: PathBinding<IPropertyChanged>) => {\r\n    binding.removeBinding();\r\n});\r\n\r\n/**\r\n * Bind the property chain as a path, separated by dots\r\n *\r\n * @example\r\n * ```ts\r\n * const binding = new PathBinding(source, \"a.b.c\");\r\n * binding.setBinding(element, \"property\");\r\n * ```\r\n */\r\nexport class PathBinding<T extends IPropertyChanged = IPropertyChanged> {\r\n    private _target?: { element: WeakRef<object>; property: PropertyKey };\r\n    private _oldPathObjects?: { source: IPropertyChanged; property: string }[];\r\n    private _actualSource?: { source: IPropertyChanged; property: string };\r\n\r\n    constructor(\r\n        readonly source: T,\r\n        readonly path: string,\r\n        public converter?: IConverter,\r\n    ) {}\r\n\r\n    setBinding<U extends object>(element: U, property: keyof U) {\r\n        if (this._target) throw new Error(\"Binding already set\");\r\n        this._target = { element: new WeakRef(element), property };\r\n        registry.register(element, this);\r\n        this.addPropertyChangedHandler();\r\n    }\r\n\r\n    removeBinding() {\r\n        const element = this._target?.element.deref();\r\n        if (element) registry.unregister(element);\r\n        this._target = undefined;\r\n        this.removePropertyChangedHandler();\r\n    }\r\n\r\n    private readonly handleAllPathPropertyChanged = (property: string, source: any) => {\r\n        if (this.shouldUpdateHandler(property, source)) {\r\n            this.removePropertyChangedHandler();\r\n            this.addPropertyChangedHandler();\r\n        }\r\n    };\r\n\r\n    private readonly handlePropertyChanged = (property: string, source: any) => {\r\n        if (this.path.endsWith(property) && this._target) {\r\n            this.setValue(source, property);\r\n        }\r\n    };\r\n\r\n    private shouldUpdateHandler(property: string, source: any) {\r\n        if (this._oldPathObjects === undefined) {\r\n            return true;\r\n        }\r\n\r\n        if (\r\n            this._oldPathObjects.some(\r\n                (element) => element.property === property && element.source === source,\r\n            )\r\n        ) {\r\n            return true;\r\n        }\r\n\r\n        if (!this._actualSource) {\r\n            return this.path.includes(property);\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private addPropertyChangedHandler() {\r\n        const props = this.path.split(\".\");\r\n        let source: any = this.source;\r\n        this._oldPathObjects = [];\r\n        for (let i = 0; i < props.length; i++) {\r\n            if (!source || !(props[i] in source)) break;\r\n\r\n            const sourceProperty = { source, property: props[i] };\r\n            if (i === props.length - 1) {\r\n                this.setValue(source, props[i]);\r\n                this._actualSource = sourceProperty;\r\n                source.onPropertyChanged(this.handlePropertyChanged);\r\n                break;\r\n            }\r\n\r\n            source.onPropertyChanged(this.handleAllPathPropertyChanged);\r\n            this._oldPathObjects.push(sourceProperty);\r\n            source = source[props[i]];\r\n        }\r\n    }\r\n\r\n    private removePropertyChangedHandler() {\r\n        if (!this._oldPathObjects) return;\r\n        this._oldPathObjects.forEach((element) =>\r\n            element.source.removePropertyChanged(this.handleAllPathPropertyChanged),\r\n        );\r\n        this._actualSource?.source.removePropertyChanged(this.handlePropertyChanged);\r\n        this._actualSource = undefined;\r\n        this._oldPathObjects = undefined;\r\n    }\r\n\r\n    private setValue(source: any, property: string) {\r\n        if (!this._target) return;\r\n        const element = this._target.element.deref();\r\n        if (!element) return;\r\n\r\n        const value = source[property];\r\n        if (this.converter) {\r\n            const converted = this.converter.convert(value);\r\n            if (converted.isOk) (element as any)[this._target.property] = converted.value;\r\n        } else {\r\n            (element as any)[this._target.property] = value;\r\n        }\r\n    }\r\n\r\n    getPropertyValue() {\r\n        return this._actualSource\r\n            ? (this._actualSource.source as any)[this._actualSource.property]\r\n            : undefined;\r\n    }\r\n}\r\n\r\nexport class Binding<T extends IPropertyChanged = IPropertyChanged> extends PathBinding<T> {\r\n    constructor(source: T, path: keyof T, converter?: IConverter) {\r\n        super(source, path.toString(), converter);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDisposable } from \"./disposable\";\r\n\r\nexport enum CollectionAction {\r\n    add,\r\n    remove,\r\n    move,\r\n    replace,\r\n}\r\n\r\nexport type CollectionChangedArgs =\r\n    | {\r\n          action: CollectionAction.add;\r\n          items: any[];\r\n      }\r\n    | {\r\n          action: CollectionAction.remove;\r\n          items: any[];\r\n      }\r\n    | {\r\n          action: CollectionAction.move;\r\n          from: number;\r\n          to: number;\r\n      }\r\n    | {\r\n          action: CollectionAction.replace;\r\n          index: number;\r\n          item: any;\r\n          items: any[];\r\n      };\r\n\r\nexport interface ICollectionChanged {\r\n    onCollectionChanged(callback: (args: CollectionChangedArgs) => void): void;\r\n    removeCollectionChanged(callback: (args: CollectionChangedArgs) => void): void;\r\n}\r\n\r\nexport class ObservableCollection<T> implements ICollectionChanged, IDisposable {\r\n    private readonly _callbacks = new Set<(args: CollectionChangedArgs) => void>();\r\n    private _items: T[];\r\n\r\n    constructor(...items: T[]) {\r\n        this._items = [...items];\r\n    }\r\n\r\n    push(...items: T[]) {\r\n        if (items.length === 0) return;\r\n        this._items.push(...items);\r\n        this.notifyChange({\r\n            action: CollectionAction.add,\r\n            items,\r\n        });\r\n    }\r\n\r\n    remove(...items: T[]) {\r\n        if (items.length === 0) return;\r\n        const itemSet = new Set(items);\r\n        this._items = this._items.filter((item) => !itemSet.has(item));\r\n        this.notifyChange({\r\n            action: CollectionAction.remove,\r\n            items,\r\n        });\r\n    }\r\n\r\n    move(from: number, to: number) {\r\n        if (!this.isValidMove(from, to)) return;\r\n\r\n        const items = this._items.splice(from, 1);\r\n        this._items.splice(from < to ? to - 1 : to, 0, ...items);\r\n        this.notifyChange({\r\n            action: CollectionAction.move,\r\n            from,\r\n            to,\r\n        });\r\n    }\r\n\r\n    private isValidMove(from: number, to: number): boolean {\r\n        return from !== to && from >= 0 && from < this._items.length && to >= 0 && to < this._items.length;\r\n    }\r\n\r\n    clear() {\r\n        if (this._items.length === 0) return;\r\n        const items = [...this._items];\r\n        this._items = [];\r\n        this.notifyChange({\r\n            action: CollectionAction.remove,\r\n            items,\r\n        });\r\n    }\r\n\r\n    get length() {\r\n        return this._items.length;\r\n    }\r\n\r\n    replace(index: number, ...items: T[]) {\r\n        if (!this.isValidIndex(index)) return;\r\n\r\n        const item = this._items[index];\r\n        this._items.splice(index, 1, ...items);\r\n        this.notifyChange({\r\n            action: CollectionAction.replace,\r\n            index,\r\n            item,\r\n            items,\r\n        });\r\n    }\r\n\r\n    private isValidIndex(index: number): boolean {\r\n        return index >= 0 && index < this._items.length;\r\n    }\r\n\r\n    private notifyChange(args: CollectionChangedArgs) {\r\n        this._callbacks.forEach((callback) => callback(args));\r\n    }\r\n\r\n    forEach(callback: (item: T, index: number) => void) {\r\n        this.items.forEach(callback);\r\n    }\r\n\r\n    map(callback: (item: T, index: number) => any) {\r\n        return this.items.map(callback);\r\n    }\r\n\r\n    get items() {\r\n        return [...this._items];\r\n    }\r\n\r\n    [Symbol.iterator]() {\r\n        return this.items[Symbol.iterator]();\r\n    }\r\n\r\n    item(index: number) {\r\n        return this._items[index];\r\n    }\r\n\r\n    at(index: number) {\r\n        return this._items.at(index);\r\n    }\r\n\r\n    filter(predicate: (value: T, index: number, array: T[]) => boolean) {\r\n        return this._items.filter(predicate);\r\n    }\r\n\r\n    find(predicate: (value: T, index: number, array: T[]) => boolean) {\r\n        return this._items.find(predicate);\r\n    }\r\n\r\n    indexOf(item: T, fromIndex?: number) {\r\n        return this._items.indexOf(item, fromIndex);\r\n    }\r\n\r\n    contains(item: T) {\r\n        return this._items.indexOf(item) !== -1;\r\n    }\r\n\r\n    get count() {\r\n        return this._items.length;\r\n    }\r\n\r\n    onCollectionChanged(callback: (args: CollectionChangedArgs) => void): void {\r\n        this._callbacks.add(callback);\r\n    }\r\n\r\n    removeCollectionChanged(callback: (args: CollectionChangedArgs) => void): void {\r\n        this._callbacks.delete(callback);\r\n    }\r\n\r\n    dispose() {\r\n        this._callbacks.clear();\r\n        this._items.length = 0;\r\n    }\r\n}\r\n\r\nexport enum SelectMode {\r\n    check,\r\n    radio,\r\n    combo,\r\n}\r\n\r\nexport class SelectableItems<T> {\r\n    readonly items: ReadonlyArray<T>;\r\n    selectedItems: Set<T>;\r\n\r\n    get selectedIndexes(): number[] {\r\n        let indexes: number[] = [];\r\n        this.selectedItems.forEach((x) => {\r\n            let index = this.items.indexOf(x);\r\n            if (index > -1) {\r\n                indexes.push(index);\r\n            }\r\n        });\r\n        return indexes;\r\n    }\r\n\r\n    firstSelectedItem() {\r\n        return this.selectedItems.values().next().value;\r\n    }\r\n\r\n    constructor(\r\n        items: T[],\r\n        readonly mode: SelectMode = SelectMode.radio,\r\n        selectedItems?: T[],\r\n    ) {\r\n        this.items = items;\r\n        this.selectedItems = new Set(selectedItems ?? []);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { INode, INodeLinkedList } from \"../model\";\r\nimport { IDisposable } from \"./disposable\";\r\n\r\nexport interface IHistoryRecord extends IDisposable {\r\n    readonly name: string;\r\n    undo(): void;\r\n    redo(): void;\r\n}\r\n\r\nexport class History implements IDisposable {\r\n    private readonly _undos: IHistoryRecord[] = [];\r\n    private readonly _redos: IHistoryRecord[] = [];\r\n\r\n    disabled = false;\r\n    undoLimits = 50;\r\n\r\n    dispose(): void {\r\n        this._redos.forEach((record) => record.dispose());\r\n        this._undos.forEach((record) => record.dispose());\r\n        this.clear();\r\n    }\r\n\r\n    private clear(): void {\r\n        this._undos.length = 0;\r\n        this._redos.length = 0;\r\n    }\r\n\r\n    add(record: IHistoryRecord) {\r\n        if (this.disabled) return;\r\n\r\n        this._redos.length = 0;\r\n        this._undos.push(record);\r\n\r\n        if (this._undos.length > this.undoLimits) {\r\n            const removed = this._undos.shift();\r\n            removed?.dispose();\r\n        }\r\n    }\r\n\r\n    undoCount() {\r\n        return this._undos.length;\r\n    }\r\n\r\n    redoCount() {\r\n        return this._redos.length;\r\n    }\r\n\r\n    undo() {\r\n        this.tryOperate(() => {\r\n            const record = this._undos.pop();\r\n            if (!record) return;\r\n\r\n            record.undo();\r\n            this._redos.push(record);\r\n        });\r\n    }\r\n\r\n    redo() {\r\n        this.tryOperate(() => {\r\n            const record = this._redos.pop();\r\n            if (!record) return;\r\n\r\n            record.redo();\r\n            this._undos.push(record);\r\n        });\r\n    }\r\n\r\n    private tryOperate(action: () => void) {\r\n        const previousState = this.disabled;\r\n        this.disabled = true;\r\n        try {\r\n            action();\r\n        } finally {\r\n            this.disabled = previousState;\r\n        }\r\n    }\r\n}\r\n\r\nexport class PropertyHistoryRecord implements IHistoryRecord {\r\n    readonly name: string;\r\n    constructor(\r\n        readonly object: any,\r\n        readonly property: string | symbol | number,\r\n        readonly oldValue: any,\r\n        readonly newValue: any,\r\n    ) {\r\n        this.name = `change ${String(property)} property`;\r\n    }\r\n\r\n    dispose(): void {}\r\n\r\n    undo(): void {\r\n        this.object[this.property] = this.oldValue;\r\n    }\r\n\r\n    redo(): void {\r\n        this.object[this.property] = this.newValue;\r\n    }\r\n}\r\n\r\nexport enum NodeAction {\r\n    add,\r\n    remove,\r\n    move,\r\n    transfer,\r\n    insertAfter,\r\n    insertBefore,\r\n}\r\n\r\nexport interface NodeRecord {\r\n    node: INode;\r\n    action: NodeAction;\r\n    oldParent?: INodeLinkedList;\r\n    oldPrevious?: INode;\r\n    newParent?: INodeLinkedList;\r\n    newPrevious?: INode;\r\n}\r\n\r\nexport interface INodeChangedObserver {\r\n    handleNodeChanged(records: NodeRecord[]): void;\r\n}\r\n\r\nexport class NodeLinkedListHistoryRecord implements IHistoryRecord {\r\n    readonly name: string;\r\n\r\n    constructor(readonly records: NodeRecord[]) {\r\n        this.name = \"change node\";\r\n    }\r\n\r\n    dispose(): void {\r\n        this.records.forEach((record) => {\r\n            if (record.action === NodeAction.remove) {\r\n                record.node.dispose();\r\n            }\r\n        });\r\n        this.records.length = 0;\r\n    }\r\n\r\n    private handleUndo(record: NodeRecord): void {\r\n        switch (record.action) {\r\n            case NodeAction.add:\r\n                record.newParent?.remove(record.node);\r\n                break;\r\n            case NodeAction.remove:\r\n                record.oldParent?.add(record.node);\r\n                break;\r\n            case NodeAction.transfer:\r\n                record.oldParent?.add(record.node);\r\n                break;\r\n            case NodeAction.move:\r\n                record.newParent?.move(record.node, record.oldParent!, record.oldPrevious);\r\n                break;\r\n            case NodeAction.insertAfter:\r\n                record.newParent?.remove(record.node);\r\n                break;\r\n            case NodeAction.insertBefore:\r\n                record.newParent?.remove(record.node);\r\n                break;\r\n        }\r\n    }\r\n\r\n    private handleRedo(record: NodeRecord): void {\r\n        switch (record.action) {\r\n            case NodeAction.add:\r\n                record.newParent?.add(record.node);\r\n                break;\r\n            case NodeAction.remove:\r\n                record.oldParent?.remove(record.node);\r\n                break;\r\n            case NodeAction.transfer:\r\n                record.oldParent?.transfer(record.node);\r\n                break;\r\n            case NodeAction.move:\r\n                record.oldParent?.move(record.node, record.newParent!, record.newPrevious);\r\n                break;\r\n            case NodeAction.insertAfter:\r\n                record.newParent?.insertAfter(record.newPrevious, record.node);\r\n                break;\r\n            case NodeAction.insertBefore:\r\n                record.newParent?.insertBefore(record.newPrevious?.nextSibling, record.node);\r\n                break;\r\n        }\r\n    }\r\n\r\n    undo(): void {\r\n        for (let i = this.records.length - 1; i >= 0; i--) {\r\n            this.handleUndo(this.records[i]);\r\n        }\r\n    }\r\n\r\n    redo(): void {\r\n        this.records.forEach((record) => this.handleRedo(record));\r\n    }\r\n}\r\n\r\nexport class ArrayRecord implements IHistoryRecord {\r\n    readonly records: Array<IHistoryRecord> = [];\r\n\r\n    constructor(readonly name: string) {}\r\n\r\n    dispose(): void {\r\n        this.records.forEach((r) => r.dispose());\r\n    }\r\n\r\n    undo() {\r\n        for (let index = this.records.length - 1; index >= 0; index--) {\r\n            this.records[index].undo();\r\n        }\r\n    }\r\n\r\n    redo() {\r\n        for (const record of this.records) {\r\n            record.redo();\r\n        }\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nconst classNameToClass = new Map<string, new (...args: any[]) => any>();\r\n\r\nexport namespace ClassMap {\r\n    export function save(className: string, ctor: new (...args: any[]) => any) {\r\n        if (classNameToClass.has(className)) throw new Error(`Class ${className} already registered`);\r\n        classNameToClass.set(className, ctor);\r\n    }\r\n\r\n    export function getClass(className: string): new (...args: any[]) => any {\r\n        const cls = classNameToClass.get(className);\r\n        if (cls) return cls;\r\n        throw new Error(`Type ${className} is not find, please add the @Serializer.register decorator.`);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { ClassMap } from \"./classMap\";\r\n\r\nexport interface ISerialize {\r\n    serialize(): Serialized;\r\n}\r\n\r\nexport type Serialized = {\r\n    classKey: string;\r\n    properties: SerializedProperties<any>;\r\n};\r\n\r\nexport type SerializedProperties<T> = {\r\n    [P in keyof T]?: any;\r\n};\r\n\r\ninterface RefelectData {\r\n    ctor: new (...args: any[]) => any;\r\n    ctorParamNames: string[];\r\n    serialize?: (target: any) => SerializedProperties<any>;\r\n    deserialize?: (...args: any[]) => any;\r\n}\r\n\r\nexport function serializeTypeArray(TypeArray: new (array: number[]) => Float32Array | Uint32Array): RefelectData {\r\n    return {\r\n        ctor: TypeArray,\r\n        ctorParamNames: [\"buffer\"],\r\n        serialize: (target: Float16Array | Uint32Array) => {\r\n            return {\r\n                buffer: Array.from(target),\r\n            };\r\n        },\r\n        deserialize: (buffer) => {\r\n            return new TypeArray(buffer);\r\n        },\r\n    }\r\n}\r\n\r\nconst propertiesMap = new Map<new (...args: any[]) => any, Set<string>>();\r\nconst reflectMap = new Map<string, RefelectData>();\r\nreflectMap.set(\"Float32Array\", serializeTypeArray(Float32Array));\r\nreflectMap.set(\"Uint32Array\", serializeTypeArray(Uint32Array));\r\n\r\nexport namespace Serializer {\r\n    export function serialze() {\r\n        return (target: any, property: string) => {\r\n            let keys = propertiesMap.get(target);\r\n            if (keys === undefined) {\r\n                keys = new Set();\r\n                propertiesMap.set(target, keys);\r\n            }\r\n            keys.add(property);\r\n        };\r\n    }\r\n\r\n    export function register<T>(\r\n        ctorParamNames: (keyof T & string)[],\r\n        deserialize?: (...args: any[]) => T,\r\n        serialize?: (target: T) => SerializedProperties<T>,\r\n    ) {\r\n        return (target: new (...args: any[]) => T) => {\r\n            ClassMap.save(target.name, target);\r\n            reflectMap.set(target.name, {\r\n                ctor: target,\r\n                ctorParamNames,\r\n                serialize,\r\n                deserialize,\r\n            });\r\n        };\r\n    }\r\n}\r\n\r\nexport namespace Serializer {\r\n    /**\r\n     * Deserialize an object\r\n     *\r\n     * @param document Document that contains the object.\r\n     * @param data Serialize the data. If the serialized data does not contain\r\n     * the parameters required by the deserialization function, these parameters\r\n     * should be added to the serialized data, for example:\r\n     * ```\r\n     * data.properties[“parent”] = node.\r\n     * ```\r\n     * @returns Deserialized object\r\n     */\r\n    export function deserializeObject(document: IDocument, data: Serialized) {\r\n        let instance = deserializeInstance(document, data.classKey, data.properties);\r\n        deserializeProperties(document, instance, data);\r\n        return instance;\r\n    }\r\n\r\n    function deserializeInstance(\r\n        document: IDocument,\r\n        className: string,\r\n        properties: SerializedProperties<any>,\r\n    ) {\r\n        if (!reflectMap.has(className)) {\r\n            throw new Error(\r\n                `${className} cannot be deserialize. Did you forget to add the decorator @Serializer.register?`,\r\n            );\r\n        }\r\n\r\n        const { ctor, ctorParamNames, deserialize } = reflectMap.get(className)!;\r\n        const parameters = deserilizeParameters(document, ctorParamNames, properties, className);\r\n        if (deserialize) {\r\n            return deserialize(...ctorParamNames.map((x) => parameters[x]));\r\n        }\r\n        return new ctor(...ctorParamNames.map((x) => parameters[x]));\r\n    }\r\n\r\n    function deserilizeParameters(\r\n        document: IDocument,\r\n        ctorParamNames: any[],\r\n        properties: SerializedProperties<any>,\r\n        className: string,\r\n    ) {\r\n        const parameters: SerializedProperties<any> = {};\r\n        parameters[\"document\"] = document;\r\n        for (const key of ctorParamNames) {\r\n            if (key in properties) {\r\n                if (properties[key] !== undefined)\r\n                    parameters[key] = deserialValue(document, properties[key]);\r\n            } else if (key !== \"document\") {\r\n                parameters[key] = undefined;\r\n                console.warn(`${className} constructor parameter ${key} is missing`);\r\n            }\r\n        }\r\n        return parameters;\r\n    }\r\n\r\n    function deserialValue(document: IDocument, value: any) {\r\n        if (value === undefined) {\r\n            return undefined;\r\n        }\r\n        if (Array.isArray(value)) {\r\n            return value.map((v) => {\r\n                return typeof v === \"object\" ? deserializeObject(document, v) : v;\r\n            });\r\n        }\r\n        return (value as Serialized).classKey ? deserializeObject(document, value) : value;\r\n    }\r\n\r\n    function deserializeProperties(\r\n        document: IDocument,\r\n        instance: any,\r\n        data: Serialized,\r\n        ignores?: string[],\r\n    ) {\r\n        let { ctorParamNames } = reflectMap.get(data.classKey)!;\r\n        const filter = (key: string) => {\r\n            return !ctorParamNames.includes(key) && !ignores?.includes(key);\r\n        };\r\n        let keys = Object.keys(data.properties).filter(filter);\r\n        for (const key of keys) {\r\n            instance[key] = deserialValue(document, data.properties[key]);\r\n        }\r\n    }\r\n}\r\n\r\nexport namespace Serializer {\r\n    export function serializeObject(target: Object) {\r\n        let classKey = target.constructor.name;\r\n        if (!reflectMap.has(classKey)) {\r\n            console.log(target);\r\n\r\n            throw new Error(\r\n                `Type ${target.constructor.name} is not registered, please add the @Serializer.register decorator.`,\r\n            );\r\n        }\r\n        let data = reflectMap.get(classKey)!;\r\n        let properties = data.serialize?.(target) ?? serializeProperties(target);\r\n        return {\r\n            classKey,\r\n            properties,\r\n        };\r\n    }\r\n\r\n    export function serializeProperties(target: Object) {\r\n        let data: SerializedProperties<any> = {};\r\n        let keys = getAllKeysOfPrototypeChain(target, propertiesMap);\r\n        for (const key of keys) {\r\n            let value = (target as any)[key];\r\n            if (Array.isArray(value)) {\r\n                data[key] = value.map((v) => serializePropertyValue(v));\r\n            } else {\r\n                data[key] = serializePropertyValue(value);\r\n            }\r\n        }\r\n        return data;\r\n    }\r\n\r\n    function serializePropertyValue(value: any) {\r\n        let type = typeof value;\r\n        if (type === \"object\") {\r\n            return serializeObject(value);\r\n        }\r\n        if (type !== \"function\" && type !== \"symbol\") {\r\n            return value;\r\n        }\r\n        throw new Error(`Unsupported serialized object: ${value}`);\r\n    }\r\n\r\n    function getAllKeysOfPrototypeChain(target: Object, map: Map<new (...args: any[]) => any, Set<string>>) {\r\n        let keys: string[] = [];\r\n        let prototype = Object.getPrototypeOf(target);\r\n        while (prototype !== null) {\r\n            let k = map.get(prototype);\r\n            if (k) keys.push(...k.values());\r\n            prototype = Object.getPrototypeOf(prototype); // prototype chain\r\n        }\r\n        return new Set(keys);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum MessageType {\r\n    info,\r\n    warn,\r\n    error,\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport namespace Precision {\r\n    export const Distance = 1e-7;\r\n    export const Angle = 1e-3;\r\n    export const Float = 1e-7;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Binding } from \"../foundation\";\r\nimport { ICommand } from \"./command\";\r\nimport { CommandKeys } from \"./commandKeys\";\r\n\r\nconst commandRegistry = new Map<string, CommandConstructor>();\r\n\r\nexport type CommandConstructor = new (...args: any[]) => ICommand;\r\n\r\nexport interface CommandData {\r\n    key: CommandKeys;\r\n    icon: string;\r\n    toggle?: Binding;\r\n    helpText?: string;\r\n    helpUrl?: string;\r\n}\r\n\r\nexport function command<T extends CommandConstructor>(metadata: CommandData) {\r\n    return (constructor: T) => {\r\n        commandRegistry.set(metadata.key, constructor);\r\n        constructor.prototype.data = metadata;\r\n    };\r\n}\r\n\r\nexport namespace Command {\r\n    export function getData(target: string | ICommand | CommandConstructor): CommandData | undefined {\r\n        if (typeof target === \"string\") {\r\n            const constructor = commandRegistry.get(target);\r\n            return constructor?.prototype.data;\r\n        }\r\n\r\n        const prototype = typeof target === \"function\" ? target.prototype : Object.getPrototypeOf(target);\r\n\r\n        return prototype.data;\r\n    }\r\n\r\n    export function get(name: CommandKeys): CommandConstructor | undefined {\r\n        return commandRegistry.get(name);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum ObjectSnapType {\r\n    none = 0,\r\n    endPoint = 1,\r\n    midPoint = 1 << 1,\r\n    center = 1 << 2,\r\n    angle = 1 << 3,\r\n    intersection = 1 << 4,\r\n    perpendicular = 1 << 5,\r\n    extension = 1 << 6,\r\n    parallel = 1 << 7,\r\n    special = 1 << 8,\r\n    nearest = 1 << 9,\r\n    vertex = 1 << 10,\r\n    grid = 1 << 11,\r\n}\r\n\r\nexport namespace ObjectSnapType {\r\n    export function has(snapTypes: ObjectSnapType, targetType: ObjectSnapType) {\r\n        return (snapTypes & targetType) === targetType;\r\n    }\r\n\r\n    export function add(snapTypes: ObjectSnapType, targetType: ObjectSnapType) {\r\n        return snapTypes | targetType;\r\n    }\r\n\r\n    export function remove(snapTypes: ObjectSnapType, targetType: ObjectSnapType) {\r\n        return snapTypes & ~targetType;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Ray, XYZ } from \"../math\";\r\nimport { IGeometry } from \"./geometry\";\r\nimport { IEdge } from \"./shape\";\r\n\r\nexport enum CurveType {\r\n    Line,\r\n    Circle,\r\n    Ellipse,\r\n    Hyperbola,\r\n    Parabola,\r\n    BezierCurve,\r\n    BSplineCurve,\r\n    OffsetCurve,\r\n    OtherCurve,\r\n    TrimmedCurve,\r\n}\r\n\r\nexport enum Continuity {\r\n    C0,\r\n    G1,\r\n    C1,\r\n    G2,\r\n    C2,\r\n    C3,\r\n    CN,\r\n}\r\n\r\nexport interface ICurve extends IGeometry {\r\n    get curveType(): CurveType;\r\n    uniformAbscissaByLength(length: number): XYZ[];\r\n    uniformAbscissaByCount(curveCount: number): XYZ[];\r\n    length(): number;\r\n    parameter(point: XYZ, tolerance: number): number | undefined;\r\n    firstParameter(): number;\r\n    lastParameter(): number;\r\n    project(point: XYZ): XYZ[];\r\n    value(parameter: number): XYZ;\r\n    isCN(n: number): boolean;\r\n    trim(u1: number, u2: number): ITrimmedCurve;\r\n    d0(u: number): XYZ;\r\n    d1(u: number): { point: XYZ; vec: XYZ };\r\n    d2(u: number): { point: XYZ; vec1: XYZ; vec2: XYZ };\r\n    d3(u: number): { point: XYZ; vec1: XYZ; vec2: XYZ; vec3: XYZ };\r\n    dn(u: number, n: number): XYZ;\r\n    reverse(): void;\r\n    reversed(): ICurve;\r\n    nearestFromPoint(point: XYZ): {\r\n        point: XYZ;\r\n        parameter: number;\r\n        distance: number;\r\n    };\r\n    nearestExtrema(curve: ICurve | Ray):\r\n        | undefined\r\n        | {\r\n              isParallel: boolean;\r\n              distance: number;\r\n              p1: XYZ;\r\n              p2: XYZ;\r\n              u1: number;\r\n              u2: number;\r\n          };\r\n    isClosed(): boolean;\r\n    period(): number;\r\n    isPeriodic(): boolean;\r\n    continutity(): Continuity;\r\n    makeEdge(): IEdge;\r\n}\r\n\r\nexport interface ILine extends ICurve {\r\n    direction: XYZ;\r\n}\r\n\r\nexport interface IConic extends ICurve {\r\n    axis: XYZ;\r\n    xAxis: XYZ;\r\n    yAxis: XYZ;\r\n    eccentricity(): number;\r\n}\r\n\r\nexport interface ICircle extends IConic {\r\n    center: XYZ;\r\n    radius: number;\r\n}\r\n\r\nexport interface IEllipse extends IConic {\r\n    center: XYZ;\r\n    get focus1(): XYZ;\r\n    get focus2(): XYZ;\r\n    majorRadius: number;\r\n    minorRadius: number;\r\n}\r\n\r\nexport interface IHyperbola extends IConic {\r\n    focal(): number;\r\n    location: XYZ;\r\n    get focus1(): XYZ;\r\n    get focus2(): XYZ;\r\n    majorRadius: number;\r\n    minorRadius: number;\r\n}\r\n\r\nexport interface IParabola extends IConic {\r\n    focal(): number;\r\n    get focus(): XYZ;\r\n    get directrix(): XYZ;\r\n}\r\n\r\nexport interface IBoundedCurve extends ICurve {\r\n    startPoint(): XYZ;\r\n    endPoint(): XYZ;\r\n}\r\n\r\nexport interface IBezierCurve extends IBoundedCurve {\r\n    degree(): number;\r\n    weight(index: number): number;\r\n    insertPoleAfter(index: number, point: XYZ, weight?: number): void;\r\n    insertPoleBefore(index: number, point: XYZ, weight?: number): void;\r\n    removePole(index: number): void;\r\n    setPole(index: number, point: XYZ, weight?: number): void;\r\n    setWeight(index: number, weight: number): void;\r\n    nbPoles(): number;\r\n    pole(index: number): XYZ;\r\n    poles(): XYZ[];\r\n}\r\n\r\nexport interface IBSplineCurve extends IBoundedCurve {\r\n    degree(): number;\r\n    nbKnots(): number;\r\n    knot(index: number): number;\r\n    setKnot(index: number, value: number): void;\r\n    nbPoles(): number;\r\n    pole(index: number): XYZ;\r\n    poles(): XYZ[];\r\n    weight(index: number): number;\r\n    setWeight(index: number, value: number): void;\r\n}\r\n\r\nexport interface ITrimmedCurve extends IBoundedCurve {\r\n    get basisCurve(): ICurve;\r\n    setTrim(u1: number, u2: number): void;\r\n}\r\n\r\nexport interface IOffsetCurve extends ICurve {\r\n    get basisCurve(): ICurve;\r\n    offset(): number;\r\n    direction(): XYZ;\r\n}\r\n\r\nexport interface IComplexCurve {\r\n    nbCurves(): number;\r\n    curve(index: number): ICurve;\r\n}\r\n\r\nexport namespace ICurve {\r\n    export function isConic(curve: ICurve): curve is IConic {\r\n        return (curve as IConic).axis !== undefined;\r\n    }\r\n\r\n    export function isCircle(curve: ICurve): curve is ICircle {\r\n        let circle = curve as ICircle;\r\n        return circle.center !== undefined && circle.radius !== undefined;\r\n    }\r\n\r\n    export function isLine(curve: ICurve): curve is ILine {\r\n        return (curve as ILine).direction !== undefined;\r\n    }\r\n\r\n    export function isTrimmed(curve: ICurve): curve is ITrimmedCurve {\r\n        return (curve as ITrimmedCurve).basisCurve !== undefined;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDisposable } from \"../foundation\";\r\nimport { Matrix4 } from \"../math\";\r\n\r\nexport enum GeometryType {\r\n    Curve,\r\n    Surface,\r\n}\r\n\r\nexport interface IGeometry extends IDisposable {\r\n    get geometryType(): GeometryType;\r\n    transform(matrix: Matrix4): void;\r\n    transformed(matrix: Matrix4): IGeometry;\r\n    copy(): IGeometry;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum LineType {\r\n    Solid,\r\n    Dash,\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { VisualConfig } from \"../config\";\r\nimport { Matrix4, XYZ } from \"../math\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { LineType } from \"./lineType\";\r\nimport { ISubShape } from \"./shape\";\r\n\r\n@Serializer.register([\"start\", \"count\", \"materialIndex\"])\r\nexport class MeshGroup {\r\n    @Serializer.serialze()\r\n    start: number;\r\n    @Serializer.serialze()\r\n    count: number;\r\n    @Serializer.serialze()\r\n    materialIndex: number;\r\n\r\n    constructor(start: number, count: number, materialIndex: number) {\r\n        this.start = start;\r\n        this.count = count;\r\n        this.materialIndex = materialIndex;\r\n    }\r\n}\r\n\r\nexport type MeshType = \"surface\" | \"linesegments\";\r\n\r\n@Serializer.register([])\r\nexport class Mesh {\r\n    static createSurface(positionSize: number, indexSize: number) {\r\n        let mesh = new Mesh();\r\n        mesh.meshType = \"surface\";\r\n        mesh.normal = new Float32Array(positionSize * 3);\r\n        mesh.uv = new Float32Array(positionSize * 2);\r\n        mesh.position = new Float32Array(positionSize * 3);\r\n        mesh.index = new Uint32Array(indexSize);\r\n        return mesh;\r\n    }\r\n\r\n    static createLineSegments(size: number) {\r\n        let mesh = new Mesh();\r\n        mesh.meshType = \"linesegments\";\r\n        mesh.position = new Float32Array(size * 3);\r\n        return mesh;\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    meshType: MeshType = \"linesegments\";\r\n\r\n    @Serializer.serialze()\r\n    position: Float32Array | undefined;\r\n\r\n    @Serializer.serialze()\r\n    normal: Float32Array | undefined = undefined;\r\n\r\n    @Serializer.serialze()\r\n    index: Uint32Array | undefined = undefined;\r\n\r\n    @Serializer.serialze()\r\n    color: number | number[] = 0xfff;\r\n\r\n    @Serializer.serialze()\r\n    uv: Float32Array | undefined = undefined;\r\n\r\n    @Serializer.serialze()\r\n    groups: MeshGroup[] = [];\r\n}\r\n\r\nexport interface IShapeMeshData {\r\n    edges: EdgeMeshData | undefined;\r\n    faces: FaceMeshData | undefined;\r\n}\r\n\r\nexport interface ShapeMeshRange {\r\n    start: number;\r\n    count: number;\r\n    shape: ISubShape;\r\n    transform?: Matrix4;\r\n}\r\n\r\nexport interface ShapeMeshData {\r\n    position: Float32Array;\r\n    range: ShapeMeshRange[];\r\n    color?: number | number[];\r\n}\r\n\r\nexport namespace ShapeMeshData {\r\n    export function isVertex(data: ShapeMeshData): data is VertexMeshData {\r\n        return (data as VertexMeshData)?.size !== undefined;\r\n    }\r\n\r\n    export function isEdge(data: ShapeMeshData): data is EdgeMeshData {\r\n        return (data as EdgeMeshData)?.lineType !== undefined;\r\n    }\r\n\r\n    export function isFace(data: ShapeMeshData): data is FaceMeshData {\r\n        return (data as FaceMeshData)?.index !== undefined;\r\n    }\r\n}\r\n\r\nexport interface VertexMeshData extends ShapeMeshData {\r\n    size: number;\r\n}\r\n\r\nexport namespace VertexMeshData {\r\n    export function from(point: XYZ, size: number, color: number): VertexMeshData {\r\n        return {\r\n            position: new Float32Array([point.x, point.y, point.z]),\r\n            range: [],\r\n            color,\r\n            size,\r\n        };\r\n    }\r\n}\r\n\r\nexport interface EdgeMeshData extends ShapeMeshData {\r\n    lineType: LineType;\r\n    lineWidth?: number;\r\n}\r\n\r\nexport function concatTypedArrays<T extends Float32Array | Uint32Array>(arrays: T[]): T {\r\n    const totalLength = arrays.reduce((acc, arr) => acc + arr.length, 0);\r\n    const result = new (arrays[0].constructor as new (length: number) => T)(totalLength);\r\n    let offset = 0;\r\n    for (const arr of arrays) {\r\n        result.set(arr, offset);\r\n        offset += arr.length;\r\n    }\r\n    return result;\r\n}\r\n\r\nexport namespace EdgeMeshData {\r\n    export function from(start: XYZ, end: XYZ, color: number, lineType: LineType): EdgeMeshData {\r\n        return {\r\n            position: new Float32Array([start.x, start.y, start.z, end.x, end.y, end.z]),\r\n            color,\r\n            lineType,\r\n            range: [],\r\n        };\r\n    }\r\n\r\n    export function merge(data: EdgeMeshData, other: EdgeMeshData): EdgeMeshData {\r\n        const otherRange = other.range.map((range) => {\r\n            return {\r\n                start: range.start + data.position.length / 3,\r\n                count: range.count,\r\n                shape: range.shape,\r\n                transform: range.transform,\r\n            };\r\n        });\r\n        return {\r\n            position: concatTypedArrays([data.position, other.position]),\r\n            range: data.range.concat(otherRange),\r\n            color: data.color,\r\n            lineType: data.lineType,\r\n            lineWidth: data.lineWidth,\r\n        };\r\n    }\r\n}\r\n\r\nexport interface FaceMeshData extends ShapeMeshData {\r\n    index: Uint32Array;\r\n    normal: Float32Array;\r\n    uv: Float32Array;\r\n    groups: MeshGroup[];\r\n}\r\n\r\nexport namespace FaceMeshData {\r\n    export function merge(data: FaceMeshData, other: FaceMeshData): FaceMeshData {\r\n        const otherRange = other.range.map((range) => {\r\n            return {\r\n                start: range.start + data.position.length / 3,\r\n                count: range.count,\r\n                shape: range.shape,\r\n                transform: range.transform,\r\n            };\r\n        });\r\n        const groups = other.groups.map((group) => {\r\n            return {\r\n                start: group.start + data.index.length,\r\n                count: group.count,\r\n                materialIndex: group.materialIndex,\r\n            };\r\n        });\r\n        return {\r\n            position: concatTypedArrays([data.position, other.position]),\r\n            range: data.range.concat(otherRange),\r\n            index: concatTypedArrays([data.index, other.index]),\r\n            normal: concatTypedArrays([data.normal, other.normal]),\r\n            uv: concatTypedArrays([data.uv, other.uv]),\r\n            color: data.color,\r\n            groups,\r\n        };\r\n    }\r\n}\r\n\r\nexport abstract class MeshDataBuilder<T extends ShapeMeshData> {\r\n    protected readonly _positions: number[] = [];\r\n    protected readonly _groups: ShapeMeshRange[] = [];\r\n    protected _color: number | undefined;\r\n    protected _vertexColor: number[] | undefined;\r\n\r\n    setColor(color: number) {\r\n        this._color = color;\r\n    }\r\n\r\n    addColor(r: number, g: number, b: number) {\r\n        this._vertexColor ??= [];\r\n        this._vertexColor.push(r, g, b);\r\n        return this;\r\n    }\r\n\r\n    protected getColor() {\r\n        let color: number | number[] | undefined = this._vertexColor;\r\n        if (this._vertexColor?.length !== this._positions.length) {\r\n            color = this._color;\r\n        }\r\n        return color;\r\n    }\r\n\r\n    abstract newGroup(): this;\r\n\r\n    abstract endGroup(shape: ISubShape): this;\r\n\r\n    abstract addPosition(x: number, y: number, z: number): this;\r\n\r\n    abstract build(): T;\r\n}\r\n\r\n/**\r\n * LineSegments\r\n */\r\nexport class EdgeMeshDataBuilder extends MeshDataBuilder<EdgeMeshData> {\r\n    protected _positionStart: number = 0;\r\n    private _previousVertex: [number, number, number] | undefined = undefined;\r\n    private _lineType: LineType = LineType.Solid;\r\n\r\n    constructor() {\r\n        super();\r\n        this._color = VisualConfig.defaultEdgeColor;\r\n    }\r\n\r\n    setType(type: LineType) {\r\n        this._lineType = type;\r\n    }\r\n\r\n    override newGroup() {\r\n        this._positionStart = this._positions.length;\r\n        this._previousVertex = undefined;\r\n        return this;\r\n    }\r\n\r\n    override endGroup(shape: ISubShape) {\r\n        this._groups.push({\r\n            start: this._positionStart / 3,\r\n            count: (this._positions.length - this._positionStart) / 3,\r\n            shape,\r\n        });\r\n        return this;\r\n    }\r\n\r\n    override addPosition(x: number, y: number, z: number) {\r\n        if (this._previousVertex) {\r\n            this._positions.push(...this._previousVertex, x, y, z);\r\n        }\r\n        this._previousVertex = [x, y, z];\r\n        return this;\r\n    }\r\n\r\n    override build(): EdgeMeshData {\r\n        let color = this.getColor()!;\r\n        return {\r\n            position: new Float32Array(this._positions),\r\n            range: this._groups,\r\n            lineType: this._lineType,\r\n            color,\r\n        };\r\n    }\r\n}\r\n\r\nexport class FaceMeshDataBuilder extends MeshDataBuilder<FaceMeshData> {\r\n    private _indexStart: number = 0;\r\n    private _groupStart: number = 0;\r\n    private readonly _normals: number[] = [];\r\n    private readonly _uvs: number[] = [];\r\n    private readonly _indices: number[] = [];\r\n\r\n    constructor() {\r\n        super();\r\n        this._color = VisualConfig.defaultFaceColor;\r\n    }\r\n\r\n    override newGroup() {\r\n        this._groupStart = this._indices.length;\r\n        this._indexStart = this._positions.length / 3;\r\n        return this;\r\n    }\r\n\r\n    override endGroup(shape: ISubShape) {\r\n        this._groups.push({\r\n            start: this._groupStart,\r\n            count: this._indices.length - this._groupStart,\r\n            shape,\r\n        });\r\n        return this;\r\n    }\r\n\r\n    override addPosition(x: number, y: number, z: number) {\r\n        this._positions.push(x, y, z);\r\n        return this;\r\n    }\r\n\r\n    addNormal(x: number, y: number, z: number) {\r\n        this._normals.push(x, y, z);\r\n        return this;\r\n    }\r\n\r\n    addUV(u: number, v: number) {\r\n        this._uvs.push(u, v);\r\n        return this;\r\n    }\r\n\r\n    addIndices(i1: number, i2: number, i3: number) {\r\n        this._indices.push(this._indexStart + i1, this._indexStart + i2, this._indexStart + i3);\r\n        return this;\r\n    }\r\n\r\n    build(): FaceMeshData {\r\n        return {\r\n            position: new Float32Array(this._positions),\r\n            color: this.getColor()!,\r\n            normal: new Float32Array(this._normals),\r\n            index: new Uint32Array(this._indices),\r\n            uv: new Float32Array(this._uvs),\r\n            range: this._groups,\r\n            groups: [],\r\n        };\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDisposable, Result } from \"../foundation\";\r\nimport { Matrix4, Plane, Ray, XYZ } from \"../math\";\r\nimport { ICurve, ITrimmedCurve } from \"./curve\";\r\nimport { EdgeMeshData, IShapeMeshData } from \"./meshData\";\r\nimport { ShapeType } from \"./shapeType\";\r\nimport { ISurface } from \"./surface\";\r\n\r\nexport enum Orientation {\r\n    FORWARD,\r\n    REVERSED,\r\n    INTERNAL,\r\n    EXTERNAL,\r\n}\r\n\r\nexport interface IShape extends IDisposable {\r\n    readonly shapeType: ShapeType;\r\n    get id(): string;\r\n    get mesh(): IShapeMeshData;\r\n    transformed(matrix: Matrix4): IShape;\r\n    transformedMul(matrix: Matrix4): IShape;\r\n    edgesMeshPosition(): EdgeMeshData;\r\n    matrix: Matrix4;\r\n    isClosed(): boolean;\r\n    isNull(): boolean;\r\n    /**\r\n     * they share the same TShape with the same Locations and Orientations.\r\n     */\r\n    isEqual(other: IShape): boolean;\r\n    /**\r\n     * they share the same TShape with the same Locations, Orientations may differ.\r\n     */\r\n    isSame(other: IShape): boolean;\r\n    /**\r\n     * they share the same TShape. Locations and Orientations may differ.\r\n     */\r\n    isPartner(other: IShape): boolean;\r\n    orientation(): Orientation;\r\n    findAncestor(ancestorType: ShapeType, fromShape: IShape): IShape[];\r\n    findSubShapes(subshapeType: ShapeType): IShape[];\r\n    iterShape(): IShape[];\r\n    section(shape: IShape | Plane): IShape;\r\n    split(edges: (IEdge | IWire)[]): IShape;\r\n    reserve(): void;\r\n    clone(): IShape;\r\n}\r\n\r\nexport interface ISubShape extends IShape {\r\n    index: number;\r\n    parent: IShape;\r\n}\r\n\r\nexport interface ISubEdgeShape extends ISubShape, IEdge {}\r\n\r\nexport interface ISubFaceShape extends ISubShape, IFace {}\r\n\r\nexport interface IVertex extends IShape {}\r\n\r\nexport interface IEdge extends IShape {\r\n    update(curve: ICurve): void;\r\n    intersect(other: IEdge | Ray): { parameter: number; point: XYZ }[];\r\n    length(): number;\r\n    get curve(): ITrimmedCurve;\r\n    offset(distance: number, dir: XYZ): Result<IEdge>;\r\n    trim(start: number, end: number): IEdge;\r\n}\r\n\r\nexport enum JoinType {\r\n    arc,\r\n    tangent,\r\n    intersection,\r\n}\r\n\r\nexport interface IWire extends IShape {\r\n    toFace(): Result<IFace>;\r\n    edgeLoop(): IEdge[];\r\n    offset(distance: number, joinType: JoinType): Result<IShape>;\r\n}\r\n\r\nexport interface IFace extends IShape {\r\n    area(): number;\r\n    normal(u: number, v: number): [point: XYZ, normal: XYZ];\r\n    outerWire(): IWire;\r\n    surface(): ISurface;\r\n    segmentsOfEdgeOnFace(edge: IEdge):\r\n        | undefined\r\n        | {\r\n              start: number;\r\n              end: number;\r\n          };\r\n}\r\n\r\nexport interface IShell extends IShape {}\r\n\r\nexport interface ISolid extends IShape {\r\n    volume(): number;\r\n}\r\n\r\nexport interface ICompound extends IShape {}\r\n\r\nexport interface ICompoundSolid extends IShape {}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum ShapeType {\r\n    Shape = 0b0,\r\n    Compound = 0b1,\r\n    CompoundSolid = 0b10,\r\n    Solid = 0b100,\r\n    Shell = 0b1000,\r\n    Face = 0b10000,\r\n    Wire = 0b100000,\r\n    Edge = 0b1000000,\r\n    Vertex = 0b10000000,\r\n}\r\n\r\nexport namespace ShapeType {\r\n    export function isWhole(type: ShapeType) {\r\n        return (\r\n            type === ShapeType.Shape ||\r\n            type === ShapeType.Compound ||\r\n            type === ShapeType.CompoundSolid ||\r\n            type === ShapeType.Solid\r\n        );\r\n    }\r\n\r\n    export function stringValue(type: ShapeType) {\r\n        switch (type) {\r\n            case ShapeType.Shape:\r\n                return \"Shape\";\r\n            case ShapeType.Compound:\r\n                return \"Compound\";\r\n            case ShapeType.CompoundSolid:\r\n                return \"CompoundSolid\";\r\n            case ShapeType.Solid:\r\n                return \"Solid\";\r\n            case ShapeType.Shell:\r\n                return \"Shell\";\r\n            case ShapeType.Face:\r\n                return \"Face\";\r\n            case ShapeType.Wire:\r\n                return \"Wire\";\r\n            case ShapeType.Edge:\r\n                return \"Edge\";\r\n            case ShapeType.Vertex:\r\n                return \"Vertex\";\r\n            default:\r\n                return \"Unknown\";\r\n        }\r\n    }\r\n\r\n    export function hasCompound(type: ShapeType): boolean {\r\n        return (type & ShapeType.Compound) !== 0;\r\n    }\r\n    export function hasCompoundSolid(type: ShapeType): boolean {\r\n        return (type & ShapeType.CompoundSolid) !== 0;\r\n    }\r\n    export function hasSolid(type: ShapeType): boolean {\r\n        return (type & ShapeType.Solid) !== 0;\r\n    }\r\n    export function hasShell(type: ShapeType): boolean {\r\n        return (type & ShapeType.Shell) !== 0;\r\n    }\r\n    export function hasFace(type: ShapeType): boolean {\r\n        return (type & ShapeType.Face) !== 0;\r\n    }\r\n    export function hasWire(type: ShapeType): boolean {\r\n        return (type & ShapeType.Wire) !== 0;\r\n    }\r\n    export function hasEdge(type: ShapeType): boolean {\r\n        return (type & ShapeType.Edge) !== 0;\r\n    }\r\n    export function hasVertex(type: ShapeType): boolean {\r\n        return (type & ShapeType.Vertex) !== 0;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Plane, XYZ } from \"../math\";\r\nimport { Continuity, ICurve } from \"./curve\";\r\nimport { IGeometry } from \"./geometry\";\r\n\r\nexport enum SurfaceType {\r\n    Plate,\r\n    Bezier,\r\n    BSpline,\r\n    RectangularTrimmed,\r\n    Conical,\r\n    Cylinder,\r\n    Plane,\r\n    Spherical,\r\n    Toroidal,\r\n    Revolution,\r\n    Extrusion,\r\n    Offset,\r\n    Composite,\r\n}\r\n\r\nexport interface ISurface extends IGeometry {\r\n    nearestPoint(point: XYZ): [XYZ, number] | undefined;\r\n    project(point: XYZ): XYZ[];\r\n    projectCurve(curve: ICurve): ICurve | undefined;\r\n    parameter(point: XYZ, maxDistance: number): { u: number; v: number } | undefined;\r\n    continuity(): Continuity;\r\n    uIso(u: number): ICurve;\r\n    vIso(v: number): ICurve;\r\n    isPlanar(): boolean;\r\n    isUClosed(): boolean;\r\n    isVClosed(): boolean;\r\n    isUPreiodic(): boolean;\r\n    isVPreiodic(): boolean;\r\n    vPeriod(): number;\r\n    uPeriod(): number;\r\n    bounds(): {\r\n        u1: number;\r\n        u2: number;\r\n        v1: number;\r\n        v2: number;\r\n    };\r\n    isCNu(n: number): boolean;\r\n    isCNv(n: number): boolean;\r\n    d0(u: number, v: number): XYZ;\r\n    d1(\r\n        u: number,\r\n        v: number,\r\n    ): {\r\n        point: XYZ;\r\n        d1u: XYZ;\r\n        d1v: XYZ;\r\n    };\r\n    d2(\r\n        u: number,\r\n        v: number,\r\n    ): {\r\n        point: XYZ;\r\n        d1u: XYZ;\r\n        d1v: XYZ;\r\n        d2u: XYZ;\r\n        d2v: XYZ;\r\n        d2uv: XYZ;\r\n    };\r\n    d3(\r\n        u: number,\r\n        v: number,\r\n    ): {\r\n        point: XYZ;\r\n        d1u: XYZ;\r\n        d1v: XYZ;\r\n        d2u: XYZ;\r\n        d2v: XYZ;\r\n        d2uv: XYZ;\r\n        d3u: XYZ;\r\n        d3v: XYZ;\r\n        d3uuv: XYZ;\r\n        d3uvv: XYZ;\r\n    };\r\n    dn(u: number, v: number, nu: number, nv: number): XYZ;\r\n    value(u: number, v: number): XYZ;\r\n}\r\n\r\nexport interface IPlateSurface extends ISurface {\r\n    setBounds(u1: number, u2: number, v1: number, v2: number): void;\r\n}\r\n\r\nexport interface IBoundedSurface extends ISurface {}\r\n\r\nexport interface IElementarySurface extends ISurface {\r\n    axis: XYZ;\r\n    coordinates: Plane;\r\n    location: XYZ;\r\n}\r\n\r\nexport interface IOffsetSurface extends ISurface {\r\n    offset: number;\r\n    basisSurface: ISurface;\r\n}\r\n\r\nexport interface ISweptSurface extends ISurface {\r\n    direction(): XYZ;\r\n    basisCurve(): ICurve;\r\n}\r\n\r\nexport interface ICompositeSurface extends ISurface {}\r\n\r\nexport interface IBSplineSurface extends IBoundedSurface {}\r\n\r\nexport interface IBezierSurface extends IBoundedSurface {}\r\n\r\nexport interface IRectangularTrimmedSurface extends IBoundedSurface {\r\n    basisSurface(): ISurface;\r\n    setUTrim(u1: number, u2: number): void;\r\n    setVTrim(v1: number, v2: number): void;\r\n    setTrim(u1: number, u2: number, v1: number, v2: number): void;\r\n}\r\n\r\nexport interface IConicalSurface extends IElementarySurface {\r\n    semiAngle: number;\r\n    setRadius(value: number): void;\r\n    apex(): XYZ;\r\n    refRadius(): number;\r\n}\r\n\r\nexport interface ICylindricalSurface extends IElementarySurface {\r\n    radius: number;\r\n}\r\n\r\nexport interface IPlaneSurface extends IElementarySurface {\r\n    plane: Plane;\r\n}\r\n\r\nexport interface ISphericalSurface extends IElementarySurface {\r\n    radius: number;\r\n    area(): number;\r\n    volume(): number;\r\n}\r\n\r\nexport interface IToroidalSurface extends IElementarySurface {\r\n    area(): number;\r\n    volume(): number;\r\n    majorRadius: number;\r\n    minorRadius: number;\r\n}\r\n\r\nexport interface ISurfaceOfLinearExtrusion extends ISweptSurface {}\r\n\r\nexport interface ISurfaceOfRevolution extends ISweptSurface {\r\n    location: XYZ;\r\n    referencePlane(): Plane;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys } from \"../i18n\";\r\n\r\nexport enum ButtonSize {\r\n    large,\r\n    small,\r\n}\r\n\r\nexport interface Button {\r\n    display: I18nKeys;\r\n    icon: string;\r\n    size: ButtonSize;\r\n    onClick: () => void;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum DialogResult {\r\n    ok,\r\n    cancel,\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { IDisposable, IPropertyChanged } from \"../foundation\";\r\nimport { Plane, Ray, XY, XYLike, XYZ, XYZLike } from \"../math\";\r\nimport { INodeFilter, IShapeFilter } from \"../selectionFilter\";\r\nimport { ShapeType } from \"../shape\";\r\nimport { ICameraController } from \"./cameraController\";\r\nimport { VisualShapeData } from \"./detectedData\";\r\nimport { IVisualObject } from \"./visualObject\";\r\n\r\nexport enum ViewMode {\r\n    solid,\r\n    wireframe,\r\n    solidAndWireframe,\r\n}\r\n\r\nexport type HtmlTextOptions = {\r\n    hideDelete?: boolean;\r\n    center?: XYLike;\r\n    onDispose?: () => void;\r\n};\r\n\r\nexport interface IView extends IPropertyChanged, IDisposable {\r\n    readonly document: IDocument;\r\n    readonly cameraController: ICameraController;\r\n    get isClosed(): boolean;\r\n    get width(): number;\r\n    get height(): number;\r\n    get dom(): HTMLElement | undefined;\r\n    mode: ViewMode;\r\n    name: string;\r\n    workplane: Plane;\r\n    update(): void;\r\n    up(): XYZ;\r\n    toImage(): string;\r\n    direction(): XYZ;\r\n    rayAt(mx: number, my: number): Ray;\r\n    screenToWorld(mx: number, my: number): XYZ;\r\n    worldToScreen(point: XYZ): XY;\r\n    resize(width: number, heigth: number): void;\r\n    setDom(element: HTMLElement): void;\r\n    htmlText(text: string, point: XYZLike, options?: HtmlTextOptions): IDisposable;\r\n    close(): void;\r\n    detectVisual(x: number, y: number, nodeFilter?: INodeFilter): IVisualObject[];\r\n    detectVisualRect(\r\n        x1: number,\r\n        y1: number,\r\n        x2: number,\r\n        y2: number,\r\n        nodeFilter?: INodeFilter,\r\n    ): IVisualObject[];\r\n    detectShapes(shapeType: ShapeType, x: number, y: number, shapeFilter?: IShapeFilter): VisualShapeData[];\r\n    detectShapesRect(\r\n        shapeType: ShapeType,\r\n        x1: number,\r\n        y1: number,\r\n        x2: number,\r\n        y2: number,\r\n        shapeFilter?: IShapeFilter,\r\n    ): VisualShapeData[];\r\n}\r\n\r\nexport namespace IView {\r\n    export function screenDistance(view: IView, mx: number, my: number, point: XYZ) {\r\n        let xy = view.worldToScreen(point);\r\n        let dx = xy.x - mx;\r\n        let dy = xy.y - my;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum VisualState {\r\n    normal = 0,\r\n    edgeHighlight = 1,\r\n    edgeSelected = 1 << 1,\r\n    faceTransparent = 1 << 2,\r\n}\r\n\r\nexport namespace VisualState {\r\n    export function addState(origin: VisualState, add: VisualState) {\r\n        return origin | add;\r\n    }\r\n\r\n    export function removeState(origin: VisualState, remove: VisualState) {\r\n        return (origin & remove) ^ origin;\r\n    }\r\n\r\n    export function hasState(origin: VisualState, testState: VisualState) {\r\n        return (origin & testState) === testState;\r\n    }\r\n}\r\n\r\nexport interface VisualGroup {\r\n    start: number;\r\n    count: number;\r\n    materialIndex?: number;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport class Logger {\r\n    static debug(message?: any, ...optionalParams: any[]) {\r\n        console.log(message, ...optionalParams);\r\n    }\r\n\r\n    static info(message?: any, ...optionalParams: any[]) {\r\n        console.log(message, ...optionalParams);\r\n    }\r\n\r\n    static warn(message?: any, ...optionalParams: any[]) {\r\n        console.warn(message, ...optionalParams);\r\n    }\r\n\r\n    static error(message?: any, ...optionalParams: any[]) {\r\n        console.error(message, ...optionalParams);\r\n    }\r\n}\r\n\r\n// facilitate debugging\r\nLogger.info = console.log;\r\nLogger.warn = console.warn;\r\nLogger.debug = console.log;\r\nLogger.error = console.error;\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { ArrayRecord, IHistoryRecord } from \"./history\";\r\nimport { Logger } from \"./logger\";\r\n\r\nexport class Transaction {\r\n    private static readonly _transactionMap: WeakMap<IDocument, ArrayRecord> = new WeakMap();\r\n\r\n    constructor(\r\n        readonly document: IDocument,\r\n        readonly name: string,\r\n    ) {}\r\n\r\n    static add(document: IDocument, record: IHistoryRecord) {\r\n        if (document.history.disabled) return;\r\n        let arrayRecord = Transaction._transactionMap.get(document);\r\n        if (arrayRecord !== undefined) {\r\n            arrayRecord.records.push(record);\r\n        } else {\r\n            Transaction.addToHistory(document, record);\r\n        }\r\n    }\r\n\r\n    static addToHistory(document: IDocument, record: IHistoryRecord) {\r\n        document.history.add(record);\r\n        Logger.info(`history added ${record.name}`);\r\n    }\r\n\r\n    static execute(document: IDocument, name: string, action: () => void) {\r\n        let trans = new Transaction(document, name);\r\n        trans.start();\r\n        try {\r\n            action();\r\n            trans.commit();\r\n        } catch (e) {\r\n            trans.rollback();\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    static async executeAsync(document: IDocument, name: string, action: () => Promise<void>) {\r\n        const trans = new Transaction(document, name);\r\n        trans.start();\r\n        try {\r\n            await action();\r\n            trans.commit();\r\n        } catch (e) {\r\n            trans.rollback();\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    start(name?: string) {\r\n        const transactionName = name ?? this.name;\r\n        if (Transaction._transactionMap.has(this.document)) {\r\n            throw new Error(`The document has started a transaction ${this.name}`);\r\n        }\r\n        Transaction._transactionMap.set(this.document, new ArrayRecord(transactionName));\r\n    }\r\n\r\n    commit() {\r\n        const arrayRecord = Transaction._transactionMap.get(this.document);\r\n        if (!arrayRecord) {\r\n            throw new Error(\"Transaction has not started\");\r\n        }\r\n        if (arrayRecord.records.length > 0) Transaction.addToHistory(this.document, arrayRecord);\r\n        Transaction._transactionMap.delete(this.document);\r\n    }\r\n\r\n    rollback() {\r\n        Transaction._transactionMap.get(this.document)?.undo();\r\n        Transaction._transactionMap.delete(this.document);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { IDisposable } from \"./disposable\";\r\nimport { IEqualityComparer } from \"./equalityComparer\";\r\nimport { PropertyHistoryRecord } from \"./history\";\r\nimport { Logger } from \"./logger\";\r\nimport { Transaction } from \"./transaction\";\r\n\r\nexport type PropertyChangedHandler<T, K extends keyof T> = (property: K, source: T, oldValue: T[K]) => void;\r\n\r\nexport interface IPropertyChanged extends IDisposable {\r\n    onPropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>): void;\r\n    removePropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>): void;\r\n    clearPropertyChanged(): void;\r\n}\r\n\r\nexport function isPropertyChanged(obj: object): obj is IPropertyChanged {\r\n    return (\r\n        obj &&\r\n        typeof (obj as IPropertyChanged).onPropertyChanged === \"function\" &&\r\n        typeof (obj as IPropertyChanged).removePropertyChanged === \"function\"\r\n    );\r\n}\r\n\r\nexport class Observable implements IPropertyChanged {\r\n    protected readonly propertyChangedHandlers = new Set<PropertyChangedHandler<any, any>>();\r\n    protected _isDisposed = false;\r\n\r\n    private getPrivateKey<K extends keyof this>(pubKey: K) {\r\n        return `_${String(pubKey)}`;\r\n    }\r\n\r\n    protected getPrivateValue<K extends keyof this>(pubKey: K, defaultValue?: this[K]): this[K] {\r\n        const privateKey = this.getPrivateKey(pubKey) as keyof this;\r\n        return privateKey in this\r\n            ? (this[privateKey] as this[K])\r\n            : this.initializeDefaultValue(pubKey, defaultValue);\r\n    }\r\n\r\n    private initializeDefaultValue<K extends keyof this>(pubKey: K, defaultValue?: this[K]): this[K] {\r\n        if (defaultValue === undefined) {\r\n            Logger.warn(\r\n                `${this.constructor.name}: The property \"${String(pubKey)}\" is not initialized, and no default value is provided`,\r\n            );\r\n            return undefined as this[K];\r\n        }\r\n\r\n        const privateKey = this.getPrivateKey(pubKey);\r\n        (this as any)[privateKey] = defaultValue;\r\n        return defaultValue;\r\n    }\r\n\r\n    protected setPrivateValue<K extends keyof this>(pubKey: K, newValue: this[K]): void {\r\n        (this as any)[this.getPrivateKey(pubKey)] = newValue;\r\n    }\r\n\r\n    /**\r\n     * Set the value of a private property, and if successful, execute emitPropertyChanged.\r\n     *\r\n     * Note: The private property name must be the public property name with the prefix _, i.e., age->_age(private property name).\r\n     */\r\n    protected setProperty<K extends keyof this>(\r\n        property: K,\r\n        newValue: this[K],\r\n        onPropertyChanged?: (property: K, oldValue: this[K]) => void,\r\n        equals?: IEqualityComparer<this[K]>,\r\n    ): boolean {\r\n        const oldValue = this[property];\r\n        if (this.isEuqals(oldValue, newValue, equals)) return false;\r\n\r\n        this.setPrivateValue(property, newValue);\r\n        onPropertyChanged?.(property, oldValue);\r\n        this.emitPropertyChanged(property, oldValue);\r\n        return true;\r\n    }\r\n\r\n    private isEuqals<K extends keyof this>(\r\n        oldValue: this[K],\r\n        newValue: this[K],\r\n        equals?: IEqualityComparer<this[K]>,\r\n    ): boolean {\r\n        return equals ? equals.equals(oldValue, newValue) : oldValue === newValue;\r\n    }\r\n\r\n    protected emitPropertyChanged<K extends keyof this>(property: K, oldValue: this[K]) {\r\n        Array.from(this.propertyChangedHandlers).forEach((cb) => cb(property, this, oldValue));\r\n    }\r\n\r\n    onPropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>) {\r\n        this.propertyChangedHandlers.add(handler);\r\n    }\r\n\r\n    removePropertyChanged<K extends keyof this>(handler: PropertyChangedHandler<this, K>) {\r\n        this.propertyChangedHandlers.delete(handler);\r\n    }\r\n\r\n    clearPropertyChanged(): void {\r\n        this.propertyChangedHandlers.clear();\r\n    }\r\n\r\n    readonly dispose = () => {\r\n        if (this._isDisposed) return;\r\n        this._isDisposed = true;\r\n        this.disposeInternal();\r\n    };\r\n\r\n    protected disposeInternal() {\r\n        this.propertyChangedHandlers.clear();\r\n    }\r\n}\r\n\r\nexport abstract class HistoryObservable extends Observable {\r\n    private _document: IDocument;\r\n\r\n    get document(): IDocument {\r\n        return this._document;\r\n    }\r\n\r\n    constructor(document: IDocument) {\r\n        super();\r\n        this._document = document;\r\n    }\r\n\r\n    protected override setProperty<K extends keyof this>(\r\n        property: K,\r\n        newValue: this[K],\r\n        onPropertyChanged?: (property: K, oldValue: this[K]) => void,\r\n        equals?: IEqualityComparer<this[K]>,\r\n    ): boolean {\r\n        return super.setProperty(\r\n            property,\r\n            newValue,\r\n            (property, oldValue) => {\r\n                onPropertyChanged?.(property, oldValue);\r\n                Transaction.add(\r\n                    this.document,\r\n                    new PropertyHistoryRecord(this, property, oldValue, newValue),\r\n                );\r\n            },\r\n            equals,\r\n        );\r\n    }\r\n\r\n    override disposeInternal() {\r\n        super.disposeInternal();\r\n        this._document = null as any;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Serializer } from \"../serialize\";\r\nimport { IEqualityComparer } from \"./equalityComparer\";\r\nimport { Logger } from \"./logger\";\r\n\r\n@Serializer.register([\"isOk\", \"value\", \"error\"])\r\nexport class Result<T, E = string> {\r\n    readonly #isOk: boolean;\r\n    readonly #value: T | undefined;\r\n    readonly #error: E | undefined;\r\n\r\n    @Serializer.serialze()\r\n    get isOk(): boolean {\r\n        return this.#isOk;\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get value(): T {\r\n        if (!this.#isOk) Logger.warn(\"Result is error\");\r\n        return this.#value!;\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get error(): E {\r\n        if (this.#isOk) Logger.warn(\"Result is ok\");\r\n        return this.#error!;\r\n    }\r\n\r\n    constructor(isOk: boolean, value: T | undefined, error: E | undefined) {\r\n        this.#isOk = isOk;\r\n        this.#value = value;\r\n        this.#error = error;\r\n    }\r\n\r\n    parse<U>(): Result<U, E> {\r\n        return Result.err(this.#error as E);\r\n    }\r\n\r\n    isOkAnd(predict: (value: T) => boolean): boolean {\r\n        return this.#isOk && predict(this.#value!);\r\n    }\r\n\r\n    isErrorOr(predict: (value: T) => boolean): boolean {\r\n        return !this.#isOk || predict(this.#value!);\r\n    }\r\n\r\n    unchecked(): T | undefined {\r\n        return this.#value;\r\n    }\r\n\r\n    static ok<T>(value: T): Result<T, never> {\r\n        return new Result(true, value, undefined) as any;\r\n    }\r\n\r\n    static err<E>(error: E): Result<any, E> {\r\n        return new Result(false, undefined, error) as any;\r\n    }\r\n}\r\n\r\nexport class ResultEqualityComparer<T> implements IEqualityComparer<Result<T>> {\r\n    constructor(readonly equal?: (left: T, right: T) => boolean) {}\r\n\r\n    equals(left: Result<T>, right: Result<T>): boolean {\r\n        if (!left.isOk || !right.isOk) return false;\r\n        return this.equal ? this.equal(left.value, right.value) : left.value === right.value;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IPropertyChanged, isPropertyChanged } from \"./observer\";\r\nimport { Result } from \"./result\";\r\n\r\nexport type DeepPropertyChangedHandler = (path: string, source: IPropertyChanged, oldValue: any) => void;\r\n\r\nexport type SourceHandler = {\r\n    handler: DeepPropertyChangedHandler;\r\n    sources: {\r\n        source: IPropertyChanged;\r\n        prefix: string | undefined;\r\n    }[];\r\n};\r\n\r\nexport class DeepObserver {\r\n    private static readonly handlers = new Map<\r\n        IPropertyChanged,\r\n        Map<DeepPropertyChangedHandler, SourceHandler>\r\n    >();\r\n\r\n    static getPathValue(instance: IPropertyChanged, path: string): Result<any> {\r\n        const parts = path.split(\".\");\r\n\r\n        let value = instance;\r\n        for (let i = 0; i < parts.length; i++) {\r\n            value = (value as any)[parts[i]];\r\n            if (i < parts.length - 1 && !isPropertyChanged(value)) {\r\n                return Result.err(`Path ${path} is not valid`);\r\n            }\r\n        }\r\n\r\n        return Result.ok(value);\r\n    }\r\n\r\n    static addDeepPropertyChangedHandler(instance: IPropertyChanged, handler: DeepPropertyChangedHandler) {\r\n        const sourceHandler = DeepObserver.getOrInitHandler(instance, handler);\r\n        this.deepHandlePropertyChanged(sourceHandler, instance);\r\n    }\r\n\r\n    static deepHandlePropertyChanged(\r\n        sourceHandler: SourceHandler,\r\n        source: IPropertyChanged,\r\n        prefix?: string,\r\n    ) {\r\n        source.onPropertyChanged(sourceHandler.handler);\r\n        sourceHandler.sources.push({ source, prefix });\r\n\r\n        let keys = Object.keys(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(source)));\r\n        for (const key of keys) {\r\n            if (key === \"constructor\" || key.startsWith(\"_\")) {\r\n                continue;\r\n            }\r\n            let subSource = (source as any)[key];\r\n            if (isPropertyChanged(subSource)) {\r\n                this.deepHandlePropertyChanged(sourceHandler, subSource, prefix ? `${prefix}.${key}` : key);\r\n            }\r\n        }\r\n    }\r\n\r\n    static removeDeepPropertyChangedHandler(\r\n        instance: IPropertyChanged,\r\n        handler: DeepPropertyChangedHandler,\r\n    ) {\r\n        let handlerMap = this.handlers.get(instance);\r\n        if (!handlerMap) {\r\n            return;\r\n        }\r\n\r\n        let sourceHandler = handlerMap.get(handler);\r\n        if (!sourceHandler) {\r\n            this.handlers.delete(instance);\r\n            return;\r\n        }\r\n\r\n        sourceHandler.sources.forEach((item) => {\r\n            item.source.removePropertyChanged(sourceHandler.handler);\r\n        });\r\n\r\n        handlerMap.delete(handler);\r\n        if (handlerMap.size === 0) {\r\n            this.handlers.delete(instance);\r\n        }\r\n    }\r\n\r\n    private static getOrInitHandler(instance: IPropertyChanged, deepHandler: DeepPropertyChangedHandler) {\r\n        let handlerMap = DeepObserver.handlers.get(instance);\r\n        if (!handlerMap) {\r\n            handlerMap = new Map();\r\n            DeepObserver.handlers.set(instance, handlerMap);\r\n        }\r\n\r\n        let sourceHandler = handlerMap.get(deepHandler);\r\n        if (sourceHandler) {\r\n            sourceHandler.sources.forEach((item) => {\r\n                item.source.removePropertyChanged(sourceHandler!.handler);\r\n            });\r\n        }\r\n\r\n        sourceHandler = this.initSourceHandler(instance, deepHandler);\r\n        handlerMap.set(deepHandler, sourceHandler);\r\n        return sourceHandler;\r\n    }\r\n\r\n    private static initSourceHandler(instance: IPropertyChanged, deepHandler: DeepPropertyChangedHandler) {\r\n        const handler = (property: string, target: IPropertyChanged, oldValue: any) => {\r\n            let sourceHandler = this.handlers.get(instance)?.get(deepHandler);\r\n            if (!sourceHandler) {\r\n                return;\r\n            }\r\n\r\n            let source = sourceHandler.sources.find((x) => x.source === target);\r\n            if (!source) {\r\n                return;\r\n            }\r\n\r\n            let prefix = source.prefix ? `${source.prefix}.${property}` : property;\r\n            this.updateHandlers(sourceHandler, target, property, prefix);\r\n\r\n            deepHandler(prefix, instance, oldValue);\r\n        };\r\n        return {\r\n            handler,\r\n            sources: [],\r\n        };\r\n    }\r\n\r\n    private static updateHandlers(\r\n        sourceHandler: SourceHandler,\r\n        target: IPropertyChanged,\r\n        property: string,\r\n        prefix: string | undefined,\r\n    ) {\r\n        const value = (target as any)[property];\r\n        if (value === undefined && prefix != undefined) {\r\n            const sources = [];\r\n            for (const source of sourceHandler.sources) {\r\n                if (source.prefix?.startsWith(prefix)) {\r\n                    source.source.removePropertyChanged(sourceHandler.handler);\r\n                } else {\r\n                    sources.push(source);\r\n                }\r\n            }\r\n            sourceHandler.sources = sources;\r\n            return;\r\n        }\r\n\r\n        if (isPropertyChanged(value)) {\r\n            this.deepHandlePropertyChanged(sourceHandler, value, prefix);\r\n        }\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport interface IDisposable {\r\n    dispose(): void;\r\n}\r\n\r\nexport namespace IDisposable {\r\n    export function isDisposable(value: unknown): value is IDisposable {\r\n        return (\r\n            value != null &&\r\n            typeof value === \"object\" &&\r\n            \"dispose\" in value &&\r\n            typeof (value as IDisposable).dispose === \"function\" &&\r\n            (value as IDisposable).dispose.length === 0\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDisposable } from \"./disposable\";\r\n\r\nexport interface Deletable {\r\n    delete(): void;\r\n}\r\n\r\nexport namespace Deletable {\r\n    export function isDeletable(value: unknown): value is Deletable {\r\n        return typeof (value as any)?.delete === \"function\" && (value as any).delete.length === 0;\r\n    }\r\n}\r\n\r\nexport const gc = <R>(action: (collect: <T extends Deletable | IDisposable>(resource: T) => T) => R): R => {\r\n    const resources = new Set<Deletable | IDisposable>();\r\n\r\n    const collectResource = <T extends Deletable | IDisposable>(resource: T) => {\r\n        resources.add(resource);\r\n        return resource;\r\n    };\r\n\r\n    try {\r\n        return action(collectResource);\r\n    } finally {\r\n        for (const resource of resources) {\r\n            if (Deletable.isDeletable(resource)) {\r\n                resource.delete();\r\n            } else if (IDisposable.isDisposable(resource)) {\r\n                resource.dispose();\r\n            }\r\n        }\r\n        resources.clear();\r\n    }\r\n};\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\n// Copy from nanoid: https://github.com/ai/nanoid/blob/main/non-secure/index.js\r\n\r\n// This alphabet uses `A-Za-z0-9_-` symbols.\r\n// The order of characters is optimized for better gzip and brotli compression.\r\n// References to the same file (works both for gzip and brotli):\r\n// `'use`, `andom`, and `rict'`\r\n// References to the brotli default dictionary:\r\n// `-26T`, `1983`, `40px`, `75px`, `bush`, `jack`, `mind`, `very`, and `wolf`\r\nlet alphabet = \"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict\";\r\n\r\nexport class Id {\r\n    static generate(size = 21) {\r\n        let id = \"\";\r\n        // A compact alternative for `for (var i = 0; i < step; i++)`.\r\n        let i = size;\r\n        while (i--) {\r\n            // `| 0` is more compact and faster than `Math.floor()`.\r\n            id += alphabet[(Math.random() * 64) | 0];\r\n        }\r\n        return id;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { CommandKeys, ICommand } from \"../command\";\r\nimport { IDocument } from \"../document\";\r\nimport { I18nKeys } from \"../i18n\";\r\nimport { Material } from \"../material\";\r\nimport { INode } from \"../model\";\r\nimport { DialogResult } from \"../ui\";\r\nimport { CursorType, IView } from \"../visual\";\r\nimport { AsyncController } from \"./asyncController\";\r\nimport { IDisposable } from \"./disposable\";\r\nimport { MessageType } from \"./messageType\";\r\nimport { Result } from \"./result\";\r\n\r\nexport interface PubSubEventMap {\r\n    activeViewChanged: (view: IView | undefined) => void;\r\n    clearFloatTip: () => void;\r\n    clearInput: () => void;\r\n    clearSelectionControl: () => void;\r\n    clearStatusBarTip: () => void;\r\n    closeCommandContext: () => void;\r\n    displayError: (message: string) => void;\r\n    displayHome: (show: boolean) => void;\r\n    documentClosed: (document: IDocument) => void;\r\n    editMaterial: (document: IDocument, material: Material, callback: (material: Material) => void) => void;\r\n    executeCommand: (commandName: CommandKeys) => void;\r\n    modelUpdate: (model: INode) => void;\r\n    openCommandContext: (command: ICommand) => void;\r\n    parentVisibleChanged: (model: INode) => void;\r\n    selectionChanged: (document: IDocument, selected: INode[], unselected: INode[]) => void;\r\n    showDialog: (title: I18nKeys, content: HTMLElement, callback?: (result: DialogResult) => void) => void;\r\n    showFloatTip: (level: MessageType, msg: string) => void;\r\n    showInput: (text: string, handler: (text: string) => Result<string, I18nKeys>) => void;\r\n    showPermanent: (action: () => Promise<void>, message: I18nKeys, ...args: any[]) => void;\r\n    showProperties(document: IDocument, nodes: INode[]): void;\r\n    showSelectionControl: (controller: AsyncController) => void;\r\n    showToast: (message: I18nKeys, ...args: any[]) => void;\r\n    statusBarTip: (tip: I18nKeys) => void;\r\n    viewClosed: (view: IView) => void;\r\n    viewCursor: (cursor: CursorType) => void;\r\n    visibleChanged: (model: INode) => void;\r\n}\r\n\r\ntype EventCallback = (...args: any[]) => void;\r\ntype EventMap = Map<keyof PubSubEventMap, Set<EventCallback>>;\r\n\r\nexport class PubSub implements IDisposable {\r\n    static readonly default = new PubSub();\r\n    private readonly events: EventMap = new Map();\r\n\r\n    dispose(): void {\r\n        this.events.forEach((callbacks) => callbacks.clear());\r\n        this.events.clear();\r\n    }\r\n\r\n    sub<K extends keyof PubSubEventMap>(event: K, callback: PubSubEventMap[K]): void {\r\n        const callbacks = this.events.get(event) ?? new Set<EventCallback>();\r\n        callbacks.add(callback);\r\n        this.events.set(event, callbacks);\r\n    }\r\n\r\n    pub<K extends keyof PubSubEventMap>(event: K, ...args: Parameters<PubSubEventMap[K]>): void {\r\n        this.events.get(event)?.forEach((callback) => callback(...args));\r\n    }\r\n\r\n    remove<K extends keyof PubSubEventMap>(event: K, callback: PubSubEventMap[K]): void {\r\n        this.events.get(event)?.delete(callback);\r\n    }\r\n\r\n    removeAll<K extends keyof PubSubEventMap>(event: K): void {\r\n        this.events.get(event)?.clear();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport const debounce = <F extends (...args: any[]) => void, P extends Parameters<F>>(\r\n    fun: F,\r\n    ms: number,\r\n) => {\r\n    let timeout: number | undefined;\r\n    return (...args: P) => {\r\n        if (timeout) {\r\n            clearTimeout(timeout);\r\n        }\r\n        timeout = window.setTimeout(() => {\r\n            fun(...args);\r\n            timeout = undefined;\r\n        }, ms);\r\n    };\r\n};\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport function download(data: BlobPart[], name: string) {\r\n    let blob = new Blob(data);\r\n    const url = URL.createObjectURL(blob);\r\n    try {\r\n        let a = document.createElement(\"a\");\r\n        a.style.visibility = \"hidden\";\r\n        a.href = url;\r\n        a.download = name;\r\n        a.click();\r\n    } finally {\r\n        URL.revokeObjectURL(url);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Result } from \"..\";\r\n\r\nconst isIOS =\r\n    /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase()) ||\r\n    (navigator.maxTouchPoints > 0 && /(Macintosh)/.test(navigator.userAgent));\r\n\r\nexport async function readFilesAsync(accept: string, multiple: boolean): Promise<Result<FileList>> {\r\n    return new Promise((resolve) => {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"file\";\r\n        input.multiple = multiple;\r\n        if (!isIOS) {\r\n            input.accept = accept;\r\n        }\r\n        input.style.visibility = \"hidden\";\r\n\r\n        const cleanup = () => document.body.removeChild(input);\r\n\r\n        input.onchange = () => {\r\n            cleanup();\r\n            resolve(input.files ? Result.ok(input.files) : Result.err(\"no files selected\"));\r\n        };\r\n\r\n        input.oncancel = () => {\r\n            cleanup();\r\n            resolve(Result.err(\"cancel\"));\r\n        };\r\n\r\n        document.body.appendChild(input);\r\n        input.click();\r\n    });\r\n}\r\n\r\nexport interface FileData {\r\n    fileName: string;\r\n    data: string;\r\n}\r\n\r\nexport async function readFileAsync(\r\n    accept: string,\r\n    multiple: boolean,\r\n    method: \"readAsText\" | \"readAsDataURL\" = \"readAsText\",\r\n): Promise<Result<FileData[]>> {\r\n    const filesResult = await readFilesAsync(accept, multiple);\r\n    return filesResult.isOk ? readInputedFiles(filesResult.value, method) : filesResult.parse();\r\n}\r\n\r\nasync function readInputedFiles(\r\n    files: FileList,\r\n    method: \"readAsText\" | \"readAsDataURL\",\r\n): Promise<Result<FileData[]>> {\r\n    const fileDataPromises = Array.from(files).map(async (file) => {\r\n        const data = await readFileDataAsync(file, method);\r\n        if (!data) {\r\n            throw new Error(`Error occurred reading file: ${file.name}`);\r\n        }\r\n        return { fileName: file.name, data };\r\n    });\r\n\r\n    try {\r\n        const result = await Promise.all(fileDataPromises);\r\n        return Result.ok(result);\r\n    } catch (error) {\r\n        return Result.err((error as Error).message);\r\n    }\r\n}\r\n\r\nfunction readFileDataAsync(file: File, method: \"readAsText\" | \"readAsDataURL\"): Promise<string | null> {\r\n    return new Promise((resolve) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (e) => {\r\n            if (e.target?.readyState === FileReader.DONE) {\r\n                resolve(e.target.result as string);\r\n            }\r\n        };\r\n\r\n        reader.onerror = () => resolve(null);\r\n        reader[method](file);\r\n    });\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter } from \"./foundation\";\r\nimport { I18nKeys } from \"./i18n\";\r\n\r\nexport type PropertyType = \"color\" | \"materialId\";\r\n\r\nexport interface Property {\r\n    name: string;\r\n    display: I18nKeys;\r\n    converter?: IConverter;\r\n    group?: I18nKeys;\r\n    icon?: string;\r\n    type?: PropertyType;\r\n    dependencies?: {\r\n        property: string | number | symbol;\r\n        value: any;\r\n    }[];\r\n}\r\n\r\nconst PropertyKeyMap = new Map<Object, Map<string | number | symbol, Property>>();\r\n\r\nexport namespace Property {\r\n    export function define(display: I18nKeys, parameters?: Omit<Property, \"name\" | \"display\">) {\r\n        return (target: Object, name: string) => {\r\n            if (!PropertyKeyMap.has(target)) {\r\n                PropertyKeyMap.set(target, new Map());\r\n            }\r\n            PropertyKeyMap.get(target)?.set(name, { display, name, ...parameters });\r\n        };\r\n    }\r\n\r\n    export function getProperties(target: any, until?: object): Property[] {\r\n        const result: Property[] = [];\r\n        getAllKeysOfPrototypeChain(target, result, until);\r\n        return result;\r\n    }\r\n\r\n    export function getOwnProperties(target: any): Property[] {\r\n        const properties = PropertyKeyMap.get(target);\r\n        if (!properties) return [];\r\n        return [...properties.values()];\r\n    }\r\n\r\n    function getAllKeysOfPrototypeChain(target: any, properties: Property[], until?: object) {\r\n        if (!target || target === until) return;\r\n        if (PropertyKeyMap.has(target)) {\r\n            properties.splice(0, 0, ...PropertyKeyMap.get(target)!.values());\r\n        }\r\n        getAllKeysOfPrototypeChain(Object.getPrototypeOf(target), properties, until);\r\n    }\r\n\r\n    export function getProperty<T extends Object>(target: T, property: keyof T): Property | undefined {\r\n        if (!target) return undefined;\r\n        let map = PropertyKeyMap.get(target);\r\n        if (map?.has(property)) return map.get(property);\r\n        return getProperty(Object.getPrototypeOf(target), property);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IApplication } from \"../application\";\r\nimport { AsyncController, IDisposable, Observable, PubSub } from \"../foundation\";\r\nimport { Property } from \"../property\";\r\n\r\nexport interface ICommand {\r\n    execute(application: IApplication): Promise<void>;\r\n}\r\n\r\nexport interface ICanclableCommand extends ICommand, IDisposable {\r\n    cancel(): Promise<void>;\r\n}\r\n\r\nexport namespace ICommand {\r\n    export function isCancelableCommand(command: ICommand): command is ICanclableCommand {\r\n        return \"cancel\" in command;\r\n    }\r\n}\r\n\r\nexport abstract class CancelableCommand extends Observable implements ICanclableCommand {\r\n    private static readonly _propertiesCache: Map<string, any> = new Map(); // 所有命令共享\r\n    protected readonly disposeStack: Set<IDisposable> = new Set();\r\n\r\n    private _isCompleted: boolean = false;\r\n    get isCompleted() {\r\n        return this._isCompleted;\r\n    }\r\n\r\n    private _application: IApplication | undefined;\r\n    get application() {\r\n        if (!this._application) {\r\n            throw new Error(\"application is not set\");\r\n        }\r\n        return this._application;\r\n    }\r\n\r\n    get document() {\r\n        return this.application.activeView?.document!;\r\n    }\r\n\r\n    #controller?: AsyncController;\r\n    protected get controller() {\r\n        return this.#controller;\r\n    }\r\n    protected set controller(value: AsyncController | undefined) {\r\n        if (this.#controller === value) return;\r\n        this.#controller?.dispose();\r\n        this.#controller = value;\r\n    }\r\n\r\n    @Property.define(\"common.cancel\")\r\n    async cancel() {\r\n        this.controller?.cancel();\r\n        while (!this._isCompleted) {\r\n            await new Promise((r) => setTimeout(r, 30));\r\n        }\r\n    }\r\n\r\n    async execute(application: IApplication): Promise<void> {\r\n        if (!application.activeView?.document) return;\r\n        this._application = application;\r\n        try {\r\n            this.beforeExecute();\r\n            await this.executeAsync();\r\n        } finally {\r\n            this.afterExecute();\r\n        }\r\n    }\r\n\r\n    protected abstract executeAsync(): Promise<void>;\r\n\r\n    protected beforeExecute() {\r\n        this.readProperties();\r\n        PubSub.default.pub(\"openCommandContext\", this);\r\n    }\r\n\r\n    protected afterExecute() {\r\n        this.saveProperties();\r\n        PubSub.default.pub(\"closeCommandContext\");\r\n        this.controller?.dispose();\r\n        this.disposeStack.forEach((x) => x.dispose());\r\n        this.disposeStack.clear();\r\n        this._isCompleted = true;\r\n    }\r\n\r\n    private readProperties() {\r\n        Property.getProperties(this).forEach((x) => {\r\n            let key = this.cacheKeyOfProperty(x);\r\n            if (CancelableCommand._propertiesCache.has(key)) {\r\n                (this as any)[key] = CancelableCommand._propertiesCache.get(key);\r\n            }\r\n        });\r\n    }\r\n\r\n    private saveProperties() {\r\n        Property.getProperties(this).forEach((x) => {\r\n            let key = this.cacheKeyOfProperty(x);\r\n            let prop = (this as any)[key];\r\n            if (typeof prop === \"function\") return;\r\n            CancelableCommand._propertiesCache.set(key, prop);\r\n        });\r\n    }\r\n\r\n    private cacheKeyOfProperty(property: Property) {\r\n        return property.name;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Observable } from \"./foundation\";\r\nimport { ObjectSnapType } from \"./snapType\";\r\n\r\nexport const VisualConfig = {\r\n    defaultEdgeColor: 0x111111,\r\n    defaultFaceColor: 0xdedede,\r\n    highlightEdgeColor: 0x3333ff,\r\n    highlightFaceColor: 0x3333ff,\r\n    selectedEdgeColor: 0x0000ff,\r\n    selectedFaceColor: 0x0000ff,\r\n    editVertexSize: 7,\r\n    editVertexColor: 0x0000ff,\r\n    hintVertexSize: 5,\r\n    hintVertexColor: 0x0000ff,\r\n    trackingVertexSize: 7,\r\n    trackingVertexColor: 0x0000ff,\r\n    temporaryVertexSize: 5,\r\n    temporaryVertexColor: 0x0000ff,\r\n    temporaryEdgeColor: 0x0000ff,\r\n};\r\n\r\nexport class Config extends Observable {\r\n    static readonly #instance = new Config();\r\n\r\n    static get instance() {\r\n        return this.#instance;\r\n    }\r\n\r\n    get snapType() {\r\n        return this.getPrivateValue(\r\n            \"snapType\",\r\n            ObjectSnapType.midPoint |\r\n                ObjectSnapType.endPoint |\r\n                ObjectSnapType.center |\r\n                ObjectSnapType.perpendicular |\r\n                ObjectSnapType.intersection |\r\n                ObjectSnapType.nearest,\r\n        );\r\n    }\r\n    set snapType(snapType: ObjectSnapType) {\r\n        this.setProperty(\"snapType\", snapType);\r\n    }\r\n\r\n    get enableSnapTracking() {\r\n        return this.getPrivateValue(\"enableSnapTracking\", true);\r\n    }\r\n    set enableSnapTracking(value: boolean) {\r\n        this.setProperty(\"enableSnapTracking\", value);\r\n    }\r\n\r\n    get enableSnap() {\r\n        return this.getPrivateValue(\"enableSnap\", true);\r\n    }\r\n    set enableSnap(value: boolean) {\r\n        this.setProperty(\"enableSnap\", value);\r\n    }\r\n\r\n    get dynamicWorkplane() {\r\n        return this.getPrivateValue(\"dynamicWorkplane\", true);\r\n    }\r\n    set dynamicWorkplane(value: boolean) {\r\n        this.setProperty(\"dynamicWorkplane\", value);\r\n    }\r\n\r\n    readonly SnapDistance: number = 5;\r\n\r\n    private constructor() {\r\n        super();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport class Constants {\r\n    static readonly DBName = \"chili3d-db\";\r\n    static readonly DocumentTable = \"documents\";\r\n    static readonly RecentTable = \"recents\";\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IApplication } from \"./application\";\r\nimport {\r\n    History,\r\n    IDisposable,\r\n    INodeChangedObserver,\r\n    IPropertyChanged,\r\n    NodeRecord,\r\n    ObservableCollection,\r\n} from \"./foundation\";\r\nimport { Material } from \"./material\";\r\nimport { Component, INode, INodeLinkedList } from \"./model\";\r\nimport { ISelection } from \"./selection\";\r\nimport { ISerialize, Serialized } from \"./serialize\";\r\nimport { Act, IVisual } from \"./visual\";\r\n\r\nexport const DOCUMENT_FILE_EXTENSION = \".cd\";\r\n\r\nexport interface IDocument extends IPropertyChanged, IDisposable, ISerialize {\r\n    name: string;\r\n    currentNode?: INodeLinkedList;\r\n    rootNode: INodeLinkedList;\r\n    readonly selection: ISelection;\r\n    readonly id: string;\r\n    readonly history: History;\r\n    readonly visual: IVisual;\r\n    readonly application: IApplication;\r\n    readonly components: Array<Component>;\r\n    materials: ObservableCollection<Material>;\r\n    acts: ObservableCollection<Act>;\r\n    addNode(...nodes: INode[]): void;\r\n    addNodeObserver(observer: INodeChangedObserver): void;\r\n    removeNodeObserver(observer: INodeChangedObserver): void;\r\n    notifyNodeChanged(records: NodeRecord[]): void;\r\n    save(): Promise<void>;\r\n    close(): Promise<void>;\r\n    serialize(): Serialized;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Locale } from \"./i18n\";\r\n\r\nexport default {\r\n    display: \"English\",\r\n    code: \"en\",\r\n    translation: {\r\n        \"arc.angle\": \"Angle\",\r\n        \"arc.start\": \"Start\",\r\n        \"axis.x\": \"X Axis\",\r\n        \"axis.y\": \"Y Axis\",\r\n        \"axis.z\": \"Z Axis\",\r\n        \"body.arc\": \"Arc\",\r\n        \"body.bolean\": \"Boolean\",\r\n        \"body.box\": \"Box\",\r\n        \"body.pyramid\": \"Pyramid\",\r\n        \"body.cylinder\": \"Cylinder\",\r\n        \"body.cone\": \"Cone\",\r\n        \"body.group\": \"Group\",\r\n        \"body.sphere\": \"Sphere\",\r\n        \"body.ellipse\": \"Ellipse\",\r\n        \"body.circle\": \"Circle\",\r\n        \"body.face\": \"Face\",\r\n        \"body.fuse\": \"Fuse\",\r\n        \"body.imported\": \"Imported\",\r\n        \"body.line\": \"Line\",\r\n        \"body.polygon\": \"Polygon\",\r\n        \"body.prism\": \"Prism\",\r\n        \"body.rect\": \"Rectangle\",\r\n        \"body.revol\": \"Revolve\",\r\n        \"body.sweep\": \"Sweep\",\r\n        \"body.wire\": \"Wire\",\r\n        \"box.dx\": \"Length\",\r\n        \"box.dy\": \"Width\",\r\n        \"box.dz\": \"Height\",\r\n        \"body.editableShape\": \"Editable Shape\",\r\n        \"body.meshNode\": \"Mesh Node\",\r\n        \"body.multiShape\": \"Multi Shape\",\r\n        \"circle.center\": \"Center\",\r\n        \"circle.radius\": \"Radius\",\r\n        \"ellipsoid.radiusX\": \"RadiusX\",\r\n        \"ellipsoid.radiusY\": \"RadiusY\",\r\n        \"ellipsoid.radiusZ\": \"RadiusZ\",\r\n        \"ellipse.majorRadius\": \"majorRadius\",\r\n        \"ellipse.minorRadius\": \"minorRadius\",\r\n        \"command.act.alignCamera\": \"AlignCamera\",\r\n        \"command.boolean.common\": \"Intersect\",\r\n        \"command.boolean.cut\": \"Cut\",\r\n        \"command.boolean.join\": \"Join\",\r\n        \"command.convert.fuse\": \"Fuse\",\r\n        \"command.convert.revol\": \"Revolve\",\r\n        \"command.convert.sweep\": \"Sweep\",\r\n        \"command.convert.toFace\": \"ToFace\",\r\n        \"command.convert.toShell\": \"ToShell\",\r\n        \"command.convert.toSolid\": \"ToSolid\",\r\n        \"command.convert.toWire\": \"ToWire\",\r\n        \"command.create.arc\": \"Arc\",\r\n        \"command.create.bezier\": \"Bezier\",\r\n        \"command.create.box\": \"Box\",\r\n        \"command.create.circle\": \"Circle\",\r\n        \"command.create.cone\": \"Cone\",\r\n        \"command.create.copyShape\": \"CopyShape\",\r\n        \"command.create.cylinder\": \"Cylinder\",\r\n        \"command.create.ellipse\": \"Ellipse\",\r\n        \"command.create.ellipsoid\": \"Ellipsoid\",\r\n        \"command.create.extrude\": \"Extrude\",\r\n        \"command.create.folder\": \"Folder\",\r\n        \"command.create.group\": \"Create Group\",\r\n        \"command.create.line\": \"Line\",\r\n        \"command.create.offset\": \"Offset\",\r\n        \"command.create.polygon\": \"Polygon\",\r\n        \"command.create.pyramid\": \"Pyramid\",\r\n        \"command.create.rect\": \"Rectangle\",\r\n        \"command.create.section\": \"Section\",\r\n        \"command.create.sphere\": \"Sphere\",\r\n        \"command.create.thickSolid\": \"ThickSolid\",\r\n        \"command.doc.new\": \"New Document\",\r\n        \"command.doc.open\": \"Open Document\",\r\n        \"command.doc.save\": \"Save Document\",\r\n        \"command.doc.saveToFile\": \"SaveToFile\",\r\n        \"command.edit.redo\": \"Redo\",\r\n        \"command.edit.undo\": \"Undo\",\r\n        \"command.file.export\": \"Export\",\r\n        \"command.file.import\": \"Import\",\r\n        \"command.measure.angle\": \"Angle\",\r\n        \"command.measure.length\": \"Length\",\r\n        \"command.measure.select\": \"Select\",\r\n        \"command.modify.array\": \"Array\",\r\n        \"command.modify.break\": \"Break\",\r\n        \"command.modify.brushAdd\": \"BrushAdd\",\r\n        \"command.modify.brushRemove\": \"BrushRemove\",\r\n        \"command.modify.brushClear\": \"BrushClear\",\r\n        \"command.modify.chamfer\": \"Chamfer\",\r\n        \"command.modify.deleteNode\": \"DeleteNode\",\r\n        \"command.modify.explode\": \"Explode\",\r\n        \"command.modify.fillet\": \"Fillet\",\r\n        \"command.modify.mirror\": \"Mirror\",\r\n        \"command.modify.move\": \"Move\",\r\n        \"command.modify.removeFeature\": \"RemoveFeature\",\r\n        \"command.modify.removeShapes\": \"RemoveShapes\",\r\n        \"command.modify.rotate\": \"Rotate\",\r\n        \"command.modify.split\": \"Split\",\r\n        \"command.modify.trim\": \"Trim\",\r\n        \"command.special.last\": \"__Last_COMMAND__\",\r\n        \"command.test.performace\": \"Performance Test\",\r\n        \"command.wechat.group\": \"Wechat\",\r\n        \"command.workingPlane.alignToPlane\": \"Align\",\r\n        \"command.workingPlane.fromSection\": \"Section\",\r\n        \"command.workingPlane.set\": \"Set\",\r\n        \"command.workingPlane.toggleDynamic\": \"Toggle\",\r\n        \"common.angle\": \"Angle\",\r\n        \"common.area\": \"Area\",\r\n        \"common.back\": \"Back\",\r\n        \"common.cancel\": \"Cancel\",\r\n        \"common.clone\": \"Clone\",\r\n        \"common.color\": \"Color\",\r\n        \"common.confirm\": \"Confirm\",\r\n        \"common.general\": \"General\",\r\n        \"common.length\": \"Length\",\r\n        \"common.material\": \"Material\",\r\n        \"common.matrix\": \"Matrix\",\r\n        \"common.name\": \"Name\",\r\n        \"common.normal\": \"Normal\",\r\n        \"common.opacity\": \"Opacity\",\r\n        \"common.thickness\": \"Thickness\",\r\n        \"common.type\": \"Type\",\r\n        \"common.volume\": \"Volume\",\r\n        \"dialog.title.selectWorkingPlane\": \"Select Working Plane\",\r\n        \"entity.editable\": \"Editable Entity\",\r\n        \"entity.parameter\": \"Parameter Entity\",\r\n        \"error.default:{0}\": \"error: {0}\",\r\n        \"error.input.cannotInputANumber\": \"Overlap with reference point, 1 number cannot be entered\",\r\n        \"error.input.invalidNumber\": \"Please enter a valid number, separated by ,\",\r\n        \"error.input.threeNumberCanBeInput\": \"Reference point is empty, only 3 numbers can be entered\",\r\n        \"error.input.unsupportedInputs\": \"Exceeds the maximum number of inputs\",\r\n        \"error.import.unsupportedFileType:{0}\": \"Unsupported file type: {0}\",\r\n        \"error.export.noNodeCanBeExported\": \"No node can be exported\",\r\n        \"file.format\": \"Format\",\r\n        \"home.recent\": \"Recent\",\r\n        \"home.welcome\": \"Welcome to chili3d\",\r\n        \"items.header\": \"Items\",\r\n        \"items.tool.delete\": \"Delete\",\r\n        \"items.tool.expandAll\": \"Expand All\",\r\n        \"items.tool.newFolder\": \"New Folder\",\r\n        \"items.tool.unexpandAll\": \"Unexpand all\",\r\n        \"line.end\": \"End\",\r\n        \"line.start\": \"Start\",\r\n        \"line.type.line\": \"Line\",\r\n        \"line.type.xline\": \"XLine\",\r\n        \"material.texture.image\": \"Image\",\r\n        \"material.texture.rotation\": \"Rotation\",\r\n        \"material.texture.wrapS\": \"Wrap S\",\r\n        \"material.texture.wrapT\": \"Wrap T\",\r\n        \"material.texture.repeat\": \"Repeat\",\r\n        \"material.texture.offset\": \"Offset\",\r\n        \"material.map\": \"Map\",\r\n        \"material.specular\": \"Specular\",\r\n        \"material.shininess\": \"Shininess\",\r\n        \"material.emissive\": \"Emissive\",\r\n        \"material.specularMap\": \"Specular Map\",\r\n        \"material.normalMap\": \"Normal Map\",\r\n        \"material.bumpMap\": \"BumpMap\",\r\n        \"material.roughnessMap\": \"Roughness Map\",\r\n        \"material.emissiveMap\": \"Emissive Map\",\r\n        \"material.metalness\": \"Metalness\",\r\n        \"material.metalnessMap\": \"Metalness Map\",\r\n        \"material.roughness\": \"Roughness\",\r\n        \"model.visible\": \"Visible\",\r\n        \"option.command.repeat\": \"Repeat\",\r\n        \"option.command.isFace\": \"Face\",\r\n        \"option.command.thickness\": \"Thickness\",\r\n        \"option.command.isConnected\": \"Connected\",\r\n        \"option.command.isConvertInstance\": \"Convert Instance\",\r\n        \"option.command.insertPoint\": \"Insert Point\",\r\n        \"polygon.points\": \"Points\",\r\n        \"prompt.default\":\r\n            \"Middle mouse button to pan the view, Shift + Middle button to rotate the view, Middle button to scroll the zoom view\",\r\n        \"prompt.deleteDocument{0}\": \"Do you want to delete {0}?\",\r\n        \"prompt.pickCircleCenter\": \"pick center, ESC key to cancel\",\r\n        \"prompt.pickFistPoint\": \"Pick first point, ESC key to cancel\",\r\n        \"prompt.pickNextPoint\": \"pick next point, ESC key to cancel\",\r\n        \"prompt.pickRadius\": \"input radius, ESC key to cancel\",\r\n        \"prompt.polygon.close\": \"Close\",\r\n        \"prompt.saveDocument{0}\": \"Do you want to save the changes to {0}?\",\r\n        \"prompt.select.edges\": \"Please select edges\",\r\n        \"prompt.select.faces\": \"Please select faces\",\r\n        \"prompt.select.models\": \"Please select models\",\r\n        \"prompt.select.noModelSelected\": \"No model selected\",\r\n        \"prompt.select.shape\": \"Please select shape\",\r\n        \"prompt.select.solids\": \"Please select solids\",\r\n        \"prompt.select.vertexes\": \"Please select vertexes\",\r\n        \"prompt.select.wires\": \"Please select wires\",\r\n        \"toast.snap.notFoundValidPoint\": \"No valid point\",\r\n        \"properties.group.transform\": \"Transform\",\r\n        \"properties.header\": \"Properties\",\r\n        \"properties.multivalue\": \"Multi Value\",\r\n        \"rect.dx\": \"Length\",\r\n        \"rect.dy\": \"Width\",\r\n        \"ribbon.group.2d\": \"2D\",\r\n        \"ribbon.group.3d\": \"3D\",\r\n        \"ribbon.group.act\": \"Act\",\r\n        \"ribbon.group.boolean\": \"Boolean\",\r\n        \"ribbon.group.converter\": \"Converter\",\r\n        \"ribbon.group.draw\": \"Drawing\",\r\n        \"ribbon.group.importExport\": \"Import/Export\",\r\n        \"ribbon.group.measure\": \"Measure\",\r\n        \"ribbon.group.modify\": \"Modify\",\r\n        \"ribbon.group.other\": \"Other\",\r\n        \"ribbon.group.selection\": \"Selection\",\r\n        \"ribbon.group.tools\": \"Tools\",\r\n        \"ribbon.group.workingPlane\": \"Working Plane\",\r\n        \"ribbon.tab.draw\": \"Drawing\",\r\n        \"ribbon.tab.file\": \"File\",\r\n        \"ribbon.tab.tools\": \"Tools\",\r\n        \"ribbon.tab.startup\": \"Startup\",\r\n        \"snap.center\": \"Center\",\r\n        \"snap.end\": \"End\",\r\n        \"snap.intersection\": \"Intersection\",\r\n        \"snap.mid\": \"Middle\",\r\n        \"snap.perpendicular\": \"Perpendicular\",\r\n        \"snap.nearest\": \"Nearest\",\r\n        \"statusBar.snap\": \"Snap\",\r\n        \"statusBar.tracking\": \"Tracking\",\r\n        \"toast.command.{0}excuting\": \"Command {0} is runing\",\r\n        \"toast.converter.error\": \"Converter error\",\r\n        \"toast.converter.invalidColor\": \"The color is invalid\",\r\n        \"toast.delete{0}Objects\": \"Deleted {0} objects\",\r\n        \"toast.document.noActivated\": \"No document activated\",\r\n        \"toast.document.saved\": \"Document saved\",\r\n        \"toast.downloading\": \"Downloading\",\r\n        \"toast.excuting{0}\": \"Excuting {0}\",\r\n        \"toast.fail\": \"Fail\",\r\n        \"toast.read.error\": \"Read error\",\r\n        \"toast.select.noSelected\": \"No selected\",\r\n        \"toast.success\": \"Success\",\r\n        \"transform.rotation\": \"Rotation\",\r\n        \"transform.scale\": \"Scale\",\r\n        \"transform.translation\": \"Translation\",\r\n        \"vertex.point\": \"Point\",\r\n    },\r\n} satisfies Locale;\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Locale } from \"./i18n\";\r\n\r\nexport default {\r\n    display: \"简体中文\",\r\n    code: \"zh-CN\",\r\n    translation: {\r\n        \"arc.angle\": \"角度\",\r\n        \"arc.start\": \"起点\",\r\n        \"axis.x\": \"X 轴\",\r\n        \"axis.y\": \"Y 轴\",\r\n        \"axis.z\": \"Z 轴\",\r\n        \"body.arc\": \"圆弧\",\r\n        \"body.bolean\": \"布尔\",\r\n        \"body.box\": \"立方体\",\r\n        \"body.pyramid\": \"棱锥\",\r\n        \"body.cylinder\": \"圆柱\",\r\n        \"body.cone\": \"圆锥\",\r\n        \"body.group\": \"组\",\r\n        \"body.sphere\": \"球体\",\r\n        \"body.ellipse\": \"椭圆\",\r\n        \"body.circle\": \"圆形\",\r\n        \"body.face\": \"面\",\r\n        \"body.fuse\": \"合并\",\r\n        \"body.imported\": \"导入的模型\",\r\n        \"body.line\": \"直线\",\r\n        \"body.polygon\": \"多边形\",\r\n        \"body.prism\": \"拉伸\",\r\n        \"body.rect\": \"矩形\",\r\n        \"body.revol\": \"旋转\",\r\n        \"body.sweep\": \"扫略\",\r\n        \"body.wire\": \"线框\",\r\n        \"body.editableShape\": \"可编辑的形状\",\r\n        \"body.meshNode\": \"网格节点\",\r\n        \"body.multiShape\": \"多形状\",\r\n        \"box.dx\": \"长\",\r\n        \"box.dy\": \"宽\",\r\n        \"box.dz\": \"高\",\r\n        \"circle.center\": \"圆心\",\r\n        \"circle.radius\": \"半径\",\r\n        \"ellipsoid.radiusX\": \"半径X\",\r\n        \"ellipsoid.radiusY\": \"半径Y\",\r\n        \"ellipsoid.radiusZ\": \"半径Z\",\r\n        \"ellipse.majorRadius\": \"长轴\",\r\n        \"ellipse.minorRadius\": \"短轴\",\r\n        \"command.act.alignCamera\": \"对齐相机\",\r\n        \"command.boolean.common\": \"交集\",\r\n        \"command.boolean.cut\": \"减去\",\r\n        \"command.boolean.join\": \"合并\",\r\n        \"command.convert.fuse\": \"融合\",\r\n        \"command.convert.revol\": \"旋转\",\r\n        \"command.convert.sweep\": \"扫略\",\r\n        \"command.convert.toFace\": \"转为面\",\r\n        \"command.convert.toShell\": \"转为壳\",\r\n        \"command.convert.toSolid\": \"转为体\",\r\n        \"command.convert.toWire\": \"转多段线\",\r\n        \"command.create.arc\": \"圆弧\",\r\n        \"command.create.bezier\": \"贝塞尔\",\r\n        \"command.create.box\": \"立方体\",\r\n        \"command.create.circle\": \"圆形\",\r\n        \"command.create.cone\": \"圆锥\",\r\n        \"command.create.copyShape\": \"复制形状\",\r\n        \"command.create.cylinder\": \"圆柱\",\r\n        \"command.create.ellipse\": \"椭圆\",\r\n        \"command.create.ellipsoid\": \"椭球体\",\r\n        \"command.create.extrude\": \"拉伸\",\r\n        \"command.create.folder\": \"文件夹\",\r\n        \"command.create.group\": \"创建组\",\r\n        \"command.create.line\": \"直线\",\r\n        \"command.create.offset\": \"偏移\",\r\n        \"command.create.polygon\": \"多边形\",\r\n        \"command.create.pyramid\": \"金字塔\",\r\n        \"command.create.rect\": \"矩形\",\r\n        \"command.create.section\": \"截面\",\r\n        \"command.create.sphere\": \"球体\",\r\n        \"command.create.thickSolid\": \"厚体\",\r\n        \"command.doc.new\": \"新建文档\",\r\n        \"command.doc.open\": \"打开文档\",\r\n        \"command.doc.save\": \"保存文档\",\r\n        \"command.doc.saveToFile\": \"保存到文件\",\r\n        \"command.edit.redo\": \"重做\",\r\n        \"command.edit.undo\": \"撤销\",\r\n        \"command.file.export\": \"导出\",\r\n        \"command.file.import\": \"导入\",\r\n        \"command.measure.angle\": \"角度\",\r\n        \"command.measure.length\": \"长度\",\r\n        \"command.measure.select\": \"选择\",\r\n        \"command.modify.array\": \"阵列\",\r\n        \"command.modify.break\": \"打断\",\r\n        \"command.modify.brushAdd\": \"添加画笔\",\r\n        \"command.modify.brushRemove\": \"删除画笔\",\r\n        \"command.modify.brushClear\": \"清除画笔\",\r\n        \"command.modify.chamfer\": \"倒角\",\r\n        \"command.modify.deleteNode\": \"删除节点\",\r\n        \"command.modify.explode\": \"分解\",\r\n        \"command.modify.fillet\": \"倒角\",\r\n        \"command.modify.mirror\": \"镜像\",\r\n        \"command.modify.move\": \"移动\",\r\n        \"command.modify.removeFeature\": \"删除特征\",\r\n        \"command.modify.removeShapes\": \"删除图形\",\r\n        \"command.modify.rotate\": \"旋转\",\r\n        \"command.modify.split\": \"分割\",\r\n        \"command.modify.trim\": \"修剪\",\r\n        \"command.special.last\": \"__上一步__\",\r\n        \"command.test.performace\": \"性能测试\",\r\n        \"command.wechat.group\": \"微信群\",\r\n        \"command.workingPlane.alignToPlane\": \"对齐\",\r\n        \"command.workingPlane.fromSection\": \"从截面\",\r\n        \"command.workingPlane.set\": \"设置\",\r\n        \"command.workingPlane.toggleDynamic\": \"动态\",\r\n        \"common.angle\": \"角度\",\r\n        \"common.area\": \"面积\",\r\n        \"common.back\": \"返回\",\r\n        \"common.cancel\": \"取消\",\r\n        \"common.clone\": \"复制对象\",\r\n        \"common.color\": \"颜色\",\r\n        \"common.confirm\": \"确定\",\r\n        \"common.general\": \"常规\",\r\n        \"common.length\": \"长度\",\r\n        \"common.material\": \"材质\",\r\n        \"common.matrix\": \"矩阵\",\r\n        \"common.name\": \"名称\",\r\n        \"common.normal\": \"法向量\",\r\n        \"common.opacity\": \"不透明度\",\r\n        \"common.thickness\": \"厚度\",\r\n        \"common.type\": \"类型\",\r\n        \"common.volume\": \"体积\",\r\n        \"dialog.title.selectWorkingPlane\": \"选择工作平面\",\r\n        \"entity.editable\": \"可编辑实体\",\r\n        \"entity.parameter\": \"参数化实体\",\r\n        \"error.default:{0}\": \"错误: {0}\",\r\n        \"error.input.cannotInputANumber\": \"与参照点重合，无法输入 1 个数\",\r\n        \"error.input.invalidNumber\": \"输入错误，请输入有效的数字，以,分开\",\r\n        \"error.input.threeNumberCanBeInput\": \"参照点为空，只能输入 3 个数\",\r\n        \"error.input.unsupportedInputs\": \"超过最大输入数\",\r\n        \"error.import.unsupportedFileType:{0}\": \"不支持的文件类型: {0}\",\r\n        \"error.export.noNodeCanBeExported\": \"没有可导出的节点\",\r\n        \"file.format\": \"文件格式\",\r\n        \"home.recent\": \"最近使用\",\r\n        \"home.welcome\": \"欢迎使用 chili3d\",\r\n        \"items.header\": \"项目\",\r\n        \"items.tool.delete\": \"删除\",\r\n        \"items.tool.expandAll\": \"展开所有\",\r\n        \"items.tool.newFolder\": \"文件夹\",\r\n        \"items.tool.unexpandAll\": \"折叠所有\",\r\n        \"line.end\": \"终点\",\r\n        \"line.start\": \"起点\",\r\n        \"line.type.line\": \"直线\",\r\n        \"line.type.xline\": \"构造线\",\r\n        \"material.texture.image\": \"图片\",\r\n        \"material.texture.rotation\": \"旋转\",\r\n        \"material.texture.wrapS\": \"Wrap S\",\r\n        \"material.texture.wrapT\": \"Wrap T\",\r\n        \"material.texture.repeat\": \"重复\",\r\n        \"material.texture.offset\": \"偏移\",\r\n        \"material.map\": \"贴图\",\r\n        \"material.specular\": \"高光\",\r\n        \"material.shininess\": \"高光强度\",\r\n        \"material.emissive\": \"自发光\",\r\n        \"material.specularMap\": \"高光贴图\",\r\n        \"material.normalMap\": \"法线贴图\",\r\n        \"material.bumpMap\": \"凹凸贴图\",\r\n        \"material.roughnessMap\": \"粗糙度贴图\",\r\n        \"material.emissiveMap\": \"自发光贴图\",\r\n        \"material.metalness\": \"金属度\",\r\n        \"material.metalnessMap\": \"金属度贴图\",\r\n        \"material.roughness\": \"粗糙度\",\r\n        \"model.visible\": \"可见\",\r\n        \"option.command.repeat\": \"重复\",\r\n        \"option.command.isFace\": \"面\",\r\n        \"option.command.thickness\": \"厚度\",\r\n        \"option.command.isConnected\": \"相连\",\r\n        \"option.command.isConvertInstance\": \"转为实例\",\r\n        \"option.command.insertPoint\": \"插入点\",\r\n        \"polygon.points\": \"点\",\r\n        \"prompt.default\": \"鼠标中键平移视图，Shift + 中键旋转视图，中键滚动缩放视图\",\r\n        \"prompt.deleteDocument{0}\": \"是否删除 {0} ？\",\r\n        \"prompt.pickCircleCenter\": \"请选择圆心  按 ESC 键取消\",\r\n        \"prompt.pickFistPoint\": \"请选择第一个点, 按 ESC 键取消\",\r\n        \"prompt.pickNextPoint\": \"请选择下一个点， 按 ESC 键取消\",\r\n        \"prompt.pickRadius\": \"请选择半径，按 ESC 键取消\",\r\n        \"prompt.polygon.close\": \"闭合\",\r\n        \"prompt.saveDocument{0}\": \"是否保存对 {0} 的更改？\",\r\n        \"prompt.select.edges\": \"请选择边\",\r\n        \"prompt.select.faces\": \"请选择面\",\r\n        \"prompt.select.models\": \"请选择模型\",\r\n        \"prompt.select.noModelSelected\": \"未选择任何模型\",\r\n        \"prompt.select.shape\": \"选择形状\",\r\n        \"prompt.select.solids\": \"请选择实体\",\r\n        \"prompt.select.vertexes\": \"请选择点\",\r\n        \"prompt.select.wires\": \"请选择线\",\r\n        \"toast.snap.notFoundValidPoint\": \"未找到有效的点\",\r\n        \"properties.group.transform\": \"转换\",\r\n        \"properties.header\": \"属性\",\r\n        \"properties.multivalue\": \"多个值\",\r\n        \"rect.dx\": \"长\",\r\n        \"rect.dy\": \"宽\",\r\n        \"ribbon.group.2d\": \"2D\",\r\n        \"ribbon.group.3d\": \"3D\",\r\n        \"ribbon.group.act\": \"场景\",\r\n        \"ribbon.group.boolean\": \"布尔运算\",\r\n        \"ribbon.group.converter\": \"转换\",\r\n        \"ribbon.group.draw\": \"绘制\",\r\n        \"ribbon.group.importExport\": \"导入/导出\",\r\n        \"ribbon.group.measure\": \"测量\",\r\n        \"ribbon.group.modify\": \"修改\",\r\n        \"ribbon.group.other\": \"其他\",\r\n        \"ribbon.group.selection\": \"选择\",\r\n        \"ribbon.group.tools\": \"工具\",\r\n        \"ribbon.group.workingPlane\": \"工作平面\",\r\n        \"ribbon.tab.draw\": \"绘图\",\r\n        \"ribbon.tab.file\": \"文件\",\r\n        \"ribbon.tab.tools\": \"工具\",\r\n        \"ribbon.tab.startup\": \"开始\",\r\n        \"snap.center\": \"圆心\",\r\n        \"snap.end\": \"端点\",\r\n        \"snap.intersection\": \"交点\",\r\n        \"snap.mid\": \"中点\",\r\n        \"snap.perpendicular\": \"垂点\",\r\n        \"snap.nearest\": \"最近点\",\r\n        \"statusBar.snap\": \"捕捉\",\r\n        \"statusBar.tracking\": \"追踪\",\r\n        \"toast.command.{0}excuting\": \"{0}命令正在执行\",\r\n        \"toast.converter.error\": \"转换错误\",\r\n        \"toast.converter.invalidColor\": \"无效的颜色\",\r\n        \"toast.delete{0}Objects\": \"删除了 {0} 个对象\",\r\n        \"toast.document.noActivated\": \"未打开任何文档\",\r\n        \"toast.document.saved\": \"文档已保存\",\r\n        \"toast.downloading\": \"正在下载\",\r\n        \"toast.excuting{0}\": \"正在执行{0}\",\r\n        \"toast.fail\": \"失败\",\r\n        \"toast.read.error\": \"读取错误\",\r\n        \"toast.select.noSelected\": \"未选择任何对象\",\r\n        \"toast.success\": \"成功\",\r\n        \"transform.rotation\": \"旋转\",\r\n        \"transform.scale\": \"缩放\",\r\n        \"transform.translation\": \"位移\",\r\n        \"vertex.point\": \"点\",\r\n    },\r\n} satisfies Locale;\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport en from \"./en\";\r\nimport { I18nKeys } from \"./keys\";\r\nimport zh from \"./zh-cn\";\r\n\r\nconst I18nId = \"chili18n\";\r\nconst I18nArgs = new WeakMap<HTMLElement, any[]>();\r\n\r\nexport type LanguageCode = \"zh-CN\" | \"en\";\r\n\r\nexport type Locale = {\r\n    display: string;\r\n    code: LanguageCode;\r\n    translation: {\r\n        [key in I18nKeys]: string;\r\n    } & {\r\n        [key: string]: string;\r\n    };\r\n};\r\n\r\nexport type I18nPath = \"textContent\" | \"title\";\r\n\r\nexport class Localize {\r\n    constructor(readonly key: I18nKeys) {}\r\n\r\n    set(e: HTMLElement, path: I18nPath) {\r\n        I18n.set(e, path, this.key);\r\n    }\r\n}\r\n\r\nexport type Translation = Record<I18nKeys, string>;\r\n\r\nexport namespace I18n {\r\n    export const languages = new Map<LanguageCode, Locale>([\r\n        [\"en\", en],\r\n        [\"zh-CN\", zh],\r\n    ]);\r\n\r\n    let _currentLanguage: LanguageCode = navigator.language.toLowerCase() === \"zh-cn\" ? \"zh-CN\" : \"en\";\r\n\r\n    export function currentLanguage() {\r\n        return _currentLanguage;\r\n    }\r\n\r\n    export function combineTranslation(language: LanguageCode, translations: Record<string, string>) {\r\n        let local = languages.get(language);\r\n        if (local) {\r\n            local.translation = {\r\n                ...local.translation,\r\n                ...translations,\r\n            };\r\n        }\r\n    }\r\n\r\n    export function translate(key: I18nKeys, ...args: any[]) {\r\n        let language = languages.get(_currentLanguage)!;\r\n        let text = language.translation[key] ?? languages.get(\"zh-CN\")!.translation[key];\r\n        if (args.length > 0) {\r\n            text = text.replace(/\\{(\\d+)\\}/g, (_, index) => args[index]);\r\n        }\r\n        return text;\r\n    }\r\n\r\n    export function isI18nKey(key: string): key is I18nKeys {\r\n        return key in languages.get(\"zh-CN\")!.translation;\r\n    }\r\n\r\n    const LINK_KEY = \"_:_\";\r\n\r\n    export function set(dom: HTMLElement, path: I18nPath, key: I18nKeys, ...args: any[]) {\r\n        dom[path] = translate(key, ...args);\r\n        dom.dataset[I18nId] = `${key}${LINK_KEY}${path}`;\r\n        if (args.length > 0) {\r\n            I18nArgs.set(dom, args);\r\n        }\r\n    }\r\n\r\n    export function changeLanguage(index: number) {\r\n        if (index < 0 || index >= languages.size) return;\r\n\r\n        let newLanguage = Array.from(languages.keys())[index];\r\n        if (newLanguage === _currentLanguage) return;\r\n        _currentLanguage = newLanguage;\r\n\r\n        document.querySelectorAll(`[data-${I18nId}]`).forEach((e) => {\r\n            let html = e as HTMLElement;\r\n            let data = html?.dataset[I18nId]?.split(LINK_KEY);\r\n            if (data?.length !== 2) return;\r\n            let args = I18nArgs.get(html) ?? [];\r\n            html[data[1] as I18nPath] = translate(data[0] as I18nKeys, ...args);\r\n        });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Precision } from \"../foundation\";\r\n\r\nexport class MathUtils {\r\n    static degToRad(degrees: number) {\r\n        return degrees * (Math.PI / 180);\r\n    }\r\n\r\n    static radToDeg(radians: number) {\r\n        return radians * (180 / Math.PI);\r\n    }\r\n\r\n    static anyEqualZero(...values: number[]) {\r\n        return values.some((value) => Math.abs(value) < Precision.Float);\r\n    }\r\n\r\n    static allEqualZero(...values: number[]) {\r\n        return values.every((value) => Math.abs(value) < Precision.Float);\r\n    }\r\n\r\n    static almostEqual(a: number, b: number, tolerance = 1e-6) {\r\n        return Math.abs(a - b) < tolerance;\r\n    }\r\n\r\n    static clamp(value: number, min: number, max: number) {\r\n        return Math.max(min, Math.min(max, value));\r\n    }\r\n\r\n    static minMax(values: ArrayLike<number>) {\r\n        if (values.length === 0) return undefined;\r\n\r\n        let min = values[0];\r\n        let max = values[0];\r\n\r\n        for (let i = 1; i < values.length; i++) {\r\n            const value = values[i];\r\n            if (value < min) min = value;\r\n            if (value > max) max = value;\r\n        }\r\n\r\n        return { min, max };\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Precision } from \"../foundation\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { MathUtils } from \"./mathUtils\";\r\n\r\nexport type XYZLike = { x: number; y: number; z: number };\r\n\r\n@Serializer.register([\"x\", \"y\", \"z\"])\r\nexport class XYZ {\r\n    static readonly zero = new XYZ(0, 0, 0);\r\n    static readonly unitX = new XYZ(1, 0, 0);\r\n    static readonly unitY = new XYZ(0, 1, 0);\r\n    static readonly unitZ = new XYZ(0, 0, 1);\r\n    static readonly one = new XYZ(1, 1, 1);\r\n\r\n    @Serializer.serialze()\r\n    readonly x: number;\r\n    @Serializer.serialze()\r\n    readonly y: number;\r\n    @Serializer.serialze()\r\n    readonly z: number;\r\n\r\n    constructor(x: number, y: number, z: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n\r\n    toString() {\r\n        return `${this.x}, ${this.y}, ${this.z}`;\r\n    }\r\n\r\n    toArray(): number[] {\r\n        return [this.x, this.y, this.z];\r\n    }\r\n\r\n    cross(right: XYZLike): XYZ {\r\n        return new XYZ(\r\n            this.y * right.z - this.z * right.y,\r\n            this.z * right.x - this.x * right.z,\r\n            this.x * right.y - this.y * right.x,\r\n        );\r\n    }\r\n\r\n    dot(right: XYZLike): number {\r\n        return this.x * right.x + this.y * right.y + this.z * right.z;\r\n    }\r\n\r\n    divided(scalar: number): XYZ | undefined {\r\n        if (Math.abs(scalar) < Precision.Float) return undefined;\r\n        return new XYZ(this.x / scalar, this.y / scalar, this.z / scalar);\r\n    }\r\n\r\n    reverse(): XYZ {\r\n        return new XYZ(-this.x, -this.y, -this.z);\r\n    }\r\n\r\n    multiply(scalar: number): XYZ {\r\n        return new XYZ(this.x * scalar, this.y * scalar, this.z * scalar);\r\n    }\r\n\r\n    sub(right: XYZLike): XYZ {\r\n        return new XYZ(this.x - right.x, this.y - right.y, this.z - right.z);\r\n    }\r\n\r\n    add(right: XYZLike): XYZ {\r\n        return new XYZ(this.x + right.x, this.y + right.y, this.z + right.z);\r\n    }\r\n\r\n    normalize(): XYZ | undefined {\r\n        const d = this.length();\r\n        return d < Precision.Float ? undefined : new XYZ(this.x / d, this.y / d, this.z / d);\r\n    }\r\n\r\n    distanceTo(right: XYZLike): number {\r\n        const dx = this.x - right.x;\r\n        const dy = this.y - right.y;\r\n        const dz = this.z - right.z;\r\n        return Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n    }\r\n\r\n    static center(p1: XYZLike, p2: XYZLike): XYZ {\r\n        return new XYZ((p1.x + p2.x) / 2, (p1.y + p2.y) / 2, (p1.z + p2.z) / 2);\r\n    }\r\n\r\n    lengthSq(): number {\r\n        return this.x * this.x + this.y * this.y + this.z * this.z;\r\n    }\r\n\r\n    length(): number {\r\n        return Math.sqrt(this.lengthSq());\r\n    }\r\n\r\n    /**\r\n     * Computes the angular value in radians between me and right\r\n     * @param right vector\r\n     * @returns [0, PI]\r\n     */\r\n    angleTo(right: XYZLike): number | undefined {\r\n        if (this.isEqualTo(XYZ.zero) || XYZ.zero.isEqualTo(right)) return undefined;\r\n        let cross = this.cross(right);\r\n        let dot = this.dot(right);\r\n        // tan(x) = |a||b|sin(x) / |a||b|cos(x)\r\n        return Math.atan2(cross.length(), dot);\r\n    }\r\n\r\n    /**\r\n     * Computes the angular value in radians between me and right on plane\r\n     * @param right vector\r\n     * @param normal plane normal\r\n     * @returns [0, 2PI]\r\n     */\r\n    angleOnPlaneTo(right: XYZLike, normal: XYZLike): number | undefined {\r\n        const angle = this.angleTo(right);\r\n        if (angle === undefined || XYZ.zero.isEqualTo(normal)) return undefined;\r\n        const vec = this.cross(right).normalize();\r\n        return vec?.isOppositeTo(normal) ? Math.PI * 2 - angle : angle;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param normal rotate axis\r\n     * @param angle angular value in radians\r\n     * @returns\r\n     */\r\n    rotate(normal: XYZ, angle: number): XYZ | undefined {\r\n        const n = normal.normalize();\r\n        if (n === undefined) return undefined;\r\n        const cos = Math.cos(angle);\r\n        return this.multiply(cos)\r\n            .add(n.multiply((1 - cos) * n.dot(this)))\r\n            .add(n.cross(this).multiply(Math.sin(angle)));\r\n    }\r\n\r\n    isEqualTo(right: XYZLike, tolerance: number = 1e-8) {\r\n        return (\r\n            MathUtils.almostEqual(this.x, right.x, tolerance) &&\r\n            MathUtils.almostEqual(this.y, right.y, tolerance) &&\r\n            MathUtils.almostEqual(this.z, right.z, tolerance)\r\n        );\r\n    }\r\n\r\n    isParallelTo(right: XYZLike, tolerance: number = 1e-8): boolean | undefined {\r\n        const angle = this.angleTo(right);\r\n        return angle === undefined ? undefined : angle <= tolerance || Math.PI - angle <= tolerance;\r\n    }\r\n\r\n    isOppositeTo(right: XYZLike, tolerance: number = 1e-8): boolean | undefined {\r\n        const angle = this.angleTo(right);\r\n        return angle === undefined ? undefined : Math.PI - angle <= tolerance;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { EdgeMeshData, LineType } from \"../shape\";\r\nimport { Matrix4 } from \"./matrix4\";\r\nimport { XYZ } from \"./xyz\";\r\n\r\nexport type PointLike = { x: number; y: number; z: number };\r\n\r\nexport class BoundingBox {\r\n    constructor(\r\n        readonly min: PointLike,\r\n        readonly max: PointLike,\r\n    ) {}\r\n\r\n    static readonly zero = new BoundingBox(new XYZ(0, 0, 0), new XYZ(0, 0, 0));\r\n\r\n    static transformed(box: BoundingBox, matrix: Matrix4) {\r\n        const min = matrix.ofPoint(box.min);\r\n        const max = matrix.ofPoint(box.max);\r\n\r\n        return new BoundingBox(min, max);\r\n    }\r\n\r\n    static center(box: BoundingBox | undefined) {\r\n        if (!box) {\r\n            return XYZ.zero;\r\n        }\r\n\r\n        const x = (box.min.x + box.max.x) / 2;\r\n        const y = (box.min.y + box.max.y) / 2;\r\n        const z = (box.min.z + box.max.z) / 2;\r\n\r\n        return new XYZ(x, y, z);\r\n    }\r\n\r\n    static expand(box: BoundingBox, value: number) {\r\n        const min = {\r\n            x: box.min.x - value,\r\n            y: box.min.y - value,\r\n            z: box.min.z - value,\r\n        };\r\n        const max = {\r\n            x: box.max.x + value,\r\n            y: box.max.y + value,\r\n            z: box.max.z + value,\r\n        };\r\n\r\n        return new BoundingBox(min, max);\r\n    }\r\n\r\n    static wireframe(box: BoundingBox): EdgeMeshData {\r\n        const { min, max } = box;\r\n        const position = [\r\n            min.x, min.y, min.z, min.x, min.y, max.z, // z\r\n            min.x, min.y, max.z, min.x, max.y, max.z, // y\r\n            min.x, max.y, max.z, min.x, max.y, min.z, // z\r\n            min.x, max.y, min.z, min.x, min.y, min.z, // y\r\n            max.x, min.y, min.z, max.x, min.y, max.z, // z\r\n            max.x, min.y, max.z, max.x, max.y, max.z, // y\r\n            max.x, max.y, max.z, max.x, max.y, min.z, // z\r\n            max.x, max.y, min.z, max.x, min.y, min.z, // y\r\n            min.x, min.y, min.z, max.x, min.y, min.z, // x\r\n            min.x, min.y, max.z, max.x, min.y, max.z, // x\r\n            min.x, max.y, max.z, max.x, max.y, max.z, // x\r\n            min.x, max.y, min.z, max.x, max.y, min.z, // x\r\n        ];\r\n        return {\r\n            position: new Float32Array(position),\r\n            lineType: LineType.Solid,\r\n            range: [],\r\n        };\r\n    }\r\n\r\n    static isValid(box: BoundingBox) {\r\n        return box.min.x <= box.max.x && box.min.y <= box.max.y && box.min.z <= box.max.z;\r\n    }\r\n\r\n    static expandByPoint(box: BoundingBox, point: PointLike) {\r\n        const { min, max } = box;\r\n        min.x = Math.min(min.x, point.x);\r\n        min.y = Math.min(min.y, point.y);\r\n        min.z = Math.min(min.z, point.z);\r\n        max.x = Math.max(max.x, point.x);\r\n        max.y = Math.max(max.y, point.y);\r\n        max.z = Math.max(max.z, point.z);\r\n    }\r\n\r\n    static combine(box1: BoundingBox | undefined, box2: BoundingBox | undefined) {\r\n        if (!box2) {\r\n            return box1;\r\n        }\r\n\r\n        if (!box1) {\r\n            return box2;\r\n        }\r\n\r\n        const min = {\r\n            x: Math.min(box1.min.x, box2.min.x),\r\n            y: Math.min(box1.min.y, box2.min.y),\r\n            z: Math.min(box1.min.z, box2.min.z),\r\n        };\r\n        const max = {\r\n            x: Math.max(box1.max.x, box2.max.x),\r\n            y: Math.max(box1.max.y, box2.max.y),\r\n            z: Math.max(box1.max.z, box2.max.z),\r\n        };\r\n        return new BoundingBox(min, max);\r\n    }\r\n\r\n    static fromNumbers(points: ArrayLike<number>): BoundingBox {\r\n        const min = { x: Infinity, y: Infinity, z: Infinity };\r\n        const max = { x: -Infinity, y: -Infinity, z: -Infinity };\r\n\r\n        for (let i = 0; i < points.length; i += 3) {\r\n            const x = points[i];\r\n            const y = points[i + 1];\r\n            const z = points[i + 2];\r\n\r\n            min.x = Math.min(min.x, x);\r\n            min.y = Math.min(min.y, y);\r\n            min.z = Math.min(min.z, z);\r\n            max.x = Math.max(max.x, x);\r\n            max.y = Math.max(max.y, y);\r\n            max.z = Math.max(max.z, z);\r\n        }\r\n        return new BoundingBox(min, max);\r\n    }\r\n\r\n    static fromPoints(points: PointLike[]): BoundingBox {\r\n        const min = { x: Infinity, y: Infinity, z: Infinity };\r\n        const max = { x: -Infinity, y: -Infinity, z: -Infinity };\r\n\r\n        for (const point of points) {\r\n            min.x = Math.min(min.x, point.x);\r\n            min.y = Math.min(min.y, point.y);\r\n            min.z = Math.min(min.z, point.z);\r\n            max.x = Math.max(max.x, point.x);\r\n            max.y = Math.max(max.y, point.y);\r\n            max.z = Math.max(max.z, point.z);\r\n        }\r\n        return new BoundingBox(min, max);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Matrix4 } from \"./matrix4\";\r\n\r\nexport class Quaternion {\r\n    readonly w: number;\r\n    readonly x: number;\r\n    readonly y: number;\r\n    readonly z: number;\r\n    constructor(w = 1, x = 0, y = 0, z = 0) {\r\n        this.w = w;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n    add(q: Quaternion): Quaternion {\r\n        return new Quaternion(this.w + q.w, this.x + q.x, this.y + q.y, this.z + q.z);\r\n    }\r\n    subtract(q: Quaternion): Quaternion {\r\n        return new Quaternion(this.w - q.w, this.x - q.x, this.y - q.y, this.z - q.z);\r\n    }\r\n    multiply(q: Quaternion): Quaternion {\r\n        const { w: w1, x: x1, y: y1, z: z1 } = this;\r\n        const { w: w2, x: x2, y: y2, z: z2 } = q;\r\n\r\n        return new Quaternion(\r\n            w1 * w2 - x1 * x2 - y1 * y2 - z1 * z2,\r\n            w1 * x2 + x1 * w2 + y1 * z2 - z1 * y2,\r\n            w1 * y2 - x1 * z2 + y1 * w2 + z1 * x2,\r\n            w1 * z2 + x1 * y2 - y1 * x2 + z1 * w2,\r\n        );\r\n    }\r\n    toEuler(): { x: number; y: number; z: number } {\r\n        let sig = 0.499;\r\n        let [qw, qx, qy, qz] = [this.w, this.x, this.y, this.z];\r\n        let [sqw, sqx, sqy, sqz] = [qw * qw, qx * qx, qy * qy, qz * qz];\r\n        let unit = sqx + sqz + sqy + sqw;\r\n        let test = qx * qz + qy * qw;\r\n        if (test > sig * unit) {\r\n            return {\r\n                x: 0,\r\n                y: Math.PI / 4,\r\n                z: Math.atan2(qx, qw) * 2,\r\n            };\r\n        } else if (test < -sig * unit) {\r\n            return {\r\n                x: 0,\r\n                y: -Math.PI / 4,\r\n                z: Math.atan2(qx, qw) * 2,\r\n            };\r\n        } else {\r\n            return {\r\n                x: Math.atan2(2 * (-qy * qz + qx * qw), 1 - 2 * (sqx + sqy)),\r\n                y: Math.asin(2 * (qx * qz + qy * qw)),\r\n                z: Math.atan2(2 * (-qx * qy + qz * qw), 1 - 2 * (sqy + sqz)),\r\n            };\r\n        }\r\n    }\r\n    toMatrix4(): Matrix4 {\r\n        const x2 = this.x * this.x;\r\n        const y2 = this.y * this.y;\r\n        const z2 = this.z * this.z;\r\n\r\n        const xx2 = x2 * this.x;\r\n        const xy2 = x2 * this.y;\r\n        const xz2 = x2 * this.z;\r\n\r\n        const yy2 = y2 * this.y;\r\n        const yz2 = y2 * this.z;\r\n        const zz2 = z2 * this.z;\r\n\r\n        const sy2 = y2 * this.w;\r\n        const sz2 = z2 * this.w;\r\n        const sx2 = x2 * this.w;\r\n\r\n        return Matrix4.fromArray([\r\n            1 - yy2 - zz2,\r\n            xy2 + sz2,\r\n            xz2 - sy2,\r\n            0,\r\n            xy2 - sz2,\r\n            1 - xx2 - zz2,\r\n            yz2 + sx2,\r\n            0,\r\n            xz2 + sy2,\r\n            yz2 - sx2,\r\n            1 - xx2 - yy2,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            1,\r\n        ]);\r\n    }\r\n    static fromEuler(roll: number, pitch: number, yaw: number): Quaternion {\r\n        const halfRoll = roll * 0.5;\r\n        const halfPitch = pitch * 0.5;\r\n        const halfYaw = yaw * 0.5;\r\n\r\n        const cr = Math.cos(halfRoll);\r\n        const sr = Math.sin(halfRoll);\r\n        const cp = Math.cos(halfPitch);\r\n        const sp = Math.sin(halfPitch);\r\n        const cy = Math.cos(halfYaw);\r\n        const sy = Math.sin(halfYaw);\r\n\r\n        return new Quaternion(\r\n            -sr * sp * sy + cr * cp * cy,\r\n            sr * cp * cy + cr * sp * sy,\r\n            -sr * cp * sy + cr * sp * cy,\r\n            cr * cp * sy + sr * sp * cy,\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Serializer } from \"../serialize\";\r\nimport { MathUtils } from \"./mathUtils\";\r\nimport { Plane } from \"./plane\";\r\nimport { Quaternion } from \"./quaternion\";\r\nimport { XYZ, XYZLike } from \"./xyz\";\r\n\r\n/**\r\n * Matrix in column-major order\r\n */\r\n@Serializer.register([\"array\"], (array: Float32Array) => {\r\n    return Matrix4.fromArray(array);\r\n})\r\nexport class Matrix4 {\r\n    private readonly _array: Float32Array = new Float32Array(16);\r\n    @Serializer.serialze()\r\n    get array(): ReadonlyArray<number> {\r\n        return [...this._array];\r\n    }\r\n\r\n    public determinant(): number {\r\n        let [a00, a01, a02, a03] = [this._array[0], this._array[1], this._array[2], this._array[3]];\r\n        let [a10, a11, a12, a13] = [this._array[4], this._array[5], this._array[6], this._array[7]];\r\n        let [a20, a21, a22, a23] = [this._array[8], this._array[9], this._array[10], this._array[11]];\r\n        let [a30, a31, a32, a33] = [this._array[12], this._array[13], this._array[14], this._array[15]];\r\n\r\n        let b0 = a00 * a11 - a01 * a10;\r\n        let b1 = a00 * a12 - a02 * a10;\r\n        let b2 = a01 * a12 - a02 * a11;\r\n        let b3 = a20 * a31 - a21 * a30;\r\n        let b4 = a20 * a32 - a22 * a30;\r\n        let b5 = a21 * a32 - a22 * a31;\r\n        let b6 = a00 * b5 - a01 * b4 + a02 * b3;\r\n        let b7 = a10 * b5 - a11 * b4 + a12 * b3;\r\n        let b8 = a20 * b2 - a21 * b1 + a22 * b0;\r\n        let b9 = a30 * b2 - a31 * b1 + a32 * b0;\r\n\r\n        return a13 * b6 - a03 * b7 + a33 * b8 - a23 * b9;\r\n    }\r\n\r\n    public toArray(): readonly number[] {\r\n        return [...this._array];\r\n    }\r\n\r\n    public add(other: Matrix4): Matrix4 {\r\n        let result = new Matrix4();\r\n        for (let index = 0; index < 16; index++) {\r\n            result._array[index] = this._array[index] + other._array[index];\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public invert(): Matrix4 | undefined {\r\n        let [a00, a01, a02, a03] = [this._array[0], this._array[1], this._array[2], this._array[3]];\r\n        let [a10, a11, a12, a13] = [this._array[4], this._array[5], this._array[6], this._array[7]];\r\n        let [a20, a21, a22, a23] = [this._array[8], this._array[9], this._array[10], this._array[11]];\r\n        let [a30, a31, a32, a33] = [this._array[12], this._array[13], this._array[14], this._array[15]];\r\n        let b00 = a00 * a11 - a01 * a10;\r\n        let b01 = a00 * a12 - a02 * a10;\r\n        let b02 = a00 * a13 - a03 * a10;\r\n        let b03 = a01 * a12 - a02 * a11;\r\n        let b04 = a01 * a13 - a03 * a11;\r\n        let b05 = a02 * a13 - a03 * a12;\r\n        let b06 = a20 * a31 - a21 * a30;\r\n        let b07 = a20 * a32 - a22 * a30;\r\n        let b08 = a20 * a33 - a23 * a30;\r\n        let b09 = a21 * a32 - a22 * a31;\r\n        let b10 = a21 * a33 - a23 * a31;\r\n        let b11 = a22 * a33 - a23 * a32;\r\n\r\n        let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n        if (det === 0) return undefined;\r\n        det = 1.0 / det;\r\n\r\n        return Matrix4.fromArray([\r\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\r\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\r\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\r\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\r\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\r\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\r\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\r\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\r\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\r\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\r\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\r\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\r\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\r\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\r\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\r\n            (a20 * b03 - a21 * b01 + a22 * b00) * det,\r\n        ]);\r\n    }\r\n\r\n    public multiply(other: Matrix4): Matrix4 {\r\n        const array = new Array(16).fill(0);\r\n        for (let i = 0; i < 4; i++) {\r\n            for (let j = 0; j < 4; j++) {\r\n                for (let k = 0; k < 4; k++) {\r\n                    array[i * 4 + j] += this._array[i * 4 + k] * other._array[k * 4 + j];\r\n                }\r\n            }\r\n        }\r\n        return Matrix4.fromArray(array);\r\n    }\r\n\r\n    public equals(value: Matrix4): boolean {\r\n        for (let i = 0; i < 16; i++) {\r\n            if (!MathUtils.almostEqual(this._array[i], value._array[i])) return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public clone(): Matrix4 {\r\n        return Matrix4.fromArray([...this._array]);\r\n    }\r\n\r\n    public static fromArray(array: ArrayLike<number>): Matrix4 {\r\n        let result = new Matrix4();\r\n        for (let index = 0; index < 16; index++) {\r\n            result._array[index] = array[index];\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public static identity(): Matrix4 {\r\n        return Matrix4.fromArray([\r\n            1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0,\r\n        ]);\r\n    }\r\n\r\n    public static zero(): Matrix4 {\r\n        return Matrix4.fromArray(new Array(16).fill(0));\r\n    }\r\n\r\n    public static fromEuler(x: number, y: number, z: number): Matrix4 {\r\n        let cx = Math.cos(x);\r\n        let sx = Math.sin(x);\r\n        let cy = Math.cos(y);\r\n        let sy = Math.sin(y);\r\n        let cz = Math.cos(z);\r\n        let sz = Math.sin(z);\r\n        return Matrix4.fromArray([\r\n            cy * cz,\r\n            cx * sz + sx * sy * cz,\r\n            sx * sz - cx * sy * cz,\r\n            0,\r\n            -cy * sz,\r\n            cx * cz - sx * sy * sz,\r\n            sx * cz + cx * sy * sz,\r\n            0,\r\n            sy,\r\n            -sx * cy,\r\n            cx * cy,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            1,\r\n        ]);\r\n    }\r\n\r\n    public static fromAxisRad(position: XYZLike, normal: XYZLike, radians: number): Matrix4 {\r\n        let unit = new XYZ(normal.x, normal.y, normal.z).normalize();\r\n        if (unit === undefined) throw new TypeError(\"invalid vector\");\r\n\r\n        let { x, y, z } = unit;\r\n        let s = Math.sin(-radians);\r\n        let c = Math.cos(-radians);\r\n        let t = 1 - c;\r\n\r\n        const array = [\r\n            t * x * x + c,\r\n            t * x * y - z * s,\r\n            t * x * z + y * s,\r\n            0,\r\n            t * x * y + z * s,\r\n            t * y * y + c,\r\n            t * y * z - x * s,\r\n            0,\r\n            t * x * z - y * s,\r\n            t * y * z + x * s,\r\n            t * z * z + c,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            1,\r\n        ];\r\n\r\n        array[12] = position.x - position.x * array[0] - position.y * array[4] - position.z * array[8];\r\n        array[13] = position.y - position.x * array[1] - position.y * array[5] - position.z * array[9];\r\n        array[14] = position.z - position.x * array[2] - position.y * array[6] - position.z * array[10];\r\n\r\n        return Matrix4.fromArray(array);\r\n    }\r\n\r\n    public static fromScale(x: number, y: number, z: number): Matrix4 {\r\n        return Matrix4.fromArray([x, 0, 0, 0, 0, y, 0, 0, 0, 0, z, 0, 0, 0, 0, 1]);\r\n    }\r\n\r\n    public static fromTranslation(x: number, y: number, z: number): Matrix4 {\r\n        return Matrix4.fromArray([1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, x, y, z, 1.0]);\r\n    }\r\n\r\n    public static createMirrorWithPlane(plane: Plane): Matrix4 {\r\n        let d = -plane.origin.dot(plane.normal);\r\n        const x = plane.normal.x;\r\n        const y = plane.normal.y;\r\n        const z = plane.normal.z;\r\n        const temp = -2 * x;\r\n        const temp2 = -2 * y;\r\n        const temp3 = -2 * z;\r\n        return Matrix4.fromArray([\r\n            temp * x + 1,\r\n            temp2 * x,\r\n            temp3 * x,\r\n            0.0,\r\n            temp * y,\r\n            temp2 * y + 1,\r\n            temp3 * y,\r\n            0.0,\r\n            temp * z,\r\n            temp2 * z,\r\n            temp3 * z + 1,\r\n            0.0,\r\n            temp * d,\r\n            temp2 * d,\r\n            temp3 * d,\r\n            1.0,\r\n        ]);\r\n    }\r\n\r\n    public transpose(): Matrix4 {\r\n        let result = new Matrix4();\r\n        result._array[0] = this._array[0];\r\n        result._array[1] = this._array[4];\r\n        result._array[2] = this._array[8];\r\n        result._array[3] = this._array[12];\r\n\r\n        result._array[4] = this._array[1];\r\n        result._array[5] = this._array[5];\r\n        result._array[6] = this._array[9];\r\n        result._array[7] = this._array[13];\r\n\r\n        result._array[8] = this._array[2];\r\n        result._array[9] = this._array[6];\r\n        result._array[10] = this._array[10];\r\n        result._array[11] = this._array[14];\r\n\r\n        result._array[12] = this._array[3];\r\n        result._array[13] = this._array[7];\r\n        result._array[14] = this._array[11];\r\n        result._array[15] = this._array[15];\r\n\r\n        return result;\r\n    }\r\n\r\n    ofPoints(points: ArrayLike<number>): number[] {\r\n        let result: number[] = [];\r\n        for (let i = 0; i < points.length / 3; i++) {\r\n            let x =\r\n                points[3 * i] * this._array[0] +\r\n                points[3 * i + 1] * this._array[4] +\r\n                points[3 * i + 2] * this._array[8] +\r\n                this._array[12];\r\n            let y =\r\n                points[3 * i] * this._array[1] +\r\n                points[3 * i + 1] * this._array[5] +\r\n                points[3 * i + 2] * this._array[9] +\r\n                this._array[13];\r\n            let z =\r\n                points[3 * i] * this._array[2] +\r\n                points[3 * i + 1] * this._array[6] +\r\n                points[3 * i + 2] * this._array[10] +\r\n                this._array[14];\r\n            let w =\r\n                points[3 * i] * this._array[3] +\r\n                points[3 * i + 1] * this._array[7] +\r\n                points[3 * i + 2] * this._array[11] +\r\n                this._array[15];\r\n            result.push(x / w, y / w, z / w);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public ofPoint(point: XYZLike): XYZ {\r\n        let result = this.ofPoints([point.x, point.y, point.z]);\r\n        return new XYZ(result[0], result[1], result[2]);\r\n    }\r\n\r\n    public ofVector(vector: XYZLike): XYZ {\r\n        let result = this.ofVectors([vector.x, vector.y, vector.z]);\r\n        return new XYZ(result[0], result[1], result[2]);\r\n    }\r\n\r\n    public ofVectors(vectors: ArrayLike<number>): number[] {\r\n        let result: number[] = [];\r\n        for (let i = 0; i < vectors.length / 3; i++) {\r\n            let x =\r\n                vectors[3 * i] * this._array[0] +\r\n                vectors[3 * i + 1] * this._array[4] +\r\n                vectors[3 * i + 2] * this._array[8];\r\n            let y =\r\n                vectors[3 * i] * this._array[1] +\r\n                vectors[3 * i + 1] * this._array[5] +\r\n                vectors[3 * i + 2] * this._array[9];\r\n            let z =\r\n                vectors[3 * i] * this._array[2] +\r\n                vectors[3 * i + 1] * this._array[6] +\r\n                vectors[3 * i + 2] * this._array[10];\r\n            result.push(x, y, z);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public translationPart(): XYZ {\r\n        return new XYZ(this._array[12], this._array[13], this._array[14]);\r\n    }\r\n\r\n    public getScale(): XYZ {\r\n        const x = Math.hypot(this._array[0], this._array[1], this._array[2]);\r\n        const y = Math.hypot(this._array[4], this._array[5], this._array[6]);\r\n        const z = Math.hypot(this._array[8], this._array[9], this._array[10]);\r\n        return new XYZ(x, y, z);\r\n    }\r\n\r\n    public getEulerAngles(): { pitch: number; yaw: number; roll: number } {\r\n        const m = this._array;\r\n        const m11 = m[0],\r\n            m12 = m[4],\r\n            m13 = m[8];\r\n        const m22 = m[5],\r\n            m23 = m[9];\r\n        const m32 = m[6],\r\n            m33 = m[10];\r\n\r\n        let pitch = 0;\r\n        let yaw = Math.asin(MathUtils.clamp(m13, -1, 1));\r\n        let roll = 0;\r\n\r\n        if (Math.abs(m13) < 0.9999999) {\r\n            pitch = Math.atan2(-m23, m33);\r\n            roll = Math.atan2(-m12, m11);\r\n        } else {\r\n            pitch = Math.atan2(m32, m22);\r\n        }\r\n\r\n        return { pitch, yaw, roll };\r\n    }\r\n\r\n    public static createFromTRS(\r\n        position: XYZLike,\r\n        rotation: { pitch: number; yaw: number; roll: number },\r\n        scale: XYZLike,\r\n    ): Matrix4 {\r\n        const quaternion = Quaternion.fromEuler(rotation.pitch, rotation.yaw, rotation.roll);\r\n        const te = new Array(16).fill(0);\r\n\r\n        const x = quaternion.x,\r\n            y = quaternion.y,\r\n            z = quaternion.z,\r\n            w = quaternion.w;\r\n        const x2 = x + x,\r\n            y2 = y + y,\r\n            z2 = z + z;\r\n        const xx = x * x2,\r\n            xy = x * y2,\r\n            xz = x * z2;\r\n        const yy = y * y2,\r\n            yz = y * z2,\r\n            zz = z * z2;\r\n        const wx = w * x2,\r\n            wy = w * y2,\r\n            wz = w * z2;\r\n\r\n        const sx = scale.x,\r\n            sy = scale.y,\r\n            sz = scale.z;\r\n\r\n        te[0] = (1 - (yy + zz)) * sx;\r\n        te[1] = (xy + wz) * sx;\r\n        te[2] = (xz - wy) * sx;\r\n        te[3] = 0;\r\n\r\n        te[4] = (xy - wz) * sy;\r\n        te[5] = (1 - (xx + zz)) * sy;\r\n        te[6] = (yz + wx) * sy;\r\n        te[7] = 0;\r\n\r\n        te[8] = (xz + wy) * sz;\r\n        te[9] = (yz - wx) * sz;\r\n        te[10] = (1 - (xx + yy)) * sz;\r\n        te[11] = 0;\r\n\r\n        te[12] = position.x;\r\n        te[13] = position.y;\r\n        te[14] = position.z;\r\n        te[15] = 1;\r\n\r\n        return Matrix4.fromArray(te);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Serializer } from \"../serialize\";\r\nimport { MathUtils } from \"./mathUtils\";\r\nimport { Matrix4 } from \"./matrix4\";\r\nimport { Ray } from \"./ray\";\r\nimport { XYZ } from \"./xyz\";\r\n\r\n@Serializer.register([\"origin\", \"normal\", \"xvec\"])\r\nexport class Plane {\r\n    static readonly XY: Plane = new Plane(XYZ.zero, XYZ.unitZ, XYZ.unitX);\r\n    static readonly YZ: Plane = new Plane(XYZ.zero, XYZ.unitX, XYZ.unitY);\r\n    static readonly ZX: Plane = new Plane(XYZ.zero, XYZ.unitY, XYZ.unitZ);\r\n\r\n    @Serializer.serialze()\r\n    readonly origin: XYZ;\r\n    /**\r\n     * unit vector\r\n     */\r\n    @Serializer.serialze()\r\n    readonly normal: XYZ;\r\n    @Serializer.serialze()\r\n    readonly xvec: XYZ;\r\n    readonly yvec: XYZ;\r\n    constructor(origin: XYZ, normal: XYZ, xvec: XYZ) {\r\n        this.origin = origin;\r\n        let n = normal.normalize(),\r\n            x = xvec.normalize();\r\n        if (n === undefined || n.isEqualTo(XYZ.zero)) {\r\n            throw new Error(\"normal can not be zero\");\r\n        }\r\n        if (x === undefined || x.isEqualTo(XYZ.zero)) {\r\n            throw new Error(\"xDirector can not be zero\");\r\n        }\r\n        if (n.isParallelTo(x)) {\r\n            throw new Error(\"xDirector can not parallel normal\");\r\n        }\r\n        this.normal = n;\r\n        this.xvec = x;\r\n        this.yvec = n.cross(x).normalize()!;\r\n    }\r\n\r\n    translateTo(origin: XYZ) {\r\n        return new Plane(origin, this.normal, this.xvec);\r\n    }\r\n\r\n    project(point: XYZ): XYZ {\r\n        const vector = point.sub(this.origin);\r\n        const dot = vector.dot(this.normal);\r\n        return this.origin.add(vector.sub(this.normal.multiply(dot)));\r\n    }\r\n\r\n    transformed(matrix: Matrix4) {\r\n        const location = matrix.ofPoint(this.origin);\r\n        const x = matrix.ofVector(this.xvec);\r\n        const normal = matrix.ofVector(this.normal);\r\n        return new Plane(location, normal, x);\r\n    }\r\n\r\n    intersect(ray: Ray, containsExtension: boolean = true): XYZ | undefined {\r\n        const vec = this.origin.sub(ray.location);\r\n        if (vec.isEqualTo(XYZ.zero)) return this.origin;\r\n        const len = vec.dot(this.normal);\r\n        const dot = ray.direction.dot(this.normal);\r\n        if (MathUtils.almostEqual(dot, 0)) return MathUtils.almostEqual(len, 0) ? ray.location : undefined;\r\n        const t = len / dot;\r\n        if (!containsExtension && t < 0) return undefined;\r\n        return ray.location.add(ray.direction.multiply(t));\r\n    }\r\n\r\n    projectDistance(p1: XYZ, p2: XYZ) {\r\n        let dp1 = this.project(p1);\r\n        let dp2 = this.project(p2);\r\n        return dp1.distanceTo(dp2);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Precision } from \"../foundation\";\r\nimport { Plane } from \"./plane\";\r\nimport { XYZ } from \"./xyz\";\r\n\r\nexport class PlaneAngle {\r\n    private lastX: number = 1;\r\n    private lastY: number = 0;\r\n    private isNegativeRotation: boolean = false;\r\n    private currentAngle: number = 0;\r\n\r\n    get angle() {\r\n        return this.currentAngle;\r\n    }\r\n\r\n    constructor(readonly plane: Plane) {}\r\n\r\n    movePoint(point: XYZ) {\r\n        const vectorToPoint = point.sub(this.plane.origin);\r\n        const projectionX = vectorToPoint.dot(this.plane.xvec);\r\n        const projectionY = vectorToPoint.dot(this.plane.yvec);\r\n\r\n        if (this.isCrossingPositiveXAxis(projectionX, projectionY)) {\r\n            this.isNegativeRotation = !this.isNegativeRotation;\r\n        }\r\n\r\n        this.currentAngle = this.calculateAngle(vectorToPoint);\r\n        this.updateLastProjections(projectionX, projectionY);\r\n    }\r\n\r\n    private calculateAngle(vector: XYZ): number {\r\n        const angleInRadians = this.plane.xvec.angleOnPlaneTo(vector, this.plane.normal)!;\r\n        const angleInDegrees = (angleInRadians * 180) / Math.PI;\r\n        return this.isNegativeRotation ? angleInDegrees - 360 : angleInDegrees;\r\n    }\r\n\r\n    private isCrossingPositiveXAxis(x: number, y: number): boolean {\r\n        const isMovingUpward = this.lastY < -Precision.Distance && y > Precision.Distance;\r\n        const isMovingDownward = this.lastY > -Precision.Distance && y < -Precision.Distance;\r\n        const isCrossingX =\r\n            (isMovingUpward && this.currentAngle < Precision.Angle) ||\r\n            (isMovingDownward && this.currentAngle > -Precision.Angle);\r\n\r\n        return isCrossingX && this.lastX > 0 && x > 0;\r\n    }\r\n\r\n    private updateLastProjections(x: number, y: number) {\r\n        if (Math.abs(x) > Precision.Distance) this.lastX = x;\r\n        if (Math.abs(y) > Precision.Distance) this.lastY = y;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Serializer } from \"../serialize\";\r\nimport { Plane } from \"./plane\";\r\nimport { XYZ } from \"./xyz\";\r\n\r\n@Serializer.register([\"location\", \"direction\"])\r\nexport class Ray {\r\n    @Serializer.serialze()\r\n    readonly location: XYZ;\r\n    /**\r\n     * unit vector\r\n     */\r\n    @Serializer.serialze()\r\n    readonly direction: XYZ;\r\n\r\n    constructor(location: XYZ, direction: XYZ) {\r\n        this.location = location;\r\n        const n = direction.normalize();\r\n        if (n === undefined || n.isEqualTo(XYZ.zero)) {\r\n            throw new Error(\"direction can not be zero\");\r\n        }\r\n        this.direction = n;\r\n    }\r\n\r\n    intersect(right: Ray): XYZ | undefined {\r\n        if (this.direction.isParallelTo(right.direction)) return undefined;\r\n        const result = this.nearestTo(right);\r\n        const vec = result.sub(right.location);\r\n        return vec.isParallelTo(right.direction) ? result : undefined;\r\n    }\r\n\r\n    nearestTo(right: Ray): XYZ {\r\n        const n = right.direction.cross(this.direction).normalize();\r\n        if (n === undefined) return this.nearestToPoint(right.location);\r\n        const normal = n.cross(right.direction).normalize()!;\r\n        const plane = new Plane(right.location, normal, n);\r\n        return plane.intersect(this)!;\r\n    }\r\n\r\n    nearestToPoint(point: XYZ): XYZ {\r\n        const vec = point.sub(this.location);\r\n        const dot = vec.dot(this.direction);\r\n        return this.location.add(this.direction.multiply(dot));\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Precision } from \"../foundation\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { MathUtils } from \"./mathUtils\";\r\n\r\nexport type XYLike = { x: number; y: number };\r\n\r\n@Serializer.register([\"x\", \"y\"])\r\nexport class XY {\r\n    static readonly zero = new XY(0, 0);\r\n    static readonly unitX = new XY(1, 0);\r\n    static readonly unitY = new XY(0, 1);\r\n\r\n    @Serializer.serialze()\r\n    readonly x: number;\r\n    @Serializer.serialze()\r\n    readonly y: number;\r\n\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    cross(right: XY): number {\r\n        return this.x * right.y - this.y * right.x;\r\n    }\r\n\r\n    dot(right: XY): number {\r\n        return this.x * right.x + this.y * right.y;\r\n    }\r\n\r\n    divided(scalar: number): XY | undefined {\r\n        return Math.abs(scalar) < Precision.Float ? undefined : new XY(this.x / scalar, this.y / scalar);\r\n    }\r\n\r\n    reverse(): XY {\r\n        return new XY(-this.x, -this.y);\r\n    }\r\n\r\n    multiply(scalar: number): XY {\r\n        return new XY(this.x * scalar, this.y * scalar);\r\n    }\r\n\r\n    sub(right: XY): XY {\r\n        return new XY(this.x - right.x, this.y - right.y);\r\n    }\r\n\r\n    add(right: XY): XY {\r\n        return new XY(this.x + right.x, this.y + right.y);\r\n    }\r\n\r\n    normalize(): XY | undefined {\r\n        const d = this.length();\r\n        return d < Precision.Float ? undefined : new XY(this.x / d, this.y / d);\r\n    }\r\n\r\n    distanceTo(right: XY): number {\r\n        const dx = this.x - right.x;\r\n        const dy = this.y - right.y;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    static center(p1: XY, p2: XY): XY {\r\n        return new XY((p1.x + p2.x) / 2, (p1.y + p2.y) / 2);\r\n    }\r\n\r\n    lengthSq(): number {\r\n        return this.x ** 2 + this.y ** 2;\r\n    }\r\n\r\n    length(): number {\r\n        return Math.sqrt(this.lengthSq());\r\n    }\r\n\r\n    /**\r\n     * Computes the angular value in radians between me and right\r\n     * @param right vector\r\n     * @returns [0, PI]\r\n     */\r\n    angleTo(right: XY): number | undefined {\r\n        if (this.isEqualTo(XY.zero) || right.isEqualTo(XY.zero)) return undefined;\r\n        // tan(x) = |a||b|sin(x) / |a||b|cos(x)\r\n        return Math.atan2(this.cross(right), this.dot(right));\r\n    }\r\n\r\n    isEqualTo(right: XY, tolerance: number = 1e-8) {\r\n        return (\r\n            MathUtils.almostEqual(this.x, right.x, tolerance) &&\r\n            MathUtils.almostEqual(this.y, right.y, tolerance)\r\n        );\r\n    }\r\n\r\n    isParallelTo(right: XY, tolerance: number = 1e-8): boolean | undefined {\r\n        const angle = this.angleTo(right);\r\n        return angle === undefined ? undefined : angle <= tolerance || Math.PI - angle <= tolerance;\r\n    }\r\n\r\n    isOppositeTo(right: XY, tolerance: number = 1e-8): boolean | undefined {\r\n        const angle = this.angleTo(right);\r\n        return angle === undefined ? undefined : Math.PI - angle <= tolerance;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"./document\";\r\nimport { HistoryObservable, Id } from \"./foundation\";\r\nimport { XY } from \"./math\";\r\nimport { Property } from \"./property\";\r\nimport { Serializer } from \"./serialize\";\r\n\r\n@Serializer.register([\"document\"])\r\nexport class Texture extends HistoryObservable {\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.texture.image\")\r\n    get image(): string {\r\n        return this.getPrivateValue(\"image\", \"\");\r\n    }\r\n    set image(value: string) {\r\n        this.setProperty(\"image\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get wrapS(): number {\r\n        return this.getPrivateValue(\"wrapS\", 1000);\r\n    }\r\n    set wrapS(value: number) {\r\n        this.setProperty(\"wrapS\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get wrapT(): number {\r\n        return this.getPrivateValue(\"wrapT\", 1000);\r\n    }\r\n    set wrapT(value: number) {\r\n        this.setProperty(\"wrapT\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.texture.rotation\")\r\n    get rotation(): number {\r\n        return this.getPrivateValue(\"rotation\", 0);\r\n    }\r\n    set rotation(value: number) {\r\n        this.setProperty(\"rotation\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.texture.offset\")\r\n    get offset(): XY {\r\n        return this.getPrivateValue(\"offset\", new XY(0, 0));\r\n    }\r\n    set offset(value: XY) {\r\n        this.setProperty(\"offset\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.texture.repeat\")\r\n    get repeat(): XY {\r\n        return this.getPrivateValue(\"repeat\", new XY(1, 1));\r\n    }\r\n    set repeat(value: XY) {\r\n        this.setProperty(\"repeat\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    center: XY = new XY(0.5, 0.5);\r\n}\r\n\r\n@Serializer.register([\"document\", \"name\", \"color\", \"id\"])\r\nexport class Material extends HistoryObservable {\r\n    @Serializer.serialze()\r\n    vertexColors = false;\r\n\r\n    @Serializer.serialze()\r\n    transparent = true;\r\n\r\n    @Serializer.serialze()\r\n    readonly id: string;\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.name\")\r\n    get name(): string {\r\n        return this.getPrivateValue(\"name\");\r\n    }\r\n    set name(value: string) {\r\n        this.setProperty(\"name\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.color\", { type: \"color\" })\r\n    get color(): number | string {\r\n        return this.getPrivateValue(\"color\");\r\n    }\r\n    set color(value: number | string) {\r\n        this.setProperty(\"color\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.opacity\")\r\n    get opacity(): number {\r\n        return this.getPrivateValue(\"opacity\", 1);\r\n    }\r\n    set opacity(value: number) {\r\n        this.setProperty(\"opacity\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.map\")\r\n    get map(): Texture {\r\n        return this.getPrivateValue(\"map\", new Texture(this.document));\r\n    }\r\n    set map(value: Texture) {\r\n        this.setProperty(\"map\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, name: string, color: number | string, id: string = Id.generate()) {\r\n        super(document);\r\n        this.id = id;\r\n        this.setPrivateValue(\"name\", name?.length > 0 ? name : \"unnamed\");\r\n        this.setPrivateValue(\"color\", color);\r\n    }\r\n\r\n    clone(): Material {\r\n        let material = new Material(this.document, `${this.name} clone`, this.color);\r\n        material.setPrivateValue(\"map\", this.map);\r\n\r\n        return material;\r\n    }\r\n}\r\n\r\n@Serializer.register([\"document\", \"name\", \"color\", \"id\"])\r\nexport class PhongMaterial extends Material {\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.specular\", { type: \"color\" })\r\n    get specular(): number | string {\r\n        return this.getPrivateValue(\"specular\", 0x111111);\r\n    }\r\n    set specular(value: number | string) {\r\n        this.setProperty(\"specular\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.shininess\")\r\n    get shininess(): number {\r\n        return this.getPrivateValue(\"shininess\", 30);\r\n    }\r\n    set shininess(value: number) {\r\n        this.setProperty(\"shininess\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.emissive\", { type: \"color\" })\r\n    get emissive(): number | string {\r\n        return this.getPrivateValue(\"emissive\", 0x000000);\r\n    }\r\n    set emissive(value: number | string) {\r\n        this.setProperty(\"emissive\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.specularMap\")\r\n    get specularMap(): Texture {\r\n        return this.getPrivateValue(\"specularMap\", new Texture(this.document));\r\n    }\r\n    set specularMap(value: Texture) {\r\n        this.setProperty(\"specularMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.bumpMap\")\r\n    get bumpMap(): Texture {\r\n        return this.getPrivateValue(\"bumpMap\", new Texture(this.document));\r\n    }\r\n    set bumpMap(value: Texture) {\r\n        this.setProperty(\"bumpMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.normalMap\")\r\n    get normalMap(): Texture {\r\n        return this.getPrivateValue(\"normalMap\", new Texture(this.document));\r\n    }\r\n    set normalMap(value: Texture) {\r\n        this.setProperty(\"normalMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.emissiveMap\")\r\n    get emissiveMap(): Texture {\r\n        return this.getPrivateValue(\"emissiveMap\", new Texture(this.document));\r\n    }\r\n    set emissiveMap(value: Texture) {\r\n        this.setProperty(\"emissiveMap\", value);\r\n    }\r\n}\r\n\r\n@Serializer.register([\"document\", \"name\", \"color\", \"id\"])\r\nexport class PhysicalMaterial extends Material {\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.metalness\")\r\n    get metalness(): number {\r\n        return this.getPrivateValue(\"metalness\", 0);\r\n    }\r\n    set metalness(value: number) {\r\n        this.setProperty(\"metalness\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.metalnessMap\")\r\n    get metalnessMap(): Texture {\r\n        return this.getPrivateValue(\"metalnessMap\", new Texture(this.document));\r\n    }\r\n    set metalnessMap(value: Texture) {\r\n        this.setProperty(\"metalnessMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.roughness\")\r\n    get roughness(): number {\r\n        return this.getPrivateValue(\"roughness\", 1);\r\n    }\r\n    set roughness(value: number) {\r\n        this.setProperty(\"roughness\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.roughnessMap\")\r\n    get roughnessMap(): Texture {\r\n        return this.getPrivateValue(\"roughnessMap\", new Texture(this.document));\r\n    }\r\n    set roughnessMap(value: Texture) {\r\n        this.setProperty(\"roughnessMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.emissive\", { type: \"color\" })\r\n    get emissive(): number | string {\r\n        return this.getPrivateValue(\"emissive\", 0x000000);\r\n    }\r\n    set emissive(value: number | string) {\r\n        this.setProperty(\"emissive\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.bumpMap\")\r\n    get bumpMap(): Texture {\r\n        return this.getPrivateValue(\"bumpMap\", new Texture(this.document));\r\n    }\r\n    set bumpMap(value: Texture) {\r\n        this.setProperty(\"bumpMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.normalMap\")\r\n    get normalMap(): Texture {\r\n        return this.getPrivateValue(\"normalMap\", new Texture(this.document));\r\n    }\r\n    set normalMap(value: Texture) {\r\n        this.setProperty(\"normalMap\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"material.emissiveMap\")\r\n    get emissiveMap(): Texture {\r\n        return this.getPrivateValue(\"emissiveMap\", new Texture(this.document));\r\n    }\r\n    set emissiveMap(value: Texture) {\r\n        this.setProperty(\"emissiveMap\", value);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { HistoryObservable, IDisposable, IPropertyChanged, Id } from \"../foundation\";\r\nimport { Property } from \"../property\";\r\nimport { Serialized, Serializer } from \"../serialize\";\r\n\r\nexport interface INode extends IPropertyChanged, IDisposable {\r\n    readonly id: string;\r\n    visible: boolean;\r\n    parentVisible: boolean;\r\n    name: string;\r\n    parent: INodeLinkedList | undefined;\r\n    previousSibling: INode | undefined;\r\n    nextSibling: INode | undefined;\r\n    clone(): this;\r\n}\r\n\r\nexport interface INodeLinkedList extends INode {\r\n    get firstChild(): INode | undefined;\r\n    get lastChild(): INode | undefined;\r\n    add(...items: INode[]): void;\r\n    remove(...items: INode[]): void;\r\n    transfer(...items: INode[]): void;\r\n    size(): number;\r\n    insertAfter(target: INode | undefined, node: INode): void;\r\n    insertBefore(target: INode | undefined, node: INode): void;\r\n    move(child: INode, newParent: this, newPreviousSibling?: INode): void;\r\n}\r\n\r\nexport namespace INode {\r\n    export function isLinkedListNode(node: INode): node is INodeLinkedList {\r\n        return (node as INodeLinkedList).add !== undefined;\r\n    }\r\n}\r\n\r\nexport abstract class Node extends HistoryObservable implements INode {\r\n    parent: INodeLinkedList | undefined;\r\n    previousSibling: INode | undefined;\r\n    nextSibling: INode | undefined;\r\n\r\n    @Serializer.serialze()\r\n    readonly id: string;\r\n\r\n    constructor(document: IDocument, name: string, id: string) {\r\n        super(document);\r\n        this.id = id;\r\n        this.setPrivateValue(\"name\", name || \"untitled\");\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.name\")\r\n    get name() {\r\n        return this.getPrivateValue(\"name\");\r\n    }\r\n    set name(value: string) {\r\n        this.setProperty(\"name\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get visible(): boolean {\r\n        return this.getPrivateValue(\"visible\", true);\r\n    }\r\n    set visible(value: boolean) {\r\n        this.setProperty(\"visible\", value, () => this.onVisibleChanged());\r\n    }\r\n\r\n    protected abstract onVisibleChanged(): void;\r\n\r\n    get parentVisible() {\r\n        return this.getPrivateValue(\"parentVisible\", true);\r\n    }\r\n    set parentVisible(value: boolean) {\r\n        this.setProperty(\"parentVisible\", value, () => this.onParentVisibleChanged());\r\n    }\r\n\r\n    override disposeInternal(): void {\r\n        this.document.visual.context.removeNode([this]);\r\n        super.disposeInternal();\r\n    }\r\n\r\n    clone(): this {\r\n        let serialized = Serializer.serializeObject(this);\r\n        serialized.properties[\"id\"] = Id.generate();\r\n        serialized.properties[\"name\"] = `${this.name}_copy`;\r\n        let cloned: this = Serializer.deserializeObject(this.document, serialized);\r\n        this.parent?.add(cloned);\r\n        return cloned;\r\n    }\r\n\r\n    protected abstract onParentVisibleChanged(): void;\r\n}\r\n\r\nexport namespace INode {\r\n    export function getNodesBetween(node1: INode, node2: INode): INode[] {\r\n        if (node1 === node2) return [node1];\r\n        let nodes: INode[] = [];\r\n        let prePath = getPathToRoot(node1);\r\n        let curPath = getPathToRoot(node2);\r\n        let index = getCommonParentIndex(prePath, curPath);\r\n        let parent = prePath.at(1 - index) as INodeLinkedList;\r\n        if (parent === curPath[0] || parent === prePath[0]) {\r\n            let child = parent === curPath[0] ? prePath[0] : curPath[0];\r\n            getNodesFromParentToChild(nodes, parent, child);\r\n        } else if (currentAtBack(prePath.at(-index)!, curPath.at(-index)!)) {\r\n            getNodesFromPath(nodes, prePath, curPath, index);\r\n        } else {\r\n            getNodesFromPath(nodes, curPath, prePath, index);\r\n        }\r\n        return nodes;\r\n    }\r\n\r\n    function getNodesFromPath(nodes: INode[], path1: INode[], path2: INode[], commonIndex: number) {\r\n        nodeOrChildrenAppendToNodes(nodes, path1[0]);\r\n        path1ToCommonNodes(nodes, path1, commonIndex);\r\n        commonToPath2Nodes(nodes, path1, path2, commonIndex);\r\n    }\r\n\r\n    function path1ToCommonNodes(nodes: INode[], path1: INode[], commonIndex: number) {\r\n        for (let i = 0; i < path1.length - commonIndex; i++) {\r\n            let next = path1[i].nextSibling;\r\n            while (next !== undefined) {\r\n                INode.nodeOrChildrenAppendToNodes(nodes, next);\r\n                next = next.nextSibling;\r\n            }\r\n        }\r\n    }\r\n\r\n    function commonToPath2Nodes(nodes: INode[], path1: INode[], path2: INode[], commonIndex: number) {\r\n        let nextParent = path1.at(-commonIndex)?.nextSibling;\r\n        while (nextParent) {\r\n            if (nextParent === path2[0]) {\r\n                nodes.push(path2[0]);\r\n                return;\r\n            }\r\n            if (INode.isLinkedListNode(nextParent)) {\r\n                if (getNodesFromParentToChild(nodes, nextParent, path2[0])) {\r\n                    return;\r\n                }\r\n            } else {\r\n                nodes.push(nextParent);\r\n            }\r\n            nextParent = nextParent.nextSibling;\r\n        }\r\n    }\r\n\r\n    export function nodeOrChildrenAppendToNodes(nodes: INode[], node: INode) {\r\n        if (INode.isLinkedListNode(node)) {\r\n            getNodesFromParentToChild(nodes, node);\r\n        } else {\r\n            nodes.push(node);\r\n        }\r\n    }\r\n\r\n    export function findTopLevelNodes(nodes: Set<INode>) {\r\n        let result: INode[] = [];\r\n        for (const node of nodes) {\r\n            if (!containsDescendant(nodes, node)) {\r\n                result.push(node);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    export function containsDescendant(nodes: Set<INode>, node: INode): boolean {\r\n        if (node.parent === undefined) return false;\r\n        if (nodes.has(node.parent)) return true;\r\n        return containsDescendant(nodes, node.parent);\r\n    }\r\n\r\n    function getNodesFromParentToChild(nodes: INode[], parent: INodeLinkedList, until?: INode): boolean {\r\n        nodes.push(parent);\r\n        let node = parent.firstChild;\r\n        while (node !== undefined) {\r\n            if (until === node) {\r\n                nodes.push(node);\r\n                return true;\r\n            }\r\n\r\n            if (INode.isLinkedListNode(node)) {\r\n                if (getNodesFromParentToChild(nodes, node, until)) return true;\r\n            } else {\r\n                nodes.push(node);\r\n            }\r\n            node = node.nextSibling;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function currentAtBack(preNode: INode, curNode: INode) {\r\n        while (preNode.nextSibling !== undefined) {\r\n            if (preNode.nextSibling === curNode) return true;\r\n            preNode = preNode.nextSibling;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function getCommonParentIndex(prePath: INode[], curPath: INode[]) {\r\n        let index = 1;\r\n        for (index; index <= Math.min(prePath.length, curPath.length); index++) {\r\n            if (prePath.at(-index) !== curPath.at(-index)) break;\r\n        }\r\n        if (prePath.at(1 - index) !== curPath.at(1 - index)) throw new Error(\"can not find a common parent\");\r\n        return index;\r\n    }\r\n\r\n    function getPathToRoot(node: INode): INode[] {\r\n        let path: INode[] = [];\r\n        let parent: INode | undefined = node;\r\n        while (parent !== undefined) {\r\n            path.push(parent);\r\n            parent = parent.parent;\r\n        }\r\n        return path;\r\n    }\r\n}\r\n\r\nexport namespace NodeSerializer {\r\n    export function serialize(node: INode) {\r\n        let nodes: Serialized[] = [];\r\n        serializeNodeToArray(nodes, node, undefined);\r\n        return nodes;\r\n    }\r\n\r\n    function serializeNodeToArray(nodes: Serialized[], node: INode, parentId: string | undefined) {\r\n        let serialized: any = Serializer.serializeObject(node);\r\n        if (parentId) serialized[\"parentId\"] = parentId;\r\n        nodes.push(serialized);\r\n\r\n        if (INode.isLinkedListNode(node) && node.firstChild) {\r\n            serializeNodeToArray(nodes, node.firstChild, node.id);\r\n        }\r\n        if (node.nextSibling) {\r\n            serializeNodeToArray(nodes, node.nextSibling, parentId);\r\n        }\r\n        return nodes;\r\n    }\r\n\r\n    export async function deserialize(document: IDocument, nodes: Serialized[]) {\r\n        let nodeMap: Map<string, INodeLinkedList> = new Map();\r\n        nodes.forEach((n) => {\r\n            let node = Serializer.deserializeObject(document, n);\r\n            if (INode.isLinkedListNode(node)) {\r\n                nodeMap.set(n.properties[\"id\"], node);\r\n            }\r\n            let parentId = (n as any)[\"parentId\"];\r\n            if (!parentId) return;\r\n            if (nodeMap.has(parentId)) {\r\n                nodeMap.get(parentId)!.add(node);\r\n            } else {\r\n                console.warn(\"parent not found: \" + parentId);\r\n            }\r\n        });\r\n        return Promise.resolve(nodeMap.get(nodes[0].properties[\"id\"]));\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys } from \"../i18n\";\r\nimport { BoundingBox, Matrix4 } from \"../math\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { Node } from \"./node\";\r\n\r\nexport abstract class VisualNode extends Node {\r\n    abstract display(): I18nKeys;\r\n\r\n    @Serializer.serialze()\r\n    get transform(): Matrix4 {\r\n        return this.getPrivateValue(\"transform\", Matrix4.identity());\r\n    }\r\n    set transform(value: Matrix4) {\r\n        this.setProperty(\"transform\", value, undefined, {\r\n            equals: (left, right) => left.equals(right),\r\n        });\r\n    }\r\n\r\n    worldTransform(): Matrix4 {\r\n        const visual = this.document.visual.context.getVisual(this);\r\n        if (visual) {\r\n            return visual.worldTransform();\r\n        }\r\n        return this.transform;\r\n    }\r\n\r\n    protected onVisibleChanged(): void {\r\n        this.document.visual.context.setVisible(this, this.visible && this.parentVisible);\r\n    }\r\n\r\n    protected onParentVisibleChanged(): void {\r\n        this.document.visual.context.setVisible(this, this.visible && this.parentVisible);\r\n    }\r\n\r\n    abstract boundingBox(): BoundingBox | undefined;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { Id } from \"../foundation\";\r\nimport { I18nKeys } from \"../i18n\";\r\nimport { BoundingBox } from \"../math\";\r\nimport { Property } from \"../property\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { Mesh } from \"../shape\";\r\nimport { VisualNode } from \"./visualNode\";\r\n\r\n@Serializer.register([\"document\", \"mesh\", \"name\", \"id\"])\r\nexport class MeshNode extends VisualNode {\r\n    override display(): I18nKeys {\r\n        return \"body.meshNode\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.material\", { type: \"materialId\" })\r\n    get materialId(): string | string[] {\r\n        return this.getPrivateValue(\"materialId\");\r\n    }\r\n    set materialId(value: string | string[]) {\r\n        this.setProperty(\"materialId\", value);\r\n    }\r\n\r\n    protected _mesh: Mesh;\r\n    @Serializer.serialze()\r\n    get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n    set mesh(value: Mesh) {\r\n        this.setProperty(\"mesh\", value);\r\n    }\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        mesh: Mesh,\r\n        name: string,\r\n        materialId?: string | string[],\r\n        id: string = Id.generate(),\r\n    ) {\r\n        super(document, name, id);\r\n        this._mesh = mesh;\r\n        this.setPrivateValue(\"materialId\", materialId ?? document.materials.at(0)?.id ?? \"\");\r\n    }\r\n\r\n    override boundingBox(): BoundingBox | undefined {\r\n        let points = this.transform.ofPoints(this.mesh.position!);\r\n        return BoundingBox.fromNumbers(points);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { MeshUtils } from \"chili-geo\";\r\nimport { IDocument } from \"../document\";\r\nimport { Id, PropertyHistoryRecord, Transaction } from \"../foundation\";\r\nimport { BoundingBox } from \"../math\";\r\nimport { Property } from \"../property\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { FaceMeshData, IShapeMeshData } from \"../shape\";\r\nimport { VisualNode } from \"./visualNode\";\r\n\r\n@Serializer.register([\"faceIndex\", \"materialIndex\"])\r\nexport class FaceMaterialPair {\r\n    @Serializer.serialze()\r\n    faceIndex: number;\r\n\r\n    @Serializer.serialze()\r\n    materialIndex: number;\r\n    constructor(faceIndex: number, materialIndex: number) {\r\n        this.faceIndex = faceIndex;\r\n        this.materialIndex = materialIndex;\r\n    }\r\n}\r\n\r\nexport abstract class GeometryNode extends VisualNode {\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.material\", { type: \"materialId\" })\r\n    get materialId(): string | string[] {\r\n        return this.getPrivateValue(\"materialId\");\r\n    }\r\n    set materialId(value: string | string[]) {\r\n        this.setProperty(\"materialId\", value);\r\n    }\r\n\r\n    protected _originFaceMesh?: FaceMeshData;\r\n\r\n    @Serializer.serialze()\r\n    get faceMaterialPair(): FaceMaterialPair[] {\r\n        return this.getPrivateValue(\"faceMaterialPair\", []);\r\n    }\r\n    set faceMaterialPair(value: FaceMaterialPair[]) {\r\n        const oldMaterisl = Array.isArray(this.materialId) ? [...this.materialId] : this.materialId;\r\n        const Face = [...this.faceMaterialPair];\r\n        this.setProperty(\"faceMaterialPair\", value, () => this.updateVisual(oldMaterisl, Face));\r\n    }\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        name: string,\r\n        materialId?: string | string[],\r\n        id: string = Id.generate(),\r\n    ) {\r\n        super(document, name, id);\r\n        this.setPrivateValue(\"materialId\", materialId ?? document.materials.at(0)?.id ?? \"\");\r\n    }\r\n\r\n    protected _mesh: IShapeMeshData | undefined;\r\n    get mesh(): IShapeMeshData {\r\n        this._mesh ??= this.createMesh();\r\n        return this._mesh as any;\r\n    }\r\n\r\n    override boundingBox(): BoundingBox | undefined {\r\n        let points = this.mesh.faces?.position;\r\n        if (!points || points.length === 0) {\r\n            points = this.mesh.edges?.position;\r\n        }\r\n\r\n        if (!points || points.length === 0) {\r\n            return undefined;\r\n        }\r\n        return BoundingBox.fromNumbers(this.transform.ofPoints(points));\r\n    }\r\n\r\n    override disposeInternal(): void {\r\n        super.disposeInternal();\r\n        this._mesh = undefined;\r\n    }\r\n\r\n    private copyOldValue() {\r\n        const oldMaterial = Array.isArray(this.materialId) ? [...this.materialId] : this.materialId;\r\n        const oldFacePair = [...this.faceMaterialPair];\r\n        return {\r\n            oldFacePair,\r\n            oldMaterial,\r\n        };\r\n    }\r\n\r\n    addFaceMaterial(pairs: { faceIndex: number; materialId: string }[]) {\r\n        const { oldFacePair, oldMaterial } = this.copyOldValue();\r\n        pairs.forEach(({ faceIndex, materialId }) => {\r\n            if (this.materialId === materialId) {\r\n                return;\r\n            }\r\n\r\n            if (this._mesh?.faces?.range.length === 1) {\r\n                this.setPrivateValue(\"materialId\", materialId);\r\n                return;\r\n            }\r\n\r\n            if (typeof this.materialId === \"string\") {\r\n                this.setPrivateValue(\"materialId\", [this.materialId, materialId]);\r\n            }\r\n\r\n            const index = this.materialId.indexOf(materialId);\r\n            if (index === -1) {\r\n                (this.materialId as string[]).push(materialId);\r\n                this.faceMaterialPair.push(new FaceMaterialPair(faceIndex, this.materialId.length - 1));\r\n            } else {\r\n                this.faceMaterialPair.push(new FaceMaterialPair(faceIndex, index));\r\n            }\r\n        });\r\n        this.updateVisual(oldMaterial, oldFacePair);\r\n    }\r\n\r\n    removeFaceMaterial(faceIndexs: number[]) {\r\n        const { oldFacePair, oldMaterial } = this.copyOldValue();\r\n        const toDelete = this.faceMaterialPair.filter((x) => faceIndexs.includes(x.faceIndex));\r\n        this.setPrivateValue(\r\n            \"faceMaterialPair\",\r\n            this.faceMaterialPair.filter((x) => !faceIndexs.includes(x.faceIndex)),\r\n        );\r\n        toDelete.forEach((pair) => {\r\n            const hasSameMaterial = this.faceMaterialPair.some(\r\n                (x) => x.materialIndex === pair.materialIndex,\r\n            );\r\n            if (hasSameMaterial || !Array.isArray(this.materialId)) {\r\n                return;\r\n            }\r\n            this.materialId.splice(pair.materialIndex, 1);\r\n            if (this.materialId.length === 1) {\r\n                this.setPrivateValue(\"materialId\", this.materialId[0]);\r\n            } else if (this.materialId.length > 1) {\r\n                this.faceMaterialPair.forEach((x) => {\r\n                    if (x.materialIndex > pair.materialIndex) {\r\n                        x.materialIndex--;\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        this.updateVisual(oldMaterial, oldFacePair);\r\n    }\r\n\r\n    clearFaceMaterial() {\r\n        const { oldFacePair, oldMaterial } = this.copyOldValue();\r\n\r\n        if (Array.isArray(this.materialId)) {\r\n            this.setPrivateValue(\"materialId\", this.materialId[0]);\r\n        }\r\n        this.setPrivateValue(\"faceMaterialPair\", []);\r\n\r\n        this.updateVisual(oldMaterial, oldFacePair);\r\n    }\r\n\r\n    private readonly updateVisual = (oldMaterisl: string | string[], oldFacePair: FaceMaterialPair[]) => {\r\n        if (!this._originFaceMesh) return;\r\n        if (this.faceMaterialPair.length === 0) {\r\n            this._mesh!.faces = this._originFaceMesh;\r\n        } else {\r\n            this._mesh!.faces = MeshUtils.mergeFaceMesh(\r\n                this._originFaceMesh,\r\n                this.faceMaterialPair.map((x) => [x.faceIndex, x.materialIndex] as [number, number]),\r\n            );\r\n            if (this._mesh!.faces.groups.length === 1) {\r\n                this.setPrivateValue(\"materialId\", this.materialId[this.faceMaterialPair[0].materialIndex]);\r\n            }\r\n        }\r\n\r\n        this.emitPropertyChanged(\"materialId\", oldMaterisl);\r\n        this.emitPropertyChanged(\"faceMaterialPair\", oldFacePair);\r\n        const newMaterisl = Array.isArray(this.materialId) ? [...this.materialId] : this.materialId;\r\n        Transaction.add(\r\n            this.document,\r\n            new PropertyHistoryRecord(this, \"materialId\", oldMaterisl, newMaterisl),\r\n        );\r\n        Transaction.add(\r\n            this.document,\r\n            new PropertyHistoryRecord(this, \"faceMaterialPair\", oldFacePair, [...this.faceMaterialPair]),\r\n        );\r\n\r\n        this.document.visual.context.redrawNode([this]);\r\n    };\r\n\r\n    protected abstract createMesh(): IShapeMeshData;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { MeshUtils } from \"chili-geo\";\r\nimport { VisualConfig } from \"../config\";\r\nimport { IDocument } from \"../document\";\r\nimport { Id, IEqualityComparer, PubSub, Result } from \"../foundation\";\r\nimport { I18n, I18nKeys } from \"../i18n\";\r\nimport { Matrix4 } from \"../math\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { EdgeMeshData, FaceMeshData, IShape, IShapeMeshData, LineType } from \"../shape\";\r\nimport { GeometryNode } from \"./geometryNode\";\r\n\r\nexport abstract class ShapeNode extends GeometryNode {\r\n    protected _shape: Result<IShape> = Result.err(SHAPE_UNDEFINED);\r\n    get shape(): Result<IShape> {\r\n        return this._shape;\r\n    }\r\n\r\n    protected setShape(shape: Result<IShape>) {\r\n        if (this._shape.isOk && this._shape.value.isEqual(shape.value)) {\r\n            return;\r\n        }\r\n\r\n        if (!shape.isOk) {\r\n            PubSub.default.pub(\"displayError\", shape.error);\r\n            return;\r\n        }\r\n\r\n        let oldShape = this._shape;\r\n        this._shape = shape;\r\n        this._mesh = undefined;\r\n\r\n        this.emitPropertyChanged(\"shape\", oldShape);\r\n\r\n        oldShape.unchecked()?.dispose();\r\n    }\r\n\r\n    protected override createMesh(): IShapeMeshData {\r\n        if (!this.shape.isOk) {\r\n            throw new Error(this.shape.error);\r\n        }\r\n        const mesh = this.shape.value.mesh;\r\n        this._originFaceMesh = mesh.faces;\r\n        if (mesh.faces)\r\n            mesh.faces = MeshUtils.mergeFaceMesh(\r\n                mesh.faces,\r\n                this.faceMaterialPair.map((x) => [x.faceIndex, x.materialIndex]),\r\n            );\r\n        return mesh;\r\n    }\r\n\r\n    override disposeInternal(): void {\r\n        super.disposeInternal();\r\n        this._shape.unchecked()?.dispose();\r\n        this._shape = null as any;\r\n    }\r\n}\r\n\r\nexport class MultiShapeMesh implements IShapeMeshData {\r\n    private readonly _edges: EdgeMeshData;\r\n    private readonly _faces: FaceMeshData;\r\n\r\n    get edges() {\r\n        return this._edges.position.length > 0 ? this._edges : undefined;\r\n    }\r\n\r\n    get faces() {\r\n        return this._faces.position.length > 0 ? this._faces : undefined;\r\n    }\r\n\r\n    constructor() {\r\n        this._edges = {\r\n            lineType: LineType.Solid,\r\n            position: new Float32Array(),\r\n            range: [],\r\n            color: VisualConfig.defaultEdgeColor,\r\n        };\r\n\r\n        this._faces = {\r\n            index: new Uint32Array(),\r\n            normal: new Float32Array(),\r\n            position: new Float32Array(),\r\n            uv: new Float32Array(),\r\n            range: [],\r\n            groups: [],\r\n            color: VisualConfig.defaultFaceColor,\r\n        };\r\n    }\r\n\r\n    public addShape(shape: IShape, matrix: Matrix4) {\r\n        const mesh = shape.mesh;\r\n        const totleMatrix = shape.matrix.multiply(matrix);\r\n        if (mesh.faces) {\r\n            MeshUtils.combineFaceMeshData(this._faces, mesh.faces, totleMatrix);\r\n        }\r\n        if (mesh.edges) {\r\n            MeshUtils.combineEdgeMeshData(this._edges, mesh.edges, totleMatrix);\r\n        }\r\n    }\r\n}\r\n\r\n@Serializer.register([\"document\", \"name\", \"shapes\", \"materialId\", \"id\"])\r\nexport class MultiShapeNode extends GeometryNode {\r\n    private readonly _shapes: IShape[];\r\n    @Serializer.serialze()\r\n    get shapes(): ReadonlyArray<IShape> {\r\n        return this._shapes;\r\n    }\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        name: string,\r\n        shapes: IShape[],\r\n        materialId?: string,\r\n        id: string = Id.generate(),\r\n    ) {\r\n        super(document, name, materialId, id);\r\n        this._shapes = shapes;\r\n    }\r\n\r\n    protected override createMesh(): IShapeMeshData {\r\n        const meshes = new MultiShapeMesh();\r\n\r\n        this._shapes.forEach((shape) => {\r\n            meshes.addShape(shape, Matrix4.identity());\r\n        });\r\n\r\n        return meshes;\r\n    }\r\n\r\n    override display(): I18nKeys {\r\n        return \"body.multiShape\";\r\n    }\r\n}\r\n\r\nconst SHAPE_UNDEFINED = \"Shape not initialized\";\r\nexport abstract class ParameterShapeNode extends ShapeNode {\r\n    override get shape(): Result<IShape> {\r\n        if (!this._shape.isOk && this._shape.error === SHAPE_UNDEFINED) {\r\n            this._shape = this.generateShape();\r\n        }\r\n        return this._shape;\r\n    }\r\n\r\n    protected setPropertyEmitShapeChanged<K extends keyof this>(\r\n        property: K,\r\n        newValue: this[K],\r\n        onPropertyChanged?: (property: K, oldValue: this[K]) => void,\r\n        equals?: IEqualityComparer<this[K]> | undefined,\r\n    ): boolean {\r\n        if (this.setProperty(property, newValue, onPropertyChanged, equals)) {\r\n            this.setShape(this.generateShape());\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    constructor(document: IDocument, materialId?: string, id?: string) {\r\n        super(document, undefined as any, materialId, id);\r\n        this.setPrivateValue(\"name\", I18n.translate(this.display()));\r\n    }\r\n\r\n    protected abstract generateShape(): Result<IShape>;\r\n}\r\n\r\n@Serializer.register([\"document\", \"name\", \"shape\", \"materialId\", \"id\"])\r\nexport class EditableShapeNode extends ShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.editableShape\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    override get shape() {\r\n        return this._shape;\r\n    }\r\n\r\n    override set shape(shape: Result<IShape>) {\r\n        this.setShape(shape);\r\n    }\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        name: string,\r\n        shape: IShape | Result<IShape>,\r\n        materialId?: string | string[],\r\n        id?: string,\r\n    ) {\r\n        super(document, name, materialId, id);\r\n        this._shape = shape instanceof Result ? shape : Result.ok(shape);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 Licensettt.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { MeshUtils } from \"chili-geo\";\r\nimport { IDocument } from \"../document\";\r\nimport { Id } from \"../foundation\";\r\nimport { I18nKeys } from \"../i18n\";\r\nimport { BoundingBox, Matrix4, XYZ } from \"../math\";\r\nimport { Property } from \"../property\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { EdgeMeshData, FaceMeshData, LineType, Mesh } from \"../shape\";\r\nimport { MeshNode } from \"./meshNode\";\r\nimport { INode } from \"./node\";\r\nimport { ShapeNode } from \"./shapeNode\";\r\nimport { VisualNode } from \"./visualNode\";\r\n\r\nexport type ComponentMesh = {\r\n    faceMaterials: string[];\r\n    edge: EdgeMeshData;\r\n    face: FaceMeshData;\r\n    linesegments: Mesh;\r\n    surfaceMaterials: string[];\r\n    surface: Mesh;\r\n};\r\n\r\nexport function createComponentMesh(size: ComponentSize): ComponentMesh {\r\n    return {\r\n        faceMaterials: [],\r\n        edge: {\r\n            lineType: LineType.Solid,\r\n            position: new Float32Array(size.edge * 3),\r\n            range: [],\r\n        },\r\n        face: {\r\n            index: new Uint32Array(size.faceIndex),\r\n            normal: new Float32Array(size.facePosition * 3),\r\n            position: new Float32Array(size.facePosition * 3),\r\n            uv: new Float32Array(size.facePosition * 2),\r\n            range: [],\r\n            groups: [],\r\n        },\r\n        linesegments: Mesh.createLineSegments(size.lineSegment),\r\n        surfaceMaterials: [],\r\n        surface: Mesh.createSurface(size.meshPosition, size.meshIndex > 0 ? size.meshIndex : size.meshPosition * 3),\r\n    };\r\n}\r\n\r\nexport type ComponentSize = {\r\n    facePosition: number;\r\n    faceIndex: number;\r\n    edge: number;\r\n    lineSegment: number;\r\n    meshPosition: number;\r\n    meshIndex: number;\r\n};\r\n\r\nexport function createComponentSize(): ComponentSize {\r\n    return {\r\n        facePosition: 0,\r\n        faceIndex: 0,\r\n        edge: 0,\r\n        lineSegment: 0,\r\n        meshIndex: 0,\r\n        meshPosition: 0,\r\n    };\r\n}\r\n\r\n@Serializer.register([\"name\", \"nodes\", \"origin\", \"id\"])\r\nexport class Component {\r\n    private readonly _nodes: ReadonlyArray<VisualNode>;\r\n    @Serializer.serialze()\r\n    get nodes(): ReadonlyArray<VisualNode> {\r\n        return this._nodes;\r\n    }\r\n\r\n    private readonly _name: string;\r\n    @Serializer.serialze()\r\n    get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    readonly id: string;\r\n\r\n    private _origin: XYZ;\r\n    @Serializer.serialze()\r\n    get origin(): XYZ {\r\n        return this._origin;\r\n    }\r\n    set origin(value: XYZ) {\r\n        this._origin = value;\r\n    }\r\n\r\n    private _boundingBox?: BoundingBox;\r\n    get boundingBox(): BoundingBox | undefined {\r\n        this._boundingBox ??= this.computeBoundingBox();\r\n        return this._boundingBox;\r\n    }\r\n\r\n    private _mesh?: ComponentMesh;\r\n    get mesh(): ComponentMesh {\r\n        this._mesh ??= this.mergeMesh();\r\n        return this._mesh;\r\n    }\r\n\r\n    public instances: ComponentNode[] = [];\r\n\r\n    constructor(name: string, nodes: ReadonlyArray<VisualNode>, origin?: XYZ, id = Id.generate()) {\r\n        this._name = name;\r\n        this._nodes = nodes;\r\n        this.id = id;\r\n        this._origin = origin ?? BoundingBox.center(this.boundingBox);\r\n    }\r\n\r\n    toString(): string {\r\n        return this.name;\r\n    }\r\n\r\n    private mergeMesh() {\r\n        const size: ComponentSize = createComponentSize();\r\n        this.getSize(this._nodes, size);\r\n        const mesh = createComponentMesh(size);\r\n\r\n        const offset: ComponentSize = createComponentSize();\r\n        const faceMaterialPair: [number, number][] = [];\r\n        this.mergeNodesMesh(mesh, faceMaterialPair, this._nodes, Matrix4.identity(), offset);\r\n        mesh.face = MeshUtils.mergeFaceMesh(mesh.face, faceMaterialPair);\r\n\r\n        return mesh;\r\n    }\r\n\r\n    private getSize(nodes: Iterable<INode>, size: ComponentSize) {\r\n        for (const node of nodes) {\r\n            if (node instanceof ShapeNode && node.shape.isOk) {\r\n                const mesh = node.shape.value.mesh;\r\n                if (mesh.faces) {\r\n                    size.facePosition += mesh.faces.position.length / 3;\r\n                    size.faceIndex += mesh.faces.index.length;\r\n                }\r\n                if (mesh.edges) size.edge += mesh.edges.position.length / 3;\r\n            } else if (node instanceof MeshNode) {\r\n                size.meshPosition += node.mesh.position!.length / 3;\r\n                if (node.mesh.meshType === \"surface\") {\r\n                    size.meshIndex += node.mesh.index?.length ?? 0;\r\n                }\r\n            } else if (node instanceof ComponentNode) {\r\n                this.getSize(node.component.nodes, size);\r\n            }\r\n        }\r\n    }\r\n\r\n    private readonly mergeNodesMesh = (\r\n        visual: ComponentMesh,\r\n        faceMaterialPair: [number, number][],\r\n        nodes: Iterable<VisualNode>,\r\n        transform: Matrix4,\r\n        offset: ComponentSize,\r\n    ) => {\r\n        for (const node of nodes) {\r\n            const totleTransform = node.transform.multiply(transform);\r\n            if (node instanceof ShapeNode && node.shape.isOk) {\r\n                this.mergeShapeNode(visual, faceMaterialPair, node, totleTransform, offset);\r\n            } else if (node instanceof ComponentNode) {\r\n                this.mergeNodesMesh(visual, faceMaterialPair, node.component.nodes, totleTransform, offset);\r\n            } else if (node instanceof MeshNode) {\r\n                this.mergeMeshNode(visual, node, totleTransform, offset);\r\n            } else {\r\n                console.log(`****** to do merge MeshNode ******: ${Object.prototype.toString.call(node)}`);\r\n            }\r\n        }\r\n    };\r\n\r\n    private mergeShapeNode(\r\n        visual: ComponentMesh,\r\n        faceMaterialPair: [number, number][],\r\n        node: ShapeNode,\r\n        transform: Matrix4,\r\n        offset: ComponentSize,\r\n    ) {\r\n        const mesh = node.shape.value.mesh;\r\n        if (mesh.edges) {\r\n            MeshUtils.setEdgeMeshData(visual.edge, mesh.edges, transform, offset.edge);\r\n            offset.edge += mesh.edges.position.length / 3;\r\n        }\r\n        if (mesh.faces) {\r\n            this.mergeFaceMaterial(node, visual, faceMaterialPair);\r\n            MeshUtils.setFaceMeshData(visual.face, mesh.faces, transform, offset);\r\n            offset.facePosition += mesh.faces.position.length / 3;\r\n            offset.faceIndex += mesh.faces.index.length;\r\n        }\r\n    }\r\n\r\n    private mergeFaceMaterial(node: ShapeNode, visual: ComponentMesh, faceMaterialPair: [number, number][]) {\r\n        const materialIndexMap = this.mapOldNewMaterialIndex(node.materialId, visual.faceMaterials);\r\n\r\n        const map = new Map<number, number>(\r\n            node.faceMaterialPair.map((pair) => [pair.faceIndex, pair.materialIndex]),\r\n        );\r\n        node.mesh.faces?.range.forEach((range, i) => {\r\n            if (!map.has(i)) {\r\n                faceMaterialPair.push([i + visual.face.range.length, materialIndexMap.get(0)!]);\r\n            }\r\n        });\r\n        node.faceMaterialPair.forEach((pair) => {\r\n            faceMaterialPair.push([\r\n                pair.faceIndex + visual.face.range.length,\r\n                materialIndexMap.get(pair.materialIndex)!,\r\n            ]);\r\n        });\r\n    }\r\n\r\n    private mergeMeshNode(\r\n        visual: ComponentMesh,\r\n        node: MeshNode,\r\n        transform: Matrix4,\r\n        offset: ComponentSize\r\n    ) {\r\n        if (node.mesh.meshType === \"surface\") {\r\n            const materialONMap = this.mapOldNewMaterialIndex(node.materialId, visual.surfaceMaterials);\r\n            MeshUtils.setSurfaceMeshData(visual.surface, node.mesh, transform, offset, materialONMap);\r\n            offset.meshPosition += node.mesh.position!.length / 3;\r\n            if (node.mesh.index?.length) {\r\n                offset.meshIndex += node.mesh.index.length;\r\n            }\r\n        } else if (node.mesh.meshType === \"linesegments\") {\r\n            visual.linesegments.position?.set(transform.ofPoints(node.mesh.position!), offset.lineSegment * 3);\r\n            offset.lineSegment += node.mesh.position!.length / 3;\r\n        }\r\n    }\r\n\r\n    private mapOldNewMaterialIndex(materialId: string | string[], materialIds: string[]) {\r\n        const materialIndexMap = new Map<number, number>();\r\n        const materials = Array.isArray(materialId) ? materialId : [materialId];\r\n        for (let i = 0; i < materials.length; i++) {\r\n            const index = materialIds.indexOf(materials[i]);\r\n            if (index === -1) {\r\n                materialIds.push(materials[i]);\r\n                materialIndexMap.set(i, materialIds.length - 1);\r\n            } else {\r\n                materialIndexMap.set(i, index);\r\n            }\r\n        }\r\n\r\n        return materialIndexMap;\r\n    }\r\n\r\n    private computeBoundingBox() {\r\n        if (this._nodes.length === 0) {\r\n            return undefined;\r\n        }\r\n\r\n        let box = this._nodes[0].boundingBox();\r\n        for (let i = 1; i < this._nodes.length; i++) {\r\n            box = BoundingBox.combine(box, this._nodes[i].boundingBox());\r\n        }\r\n        return box;\r\n    }\r\n}\r\n\r\n@Serializer.register([\"document\", \"name\", \"componentId\", \"insert\", \"id\"])\r\nexport class ComponentNode extends VisualNode {\r\n    override display(): I18nKeys {\r\n        return \"body.group\";\r\n    }\r\n\r\n    override boundingBox(): BoundingBox | undefined {\r\n        if (!this.component.boundingBox) {\r\n            return undefined;\r\n        }\r\n\r\n        return BoundingBox.transformed(this.component.boundingBox, this.transform);\r\n    }\r\n\r\n    private _component?: Component;\r\n    @Property.define(\"body.group\")\r\n    get component() {\r\n        if (!this._component) {\r\n            this._component = this.document.components.find((c) => c.id === this.componentId);\r\n            if (!this._component) {\r\n                throw new Error(`Component ${this.componentId} not found`);\r\n            }\r\n            this._component.instances.push(this);\r\n        }\r\n        return this._component;\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    readonly componentId: string;\r\n\r\n    @Serializer.serialze()\r\n    readonly insert: XYZ;\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        name: string,\r\n        componentId: string,\r\n        insert: XYZ,\r\n        id: string = Id.generate(),\r\n    ) {\r\n        super(document, name, id);\r\n        this.componentId = componentId;\r\n        this.insert = insert;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Property } from \"../property\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { ParameterShapeNode } from \"./shapeNode\";\r\n\r\nexport abstract class FacebaseNode extends ParameterShapeNode {\r\n    @Serializer.serialze()\r\n    @Property.define(\"option.command.isFace\")\r\n    get isFace() {\r\n        return this.getPrivateValue(\"isFace\", false);\r\n    }\r\n    set isFace(value: boolean) {\r\n        this.setProperty(\"isFace\", value);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument } from \"../document\";\r\nimport { Id, Logger, NodeAction } from \"../foundation\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { INode, INodeLinkedList, Node } from \"./node\";\r\n\r\n@Serializer.register([\"document\", \"name\", \"id\"])\r\nexport class FolderNode extends Node implements INodeLinkedList {\r\n    private _count: number = 0;\r\n    private _firstChild: INode | undefined;\r\n    private _lastChild: INode | undefined;\r\n\r\n    get firstChild() {\r\n        return this._firstChild;\r\n    }\r\n    get lastChild() {\r\n        return this._lastChild;\r\n    }\r\n    get count() {\r\n        return this._count;\r\n    }\r\n    size(): number {\r\n        return this._count;\r\n    }\r\n\r\n    constructor(document: IDocument, name: string, id: string = Id.generate()) {\r\n        super(document, name, id);\r\n    }\r\n\r\n    add(...items: INode[]): void {\r\n        const records = items.map((item) => ({\r\n            action: NodeAction.add,\r\n            node: item,\r\n            oldParent: undefined,\r\n            oldPrevious: undefined,\r\n            newParent: this,\r\n            newPrevious: this._lastChild,\r\n        }));\r\n\r\n        items.forEach((item) => {\r\n            if (this.initNode(item)) {\r\n                this.addToLast(item);\r\n            }\r\n            this._count++;\r\n        });\r\n\r\n        this.document.notifyNodeChanged(records);\r\n    }\r\n\r\n    private initNode(node: INode): boolean {\r\n        node.parent = this;\r\n        node.parentVisible = this.visible && this.parentVisible;\r\n        if (!this._firstChild) {\r\n            this._firstChild = this._lastChild = node;\r\n            node.previousSibling = node.nextSibling = undefined;\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private addToLast(item: INode) {\r\n        this._lastChild!.nextSibling = item;\r\n        item.previousSibling = this._lastChild;\r\n        item.nextSibling = undefined;\r\n        this._lastChild = item;\r\n    }\r\n\r\n    children(): INode[] {\r\n        const result: INode[] = [];\r\n        let node = this._firstChild;\r\n        while (node) {\r\n            result.push(node);\r\n            node = node.nextSibling;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    remove(...items: INode[]): void {\r\n        const records = items\r\n            .filter((item) => this.validateChild(item))\r\n            .map((item) => ({\r\n                action: NodeAction.remove,\r\n                node: item,\r\n                newParent: undefined,\r\n                newPrevious: undefined,\r\n                oldParent: this,\r\n                oldPrevious: item.previousSibling,\r\n            }));\r\n\r\n        records.forEach((record) => this.removeNode(record.node, true));\r\n        this.document.notifyNodeChanged(records);\r\n    }\r\n\r\n    transfer(...items: INode[]): void {\r\n        const records = items\r\n            .filter((item) => this.validateChild(item))\r\n            .map((item) => ({\r\n                action: NodeAction.transfer,\r\n                node: item,\r\n                newParent: undefined,\r\n                newPrevious: undefined,\r\n                oldParent: this,\r\n                oldPrevious: item.previousSibling,\r\n            }));\r\n\r\n        records.forEach((record) => this.removeNode(record.node, true));\r\n        this.document.notifyNodeChanged(records);\r\n    }\r\n\r\n    private validateChild(item: INode): boolean {\r\n        if (item.parent !== this) {\r\n            Logger.warn(`${item.name} is not a child node of the ${this.name} node`);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private removeNode(node: INode, nullifyParent: boolean) {\r\n        if (nullifyParent) {\r\n            node.parent = undefined;\r\n            node.parentVisible = true;\r\n        }\r\n\r\n        if (node === this._firstChild) {\r\n            this.removeFirstNode(node);\r\n        } else if (node === this._lastChild) {\r\n            this.removeLastNode(node);\r\n        } else {\r\n            this.removeMiddleNode(node);\r\n        }\r\n        this._count--;\r\n    }\r\n\r\n    private removeFirstNode(node: INode) {\r\n        if (node === this._lastChild) {\r\n            this._firstChild = this._lastChild = undefined;\r\n        } else {\r\n            this._firstChild = node.nextSibling;\r\n            this._firstChild!.previousSibling = undefined;\r\n            node.nextSibling = undefined;\r\n        }\r\n    }\r\n\r\n    private removeLastNode(node: INode) {\r\n        this._lastChild = node.previousSibling;\r\n        this._lastChild!.nextSibling = undefined;\r\n        node.previousSibling = undefined;\r\n    }\r\n\r\n    private removeMiddleNode(node: INode) {\r\n        node.previousSibling!.nextSibling = node.nextSibling;\r\n        node.nextSibling!.previousSibling = node.previousSibling;\r\n        node.previousSibling = node.nextSibling = undefined;\r\n    }\r\n\r\n    insertBefore(target: INode | undefined, node: INode): void {\r\n        if (target && !this.validateChild(target)) return;\r\n\r\n        const record = {\r\n            action: NodeAction.insertBefore,\r\n            node,\r\n            oldParent: undefined,\r\n            oldPrevious: undefined,\r\n            newParent: this,\r\n            newPrevious: target?.previousSibling,\r\n        };\r\n\r\n        if (this.initNode(node)) {\r\n            if (!target || target === this._firstChild) {\r\n                this.insertAsFirst(node);\r\n            } else {\r\n                this.insertBetweenNodes(target.previousSibling!, node, target);\r\n            }\r\n        }\r\n        this._count++;\r\n        this.document.notifyNodeChanged([record]);\r\n    }\r\n\r\n    private insertAsFirst(node: INode) {\r\n        this._firstChild!.previousSibling = node;\r\n        node.nextSibling = this._firstChild;\r\n        this._firstChild = node;\r\n    }\r\n\r\n    private insertBetweenNodes(prev: INode, node: INode, next: INode) {\r\n        prev.nextSibling = node;\r\n        node.previousSibling = prev;\r\n        node.nextSibling = next;\r\n        next.previousSibling = node;\r\n    }\r\n\r\n    insertAfter(target: INode | undefined, node: INode): void {\r\n        if (target && !this.validateChild(target)) return;\r\n\r\n        const record = {\r\n            action: NodeAction.insertAfter,\r\n            oldParent: undefined,\r\n            oldPrevious: undefined,\r\n            newParent: this,\r\n            newPrevious: target,\r\n            node,\r\n        };\r\n\r\n        if (this.initNode(node)) {\r\n            if (!target) {\r\n                this.insertAsFirst(node);\r\n            } else if (target === this._lastChild) {\r\n                this.addToLast(node);\r\n            } else {\r\n                this.insertBetweenNodes(target, node, target.nextSibling!);\r\n            }\r\n        }\r\n        this._count++;\r\n        this.document.notifyNodeChanged([record]);\r\n    }\r\n\r\n    move(child: INode, newParent: FolderNode, previousSibling?: INode): void {\r\n        if (previousSibling && previousSibling.parent !== newParent) {\r\n            Logger.warn(`${previousSibling.name} is not a child node of the ${newParent.name} node`);\r\n            return;\r\n        }\r\n\r\n        const record = {\r\n            action: NodeAction.move,\r\n            oldParent: child.parent,\r\n            oldPrevious: child.previousSibling,\r\n            newParent: newParent,\r\n            newPrevious: previousSibling,\r\n            node: child,\r\n        };\r\n\r\n        this.removeNode(child, false);\r\n\r\n        if (newParent.initNode(child)) {\r\n            if (!previousSibling) {\r\n                newParent.insertAsFirst(child);\r\n            } else if (previousSibling === newParent._lastChild) {\r\n                newParent.addToLast(child);\r\n            } else {\r\n                newParent.insertBetweenNodes(previousSibling, child, previousSibling.nextSibling!);\r\n            }\r\n        }\r\n        newParent._count++;\r\n\r\n        this.document.notifyNodeChanged([record]);\r\n    }\r\n\r\n    override disposeInternal(): void {\r\n        this.disposeNodes(this._firstChild);\r\n        super.disposeInternal();\r\n    }\r\n\r\n    private readonly disposeNodes = (node: INode | undefined) => {\r\n        if (node instanceof FolderNode) {\r\n            this.disposeNodes(node.firstChild);\r\n        }\r\n\r\n        let next = node?.nextSibling;\r\n        if (node) {\r\n            node.nextSibling = null as any;\r\n        }\r\n        while (next) {\r\n            let cache = next.nextSibling;\r\n            next.previousSibling = null as any;\r\n            next.nextSibling = null as any;\r\n            next.dispose();\r\n            next = cache;\r\n        }\r\n        node?.dispose();\r\n    };\r\n\r\n    protected onVisibleChanged() {\r\n        this.setChildrenParentVisible();\r\n    }\r\n\r\n    protected onParentVisibleChanged() {\r\n        this.setChildrenParentVisible();\r\n    }\r\n\r\n    private setChildrenParentVisible() {\r\n        let child = this._firstChild;\r\n        while (child !== undefined) {\r\n            child.parentVisible = this.visible && this.parentVisible;\r\n            child = child.nextSibling;\r\n        }\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Matrix4 } from \"../math\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { FolderNode } from \"./folderNode\";\r\n\r\n@Serializer.register([\"document\", \"name\", \"id\"])\r\nexport class GroupNode extends FolderNode {\r\n    @Serializer.serialze()\r\n    get transform(): Matrix4 {\r\n        return this.getPrivateValue(\"transform\", Matrix4.identity());\r\n    }\r\n    set transform(value: Matrix4) {\r\n        this.setProperty(\"transform\", value, undefined, {\r\n            equals: (left, right) => left.equals(right),\r\n        });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { INode, ShapeNode } from \"./model\";\r\nimport { IShape } from \"./shape\";\r\n\r\nexport interface IShapeFilter {\r\n    allow(shape: IShape): boolean;\r\n}\r\n\r\nexport interface INodeFilter {\r\n    allow(node: INode): boolean;\r\n}\r\n\r\nexport class ShapeNodeFilter implements INodeFilter {\r\n    constructor(readonly shapeFilter?: IShapeFilter) {}\r\n\r\n    allow(node: INode): boolean {\r\n        if (node instanceof ShapeNode) {\r\n            if (this.shapeFilter && node.shape.isOk) {\r\n                return this.shapeFilter.allow(node.shape.value);\r\n            }\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IConverter, Observable, ObservableCollection } from \"../foundation\";\r\n\r\nexport class Combobox<T> extends Observable {\r\n    constructor(readonly converter?: IConverter<T>) {\r\n        super();\r\n    }\r\n\r\n    get selectedIndex(): number {\r\n        return this.getPrivateValue(\"selectedIndex\", 0);\r\n    }\r\n    set selectedIndex(value: number) {\r\n        if (value < 0 || value >= this.items.length) {\r\n            return;\r\n        }\r\n\r\n        this.setProperty(\"selectedIndex\", value);\r\n    }\r\n\r\n    get selectedItem(): T | undefined {\r\n        return this.items.at(this.selectedIndex);\r\n    }\r\n\r\n    readonly items = new ObservableCollection<T>();\r\n}\r\n","import { Observable } from \"../foundation\";\r\nimport { XYZ } from \"../math\";\r\nimport { Serializer } from \"../serialize\";\r\nimport { IView } from \"./view\";\r\n\r\n@Serializer.register([\"name\", \"cameraPosition\", \"cameraTarget\", \"cameraUp\"])\r\nexport class Act extends Observable {\r\n    @Serializer.serialze()\r\n    public get name() {\r\n        return this.getPrivateValue(\"name\");\r\n    }\r\n    public set name(value: string) {\r\n        this.setProperty(\"name\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    public get cameraPosition() {\r\n        return this.getPrivateValue(\"cameraPosition\");\r\n    }\r\n    public set cameraPosition(value: XYZ) {\r\n        this.setProperty(\"cameraPosition\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    public get cameraTarget() {\r\n        return this.getPrivateValue(\"cameraTarget\");\r\n    }\r\n    public set cameraTarget(value: XYZ) {\r\n        this.setProperty(\"cameraTarget\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    public get cameraUp() {\r\n        return this.getPrivateValue(\"cameraUp\");\r\n    }\r\n    public set cameraUp(value: XYZ) {\r\n        this.setProperty(\"cameraUp\", value);\r\n    }\r\n\r\n    static fromView(view: IView, name: string) {\r\n        return new Act(\r\n            name,\r\n            view.cameraController.cameraPosition,\r\n            view.cameraController.cameraTarget,\r\n            view.cameraController.cameraUp,\r\n        );\r\n    }\r\n\r\n    constructor(name: string, cameraPosition: XYZ, cameraTarget: XYZ, cameraUp: XYZ) {\r\n        super();\r\n        this.setPrivateValue(\"name\", name);\r\n        this.setPrivateValue(\"cameraPosition\", cameraPosition);\r\n        this.setPrivateValue(\"cameraTarget\", cameraTarget);\r\n        this.setPrivateValue(\"cameraUp\", cameraUp);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { BoundingBox, GeometryNode, IDisposable, Matrix4, VisualNode } from \"chili-core\";\r\n\r\nexport interface IVisualObject extends IDisposable {\r\n    visible: boolean;\r\n    transform: Matrix4;\r\n    worldTransform(): Matrix4;\r\n    boundingBox(): BoundingBox | undefined;\r\n}\r\n\r\nexport interface INodeVisual extends IVisualObject {\r\n    get node(): VisualNode;\r\n}\r\n\r\nexport interface IVisualGeometry extends IVisualObject {\r\n    get geometryNode(): GeometryNode;\r\n}\r\n\r\nexport namespace IVisualObject {\r\n    export function isGeometry(obj: IVisualObject): obj is IVisualGeometry {\r\n        return (obj as IVisualGeometry).geometryNode !== undefined;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { concatTypedArrays, EdgeMeshData, FaceMeshData, MathUtils, Matrix4, Mesh } from \"chili-core\";\r\n\r\nexport class MeshUtils {\r\n    static setFaceMeshData(\r\n        data: FaceMeshData,\r\n        other: FaceMeshData | undefined,\r\n        matrix: Matrix4,\r\n        offset: { facePosition: number; faceIndex: number },\r\n    ) {\r\n        if (!other) {\r\n            return;\r\n        }\r\n\r\n        data.range = data.range.concat(\r\n            other.range.map((g) => {\r\n                return {\r\n                    start: g.start + offset.faceIndex,\r\n                    shape: g.shape,\r\n                    count: g.count,\r\n                    transform: matrix,\r\n                };\r\n            }),\r\n        );\r\n        data.index.set(\r\n            other.index.map((x) => x + offset.facePosition),\r\n            offset.faceIndex,\r\n        );\r\n        data.position.set(matrix.ofPoints(other.position), offset.facePosition * 3);\r\n        data.normal.set(matrix.ofVectors(other.normal), offset.facePosition * 3);\r\n        data.uv.set(other.uv, offset.facePosition * 2);\r\n    }\r\n\r\n    static setSurfaceMeshData(\r\n        data: Mesh, \r\n        other: Mesh, \r\n        matrix: Matrix4,\r\n        offset: { meshPosition: number; meshIndex: number },\r\n        materialMap: Map<number, number>,\r\n    ) {\r\n        other.groups.forEach((g) => {\r\n            data.groups.push({\r\n                start: g.start + offset.meshIndex,\r\n                count: g.count,\r\n                materialIndex: materialMap.get(g.materialIndex)!,\r\n            })\r\n        })\r\n        if (data.index && other.index) {\r\n            data.index.set(other.index.map((x) => x + offset.meshPosition), offset.meshIndex);\r\n        }\r\n        if (data.position && other.position) {\r\n            data.position.set(matrix.ofPoints(other.position), offset.meshPosition * 3);\r\n        }\r\n        if (data.normal && other.normal) {\r\n            data.normal.set(matrix.ofVectors(other.normal), offset.meshPosition * 3);\r\n        }\r\n        if (data.uv && other.uv) {\r\n            data.uv.set(other.uv, offset.meshPosition * 2);\r\n        }\r\n    }\r\n\r\n    static combineFaceMeshData(data: FaceMeshData, other: FaceMeshData | undefined, matrix: Matrix4) {\r\n        if (!other) {\r\n            return;\r\n        }\r\n\r\n        data.range = data.range.concat(\r\n            other.range.map((g) => {\r\n                return {\r\n                    start: g.start + data.index.length,\r\n                    shape: g.shape,\r\n                    count: g.count,\r\n                    transform: matrix,\r\n                };\r\n            }),\r\n        );\r\n        data.index = concatTypedArrays([data.index, other.index.map((x) => x + data.position.length / 3)]);\r\n        data.position = this.concatFloat32Array(data.position, matrix.ofPoints(other.position));\r\n        data.normal = this.concatFloat32Array(data.normal, matrix.ofVectors(other.normal));\r\n        data.uv = this.concatFloat32Array(data.uv, other.uv);\r\n    }\r\n\r\n    static concatFloat32Array(arr1: ArrayLike<number>, arr2: ArrayLike<number>) {\r\n        let arr = new Float32Array(arr1.length + arr2.length);\r\n        arr.set(arr1);\r\n        arr.set(arr2, arr1.length);\r\n        return arr;\r\n    }\r\n\r\n    static setEdgeMeshData(\r\n        data: EdgeMeshData,\r\n        other: EdgeMeshData | undefined,\r\n        matrix: Matrix4,\r\n        offset: number,\r\n    ) {\r\n        if (!other) {\r\n            return;\r\n        }\r\n\r\n        data.position.set(matrix.ofPoints(other.position), offset * 3);\r\n        data.range = data.range.concat(\r\n            other.range.map((g) => {\r\n                return {\r\n                    transform: matrix,\r\n                    start: g.start + offset,\r\n                    shape: g.shape,\r\n                    count: g.count,\r\n                };\r\n            }),\r\n        );\r\n    }\r\n\r\n    static combineEdgeMeshData(data: EdgeMeshData, other: EdgeMeshData | undefined, matrix: Matrix4) {\r\n        if (!other) {\r\n            return;\r\n        }\r\n\r\n        let start = data.position.length / 3;\r\n        data.position = this.concatFloat32Array(data.position, matrix.ofPoints(other.position));\r\n        data.range = data.range.concat(\r\n            other.range.map((g) => {\r\n                return {\r\n                    start: g.start + start,\r\n                    shape: g.shape,\r\n                    count: g.count,\r\n                    transform: matrix,\r\n                };\r\n            }),\r\n        );\r\n    }\r\n\r\n    static mergeFaceMesh(mesh: FaceMeshData, materialMap: [number, number][]): FaceMeshData {\r\n        if (materialMap.length === 0) {\r\n            return mesh;\r\n        }\r\n\r\n        const materialIndexMap = new Map<number, number>(materialMap);\r\n        for (let i = 0; i < mesh.range.length; i++) {\r\n            if (!materialIndexMap.has(i)) {\r\n                materialIndexMap.set(i, 0);\r\n            }\r\n        }\r\n\r\n        return this.mergeFaceMeshWithMap(mesh, materialIndexMap);\r\n    }\r\n\r\n    private static mergeFaceMeshWithMap(mesh: FaceMeshData, materialMap: Map<number, number>): FaceMeshData {\r\n        const result: FaceMeshData = {\r\n            position: new Float32Array(mesh.position.length),\r\n            normal: new Float32Array(mesh.normal.length),\r\n            uv: new Float32Array(mesh.uv.length),\r\n            index: new Uint32Array(mesh.index.length),\r\n            range: [],\r\n            color: mesh.color,\r\n            groups: [],\r\n        };\r\n\r\n        let offset = { facePosition: 0, faceIndex: 0 };\r\n        const grouped = Object.groupBy(materialMap, (x) => x[1]);\r\n\r\n        for (const key of Object.keys(grouped)) {\r\n            const i = parseInt(key);\r\n            const groupStart = offset.faceIndex;\r\n            MeshUtils.mergeSameGroup(grouped[i]!, mesh, result, offset);\r\n            result.groups.push({\r\n                start: groupStart,\r\n                count: offset.faceIndex - groupStart,\r\n                materialIndex: i,\r\n            });\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private static mergeSameGroup(\r\n        group: [number, number][],\r\n        mesh: FaceMeshData,\r\n        result: FaceMeshData,\r\n        offset: { facePosition: number; faceIndex: number },\r\n    ) {\r\n        for (const index of group) {\r\n            const { start, count, shape, transform: worldTransform } = mesh.range[index[0]];\r\n\r\n            const oldIndex = mesh.index.slice(start, start + count);\r\n            const { min, max } = MathUtils.minMax(oldIndex)!;\r\n            result.position.set(mesh.position.slice(min * 3, (max + 1) * 3), offset.facePosition * 3);\r\n            result.normal.set(mesh.normal.slice(min * 3, (max + 1) * 3), offset.facePosition * 3);\r\n            result.uv.set(mesh.uv.slice(min * 2, (max + 1) * 2), offset.facePosition * 2);\r\n            result.index.set(\r\n                oldIndex.map((x) => x - min + offset.facePosition),\r\n                offset.faceIndex,\r\n            );\r\n            result.range.push({\r\n                start: offset.faceIndex,\r\n                count,\r\n                shape,\r\n                transform: worldTransform,\r\n            });\r\n            offset.facePosition += max - min + 1;\r\n            offset.faceIndex += oldIndex.length;\r\n        }\r\n    }\r\n\r\n    static subFace(mesh: FaceMeshData, index: number): FaceMeshData | undefined {\r\n        const group = mesh?.range[index];\r\n        if (!group) return undefined;\r\n\r\n        const indices = mesh.index.slice(group.start, group.start + group.count);\r\n        const { min, max } = MathUtils.minMax(indices)!;\r\n        const [indiceStart, indiceEnd] = [min, max + 1];\r\n\r\n        return {\r\n            position: mesh.position.slice(indiceStart * 3, indiceEnd * 3),\r\n            normal: mesh.normal.slice(indiceStart * 3, indiceEnd * 3),\r\n            index: indices.map((i) => i - indiceStart),\r\n            uv: mesh.uv.slice(indiceStart * 2, indiceEnd * 2),\r\n            range: [],\r\n            color: mesh.color,\r\n            groups: [],\r\n        };\r\n    }\r\n\r\n    static subFaceOutlines(face: FaceMeshData, index: number) {\r\n        const mesh = this.subFace(face, index);\r\n        if (!mesh) return undefined;\r\n\r\n        return this.faceOutline(mesh);\r\n    }\r\n\r\n    static addEdge(\r\n        pointsMap: Map<string, { count: number; points: number[] }>,\r\n        face: { position: Float32Array },\r\n        i: number,\r\n        j: number,\r\n    ) {\r\n        const key = i < j ? `${i}_${j}` : `${j}_${i}`;\r\n        const entry = pointsMap.get(key);\r\n        if (entry) {\r\n            entry.count++;\r\n        } else {\r\n            const points = [\r\n                ...face.position.slice(i * 3, i * 3 + 3),\r\n                ...face.position.slice(j * 3, j * 3 + 3),\r\n            ];\r\n            pointsMap.set(key, { count: 1, points });\r\n        }\r\n    }\r\n\r\n    static faceOutline(face: { position: Float32Array; index: Uint32Array }) {\r\n        const pointsMap = new Map<string, { count: number; points: number[] }>();\r\n\r\n        for (let i = 0; i < face.index.length; i += 3) {\r\n            this.addEdge(pointsMap, face, face.index[i], face.index[i + 1]);\r\n            this.addEdge(pointsMap, face, face.index[i + 1], face.index[i + 2]);\r\n            this.addEdge(pointsMap, face, face.index[i + 2], face.index[i]);\r\n        }\r\n\r\n        return new Float32Array(\r\n            Array.from(pointsMap.values())\r\n                .filter((v) => v.count === 1)\r\n                .flatMap((entry) => entry.points),\r\n        );\r\n    }\r\n\r\n    static subEdge(mesh: EdgeMeshData, index: number) {\r\n        const group = mesh?.range[index];\r\n        if (!group) return undefined;\r\n\r\n        return mesh.position.slice(group.start * 3, (group.start + group.count) * 3);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { ICurve, IEdge, IFace, IWire, Precision, Result, ShapeType, XYZ } from \"chili-core\";\r\n\r\nexport class GeoUtils {\r\n    static nearestPoint(wire: IWire, point: XYZ): { edge: IEdge; point: XYZ } {\r\n        let minDistance = Number.MAX_VALUE;\r\n        let nearest: { edge: IEdge; point: XYZ } | undefined;\r\n\r\n        for (const edge of wire.findSubShapes(ShapeType.Edge) as IEdge[]) {\r\n            const tempPoint = edge.curve.nearestFromPoint(point);\r\n            if (tempPoint.distance < minDistance) {\r\n                nearest = { edge, point: tempPoint.point };\r\n                minDistance = tempPoint.distance;\r\n            }\r\n        }\r\n        return nearest!;\r\n    }\r\n\r\n    static curveNormal(curve: ICurve) {\r\n        if (ICurve.isTrimmed(curve)) {\r\n            curve = curve.basisCurve;\r\n        }\r\n\r\n        if (ICurve.isConic(curve)) {\r\n            return curve.axis;\r\n        }\r\n        let vec = curve.dn(0, 1);\r\n        if (vec.isParallelTo(XYZ.unitX)) return XYZ.unitZ;\r\n        return vec.cross(XYZ.unitX).normalize()!;\r\n    }\r\n\r\n    private static wireNormal(wire: IWire): XYZ {\r\n        const face = wire.toFace();\r\n        if (face.isOk) return face.value.normal(0, 0)[1];\r\n\r\n        let firstEdge: IEdge | undefined = undefined;\r\n        for (const edge of wire.findSubShapes(ShapeType.Edge)) {\r\n            firstEdge = edge as IEdge;\r\n            break;\r\n        }\r\n        return this.curveNormal(firstEdge!.curve);\r\n    }\r\n\r\n    static findNextEdge(wire: IWire, edge: IEdge): Result<IEdge> {\r\n        const curve = edge.curve;\r\n        const point = curve.value(curve.lastParameter());\r\n\r\n        for (const e of wire.findSubShapes(ShapeType.Edge)) {\r\n            if (e.isEqual(edge)) continue;\r\n            const testCurve = (e as IEdge).curve;\r\n            if (\r\n                point.distanceTo(testCurve.value(testCurve.firstParameter())) < Precision.Distance ||\r\n                point.distanceTo(testCurve.value(testCurve.lastParameter())) < Precision.Distance\r\n            ) {\r\n                return Result.ok(e as IEdge);\r\n            }\r\n        }\r\n        return Result.err(\"Cannot find next edge\");\r\n    }\r\n\r\n    static normal(shape: IFace | IWire | IEdge): XYZ {\r\n        if (shape.shapeType === ShapeType.Face) {\r\n            return (shape as IFace).normal(0, 0)[1];\r\n        }\r\n\r\n        if (shape.shapeType === ShapeType.Edge) {\r\n            let curve = (shape as IEdge).curve;\r\n            return this.curveNormal(curve);\r\n        }\r\n\r\n        return this.wireNormal(shape as IWire);\r\n    }\r\n\r\n    static intersects(edge: IEdge, otherEdges: IEdge[]): { point: XYZ; parameter: number }[] {\r\n        let result: { point: XYZ; parameter: number }[] = [];\r\n        otherEdges.forEach((e) => {\r\n            let intersect = edge.intersect(e);\r\n            if (intersect.length > 0) {\r\n                result.push(...intersect);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, IDocument, IEventHandler, IView } from \"chili-core\";\r\n\r\nconst MOUSE_MIDDLE = 4;\r\n\r\nconst SelectionRectStyle = `\r\n    border: 1px solid #55aaff;\r\n    background-color: rgba(75, 160, 255, 0.3);\r\n    position: absolute;\r\n    pointer-events: none;\r\n    display: none;\r\n    left: 0px;\r\n    right: 0px;\r\n    width: 0px;\r\n    height: 0px;\r\n`;\r\n\r\ninterface SelectionRect {\r\n    element: HTMLElement;\r\n    clientX: number;\r\n    clientY: number;\r\n}\r\n\r\nexport abstract class SelectionHandler implements IEventHandler {\r\n    protected rect?: SelectionRect;\r\n    protected showRect = true;\r\n    protected mouse = { isDown: false, x: 0, y: 0 };\r\n    protected readonly pointerEventMap: Map<number, PointerEvent> = new Map();\r\n\r\n    constructor(\r\n        readonly document: IDocument,\r\n        readonly multiMode: boolean,\r\n        readonly controller?: AsyncController,\r\n    ) {\r\n        controller?.onCancelled((s) => {\r\n            this.clearSelected(document);\r\n            this.cleanHighlights();\r\n        });\r\n    }\r\n\r\n    #disposed = false;\r\n    readonly dispose = () => {\r\n        if (!this.#disposed) {\r\n            this.#disposed = true;\r\n\r\n            this.disposeInternal();\r\n        }\r\n    };\r\n\r\n    protected disposeInternal() {\r\n        this.pointerEventMap.clear();\r\n    }\r\n\r\n    pointerMove(view: IView, event: PointerEvent): void {\r\n        if (event.buttons === MOUSE_MIDDLE) return;\r\n        if (this.rect) this.updateRect(this.rect, event);\r\n\r\n        this.setHighlight(view, event);\r\n    }\r\n\r\n    protected abstract setHighlight(view: IView, event: PointerEvent): void;\r\n\r\n    protected abstract cleanHighlights(): void;\r\n\r\n    protected abstract clearSelected(document: IDocument): void;\r\n\r\n    protected abstract select(view: IView, event: PointerEvent): number;\r\n\r\n    protected abstract highlightNext(view: IView): void;\r\n\r\n    pointerDown(view: IView, event: PointerEvent): void {\r\n        event.preventDefault();\r\n        if (event.button === 0 && event.isPrimary) {\r\n            this.mouse = { isDown: true, x: event.offsetX, y: event.offsetY };\r\n            if (this.multiMode && this.showRect) {\r\n                this.rect = this.initRect(event);\r\n            }\r\n        }\r\n        this.pointerEventMap.set(event.pointerId, event);\r\n    }\r\n\r\n    private initRect(event: PointerEvent): SelectionRect {\r\n        const rect = document.createElement(\"div\");\r\n        rect.style.cssText = SelectionRectStyle;\r\n        document.body.appendChild(rect);\r\n        return { element: rect, clientX: event.clientX, clientY: event.clientY };\r\n    }\r\n\r\n    protected updateRect(rect: SelectionRect, event: PointerEvent) {\r\n        if (this.pointerEventMap.size !== 1) return;\r\n        rect.element.style.display = \"block\";\r\n        const [x1, y1] = [Math.min(rect.clientX, event.clientX), Math.min(rect.clientY, event.clientY)];\r\n        const [x2, y2] = [Math.max(rect.clientX, event.clientX), Math.max(rect.clientY, event.clientY)];\r\n        Object.assign(rect.element.style, {\r\n            left: `${x1}px`,\r\n            top: `${y1}px`,\r\n            width: `${x2 - x1}px`,\r\n            height: `${y2 - y1}px`,\r\n        });\r\n    }\r\n\r\n    pointerOut(view: IView, event: PointerEvent): void {\r\n        if (event.isPrimary) {\r\n            this.mouse.isDown = false;\r\n            this.removeRect(view);\r\n            this.cleanHighlights();\r\n        }\r\n        this.pointerEventMap.delete(event.pointerId);\r\n    }\r\n\r\n    pointerUp(view: IView, event: PointerEvent): void {\r\n        event.preventDefault();\r\n        if (this.mouse.isDown && event.button === 0 && event.isPrimary) {\r\n            this.mouse.isDown = false;\r\n            this.removeRect(view);\r\n            const count = this.select(view, event);\r\n            this.cleanHighlights();\r\n            view.update();\r\n            if (count > 0 && !this.multiMode) this.controller?.success();\r\n        }\r\n        this.pointerEventMap.delete(event.pointerId);\r\n    }\r\n\r\n    private removeRect(view: IView) {\r\n        this.rect?.element.remove();\r\n        this.rect = undefined;\r\n    }\r\n\r\n    keyDown(view: IView, event: KeyboardEvent): void {\r\n        if (event.key === \"Escape\") {\r\n            this.controller ? this.controller.cancel() : this.clearSelected(view.document.visual.document);\r\n            this.cleanHighlights();\r\n        } else if (event.key === \"Enter\") {\r\n            this.cleanHighlights();\r\n            this.controller?.success();\r\n        } else if (event.key === \"Tab\") {\r\n            event.preventDefault();\r\n            this.highlightNext(view);\r\n        }\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    IDocument,\r\n    INode,\r\n    INodeFilter,\r\n    IView,\r\n    IVisualObject,\r\n    ShapeType,\r\n    VisualNode,\r\n    VisualState,\r\n} from \"chili-core\";\r\nimport { SelectionHandler } from \"./selectionEventHandler\";\r\n\r\nexport class NodeSelectionHandler extends SelectionHandler {\r\n    private _highlights: IVisualObject[] | undefined;\r\n    private _detectAtMouse: IVisualObject[] | undefined;\r\n    private _lockDetected: IVisualObject | undefined; // 用于切换捕获的对象\r\n\r\n    nodes(): VisualNode[] {\r\n        return this.document.selection.getSelectedNodes() as VisualNode[];\r\n    }\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        multiMode: boolean,\r\n        controller?: AsyncController,\r\n        readonly filter?: INodeFilter,\r\n    ) {\r\n        super(document, multiMode, controller);\r\n    }\r\n\r\n    protected override select(view: IView, event: PointerEvent): number {\r\n        if (!this._highlights?.length) {\r\n            this.clearSelected(this.document);\r\n            return 0;\r\n        }\r\n        const models = this._highlights\r\n            .map((x) => view.document.visual.context.getNode(x))\r\n            .filter((x): x is INode => x !== undefined);\r\n        this.document.selection.setSelection(models, event.shiftKey);\r\n        return models.length;\r\n    }\r\n\r\n    getDetecteds(view: IView, event: PointerEvent) {\r\n        if (\r\n            this.rect &&\r\n            Math.abs(this.mouse.x - event.offsetX) > 3 &&\r\n            Math.abs(this.mouse.y - event.offsetY) > 3\r\n        ) {\r\n            return view.detectVisualRect(\r\n                this.mouse.x,\r\n                this.mouse.y,\r\n                event.offsetX,\r\n                event.offsetY,\r\n                this.filter,\r\n            );\r\n        }\r\n        this._detectAtMouse = view.detectVisual(event.offsetX, event.offsetY, this.filter);\r\n        const detected = this.getDetecting();\r\n        return detected ? [detected] : [];\r\n    }\r\n\r\n    private getDetecting() {\r\n        if (!this._detectAtMouse) return undefined;\r\n        const index = this._lockDetected ? this.getDetcedtingIndex() : 0;\r\n        return this._detectAtMouse[index] || undefined;\r\n    }\r\n\r\n    private getDetcedtingIndex() {\r\n        if (!this._detectAtMouse) return -1;\r\n        for (let i = 0; i < this._detectAtMouse.length; i++) {\r\n            if (this._lockDetected === this._detectAtMouse[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    protected override setHighlight(view: IView, event: PointerEvent) {\r\n        let detecteds = this.getDetecteds(view, event);\r\n        this.highlightDetecteds(view, detecteds);\r\n    }\r\n\r\n    private highlightDetecteds(view: IView, detecteds: IVisualObject[]) {\r\n        this.cleanHighlights();\r\n        detecteds.forEach((x) => {\r\n            view.document.visual.highlighter.addState(x, VisualState.edgeHighlight, ShapeType.Shape);\r\n        });\r\n        this._highlights = detecteds;\r\n        view.update();\r\n    }\r\n\r\n    protected override cleanHighlights(): void {\r\n        this._highlights?.forEach((x) => {\r\n            this.document.visual.highlighter.removeState(x, VisualState.edgeHighlight, ShapeType.Shape);\r\n        });\r\n        this._highlights = undefined;\r\n    }\r\n\r\n    protected override highlightNext(view: IView): void {\r\n        if (this._detectAtMouse && this._detectAtMouse.length > 1) {\r\n            const index = this._lockDetected\r\n                ? (this.getDetcedtingIndex() + 1) % this._detectAtMouse.length\r\n                : 1;\r\n            this._lockDetected = this._detectAtMouse[index];\r\n            const detected = this.getDetecting();\r\n            if (detected) this.highlightDetecteds(view, [detected]);\r\n        }\r\n    }\r\n\r\n    override clearSelected(document: IDocument): void {\r\n        document.selection.clearSelection();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    IDocument,\r\n    IShape,\r\n    IShapeFilter,\r\n    IView,\r\n    ShapeType,\r\n    VisualShapeData,\r\n    VisualState,\r\n} from \"chili-core\";\r\nimport { SelectionHandler } from \"./selectionEventHandler\";\r\n\r\nexport abstract class ShapeSelectionHandler extends SelectionHandler {\r\n    protected _highlights: VisualShapeData[] | undefined;\r\n    private _detectAtMouse: VisualShapeData[] | undefined;\r\n    private _lockDetected: IShape | undefined;\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        readonly shapeType: ShapeType,\r\n        multiMode: boolean,\r\n        controller?: AsyncController,\r\n        readonly filter?: IShapeFilter,\r\n    ) {\r\n        super(document, multiMode, controller);\r\n    }\r\n\r\n    private getDetecteds(view: IView, event: PointerEvent) {\r\n        if (\r\n            this.rect &&\r\n            Math.abs(this.mouse.x - event.offsetX) > 3 &&\r\n            Math.abs(this.mouse.y - event.offsetY) > 3\r\n        ) {\r\n            return view.detectShapesRect(\r\n                this.shapeType,\r\n                this.mouse.x,\r\n                this.mouse.y,\r\n                event.offsetX,\r\n                event.offsetY,\r\n                this.filter,\r\n            );\r\n        }\r\n        this._detectAtMouse = view.detectShapes(this.shapeType, event.offsetX, event.offsetY, this.filter);\r\n        const detected = this.getDetecting();\r\n        return detected ? [detected] : [];\r\n    }\r\n\r\n    protected override setHighlight(view: IView, event: PointerEvent) {\r\n        let detecteds = this.getDetecteds(view, event);\r\n        this.highlightDetecteds(view, detecteds);\r\n    }\r\n\r\n    protected highlightDetecteds(view: IView, detecteds: VisualShapeData[]) {\r\n        this.cleanHighlights();\r\n        detecteds.forEach((x) => {\r\n            view.document.visual.highlighter.addState(\r\n                x.owner,\r\n                VisualState.edgeHighlight,\r\n                this.shapeType,\r\n                ...x.indexes,\r\n            );\r\n        });\r\n        this._highlights = detecteds;\r\n        view.update();\r\n    }\r\n\r\n    protected cleanHighlights() {\r\n        this._highlights?.forEach((x) => {\r\n            x.owner.node.document.visual.highlighter.removeState(\r\n                x.owner,\r\n                VisualState.edgeHighlight,\r\n                this.shapeType,\r\n                ...x.indexes,\r\n            );\r\n        });\r\n        this._highlights = undefined;\r\n    }\r\n\r\n    protected highlightNext(view: IView) {\r\n        if (this._detectAtMouse && this._detectAtMouse.length > 1) {\r\n            let index = this._lockDetected\r\n                ? (this.getDetcedtingIndex() + 1) % this._detectAtMouse.length\r\n                : 1;\r\n            this._lockDetected = this._detectAtMouse[index].shape;\r\n            const detected = this.getDetecting();\r\n            if (detected) this.highlightDetecteds(view, [detected]);\r\n        }\r\n    }\r\n\r\n    private getDetecting() {\r\n        if (this._detectAtMouse) {\r\n            const index = this._lockDetected ? this.getDetcedtingIndex() : 0;\r\n            return this._detectAtMouse[index];\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private getDetcedtingIndex() {\r\n        return this._detectAtMouse?.findIndex((x) => this._lockDetected === x.shape) ?? -1;\r\n    }\r\n}\r\n\r\nexport class SubshapeSelectionHandler extends ShapeSelectionHandler {\r\n    private readonly _shapes: Map<IShape, VisualShapeData> = new Map();\r\n    selectedState: VisualState = VisualState.edgeSelected;\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        shapeType: ShapeType,\r\n        multiMode: boolean,\r\n        controller?: AsyncController,\r\n        filter?: IShapeFilter,\r\n    ) {\r\n        super(document, shapeType, multiMode, controller, filter);\r\n        this.showRect = false;\r\n    }\r\n\r\n    shapes(): VisualShapeData[] {\r\n        return [...this._shapes.values()];\r\n    }\r\n\r\n    override clearSelected(document: IDocument): void {\r\n        for (const shape of this._shapes.values()) {\r\n            this.removeSelected(shape);\r\n        }\r\n        this._shapes.clear();\r\n    }\r\n\r\n    protected override select(view: IView, event: PointerEvent): number {\r\n        const document = view.document.visual.document;\r\n        if (this.multiMode) {\r\n            this._highlights?.forEach((x) =>\r\n                this._shapes.has(x.shape) ? this.removeSelected(x) : this.addSelected(x),\r\n            );\r\n        } else {\r\n            this.clearSelected(document);\r\n            this._highlights?.forEach(this.addSelected.bind(this));\r\n        }\r\n        return this._shapes.size;\r\n    }\r\n\r\n    private removeSelected(shape: VisualShapeData) {\r\n        this._shapes.delete(shape.shape);\r\n        shape.owner.node.document.visual.highlighter.removeState(\r\n            shape.owner,\r\n            this.selectedState,\r\n            shape.shape.shapeType,\r\n            ...shape.indexes,\r\n        );\r\n    }\r\n\r\n    private addSelected(shape: VisualShapeData) {\r\n        shape.owner.node.document.visual.highlighter.addState(\r\n            shape.owner,\r\n            this.selectedState,\r\n            this.shapeType,\r\n            ...shape.indexes,\r\n        );\r\n        this._shapes.set(shape.shape, shape);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IView, Plane, Precision, Ray, XYZ } from \"chili-core\";\r\n\r\nexport class ViewUtils {\r\n    static rayFromEye(view: IView, point: XYZ) {\r\n        const cameraPosition = view.cameraController.cameraPosition;\r\n        const vector = point.sub(cameraPosition);\r\n        if (view.cameraController.cameraType === \"orthographic\") {\r\n            const direction = view.direction();\r\n            const dot = vector.dot(direction);\r\n            const location = point.sub(direction.multiply(dot));\r\n            return new Ray(location, direction);\r\n        } else {\r\n            return new Ray(cameraPosition, vector);\r\n        }\r\n    }\r\n\r\n    static directionAt(view: IView, point: XYZ) {\r\n        if (view.cameraController.cameraType === \"orthographic\") {\r\n            return view.direction();\r\n        } else {\r\n            const cameraPosition = view.cameraController.cameraPosition;\r\n            return point.sub(cameraPosition);\r\n        }\r\n    }\r\n\r\n    static ensurePlane(view: IView, plane: Plane) {\r\n        const direction = view.direction();\r\n        if (Math.abs(direction.dot(plane.normal)) < Precision.Float) {\r\n            const left = direction.cross(view.up());\r\n            return new Plane(plane.origin, direction, left);\r\n        }\r\n        return plane;\r\n    }\r\n\r\n    static raycastClosestPlane(view: IView, start: XYZ, end: XYZ): Plane {\r\n        const direction = view.direction();\r\n        if (Math.abs(direction.dot(view.workplane.normal)) < Precision.Float) {\r\n            const left = direction.cross(view.up());\r\n            return new Plane(start, direction, left);\r\n        }\r\n\r\n        const ray = ViewUtils.rayFromEye(view, end);\r\n        const planes = [\r\n            new Plane(start, XYZ.unitZ, XYZ.unitX),\r\n            new Plane(start, XYZ.unitX, XYZ.unitY),\r\n            new Plane(start, XYZ.unitY, XYZ.unitZ),\r\n        ];\r\n\r\n        const distances = planes.map((p) => p.intersect(ray)?.distanceTo(start));\r\n        let result: [Plane, number | undefined] = [planes[0], distances[0]];\r\n        for (let i = 1; i < distances.length; i++) {\r\n            if (distances[i] === undefined) continue;\r\n\r\n            if (result[1] === undefined || Math.abs(distances[i]!) < Math.abs(result[1])) {\r\n                result = [planes[i], distances[i]];\r\n            }\r\n        }\r\n\r\n        return result[0];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    DOCUMENT_FILE_EXTENSION,\r\n    I18n,\r\n    IApplication,\r\n    ICommand,\r\n    IDataExchange,\r\n    IDocument,\r\n    IService,\r\n    IShapeFactory,\r\n    IStorage,\r\n    IView,\r\n    IVisualFactory,\r\n    IWindow,\r\n    Material,\r\n    ObservableCollection,\r\n    Plane,\r\n    PubSub,\r\n    Serialized,\r\n} from \"chili-core\";\r\nimport { Document } from \"./document\";\r\nimport { importFiles } from \"./utils\";\r\n\r\nlet app: Application | undefined;\r\n\r\nexport interface ApplicationOptions {\r\n    visualFactory: IVisualFactory;\r\n    shapeFactory: IShapeFactory;\r\n    services: IService[];\r\n    storage: IStorage;\r\n    dataExchange: IDataExchange;\r\n    mainWindow?: IWindow;\r\n}\r\n\r\nexport class Application implements IApplication {\r\n    readonly dataExchange: IDataExchange;\r\n    readonly visualFactory: IVisualFactory;\r\n    readonly shapeFactory: IShapeFactory;\r\n    readonly services: IService[];\r\n    readonly storage: IStorage;\r\n    readonly mainWindow?: IWindow;\r\n\r\n    readonly views = new ObservableCollection<IView>();\r\n    readonly documents: Set<IDocument> = new Set<IDocument>();\r\n\r\n    executingCommand: ICommand | undefined;\r\n\r\n    private _activeView: IView | undefined;\r\n    get activeView(): IView | undefined {\r\n        return this._activeView;\r\n    }\r\n    set activeView(value: IView | undefined) {\r\n        if (this._activeView === value) return;\r\n        this._activeView = value;\r\n        PubSub.default.pub(\"activeViewChanged\", value);\r\n    }\r\n\r\n    constructor(option: ApplicationOptions) {\r\n        if (app !== undefined) {\r\n            throw new Error(\"Only one application can be created\");\r\n        }\r\n        app = this;\r\n        this.visualFactory = option.visualFactory;\r\n        this.shapeFactory = option.shapeFactory;\r\n        this.services = option.services;\r\n        this.storage = option.storage;\r\n        this.dataExchange = option.dataExchange;\r\n        this.mainWindow = option.mainWindow;\r\n\r\n        this.services.forEach((x) => x.register(this));\r\n        this.services.forEach((x) => x.start());\r\n\r\n        this.initWindowEvents();\r\n    }\r\n\r\n    private initWindowEvents() {\r\n        window.onbeforeunload = this.handleWindowUnload;\r\n        window.addEventListener(\r\n            \"dragstart\",\r\n            (ev) => {\r\n                ev.preventDefault();\r\n            },\r\n            false,\r\n        );\r\n        window.addEventListener(\r\n            \"dragover\",\r\n            (ev) => {\r\n                ev.stopPropagation();\r\n                ev.preventDefault();\r\n                ev.dataTransfer!.dropEffect = \"copy\";\r\n            },\r\n            false,\r\n        );\r\n        window.addEventListener(\r\n            \"drop\",\r\n            (ev) => {\r\n                ev.stopPropagation();\r\n                ev.preventDefault();\r\n                this.importFiles(ev.dataTransfer?.files);\r\n            },\r\n            false,\r\n        );\r\n    }\r\n\r\n    private readonly handleWindowUnload = (event: BeforeUnloadEvent) => {\r\n        if (this.activeView) {\r\n            // Cancel the event as stated by the standard.\r\n            event.preventDefault();\r\n            // Chrome requires returnValue to be set.\r\n            event.returnValue = \"\";\r\n        }\r\n    };\r\n\r\n    async importFiles(files: FileList | undefined) {\r\n        if (!files || files.length === 0) {\r\n            return;\r\n        }\r\n        const { opens, imports } = this.groupFiles(files);\r\n        this.loadDocumentsWithLoading(opens);\r\n        importFiles(this, imports);\r\n    }\r\n\r\n    private loadDocumentsWithLoading(opens: File[]) {\r\n        PubSub.default.pub(\r\n            \"showPermanent\",\r\n            async () => {\r\n                for (const file of opens) {\r\n                    let json: Serialized = JSON.parse(await file.text());\r\n                    await this.loadDocument(json);\r\n                    this.activeView?.cameraController.fitContent();\r\n                }\r\n            },\r\n            \"toast.excuting{0}\",\r\n            I18n.translate(\"command.doc.open\"),\r\n        );\r\n    }\r\n\r\n    private groupFiles(files: FileList) {\r\n        const opens: File[] = [];\r\n        const imports: File[] = [];\r\n        for (const element of files) {\r\n            if (element.name.endsWith(DOCUMENT_FILE_EXTENSION)) {\r\n                opens.push(element);\r\n            } else {\r\n                imports.push(element);\r\n            }\r\n        }\r\n        return { opens, imports };\r\n    }\r\n\r\n    async openDocument(id: string): Promise<IDocument | undefined> {\r\n        const document = await Document.open(this, id);\r\n        await this.createActiveView(document);\r\n        return document;\r\n    }\r\n\r\n    async newDocument(name: string): Promise<IDocument> {\r\n        const document = new Document(this, name);\r\n        const lightGray = new Material(document, \"LightGray\", 0xdedede);\r\n        const deepGray = new Material(document, \"DeepGray\", 0x898989);\r\n        document.materials.push(lightGray, deepGray);\r\n        await this.createActiveView(document);\r\n        return document;\r\n    }\r\n\r\n    async loadDocument(data: Serialized): Promise<IDocument | undefined> {\r\n        const document = await Document.load(this, data);\r\n        await this.createActiveView(document);\r\n        return document;\r\n    }\r\n\r\n    protected async createActiveView(document: IDocument | undefined) {\r\n        if (document === undefined) return undefined;\r\n        const view = document.visual.createView(\"3d\", Plane.XY);\r\n        this.activeView = view;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport enum Dimension {\r\n    None = 0,\r\n    D1 = 1,\r\n    D2 = 2,\r\n    D3 = 4,\r\n\r\n    D1D2 = 1 | 2,\r\n    D1D2D3 = 1 | 2 | 4,\r\n}\r\n\r\nexport namespace Dimension {\r\n    export function contains(d1: Dimension, d2: Dimension): boolean {\r\n        if (d2 === Dimension.None) return false;\r\n        return (d1 & d2) === d2;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param value 1: D1, 2: D2, 3: D3, other: None\r\n     * @returns\r\n     */\r\n    export function from(value: number): Dimension {\r\n        const mapping: { [key: number]: Dimension } = {\r\n            1: Dimension.D1,\r\n            2: Dimension.D2,\r\n            3: Dimension.D3,\r\n        };\r\n        return mapping[value] || Dimension.None;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    CursorType,\r\n    I18nKeys,\r\n    IDisposable,\r\n    IDocument,\r\n    IEventHandler,\r\n    INode,\r\n    INodeFilter,\r\n    ISelection,\r\n    IShapeFilter,\r\n    Logger,\r\n    PubSub,\r\n    ShapeNode,\r\n    ShapeType,\r\n    VisualNode,\r\n    VisualState,\r\n} from \"chili-core\";\r\nimport { NodeSelectionHandler, SubshapeSelectionHandler } from \"chili-vis\";\r\n\r\nexport class Selection implements ISelection, IDisposable {\r\n    private _selectedNodes: INode[] = [];\r\n    private _unselectedNodes: INode[] = [];\r\n\r\n    shapeType: ShapeType = ShapeType.Shape;\r\n    shapeFilter?: IShapeFilter;\r\n    nodeFilter?: INodeFilter;\r\n\r\n    constructor(readonly document: IDocument) {}\r\n\r\n    async pickShape(\r\n        prompt: I18nKeys,\r\n        controller: AsyncController,\r\n        multiMode: boolean,\r\n        selectedState: VisualState = VisualState.edgeSelected,\r\n    ) {\r\n        const handler = new SubshapeSelectionHandler(\r\n            this.document,\r\n            this.shapeType,\r\n            multiMode,\r\n            controller,\r\n            this.shapeFilter,\r\n        );\r\n        handler.selectedState = selectedState;\r\n        await this.pickAsync(handler, prompt, controller, multiMode);\r\n        return handler.shapes();\r\n    }\r\n\r\n    async pickNode(prompt: I18nKeys, controller: AsyncController, multiMode: boolean) {\r\n        const handler = new NodeSelectionHandler(this.document, multiMode, controller, this.nodeFilter);\r\n        await this.pickAsync(handler, prompt, controller, multiMode);\r\n        return handler.nodes();\r\n    }\r\n\r\n    async pickAsync(\r\n        handler: IEventHandler,\r\n        prompt: I18nKeys,\r\n        controller: AsyncController,\r\n        showControl: boolean,\r\n        cursor: CursorType = \"select.default\",\r\n    ) {\r\n        const oldHandler = this.document.visual.eventHandler;\r\n        this.document.visual.eventHandler = handler;\r\n        PubSub.default.pub(\"viewCursor\", cursor);\r\n        PubSub.default.pub(\"statusBarTip\", prompt);\r\n        if (showControl) PubSub.default.pub(\"showSelectionControl\", controller);\r\n\r\n        try {\r\n            await new Promise((resolve, reject) => {\r\n                controller.onCompleted(resolve);\r\n                controller.onCancelled(reject);\r\n            });\r\n        } catch (e) {\r\n            Logger.debug(\"pick status: \", e);\r\n        } finally {\r\n            if (showControl) PubSub.default.pub(\"clearSelectionControl\");\r\n            PubSub.default.pub(\"clearStatusBarTip\");\r\n            this.document.visual.eventHandler = oldHandler;\r\n            PubSub.default.pub(\"viewCursor\", \"default\");\r\n        }\r\n    }\r\n\r\n    dispose(): void {\r\n        this._selectedNodes.length = 0;\r\n        this._unselectedNodes.length = 0;\r\n    }\r\n\r\n    getSelectedNodes(): INode[] {\r\n        return this._selectedNodes;\r\n    }\r\n\r\n    setSelection(nodes: INode[], toggle: boolean) {\r\n        nodes = nodes.filter(this.shapeNodeFilter);\r\n        if (toggle) {\r\n            this.toggleSelectPublish(nodes, true);\r\n        } else {\r\n            this.removeSelectedPublish(this._selectedNodes, false);\r\n            this.addSelectPublish(nodes, true);\r\n        }\r\n        return this._selectedNodes.length;\r\n    }\r\n\r\n    private readonly shapeNodeFilter = (x: INode) => {\r\n        if (x instanceof ShapeNode) {\r\n            let shape = x.shape.value;\r\n            if (!shape || !this.shapeFilter) return true;\r\n            return this.shapeFilter.allow(shape);\r\n        }\r\n\r\n        if (this.nodeFilter) {\r\n            return this.nodeFilter.allow(x);\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    deselect(nodes: INode[]) {\r\n        this.removeSelectedPublish(nodes, true);\r\n    }\r\n\r\n    clearSelection() {\r\n        this.removeSelectedPublish(this._selectedNodes, true);\r\n    }\r\n\r\n    private updateSelection() {\r\n        this.document.visual.update();\r\n        PubSub.default.pub(\"selectionChanged\", this.document, this._selectedNodes, this._unselectedNodes);\r\n    }\r\n\r\n    private toggleSelectPublish(nodes: INode[], publish: boolean) {\r\n        const selected = nodes.filter((m) => this._selectedNodes.includes(m));\r\n        const unSelected = nodes.filter((m) => !this._selectedNodes.includes(m));\r\n        this.removeSelectedPublish(selected, false);\r\n        this.addSelectPublish(unSelected, publish);\r\n    }\r\n\r\n    private addSelectPublish(nodes: INode[], publish: boolean) {\r\n        nodes.forEach((m) => {\r\n            if (m instanceof VisualNode) {\r\n                const visual = this.document.visual.context.getVisual(m);\r\n                if (visual)\r\n                    this.document.visual.highlighter.addState(\r\n                        visual,\r\n                        VisualState.edgeSelected,\r\n                        ShapeType.Shape,\r\n                    );\r\n            }\r\n        });\r\n        this._selectedNodes.push(...nodes);\r\n        if (publish) this.updateSelection();\r\n    }\r\n\r\n    private removeSelectedPublish(nodes: INode[], publish: boolean) {\r\n        for (const node of nodes) {\r\n            if (node instanceof VisualNode) {\r\n                let visual = this.document.visual.context.getVisual(node);\r\n                if (visual)\r\n                    this.document.visual.highlighter.removeState(\r\n                        visual,\r\n                        VisualState.edgeSelected,\r\n                        ShapeType.Shape,\r\n                    );\r\n            }\r\n        }\r\n        this._selectedNodes = this._selectedNodes.filter((m) => !nodes.includes(m));\r\n        this._unselectedNodes = nodes;\r\n        if (publish) this.updateSelection();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    Act,\r\n    CollectionAction,\r\n    CollectionChangedArgs,\r\n    Component,\r\n    Constants,\r\n    FolderNode,\r\n    History,\r\n    I18n,\r\n    IApplication,\r\n    IDocument,\r\n    INode,\r\n    INodeChangedObserver,\r\n    INodeLinkedList,\r\n    ISelection,\r\n    IVisual,\r\n    Id,\r\n    Logger,\r\n    Material,\r\n    NodeLinkedListHistoryRecord,\r\n    NodeRecord,\r\n    NodeSerializer,\r\n    Observable,\r\n    ObservableCollection,\r\n    PubSub,\r\n    Serialized,\r\n    Serializer,\r\n    Transaction,\r\n} from \"chili-core\";\r\nimport { Selection } from \"./selection\";\r\n\r\nexport class Document extends Observable implements IDocument {\r\n    readonly components: Component[] = [];\r\n    readonly visual: IVisual;\r\n    readonly history: History;\r\n    readonly selection: ISelection;\r\n    readonly acts = new ObservableCollection<Act>();\r\n    readonly materials: ObservableCollection<Material> = new ObservableCollection();\r\n\r\n    private readonly _nodeChangedObservers = new Set<INodeChangedObserver>();\r\n\r\n    static readonly version = __DOCUMENT_VERSION__;\r\n\r\n    get name(): string {\r\n        return this.getPrivateValue(\"name\");\r\n    }\r\n    set name(name: string) {\r\n        if (this.name === name) return;\r\n        this.setProperty(\"name\", name);\r\n        if (this._rootNode) this._rootNode.name = name;\r\n    }\r\n\r\n    private _rootNode: INodeLinkedList | undefined;\r\n    @Serializer.serialze()\r\n    get rootNode(): INodeLinkedList {\r\n        if (this._rootNode === undefined) {\r\n            this.setRootNode(this.initRootNode());\r\n        }\r\n        return this._rootNode!;\r\n    }\r\n    set rootNode(value: INodeLinkedList) {\r\n        this.setRootNode(value);\r\n    }\r\n\r\n    private setRootNode(value?: INodeLinkedList) {\r\n        if (this._rootNode === value) return;\r\n        this._rootNode?.removePropertyChanged(this.handleRootNodeNameChanged);\r\n        this._rootNode = value ?? new FolderNode(this, this.name);\r\n        this._rootNode.onPropertyChanged(this.handleRootNodeNameChanged);\r\n    }\r\n\r\n    private _currentNode?: INodeLinkedList;\r\n    get currentNode(): INodeLinkedList | undefined {\r\n        return this._currentNode;\r\n    }\r\n    set currentNode(value: INodeLinkedList | undefined) {\r\n        this.setProperty(\"currentNode\", value);\r\n    }\r\n\r\n    constructor(\r\n        readonly application: IApplication,\r\n        name: string,\r\n        readonly id: string = Id.generate(),\r\n    ) {\r\n        super();\r\n        this.setPrivateValue(\"name\", name);\r\n        this.history = new History();\r\n        this.visual = application.visualFactory.create(this);\r\n        this.selection = new Selection(this);\r\n        this.materials.onCollectionChanged(this.handleMaterialChanged);\r\n        application.documents.add(this);\r\n\r\n        Logger.info(`new document: ${name}`);\r\n    }\r\n\r\n    private readonly handleRootNodeNameChanged = (prop: string) => {\r\n        if (prop === \"name\") {\r\n            this.name = this.rootNode.name;\r\n        }\r\n    };\r\n\r\n    initRootNode() {\r\n        return new FolderNode(this, this.name);\r\n    }\r\n\r\n    serialize(): Serialized {\r\n        let serialized = {\r\n            classKey: \"Document\",\r\n            version: __DOCUMENT_VERSION__,\r\n            properties: {\r\n                id: this.id,\r\n                name: this.name,\r\n                components: this.components.map((x) => Serializer.serializeObject(x)),\r\n                nodes: NodeSerializer.serialize(this.rootNode),\r\n                materials: this.materials.map((x) => Serializer.serializeObject(x)),\r\n                acts: this.acts.map((x) => Serializer.serializeObject(x)),\r\n            },\r\n        };\r\n        return serialized;\r\n    }\r\n\r\n    override disposeInternal(): void {\r\n        super.disposeInternal();\r\n        this._nodeChangedObservers.clear();\r\n        this._rootNode?.removePropertyChanged(this.handleRootNodeNameChanged);\r\n        this._rootNode?.dispose();\r\n        this.visual.dispose();\r\n        this.history.dispose();\r\n        this.selection.dispose();\r\n        this.materials.forEach((x) => x.dispose());\r\n        this.materials.clear();\r\n        this.acts.forEach((x) => x.dispose());\r\n        this.acts.clear();\r\n\r\n        this._rootNode = undefined;\r\n        this._currentNode = undefined;\r\n    }\r\n\r\n    async save() {\r\n        const data = this.serialize();\r\n        await this.application.storage.put(Constants.DBName, Constants.DocumentTable, this.id, data);\r\n        const image = this.application.activeView?.toImage();\r\n        await this.application.storage.put(Constants.DBName, Constants.RecentTable, this.id, {\r\n            id: this.id,\r\n            name: this.name,\r\n            date: Date.now(),\r\n            image,\r\n        });\r\n    }\r\n\r\n    async close() {\r\n        if (window.confirm(I18n.translate(\"prompt.saveDocument{0}\", this.name))) {\r\n            await this.save();\r\n        }\r\n\r\n        let views = this.application.views.filter((x) => x.document === this);\r\n        this.application.views.remove(...views);\r\n        this.application.activeView = this.application.views.at(0);\r\n        this.application.documents.delete(this);\r\n        this.materials.removeCollectionChanged(this.handleMaterialChanged);\r\n        PubSub.default.pub(\"documentClosed\", this);\r\n\r\n        Logger.info(`document: ${this.name} closed`);\r\n        this.dispose();\r\n    }\r\n\r\n    static async open(application: IApplication, id: string) {\r\n        let data = (await application.storage.get(\r\n            Constants.DBName,\r\n            Constants.DocumentTable,\r\n            id,\r\n        )) as Serialized;\r\n        if (data === undefined) {\r\n            Logger.warn(`document: ${id} not find`);\r\n            return;\r\n        }\r\n        let document = await this.load(application, data);\r\n        if (document !== undefined) {\r\n            Logger.info(`document: ${document.name} opened`);\r\n        }\r\n        return document;\r\n    }\r\n\r\n    static async load(app: IApplication, data: Serialized): Promise<IDocument | undefined> {\r\n        if ((data as any).version !== __DOCUMENT_VERSION__) {\r\n            alert(\r\n                \"The file version has been upgraded, no compatibility treatment was done in the development phase\",\r\n            );\r\n            return undefined;\r\n        }\r\n        let document = new Document(app, data.properties[\"name\"], data.properties[\"id\"]);\r\n        document.history.disabled = true;\r\n        document.materials.push(\r\n            ...data.properties[\"materials\"].map((x: Serialized) =>\r\n                Serializer.deserializeObject(document, x),\r\n            ),\r\n        );\r\n        document.acts.push(\r\n            ...data.properties[\"acts\"].map((x: Serialized) => Serializer.deserializeObject(document, x)),\r\n        );\r\n        document.components.push(\r\n            ...data.properties[\"components\"].map((x: Serialized) =>\r\n                Serializer.deserializeObject(document, x),\r\n            ),\r\n        );\r\n\r\n        const rootNode = await NodeSerializer.deserialize(document, data.properties[\"nodes\"]);\r\n        document.setRootNode(rootNode);\r\n        document.history.disabled = false;\r\n        return document;\r\n    }\r\n\r\n    private readonly handleMaterialChanged = (args: CollectionChangedArgs) => {\r\n        if (args.action === CollectionAction.add) {\r\n            Transaction.add(this, {\r\n                name: \"MaterialChanged\",\r\n                dispose() {},\r\n                undo: () => this.materials.remove(...args.items),\r\n                redo: () => this.materials.push(...args.items),\r\n            });\r\n        } else if (args.action === CollectionAction.remove) {\r\n            Transaction.add(this, {\r\n                name: \"MaterialChanged\",\r\n                dispose() {},\r\n                undo: () => this.materials.push(...args.items),\r\n                redo: () => this.materials.remove(...args.items),\r\n            });\r\n        }\r\n    };\r\n\r\n    addNodeObserver(observer: INodeChangedObserver) {\r\n        this._nodeChangedObservers.add(observer);\r\n    }\r\n\r\n    removeNodeObserver(observer: INodeChangedObserver) {\r\n        this._nodeChangedObservers.delete(observer);\r\n    }\r\n\r\n    notifyNodeChanged(records: NodeRecord[]) {\r\n        Transaction.add(this, new NodeLinkedListHistoryRecord(records));\r\n        this._nodeChangedObservers.forEach((x) => x.handleNodeChanged(records));\r\n    }\r\n\r\n    addNode(...nodes: INode[]): void {\r\n        (this.currentNode ?? this.rootNode).add(...nodes);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18n, IApplication, PubSub, Transaction } from \"chili-core\";\r\n\r\nexport async function importFiles(application: IApplication, files: File[] | FileList) {\r\n    let document = application.activeView?.document ?? (await application.newDocument(\"Untitled\"));\r\n    PubSub.default.pub(\r\n        \"showPermanent\",\r\n        async () => {\r\n            await Transaction.executeAsync(document, \"import model\", async () => {\r\n                await document.application.dataExchange.import(document, files);\r\n            });\r\n            document.application.activeView?.cameraController.fitContent();\r\n        },\r\n        \"toast.excuting{0}\",\r\n        I18n.translate(\"command.file.import\"),\r\n    );\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Plane,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"plane\", \"dx\", \"dy\", \"dz\"])\r\nexport class BoxNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.box\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dx\")\r\n    get dx() {\r\n        return this.getPrivateValue(\"dx\");\r\n    }\r\n    set dx(dx: number) {\r\n        this.setPropertyEmitShapeChanged(\"dx\", dx);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dy\")\r\n    get dy() {\r\n        return this.getPrivateValue(\"dy\");\r\n    }\r\n    set dy(dy: number) {\r\n        this.setPropertyEmitShapeChanged(\"dy\", dy);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dz\")\r\n    get dz() {\r\n        return this.getPrivateValue(\"dz\");\r\n    }\r\n    set dz(dz: number) {\r\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get plane(): Plane {\r\n        return this.getPrivateValue(\"plane\");\r\n    }\r\n\r\n    constructor(document: IDocument, plane: Plane, dx: number, dy: number, dz: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"plane\", plane);\r\n        this.setPrivateValue(\"dx\", dx);\r\n        this.setPrivateValue(\"dy\", dy);\r\n        this.setPrivateValue(\"dz\", dz);\r\n    }\r\n\r\n    generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.box(this.plane, this.dx, this.dy, this.dz);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { FacebaseNode, I18nKeys, IDocument, IShape, Property, Result, Serializer, XYZ } from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"normal\", \"center\", \"radius\"])\r\nexport class CircleNode extends FacebaseNode {\r\n    override display(): I18nKeys {\r\n        return \"body.circle\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.center\")\r\n    get center() {\r\n        return this.getPrivateValue(\"center\");\r\n    }\r\n    set center(center: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"center\", center);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.radius\")\r\n    get radius() {\r\n        return this.getPrivateValue(\"radius\");\r\n    }\r\n    set radius(radius: number) {\r\n        this.setPropertyEmitShapeChanged(\"radius\", radius);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get normal(): XYZ {\r\n        return this.getPrivateValue(\"normal\");\r\n    }\r\n\r\n    constructor(document: IDocument, normal: XYZ, center: XYZ, radius: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"normal\", normal);\r\n        this.setPrivateValue(\"center\", center);\r\n        this.setPrivateValue(\"radius\", radius);\r\n    }\r\n\r\n    generateShape(): Result<IShape, string> {\r\n        let circle = this.document.application.shapeFactory.circle(this.normal, this.center, this.radius);\r\n        if (!circle.isOk || !this.isFace) return circle;\r\n        let wire = this.document.application.shapeFactory.wire([circle.value]);\r\n        return wire.isOk ? wire.value.toFace() : circle;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n    XYZ,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"normal\", \"center\", \"radius\", \"dz\"])\r\nexport class ConeNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.cone\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.center\")\r\n    get center() {\r\n        return this.getPrivateValue(\"center\");\r\n    }\r\n    set center(center: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"center\", center);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.radius\")\r\n    get radius() {\r\n        return this.getPrivateValue(\"radius\");\r\n    }\r\n    set radius(dy: number) {\r\n        this.setPropertyEmitShapeChanged(\"radius\", dy);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dz\")\r\n    get dz() {\r\n        return this.getPrivateValue(\"dz\");\r\n    }\r\n    set dz(dz: number) {\r\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get normal(): XYZ {\r\n        return this.getPrivateValue(\"normal\");\r\n    }\r\n\r\n    constructor(document: IDocument, normal: XYZ, center: XYZ, radius: number, dz: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"normal\", normal);\r\n        this.setPrivateValue(\"center\", center);\r\n        this.setPrivateValue(\"radius\", radius);\r\n        this.setPrivateValue(\"dz\", dz);\r\n    }\r\n\r\n    generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.cone(\r\n            this.normal,\r\n            this.center,\r\n            this.radius,\r\n            0,\r\n            this.dz,\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n    XYZ,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"normal\", \"center\", \"radius\", \"dz\"])\r\nexport class CylinderNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.cylinder\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.center\")\r\n    get center() {\r\n        return this.getPrivateValue(\"center\");\r\n    }\r\n    set center(center: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"center\", center);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.radius\")\r\n    get radius() {\r\n        return this.getPrivateValue(\"radius\");\r\n    }\r\n    set radius(dy: number) {\r\n        this.setPropertyEmitShapeChanged(\"radius\", dy);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dz\")\r\n    get dz() {\r\n        return this.getPrivateValue(\"dz\");\r\n    }\r\n    set dz(dz: number) {\r\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get normal(): XYZ {\r\n        return this.getPrivateValue(\"normal\");\r\n    }\r\n\r\n    constructor(document: IDocument, normal: XYZ, center: XYZ, radius: number, dz: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"normal\", normal);\r\n        this.setPrivateValue(\"center\", center);\r\n        this.setPrivateValue(\"radius\", radius);\r\n        this.setPrivateValue(\"dz\", dz);\r\n    }\r\n\r\n    generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.cylinder(\r\n            this.normal,\r\n            this.center,\r\n            this.radius,\r\n            this.dz,\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { FacebaseNode, I18nKeys, IDocument, IShape, Property, Result, Serializer, XYZ } from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"normal\", \"center\", \"xvec\", \"majorRadius\", \"minorRadius\"])\r\nexport class EllipseNode extends FacebaseNode {\r\n    override display(): I18nKeys {\r\n        return \"body.ellipse\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.center\")\r\n    get center() {\r\n        return this.getPrivateValue(\"center\");\r\n    }\r\n    set center(center: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"center\", center);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"ellipse.majorRadius\")\r\n    get majorRadius() {\r\n        return this.getPrivateValue(\"majorRadius\");\r\n    }\r\n    set majorRadius(radius: number) {\r\n        this.setPropertyEmitShapeChanged(\"majorRadius\", radius);\r\n    }\r\n    @Serializer.serialze()\r\n    @Property.define(\"ellipse.minorRadius\")\r\n    get minorRadius() {\r\n        return this.getPrivateValue(\"minorRadius\");\r\n    }\r\n    set minorRadius(radius: number) {\r\n        this.setPropertyEmitShapeChanged(\"minorRadius\", radius);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get normal(): XYZ {\r\n        return this.getPrivateValue(\"normal\");\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get xvec(): XYZ {\r\n        return this.getPrivateValue(\"xvec\");\r\n    }\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        normal: XYZ,\r\n        center: XYZ,\r\n        xvec: XYZ,\r\n        majorRadius: number,\r\n        minorRadius: number,\r\n    ) {\r\n        super(document);\r\n        this.setPrivateValue(\"normal\", normal);\r\n        this.setPrivateValue(\"center\", center);\r\n        this.setPrivateValue(\"xvec\", xvec);\r\n        this.setPrivateValue(\"majorRadius\", majorRadius);\r\n        this.setPrivateValue(\"minorRadius\", minorRadius);\r\n    }\r\n\r\n    generateShape(): Result<IShape, string> {\r\n        let circle = this.document.application.shapeFactory.ellipse(\r\n            this.normal,\r\n            this.center,\r\n            this.xvec,\r\n            this.majorRadius,\r\n            this.minorRadius,\r\n        );\r\n        if (!circle.isOk || !this.isFace) return circle;\r\n        let wire = this.document.application.shapeFactory.wire([circle.value]);\r\n        return wire.isOk ? wire.value.toFace() : circle;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n    XYZ,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"start\", \"end\"])\r\nexport class LineNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.line\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"line.start\")\r\n    get start() {\r\n        return this.getPrivateValue(\"start\");\r\n    }\r\n    set start(pnt: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"start\", pnt);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"line.end\")\r\n    get end() {\r\n        return this.getPrivateValue(\"end\");\r\n    }\r\n    set end(pnt: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"end\", pnt);\r\n    }\r\n\r\n    constructor(document: IDocument, start: XYZ, end: XYZ) {\r\n        super(document);\r\n        this.setPrivateValue(\"start\", start);\r\n        this.setPrivateValue(\"end\", end);\r\n    }\r\n\r\n    generateShape(): Result<IShape, string> {\r\n        return this.document.application.shapeFactory.line(this.start, this.end);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { FacebaseNode, I18nKeys, IDocument, IShape, Property, Result, Serializer, XYZ } from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"points\"])\r\nexport class PolygonNode extends FacebaseNode {\r\n    override display(): I18nKeys {\r\n        return \"body.polygon\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"polygon.points\")\r\n    get points() {\r\n        return this.getPrivateValue(\"points\");\r\n    }\r\n    set points(value: XYZ[]) {\r\n        this.setPropertyEmitShapeChanged(\"points\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, points: XYZ[]) {\r\n        super(document);\r\n        this.setPrivateValue(\"points\", points);\r\n    }\r\n\r\n    generateShape(): Result<IShape, string> {\r\n        let wire = this.document.application.shapeFactory.polygon(this.points);\r\n        if (!wire.isOk || !this.isFace) return wire;\r\n        return wire.value.toFace();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys, IDocument, IShape, ParameterShapeNode, Property, Result, Serializer } from \"chili-core\";\r\nimport { GeoUtils } from \"chili-geo\";\r\n\r\n@Serializer.register([\"document\", \"section\", \"length\"])\r\nexport class PrismNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.prism\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get section(): IShape {\r\n        return this.getPrivateValue(\"section\");\r\n    }\r\n    set section(value: IShape) {\r\n        this.setPropertyEmitShapeChanged(\"section\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"common.length\")\r\n    get length(): number {\r\n        return this.getPrivateValue(\"length\");\r\n    }\r\n    set length(value: number) {\r\n        this.setPropertyEmitShapeChanged(\"length\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, face: IShape, length: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"section\", face);\r\n        this.setPrivateValue(\"length\", length);\r\n    }\r\n\r\n    override generateShape(): Result<IShape> {\r\n        let normal = GeoUtils.normal(this.section as any);\r\n        let vec = normal.multiply(this.length);\r\n        return this.document.application.shapeFactory.prism(this.section, vec);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Plane,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"plane\", \"dx\", \"dy\", \"dz\"])\r\nexport class PyramidNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.pyramid\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dx\")\r\n    get dx() {\r\n        return this.getPrivateValue(\"dx\");\r\n    }\r\n    set dx(dx: number) {\r\n        this.setPropertyEmitShapeChanged(\"dx\", dx);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dy\")\r\n    get dy() {\r\n        return this.getPrivateValue(\"dy\");\r\n    }\r\n    set dy(dy: number) {\r\n        this.setPropertyEmitShapeChanged(\"dy\", dy);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"box.dz\")\r\n    get dz() {\r\n        return this.getPrivateValue(\"dz\");\r\n    }\r\n    set dz(dz: number) {\r\n        this.setPropertyEmitShapeChanged(\"dz\", dz);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get plane(): Plane {\r\n        return this.getPrivateValue(\"plane\");\r\n    }\r\n\r\n    constructor(document: IDocument, plane: Plane, dx: number, dy: number, dz: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"plane\", plane);\r\n        this.setPrivateValue(\"dx\", dx);\r\n        this.setPrivateValue(\"dy\", dy);\r\n        this.setPrivateValue(\"dz\", dz);\r\n    }\r\n\r\n    generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.pyramid(this.plane, this.dx, this.dy, this.dz);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    FacebaseNode,\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    Plane,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n    XYZ,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"plane\", \"dx\", \"dy\"])\r\nexport class RectNode extends FacebaseNode {\r\n    override display(): I18nKeys {\r\n        return \"body.rect\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"rect.dx\")\r\n    get dx() {\r\n        return this.getPrivateValue(\"dx\");\r\n    }\r\n    set dx(dx: number) {\r\n        this.setPropertyEmitShapeChanged(\"dx\", dx);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"rect.dy\")\r\n    get dy() {\r\n        return this.getPrivateValue(\"dy\");\r\n    }\r\n    set dy(dy: number) {\r\n        this.setPropertyEmitShapeChanged(\"dy\", dy);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get plane(): Plane {\r\n        return this.getPrivateValue(\"plane\");\r\n    }\r\n\r\n    constructor(document: IDocument, plane: Plane, dx: number, dy: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"plane\", plane);\r\n        this.setPrivateValue(\"dx\", dx);\r\n        this.setPrivateValue(\"dy\", dy);\r\n    }\r\n\r\n    generateShape(): Result<IShape, string> {\r\n        let points = RectNode.points(this.plane, this.dx, this.dy);\r\n        let wire = this.document.application.shapeFactory.polygon(points);\r\n        if (!wire.isOk || !this.isFace) return wire;\r\n        return wire.value.toFace();\r\n    }\r\n\r\n    static points(plane: Plane, dx: number, dy: number): XYZ[] {\r\n        let start = plane.origin;\r\n        return [\r\n            start,\r\n            start.add(plane.xvec.multiply(dx)),\r\n            start.add(plane.xvec.multiply(dx)).add(plane.yvec.multiply(dy)),\r\n            start.add(plane.yvec.multiply(dy)),\r\n            start,\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys, IDocument, IShape, ParameterShapeNode, Ray, Result, Serializer } from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"profile\", \"axis\", \"angle\"])\r\nexport class RevolvedNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.revol\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get profile() {\r\n        return this.getPrivateValue(\"profile\");\r\n    }\r\n    set profile(value: IShape) {\r\n        this.setPropertyEmitShapeChanged(\"profile\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get axis() {\r\n        return this.getPrivateValue(\"axis\");\r\n    }\r\n    set axis(value: Ray) {\r\n        this.setPropertyEmitShapeChanged(\"axis\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get angle() {\r\n        return this.getPrivateValue(\"angle\");\r\n    }\r\n    set angle(value: number) {\r\n        this.setPropertyEmitShapeChanged(\"angle\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, profile: IShape, axis: Ray, angle: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"profile\", profile);\r\n        this.setPrivateValue(\"axis\", axis);\r\n        this.setPrivateValue(\"angle\", angle);\r\n    }\r\n\r\n    override generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.revolve(this.profile, this.axis, this.angle);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n    XYZ,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"center\", \"radius\"])\r\nexport class SphereNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.sphere\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.center\")\r\n    get center() {\r\n        return this.getPrivateValue(\"center\");\r\n    }\r\n    set center(center: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"center\", center);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.radius\")\r\n    get radius() {\r\n        return this.getPrivateValue(\"radius\");\r\n    }\r\n    set radius(value: number) {\r\n        this.setPropertyEmitShapeChanged(\"radius\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, center: XYZ, radius: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"center\", center);\r\n        this.setPrivateValue(\"radius\", radius);\r\n    }\r\n\r\n    generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.sphere(this.center, this.radius);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IEdge,\r\n    IShape,\r\n    IWire,\r\n    ParameterShapeNode,\r\n    Result,\r\n    Serializer,\r\n    ShapeType,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"profile\", \"path\"])\r\nexport class SweepedNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.sweep\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get profile() {\r\n        return this.getPrivateValue(\"profile\");\r\n    }\r\n    set profile(value: IShape) {\r\n        this.setPropertyEmitShapeChanged(\"profile\", value);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get path() {\r\n        return this.getPrivateValue(\"path\");\r\n    }\r\n    set path(value: IWire) {\r\n        this.setPropertyEmitShapeChanged(\"path\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, profile: IShape, path: IWire | IEdge) {\r\n        super(document);\r\n        this.setPrivateValue(\"profile\", profile);\r\n        this.setPrivateValue(\"path\", this.ensureWire(path));\r\n    }\r\n\r\n    private ensureWire(path: IEdge | IWire) {\r\n        let wire = path as IWire;\r\n        if (path.shapeType !== ShapeType.Wire) {\r\n            wire = this.document.application.shapeFactory.wire([path as unknown as IEdge]).value;\r\n        }\r\n        return wire;\r\n    }\r\n\r\n    override generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.sweep(this.profile, this.path);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IApplication, ICommand, command } from \"chili-core\";\r\n\r\nlet count = 1;\r\n\r\n@command({\r\n    key: \"doc.new\",\r\n    icon: \"icon-new\",\r\n})\r\nexport class NewDocument implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        await app.newDocument(`undefined ${count++}`);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18n, IApplication, ICommand, PubSub, Serialized, command, readFileAsync } from \"chili-core\";\r\n\r\n@command({\r\n    key: \"doc.open\",\r\n    icon: \"icon-open\",\r\n})\r\nexport class OpenDocument implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        PubSub.default.pub(\r\n            \"showPermanent\",\r\n            async () => {\r\n                let files = await readFileAsync(\".cd\", false);\r\n                if (files.isOk) {\r\n                    let json: Serialized = JSON.parse(files.value[0].data);\r\n                    let document = await app.loadDocument(json);\r\n                    document?.application.activeView?.cameraController.fitContent();\r\n                }\r\n            },\r\n            \"toast.excuting{0}\",\r\n            I18n.translate(\"command.doc.open\"),\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    IApplication,\r\n    ICommand,\r\n    IDocument,\r\n    Material,\r\n    Plane,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\n\r\nexport abstract class PerformanceTestCommand implements ICommand {\r\n    protected size = 10;\r\n    protected gap = 1;\r\n    protected rowCols = 20;\r\n\r\n    async execute(app: IApplication): Promise<void> {\r\n        let document = await app.newDocument(\"OCC Performace Test\");\r\n\r\n        const start = performance.now();\r\n        const distance = this.gap + this.size;\r\n        for (let x = 0; x < this.rowCols; x++) {\r\n            for (let y = 0; y < this.rowCols; y++) {\r\n                for (let z = 0; z < this.rowCols; z++) {\r\n                    let position = XYZ.zero\r\n                        .add(XYZ.unitX.multiply(x * distance))\r\n                        .add(XYZ.unitY.multiply(y * distance))\r\n                        .add(XYZ.unitZ.multiply(z * distance));\r\n                    this.createShape(document, document.materials.at(0)!, position);\r\n                }\r\n            }\r\n        }\r\n        document.visual.update();\r\n        alert(\r\n            `Create ${this.rowCols * this.rowCols * this.rowCols} shapes, Time: ${performance.now() - start} ms`,\r\n        );\r\n    }\r\n\r\n    protected abstract createShape(document: IDocument, material: Material, position: XYZ): void;\r\n}\r\n\r\n@command({\r\n    key: \"test.performace\",\r\n    icon: \"\",\r\n})\r\nexport class OccPerformanceTestCommand extends PerformanceTestCommand {\r\n    private index = 1;\r\n    shapes: any[] = [];\r\n\r\n    protected override createShape(document: IDocument, material: Material, position: XYZ): void {\r\n        let plane = Plane.XY.translateTo(position);\r\n        let box = document.application.shapeFactory.box(\r\n            plane,\r\n            this.size * Math.random(),\r\n            this.size * Math.random(),\r\n            this.size * Math.random(),\r\n        ).value;\r\n        let node = new EditableShapeNode(document, `box ${this.index++}`, box, material.id);\r\n        document.addNode(node);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, I18n, IApplication, ICommand, PubSub } from \"chili-core\";\r\n\r\n@command({\r\n    key: \"doc.save\",\r\n    icon: \"icon-save\",\r\n})\r\nexport class SaveDocument implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        if (!app.activeView?.document) return;\r\n        PubSub.default.pub(\r\n            \"showPermanent\",\r\n            async () => {\r\n                await app.activeView?.document!.save();\r\n                PubSub.default.pub(\"showToast\", \"toast.document.saved\");\r\n            },\r\n            \"toast.excuting{0}\",\r\n            I18n.translate(\"command.doc.save\"),\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    command,\r\n    DOCUMENT_FILE_EXTENSION,\r\n    download,\r\n    I18n,\r\n    IApplication,\r\n    ICommand,\r\n    PubSub,\r\n} from \"chili-core\";\r\n\r\n@command({\r\n    key: \"doc.saveToFile\",\r\n    icon: \"icon-download\",\r\n})\r\nexport class SaveDocumentToFile implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        if (!app.activeView?.document) return;\r\n        PubSub.default.pub(\r\n            \"showPermanent\",\r\n            async () => {\r\n                await new Promise((r, j) => {\r\n                    setTimeout(r, 100);\r\n                });\r\n                let s = app.activeView?.document!.serialize();\r\n                PubSub.default.pub(\"showToast\", \"toast.downloading\");\r\n                download([JSON.stringify(s)], `${app.activeView?.document!.name}${DOCUMENT_FILE_EXTENSION}`);\r\n            },\r\n            \"toast.excuting{0}\",\r\n            I18n.translate(\"command.doc.saveToFile\"),\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Binding, Config, IApplication, ICommand, command } from \"chili-core\";\r\n\r\n@command({\r\n    key: \"workingPlane.toggleDynamic\",\r\n    toggle: new Binding(Config.instance, \"dynamicWorkplane\"),\r\n    icon: \"icon-dynamicPlane\",\r\n})\r\nexport class ToggleDynamicWorkplaneCommand implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        Config.instance.dynamicWorkplane = !Config.instance.dynamicWorkplane;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { div, img, label } from \"chili-controls\";\r\nimport { IApplication, ICommand, PubSub, command } from \"chili-core\";\r\n\r\n@command({\r\n    key: \"wechat.group\",\r\n    icon: \"icon-qrcode\",\r\n})\r\nexport class WeChatGroup implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        PubSub.default.pub(\"showDialog\", \"command.wechat.group\", this.ui());\r\n    }\r\n\r\n    private ui() {\r\n        return div(\r\n            label({\r\n                textContent: \"chili3d交流群\",\r\n                style: {\r\n                    fontSize: \"16px\",\r\n                    display: \"block\",\r\n                    textAlign: \"center\",\r\n                    marginBottom: \"10px\",\r\n                },\r\n            }),\r\n            img({\r\n                width: 360,\r\n                src: \"images/wechat-group.jpg\",\r\n                style: {\r\n                    borderRadius: \"10px\",\r\n                },\r\n            }),\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys, IDocument, IShape, ParameterShapeNode, Result, Serializer } from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"booleanShape\"])\r\nexport class BooleanNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.bolean\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get booleanShape(): IShape {\r\n        return this.getPrivateValue(\"booleanShape\");\r\n    }\r\n\r\n    constructor(document: IDocument, shape: IShape) {\r\n        super(document);\r\n        this.setPrivateValue(\"booleanShape\", shape);\r\n    }\r\n\r\n    override generateShape(): Result<IShape> {\r\n        return Result.ok(this.booleanShape);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { EdgeMeshData, IView, LineType, Plane, VisualConfig, XYZ } from \"chili-core\";\r\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\r\n\r\nexport class AxisSnap implements ISnap {\r\n    private _tempLines?: [IView, number];\r\n\r\n    constructor(\r\n        readonly point: XYZ,\r\n        readonly direction: XYZ,\r\n    ) {}\r\n\r\n    snap(data: MouseAndDetected): SnapResult | undefined {\r\n        const right = data.view.up().cross(data.view.direction()).normalize();\r\n        const normal = right?.cross(this.direction).normalize();\r\n        if (!normal) return undefined;\r\n\r\n        const plane = new Plane(this.point, normal, right!);\r\n        const ray = data.view.rayAt(data.mx, data.my);\r\n        const intersect = plane.intersect(ray, false);\r\n        if (!intersect) return undefined;\r\n\r\n        const vector = intersect.sub(this.point);\r\n        const dot = vector.dot(this.direction);\r\n        const point = this.point.add(this.direction.multiply(dot));\r\n        this.showTempLine(data.view, dot);\r\n\r\n        return {\r\n            view: data.view,\r\n            point,\r\n            distance: dot,\r\n            shapes: [],\r\n        };\r\n    }\r\n\r\n    private showTempLine(view: IView, dot: number) {\r\n        const dist = Math.abs(dot) < 0.000001 ? 1e15 : 1e15 * dot;\r\n        const lineDats = EdgeMeshData.from(\r\n            this.point,\r\n            this.point.add(this.direction.multiply(dist)),\r\n            VisualConfig.temporaryEdgeColor,\r\n            LineType.Dash,\r\n        );\r\n        const id = view.document.visual.context.displayMesh(lineDats);\r\n        this._tempLines = [view, id];\r\n    }\r\n\r\n    removeDynamicObject(): void {\r\n        this._tempLines?.[0].document.visual.context.removeMesh(this._tempLines[1]);\r\n    }\r\n\r\n    clear(): void {\r\n        this.removeDynamicObject();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IView, VisualShapeData, VisualState, XYZ } from \"chili-core\";\r\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\r\n\r\nexport abstract class BaseSnap implements ISnap {\r\n    protected _tempMeshIds: Map<IView, number[]> = new Map();\r\n    protected _highlightedShapes: VisualShapeData[] = [];\r\n\r\n    constructor(readonly referencePoint?: () => XYZ) {}\r\n\r\n    abstract snap(data: MouseAndDetected): SnapResult | undefined;\r\n\r\n    removeDynamicObject(): void {\r\n        this.clearTempMeshes();\r\n        this.unhighlight();\r\n    }\r\n\r\n    clear(): void {\r\n        this.removeDynamicObject();\r\n    }\r\n\r\n    protected clearTempMeshes(): void {\r\n        this._tempMeshIds.forEach((ids, view) => {\r\n            ids.forEach((id) => view.document.visual.context.removeMesh(id));\r\n        });\r\n        this._tempMeshIds.clear();\r\n    }\r\n\r\n    protected addTempMesh(view: IView, meshId: number): void {\r\n        let ids = this._tempMeshIds.get(view);\r\n        if (!ids) {\r\n            ids = [];\r\n            this._tempMeshIds.set(view, ids);\r\n        }\r\n        ids.push(meshId);\r\n    }\r\n\r\n    protected highlight(shapes: VisualShapeData[]): void {\r\n        shapes.forEach((shape) => {\r\n            const highlighter = shape.owner.node.document.visual.highlighter;\r\n            highlighter.addState(\r\n                shape.owner,\r\n                VisualState.edgeHighlight,\r\n                shape.shape.shapeType,\r\n                ...shape.indexes,\r\n            );\r\n        });\r\n        this._highlightedShapes.push(...shapes);\r\n    }\r\n\r\n    protected unhighlight(): void {\r\n        this._highlightedShapes.forEach((shape) => {\r\n            const highlighter = shape.owner.node.document.visual.highlighter;\r\n            highlighter.removeState(\r\n                shape.owner,\r\n                VisualState.edgeHighlight,\r\n                shape.shape.shapeType,\r\n                ...shape.indexes,\r\n            );\r\n        });\r\n        this._highlightedShapes.length = 0;\r\n    }\r\n\r\n    protected calculateDistance(point: XYZ): number | undefined {\r\n        return this.referencePoint ? this.referencePoint().distanceTo(point) : undefined;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18n, IEdge, IView, ObjectSnapType, ShapeType, VisualShapeData, XYZ } from \"chili-core\";\r\nimport { SnapResult } from \"../snap\";\r\n\r\nexport class FeaturePointStrategy {\r\n    private readonly _featureInfos: Map<VisualShapeData, SnapResult[]> = new Map();\r\n\r\n    constructor(private _snapType: ObjectSnapType) {}\r\n\r\n    getFeaturePoints(view: IView, shape: VisualShapeData): SnapResult[] {\r\n        if (this._featureInfos.has(shape)) {\r\n            return this._featureInfos.get(shape)!;\r\n        }\r\n\r\n        const infos: SnapResult[] = [];\r\n        if (shape.shape.shapeType === ShapeType.Edge) {\r\n            this.getEdgeFeaturePoints(view, shape, infos);\r\n        }\r\n        this._featureInfos.set(shape, infos);\r\n        return infos;\r\n    }\r\n\r\n    private getEdgeFeaturePoints(view: IView, shape: VisualShapeData, infos: SnapResult[]) {\r\n        const curve = (shape.shape as IEdge).curve;\r\n        const start = curve.value(curve.firstParameter());\r\n        const end = curve.value(curve.lastParameter());\r\n\r\n        const addPoint = (point: XYZ, info: string) =>\r\n            infos.push({\r\n                view,\r\n                point: shape.transform.ofPoint(point),\r\n                info,\r\n                shapes: [shape],\r\n            });\r\n\r\n        if (ObjectSnapType.has(this._snapType, ObjectSnapType.endPoint)) {\r\n            addPoint(start, I18n.translate(\"snap.end\"));\r\n            addPoint(end, I18n.translate(\"snap.end\"));\r\n        }\r\n        if (ObjectSnapType.has(this._snapType, ObjectSnapType.midPoint)) {\r\n            const mid = curve.value((curve.firstParameter() + curve.lastParameter()) * 0.5);\r\n            addPoint(mid, I18n.translate(\"snap.mid\"));\r\n        }\r\n    }\r\n\r\n    clear(): void {\r\n        this._featureInfos.clear();\r\n    }\r\n\r\n    updateSnapType(snapType: ObjectSnapType): void {\r\n        this._snapType = snapType;\r\n        this.clear();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    Config,\r\n    I18n,\r\n    ICircle,\r\n    ICurve,\r\n    IDocument,\r\n    IEdge,\r\n    IView,\r\n    IVisualContext,\r\n    ObjectSnapType,\r\n    ShapeType,\r\n    VertexMeshData,\r\n    VisualConfig,\r\n    VisualShapeData,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { MouseAndDetected, SnapResult } from \"../snap\";\r\nimport { BaseSnap } from \"./baseSnap\";\r\nimport { FeaturePointStrategy } from \"./featurePointStrategy\";\r\n\r\ninterface InvisibleSnapInfo {\r\n    view: IView;\r\n    snaps: SnapResult[];\r\n    displays: number[];\r\n}\r\n\r\nexport class ObjectSnap extends BaseSnap {\r\n    private readonly _featureStrategy: FeaturePointStrategy;\r\n    private readonly _intersectionInfos: Map<string, SnapResult[]>;\r\n    private readonly _invisibleInfos: Map<VisualShapeData, InvisibleSnapInfo>;\r\n    private _lastDetected?: [IView, SnapResult];\r\n    private _hintVertex?: [IVisualContext, number];\r\n\r\n    constructor(\r\n        private _snapType: ObjectSnapType,\r\n        referencePoint?: () => XYZ,\r\n    ) {\r\n        super(referencePoint);\r\n        this._featureStrategy = new FeaturePointStrategy(_snapType);\r\n        this._intersectionInfos = new Map();\r\n        this._invisibleInfos = new Map();\r\n        Config.instance.onPropertyChanged(this.onSnapTypeChanged);\r\n    }\r\n\r\n    override clear() {\r\n        super.clear();\r\n        this._invisibleInfos.forEach((info) => {\r\n            info.displays.forEach((x) => info.view.document.visual.context.removeMesh(x));\r\n        });\r\n        this.removeHint();\r\n        this._featureStrategy.clear();\r\n        Config.instance.removePropertyChanged(this.onSnapTypeChanged);\r\n    }\r\n\r\n    readonly handleSnaped = (document: IDocument, snaped?: SnapResult | undefined) => {\r\n        if (snaped?.shapes.length === 0 && this._lastDetected) {\r\n            this.displayHint(this._lastDetected[0], this._lastDetected[1]);\r\n            this._lastDetected = undefined;\r\n        }\r\n    };\r\n\r\n    private readonly onSnapTypeChanged = (property: keyof Config) => {\r\n        if (property === \"snapType\" || property === \"enableSnap\") {\r\n            this._snapType = Config.instance.snapType;\r\n            this._featureStrategy.updateSnapType(this._snapType);\r\n            this._intersectionInfos.clear();\r\n        }\r\n    };\r\n\r\n    override removeDynamicObject(): void {\r\n        super.removeDynamicObject();\r\n        this.removeHint();\r\n    }\r\n\r\n    private removeHint() {\r\n        if (this._hintVertex !== undefined) {\r\n            this._hintVertex[0].removeMesh(this._hintVertex[1]);\r\n            this._hintVertex = undefined;\r\n        }\r\n    }\r\n\r\n    snap(data: MouseAndDetected): SnapResult | undefined {\r\n        if (!Config.instance.enableSnap) return undefined;\r\n\r\n        let snap: SnapResult | undefined;\r\n        if (data.shapes.length > 0) {\r\n            this.showInvisibleSnaps(data.view, data.shapes[0]);\r\n            snap = this.snapOnShape(data.view, data.mx, data.my, data.shapes);\r\n        } else {\r\n            snap = this.snapeInvisible(data.view, data.mx, data.my);\r\n        }\r\n        if (this.referencePoint && snap?.point) {\r\n            snap.distance = this.referencePoint().distanceTo(snap.point);\r\n        }\r\n        return snap;\r\n    }\r\n\r\n    private snapOnShape(view: IView, x: number, y: number, shapes: VisualShapeData[]) {\r\n        const featurePoints = this._featureStrategy.getFeaturePoints(view, shapes[0]);\r\n        const perpendiculars = this.findPerpendicular(view, shapes[0]);\r\n        const intersections = this.getIntersections(view, shapes[0], shapes);\r\n        const ordered = [...featurePoints, ...perpendiculars, ...intersections].sort((a, b) =>\r\n            this.sortSnaps(view, x, y, a, b),\r\n        );\r\n\r\n        if (ordered.length === 0) return undefined;\r\n\r\n        const dist = IView.screenDistance(view, x, y, ordered[0].point!);\r\n        if (dist < Config.instance.SnapDistance) {\r\n            this.hilighted(view, ordered[0].shapes);\r\n            return ordered[0];\r\n        } else {\r\n            this._lastDetected = [view, ordered[0]];\r\n            return undefined;\r\n        }\r\n    }\r\n\r\n    private displayHint(view: IView, shape: SnapResult) {\r\n        this.hilighted(view, shape.shapes);\r\n        let data = VertexMeshData.from(\r\n            shape.point!,\r\n            VisualConfig.hintVertexSize,\r\n            VisualConfig.hintVertexColor,\r\n        );\r\n        this._hintVertex = [view.document.visual.context, view.document.visual.context.displayMesh(data)];\r\n    }\r\n\r\n    private snapeInvisible(view: IView, x: number, y: number): SnapResult | undefined {\r\n        const { minDistance, snap } = this.getNearestInvisibleSnap(view, x, y);\r\n        if (minDistance < Config.instance.SnapDistance) {\r\n            this.hilighted(view, snap!.shapes);\r\n            return snap;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private getNearestInvisibleSnap(\r\n        view: IView,\r\n        x: number,\r\n        y: number,\r\n    ): { minDistance: number; snap?: SnapResult } {\r\n        let snap: SnapResult | undefined;\r\n        let minDistance = Number.MAX_VALUE;\r\n\r\n        this._invisibleInfos.forEach((info) => {\r\n            info.snaps.forEach((s) => {\r\n                const dist = IView.screenDistance(view, x, y, s.point!);\r\n                if (dist < minDistance) {\r\n                    minDistance = dist;\r\n                    snap = s;\r\n                }\r\n            });\r\n        });\r\n        return { minDistance, snap };\r\n    }\r\n\r\n    private showInvisibleSnaps(view: IView, shape: VisualShapeData) {\r\n        if (shape.shape.shapeType === ShapeType.Edge) {\r\n            if (this._invisibleInfos.has(shape)) return;\r\n            let curve = (shape.shape as IEdge).curve;\r\n            let basisCurve = curve.basisCurve;\r\n            if (ICurve.isCircle(basisCurve)) {\r\n                this.showCircleCenter(basisCurve, view, shape);\r\n            }\r\n        }\r\n    }\r\n\r\n    private showCircleCenter(curve: ICircle, view: IView, shape: VisualShapeData) {\r\n        const center = shape.transform.ofPoint(curve.center);\r\n        let temporary = VertexMeshData.from(\r\n            center,\r\n            VisualConfig.hintVertexSize,\r\n            VisualConfig.hintVertexColor,\r\n        );\r\n        let id = view.document.visual.context.displayMesh(temporary);\r\n        this._invisibleInfos.set(shape, {\r\n            view,\r\n            snaps: [\r\n                {\r\n                    view,\r\n                    point: center,\r\n                    info: I18n.translate(\"snap.center\"),\r\n                    shapes: [shape],\r\n                },\r\n            ],\r\n            displays: [id],\r\n        });\r\n    }\r\n\r\n    private hilighted(view: IView, shapes: VisualShapeData[]) {\r\n        this.highlight(shapes);\r\n    }\r\n\r\n    private sortSnaps(view: IView, x: number, y: number, a: SnapResult, b: SnapResult): number {\r\n        return IView.screenDistance(view, x, y, a.point!) - IView.screenDistance(view, x, y, b.point!);\r\n    }\r\n\r\n    private findPerpendicular(view: IView, shape: VisualShapeData): SnapResult[] {\r\n        let result: SnapResult[] = [];\r\n        if (\r\n            !ObjectSnapType.has(this._snapType, ObjectSnapType.perpendicular) ||\r\n            this.referencePoint === undefined\r\n        ) {\r\n            return result;\r\n        }\r\n\r\n        let curve = (shape.shape as IEdge).curve;\r\n        const transform = shape.transform;\r\n        let point = curve.project(transform.invert()!.ofPoint(this.referencePoint())).at(0);\r\n        if (point === undefined) return result;\r\n        result.push({\r\n            view,\r\n            point: transform.ofPoint(point),\r\n            info: I18n.translate(\"snap.perpendicular\"),\r\n            shapes: [shape],\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    private getIntersections(view: IView, current: VisualShapeData, shapes: VisualShapeData[]) {\r\n        let result = new Array<SnapResult>();\r\n        if (\r\n            !ObjectSnapType.has(this._snapType, ObjectSnapType.intersection) &&\r\n            current.shape.shapeType !== ShapeType.Edge\r\n        ) {\r\n            return result;\r\n        }\r\n        shapes.forEach((x) => {\r\n            if (x === current || x.shape.shapeType !== ShapeType.Edge) return;\r\n            let key = this.getIntersectionKey(current, x);\r\n            let arr = this._intersectionInfos.get(key);\r\n            if (arr === undefined) {\r\n                arr = this.findIntersections(view, current, x);\r\n                this._intersectionInfos.set(key, arr);\r\n            }\r\n            result.push(...arr);\r\n        });\r\n        return result;\r\n    }\r\n\r\n    private getIntersectionKey(s1: VisualShapeData, s2: VisualShapeData) {\r\n        return s1.shape.id < s2.shape.id ? `${s1.shape.id}:${s2.shape.id}` : `${s2.shape.id}:${s1.shape.id}`;\r\n    }\r\n\r\n    private findIntersections(view: IView, s1: VisualShapeData, s2: VisualShapeData): SnapResult[] {\r\n        const e1 = s1.shape.transformedMul(s1.transform) as IEdge;\r\n        const e2 = s2.shape.transformedMul(s2.transform) as IEdge;\r\n        let intersections = e1.intersect(e2);\r\n        e1.dispose();\r\n        e2.dispose();\r\n        return intersections.map((point) => {\r\n            return {\r\n                view,\r\n                point: point.point,\r\n                info: I18n.translate(\"snap.intersection\"),\r\n                shapes: [s1, s2],\r\n            };\r\n        });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Plane, XYZ } from \"chili-core\";\r\nimport { ViewUtils } from \"chili-vis\";\r\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\r\n\r\nexport abstract class PlaneSnapBase implements ISnap {\r\n    removeDynamicObject(): void {}\r\n    clear(): void {}\r\n    abstract snap(data: MouseAndDetected): SnapResult | undefined;\r\n\r\n    constructor(readonly refPoint?: () => XYZ) {}\r\n\r\n    protected snapAtPlane(plane: Plane, data: MouseAndDetected): SnapResult | undefined {\r\n        plane = ViewUtils.ensurePlane(data.view, plane);\r\n        const ray = data.view.rayAt(data.mx, data.my);\r\n        const point = plane.intersect(ray);\r\n        if (!point) return undefined;\r\n\r\n        const distance = this.refPoint ? this.refPoint().distanceTo(point) : undefined;\r\n\r\n        return {\r\n            view: data.view,\r\n            point,\r\n            distance,\r\n            shapes: [],\r\n        };\r\n    }\r\n}\r\n\r\nexport class WorkplaneSnap extends PlaneSnapBase {\r\n    snap(data: MouseAndDetected): SnapResult | undefined {\r\n        return this.snapAtPlane(data.view.workplane, data);\r\n    }\r\n}\r\n\r\nexport class PlaneSnap extends PlaneSnapBase {\r\n    constructor(\r\n        readonly plane: (point: XYZ) => Plane,\r\n        refPoint?: () => XYZ,\r\n    ) {\r\n        super(refPoint);\r\n    }\r\n\r\n    snap(data: MouseAndDetected): SnapResult | undefined {\r\n        let point = data.view.screenToWorld(data.mx, data.my);\r\n        const plane = this.plane(point);\r\n        const result = this.snapAtPlane(plane, data);\r\n        if (result) {\r\n            result.plane = plane;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { ICurve } from \"chili-core\";\r\nimport { SnapPointOnCurveData } from \"../handlers\";\r\nimport { ISnap, MouseAndDetected, SnapResult } from \"../snap\";\r\n\r\nexport class PointOnCurveSnap implements ISnap {\r\n    constructor(readonly pointData: SnapPointOnCurveData) {}\r\n\r\n    snap(data: MouseAndDetected): SnapResult | undefined {\r\n        const ray = data.view.rayAt(data.mx, data.my);\r\n        const curve = this.pointData.curve;\r\n        const nearest = curve.nearestExtrema(ray);\r\n        if (!nearest) return undefined;\r\n        return {\r\n            view: data.view,\r\n            point: nearest.p1,\r\n            shapes: [],\r\n        };\r\n    }\r\n\r\n    removeDynamicObject(): void {}\r\n    clear(): void {}\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18n, I18nKeys, Plane, Ray, XYZ } from \"chili-core\";\r\n\r\nexport class Axis extends Ray {\r\n    constructor(\r\n        location: XYZ,\r\n        direction: XYZ,\r\n        readonly name: string,\r\n    ) {\r\n        super(location, direction);\r\n    }\r\n\r\n    static getAxiesAtPlane(location: XYZ, plane: Plane, containsZ: boolean) {\r\n        const createAxis = (direction: XYZ, name: I18nKeys) =>\r\n            new Axis(location, direction, I18n.translate(name));\r\n\r\n        const axies = [\r\n            createAxis(plane.xvec, \"axis.x\"),\r\n            createAxis(plane.xvec.reverse(), \"axis.x\"),\r\n            createAxis(plane.yvec, \"axis.y\"),\r\n            createAxis(plane.yvec.reverse(), \"axis.y\"),\r\n        ];\r\n\r\n        if (containsZ) {\r\n            axies.push(createAxis(plane.normal, \"axis.z\"), createAxis(plane.normal.reverse(), \"axis.z\"));\r\n        }\r\n\r\n        return axies;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument, VertexMeshData } from \"chili-core\";\r\nimport { SnapResult } from \"..\";\r\n\r\nexport abstract class TrackingBase {\r\n    protected readonly tempMeshes: Map<IDocument, number[]> = new Map();\r\n    protected isCleared: boolean = false;\r\n\r\n    constructor(readonly trackingZ: boolean) {}\r\n\r\n    clear(): void {\r\n        this.clearTempMeshes();\r\n        this.isCleared = true;\r\n    }\r\n\r\n    protected clearTempMeshes(): void {\r\n        this.tempMeshes.forEach((ids, document) => {\r\n            ids.forEach((id) => document.visual.context.removeMesh(id));\r\n        });\r\n        this.tempMeshes.clear();\r\n    }\r\n\r\n    protected addTempMesh(document: IDocument, meshId: number): void {\r\n        let ids = this.tempMeshes.get(document);\r\n        if (!ids) {\r\n            ids = [];\r\n            this.tempMeshes.set(document, ids);\r\n        }\r\n        ids.push(meshId);\r\n    }\r\n\r\n    protected displayPoint(document: IDocument, point: SnapResult, size: number, color: number): number {\r\n        const data = VertexMeshData.from(point.point!, size, color);\r\n        const id = document.visual.context.displayMesh(data);\r\n        this.addTempMesh(document, id);\r\n        return id;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18n, IView, Plane, XYZ } from \"chili-core\";\r\nimport { Axis } from \"./axis\";\r\nimport { TrackingBase } from \"./trackingBase\";\r\n\r\nexport class AxisTracking extends TrackingBase {\r\n    private readonly axies: Map<IView, Axis[]> = new Map();\r\n\r\n    constructor(trackingZ: boolean) {\r\n        super(trackingZ);\r\n    }\r\n\r\n    getAxes(view: IView, referencePoint: XYZ, angle: number | undefined = undefined) {\r\n        if (!this.axies.has(view)) {\r\n            this.axies.set(view, this.initAxes(view.workplane, referencePoint, angle));\r\n        }\r\n        return this.axies.get(view)!;\r\n    }\r\n\r\n    private initAxes(plane: Plane, referencePoint: XYZ, angle: number | undefined): Axis[] {\r\n        if (angle === undefined) {\r\n            return Axis.getAxiesAtPlane(referencePoint, plane, this.trackingZ);\r\n        }\r\n\r\n        const result: Axis[] = [];\r\n        let testAngle = 0;\r\n        while (testAngle < 360) {\r\n            let direction = plane.xvec.rotate(plane.normal, (testAngle / 180) * Math.PI)!;\r\n            result.push(new Axis(referencePoint, direction, `${testAngle} °`));\r\n            testAngle += angle;\r\n        }\r\n        if (this.trackingZ) {\r\n            result.push(new Axis(referencePoint, plane.normal, I18n.translate(\"axis.z\")));\r\n            result.push(new Axis(referencePoint, plane.normal.reverse(), I18n.translate(\"axis.z\")));\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    override clear(): void {\r\n        super.clear();\r\n        this.axies.clear();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument, IView, VisualConfig } from \"chili-core\";\r\nimport { ViewUtils } from \"chili-vis\";\r\nimport { SnapResult } from \"..\";\r\nimport { Axis } from \"./axis\";\r\nimport { TrackingBase } from \"./trackingBase\";\r\n\r\nexport interface ObjectTrackingAxis {\r\n    axes: Axis[];\r\n    objectName: string | undefined;\r\n}\r\n\r\ninterface SnapeInfo {\r\n    snap: SnapResult;\r\n    shapeId: number;\r\n}\r\n\r\nexport class ObjectTracking extends TrackingBase {\r\n    private timer?: number;\r\n    private snapping?: SnapResult;\r\n    private readonly trackings: Map<IDocument, SnapeInfo[]> = new Map();\r\n\r\n    constructor(trackingZ: boolean) {\r\n        super(trackingZ);\r\n    }\r\n\r\n    override clear(): void {\r\n        this.clearTimer();\r\n        super.clear();\r\n        this.trackings.clear();\r\n    }\r\n\r\n    getTrackingRays(view: IView) {\r\n        const result: ObjectTrackingAxis[] = [];\r\n        this.trackings.get(view.document)?.map((x) => {\r\n            let plane = ViewUtils.ensurePlane(view, view.workplane);\r\n            let axes = Axis.getAxiesAtPlane(x.snap.point!, plane, this.trackingZ);\r\n            result.push({ axes, objectName: x.snap.info });\r\n        });\r\n        return result;\r\n    }\r\n\r\n    showTrackingAtTimeout(document: IDocument, snap?: SnapResult) {\r\n        if (snap !== undefined && this.snapping === snap) return;\r\n        this.snapping = snap;\r\n        this.clearTimer();\r\n        if (!snap) return;\r\n        this.timer = window.setTimeout(() => this.switchTrackingPoint(document, snap), 600);\r\n    }\r\n\r\n    private clearTimer() {\r\n        if (this.timer !== undefined) {\r\n            clearTimeout(this.timer);\r\n            this.timer = undefined;\r\n        }\r\n    }\r\n\r\n    private switchTrackingPoint(document: IDocument, snap: SnapResult) {\r\n        if (this.isCleared || snap.shapes.length === 0) return;\r\n        if (!this.trackings.has(document)) {\r\n            this.trackings.set(document, []);\r\n        }\r\n        const currentTrackings = this.trackings.get(document)!;\r\n        const existingTracking = currentTrackings.find((x) => x.snap.point!.isEqualTo(snap.point!));\r\n        existingTracking\r\n            ? this.removeTrackingPoint(document, existingTracking, currentTrackings)\r\n            : this.addTrackingPoint(snap, document, currentTrackings);\r\n        document.visual.update();\r\n    }\r\n\r\n    private removeTrackingPoint(document: IDocument, s: SnapeInfo, snaps: SnapeInfo[]) {\r\n        document.visual.context.removeMesh(s.shapeId);\r\n        this.trackings.set(\r\n            document,\r\n            snaps.filter((x) => x !== s),\r\n        );\r\n    }\r\n\r\n    private addTrackingPoint(snap: SnapResult, document: IDocument, snaps: SnapeInfo[]) {\r\n        const pointId = this.displayPoint(\r\n            document,\r\n            snap,\r\n            VisualConfig.trackingVertexSize,\r\n            VisualConfig.trackingVertexColor,\r\n        );\r\n        snaps.push({ shapeId: pointId, snap });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    Config,\r\n    EdgeMeshData,\r\n    I18n,\r\n    IDocument,\r\n    ISubEdgeShape,\r\n    IView,\r\n    LineType,\r\n    Precision,\r\n    Ray,\r\n    ShapeType,\r\n    VisualConfig,\r\n    XY,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { ISnap, MouseAndDetected, SnapResult } from \"../\";\r\nimport { Axis } from \"./axis\";\r\nimport { AxisTracking } from \"./axisTracking\";\r\nimport { ObjectTracking } from \"./objectTracking\";\r\n\r\nexport interface TrackingData {\r\n    axis: Axis;\r\n    point: XYZ;\r\n    isObjectTracking: boolean;\r\n    distance: number;\r\n    info: string;\r\n}\r\n\r\nexport class TrackingSnap implements ISnap {\r\n    private readonly _axisTracking: AxisTracking;\r\n    private readonly _objectTracking: ObjectTracking;\r\n    private readonly _tempLines: Map<IView, number[]> = new Map();\r\n\r\n    constructor(\r\n        readonly referencePoint: (() => XYZ) | undefined,\r\n        trackingAxisZ: boolean,\r\n    ) {\r\n        this._axisTracking = new AxisTracking(trackingAxisZ);\r\n        this._objectTracking = new ObjectTracking(trackingAxisZ);\r\n        Config.instance.onPropertyChanged(this.onSnapTypeChanged);\r\n    }\r\n\r\n    readonly handleSnaped = (document: IDocument, snaped?: SnapResult) => {\r\n        if (Config.instance.enableSnapTracking) {\r\n            this._objectTracking.showTrackingAtTimeout(document, snaped);\r\n        }\r\n    };\r\n\r\n    snap(data: MouseAndDetected): SnapResult | undefined {\r\n        if (!Config.instance.enableSnapTracking) return undefined;\r\n\r\n        const trackingDatas = this.detectTracking(data.view, data.mx, data.my);\r\n        if (trackingDatas.length === 0) return undefined;\r\n        trackingDatas.sort((x) => x.distance);\r\n        let snaped = this.shapeIntersectTracking(data, trackingDatas);\r\n        if (snaped !== undefined) return snaped;\r\n        if (trackingDatas.length === 1) {\r\n            return this.getSnapedAndShowTracking(data.view, trackingDatas[0].point, [trackingDatas[0]]);\r\n        }\r\n        return (\r\n            this.trackingIntersectTracking(data.view, trackingDatas) ??\r\n            this.getSnapedAndShowTracking(data.view, trackingDatas[0].point, [trackingDatas[0]])\r\n        );\r\n    }\r\n\r\n    private trackingIntersectTracking(view: IView, trackingDatas: TrackingData[]) {\r\n        const point = trackingDatas[0].axis.intersect(trackingDatas[1].axis);\r\n        return point\r\n            ? this.getSnapedAndShowTracking(view, point, [trackingDatas[0], trackingDatas[1]])\r\n            : undefined;\r\n    }\r\n\r\n    private getSnapedAndShowTracking(view: IView, point: XYZ, trackingDatas: TrackingData[]): SnapResult {\r\n        const lines: number[] = trackingDatas\r\n            .map((x) => this.showTempLine(view, x.axis.location, point))\r\n            .filter((id) => id !== undefined);\r\n        this._tempLines.set(view, lines);\r\n\r\n        let info: string | undefined = undefined;\r\n        let distance: number | undefined = undefined;\r\n        if (trackingDatas.length === 1) {\r\n            distance = point.distanceTo(trackingDatas[0].axis.location);\r\n            info = trackingDatas[0].axis.name;\r\n        } else if (trackingDatas.length === 2) {\r\n            info = I18n.translate(\"snap.intersection\");\r\n        }\r\n        const refPoint = trackingDatas[0].axis.location;\r\n        return { view, point, info, shapes: [], refPoint, distance };\r\n    }\r\n\r\n    private showTempLine(view: IView, start: XYZ, end: XYZ): number | undefined {\r\n        const vector = end.sub(start);\r\n        const normal = vector.normalize();\r\n        if (!normal) return undefined;\r\n        const distance = Math.min(vector.length() * 1e10, 1e20);\r\n        const newEnd = start.add(normal.multiply(distance));\r\n        const lineDats = EdgeMeshData.from(start, newEnd, VisualConfig.temporaryEdgeColor, LineType.Dash);\r\n        return view.document.visual.context.displayMesh(lineDats);\r\n    }\r\n\r\n    private shapeIntersectTracking(\r\n        data: MouseAndDetected,\r\n        trackingDatas: TrackingData[],\r\n    ): SnapResult | undefined {\r\n        if (data.shapes.length === 0 || data.shapes[0].shape.shapeType !== ShapeType.Edge) return undefined;\r\n        const point = this.findIntersection(data, trackingDatas);\r\n        if (!point) return undefined;\r\n        const id = this.showTempLine(data.view, point.location, point.intersect);\r\n        if (id === undefined) return undefined;\r\n        this._tempLines.set(data.view, [id]);\r\n        return {\r\n            view: data.view,\r\n            point: point.intersect,\r\n            info: I18n.translate(\"snap.intersection\"),\r\n            shapes: [data.shapes[0]],\r\n        };\r\n    }\r\n\r\n    private findIntersection(data: MouseAndDetected, trackingDatas: TrackingData[]) {\r\n        const edge = data.shapes[0].shape as ISubEdgeShape;\r\n        const points: { intersect: XYZ; location: XYZ }[] = [];\r\n        trackingDatas.forEach((x) => {\r\n            edge.intersect(x.axis).forEach((p) => {\r\n                points.push({ intersect: p.point, location: x.axis.location });\r\n            });\r\n        });\r\n        points.sort((p) => IView.screenDistance(data.view, data.mx, data.my, p.intersect));\r\n        return points.at(0);\r\n    }\r\n\r\n    private detectTracking(view: IView, x: number, y: number) {\r\n        const data: TrackingData[] = [];\r\n        if (this.referencePoint) {\r\n            const axies = this._axisTracking.getAxes(view, this.referencePoint());\r\n            data.push(...this.getSnapedFromAxes(axies, view, x, y));\r\n        }\r\n        const objectTrackingRays = this._objectTracking.getTrackingRays(view);\r\n        objectTrackingRays.forEach((a) => {\r\n            data.push(...this.getSnapedFromAxes(a.axes, view, x, y, a.objectName));\r\n        });\r\n        return data;\r\n    }\r\n\r\n    private getSnapedFromAxes(axes: Axis[], view: IView, x: number, y: number, snapedName?: string) {\r\n        let result: TrackingData[] = [];\r\n        for (const axis of axes) {\r\n            let distance = this.rayDistanceAtScreen(view, x, y, axis);\r\n            if (distance < Config.instance.SnapDistance) {\r\n                let ray = view.rayAt(x, y);\r\n                let point = axis.nearestTo(ray);\r\n                if (point.sub(axis.location).dot(axis.direction) < 0) continue;\r\n                result.push({\r\n                    axis,\r\n                    distance,\r\n                    point,\r\n                    info: snapedName ?? axis.name,\r\n                    isObjectTracking: snapedName !== undefined,\r\n                });\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private rayDistanceAtScreen(view: IView, x: number, y: number, axis: Ray): number {\r\n        const start = view.worldToScreen(axis.location);\r\n        const vector = new XY(x - start.x, y - start.y);\r\n        if (vector.isEqualTo(XY.zero)) return 0;\r\n        const end = view.worldToScreen(axis.location.add(axis.direction.multiply(100000)));\r\n        if (start.distanceTo(end) < Precision.Float) return vector.length();\r\n        const dir = end.sub(start).normalize()!;\r\n        const dot = vector.dot(dir);\r\n        return Math.sqrt(vector.lengthSq() - dot * dot);\r\n    }\r\n\r\n    removeDynamicObject(): void {\r\n        this._tempLines.forEach((v, k) => {\r\n            v.forEach((id) => {\r\n                k.document.visual.context.removeMesh(id);\r\n            });\r\n        });\r\n        this._tempLines.clear();\r\n    }\r\n\r\n    private readonly onSnapTypeChanged = (property: keyof Config): void => {\r\n        if (property === \"snapType\" || property === \"enableSnapTracking\" || property === \"enableSnap\") {\r\n            this.removeDynamicObject();\r\n            this._objectTracking.clear();\r\n            this._axisTracking.clear();\r\n        }\r\n    };\r\n\r\n    clear(): void {\r\n        this.removeDynamicObject();\r\n        this._axisTracking.clear();\r\n        this._objectTracking.clear();\r\n        Config.instance.removePropertyChanged(this.onSnapTypeChanged);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    Config,\r\n    I18nKeys,\r\n    IDocument,\r\n    IEventHandler,\r\n    IView,\r\n    MessageType,\r\n    PubSub,\r\n    Result,\r\n    ShapeType,\r\n    VertexMeshData,\r\n    VisualConfig,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { ISnap, MouseAndDetected, SnapData, SnapResult } from \"../snap\";\r\n\r\nenum SnapState {\r\n    Idle,\r\n    Snapping,\r\n    InputMode,\r\n    Cancelled,\r\n}\r\n\r\nexport abstract class SnapEventHandler<D extends SnapData = SnapData> implements IEventHandler {\r\n    private _tempPoint?: number;\r\n    private _tempShapes?: number[];\r\n    protected _snaped?: SnapResult;\r\n    private _state: SnapState = SnapState.Idle;\r\n\r\n    constructor(\r\n        readonly document: IDocument,\r\n        readonly controller: AsyncController,\r\n        readonly snaps: ISnap[],\r\n        readonly data: D,\r\n    ) {\r\n        this.showTempShape(undefined);\r\n        controller.onCancelled(() => this.handleCancel());\r\n    }\r\n\r\n    get snaped() {\r\n        return this._snaped;\r\n    }\r\n    get state() {\r\n        return this._state;\r\n    }\r\n\r\n    dispose() {\r\n        this._snaped = undefined;\r\n        this._state = SnapState.Idle;\r\n    }\r\n\r\n    private handleSuccess() {\r\n        this._state = SnapState.Idle;\r\n        this.controller.success();\r\n        this.cleanupResources();\r\n    }\r\n\r\n    private handleCancel() {\r\n        if (this._state === SnapState.Cancelled) return;\r\n        this._state = SnapState.Cancelled;\r\n        this.controller.cancel();\r\n        this.cleanupResources();\r\n    }\r\n\r\n    private cleanupResources() {\r\n        this.clearSnapTip();\r\n        this.clearInput();\r\n        this.removeTempVisuals();\r\n        this.snaps.forEach((snap) => snap.clear());\r\n    }\r\n\r\n    private clearInput() {\r\n        PubSub.default.pub(\"clearInput\");\r\n    }\r\n\r\n    pointerMove(view: IView, event: PointerEvent): void {\r\n        this._state = SnapState.Snapping;\r\n        this.removeTempVisuals();\r\n        this.updateSnapPoint(view, event);\r\n        this.updateVisualFeedback(view);\r\n    }\r\n\r\n    private updateSnapPoint(view: IView, event: PointerEvent) {\r\n        this.setSnaped(view, event);\r\n        if (this._snaped) {\r\n            this.showSnapPrompt(this.formatPrompt(this._snaped));\r\n        } else {\r\n            this.clearSnapTip();\r\n        }\r\n    }\r\n\r\n    private updateVisualFeedback(view: IView) {\r\n        this.showTempShape(this._snaped?.point);\r\n        view.document.visual.update();\r\n    }\r\n\r\n    private formatPrompt(snaped: SnapResult) {\r\n        let prompt = this.data.prompt?.(snaped);\r\n        if (!prompt) {\r\n            let distance = snaped.distance ?? snaped.refPoint?.distanceTo(snaped.point!);\r\n            if (distance) {\r\n                prompt = `${distance.toFixed(2)}`;\r\n            }\r\n        }\r\n\r\n        return [snaped.info, prompt].filter((x) => x !== undefined).join(\" -> \");\r\n    }\r\n\r\n    protected setSnaped(view: IView, event: PointerEvent) {\r\n        if (this.trySnapToFeaturePoint(view, event)) return;\r\n\r\n        this._snaped = this.findSnapPoint(ShapeType.Edge, view, event);\r\n        this.snaps.forEach((snap) => snap.handleSnaped?.(view.document.visual.document, this._snaped));\r\n    }\r\n\r\n    private trySnapToFeaturePoint(view: IView, event: PointerEvent) {\r\n        const featurePoint = this.findNearestFeaturePoint(view, event);\r\n        if (!featurePoint) return false;\r\n\r\n        this._snaped = {\r\n            view,\r\n            point: featurePoint.point,\r\n            info: featurePoint.prompt,\r\n            shapes: [],\r\n        };\r\n        return true;\r\n    }\r\n\r\n    private findNearestFeaturePoint(view: IView, event: PointerEvent) {\r\n        let minDist = Number.MAX_VALUE;\r\n        let nearest;\r\n\r\n        for (const point of this.data.featurePoints || []) {\r\n            if (point.when && !point.when()) continue;\r\n\r\n            const dist = IView.screenDistance(view, event.offsetX, event.offsetY, point.point);\r\n            if (dist < minDist) {\r\n                minDist = dist;\r\n                nearest = point;\r\n            }\r\n        }\r\n\r\n        return minDist < Config.instance.SnapDistance ? nearest : undefined;\r\n    }\r\n\r\n    private findSnapPoint(shapeType: ShapeType, view: IView, event: MouseEvent) {\r\n        const detected = this.detectShapes(shapeType, view, event);\r\n        for (const snap of this.snaps) {\r\n            const snaped = snap.snap(detected);\r\n            if (snaped && this.validateSnapPoint(snaped)) return snaped;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private validateSnapPoint(snaped: SnapResult) {\r\n        return !this.data.validator || this.data.validator(snaped.point!);\r\n    }\r\n\r\n    private detectShapes(shapeType: ShapeType, view: IView, event: MouseEvent): MouseAndDetected {\r\n        const shapes = view.detectShapes(shapeType, event.offsetX, event.offsetY, this.data.filter);\r\n        return { shapes, view, mx: event.offsetX, my: event.offsetY };\r\n    }\r\n\r\n    private clearSnapTip() {\r\n        PubSub.default.pub(\"clearFloatTip\");\r\n    }\r\n\r\n    private showSnapPrompt(msg: string | undefined) {\r\n        if (!msg) {\r\n            this.clearSnapTip();\r\n            return;\r\n        }\r\n        PubSub.default.pub(\"showFloatTip\", MessageType.info, msg);\r\n    }\r\n\r\n    private removeTempVisuals() {\r\n        this.removeTempShapes();\r\n        this.snaps.forEach((snap) => snap.removeDynamicObject());\r\n    }\r\n\r\n    private showTempShape(point: XYZ | undefined) {\r\n        if (point) {\r\n            const data = VertexMeshData.from(\r\n                point,\r\n                VisualConfig.temporaryVertexSize,\r\n                VisualConfig.temporaryVertexColor,\r\n            );\r\n            this._tempPoint = this.document.visual.context.displayMesh(data);\r\n        }\r\n\r\n        this._tempShapes = this.data\r\n            .preview?.(point)\r\n            ?.map((shape) => this.document.visual.context.displayMesh(shape));\r\n    }\r\n\r\n    private removeTempShapes() {\r\n        if (this._tempPoint) {\r\n            this.document.visual.context.removeMesh(this._tempPoint);\r\n            this._tempPoint = undefined;\r\n        }\r\n        this._tempShapes?.forEach((id) => {\r\n            this.document.visual.context.removeMesh(id);\r\n        });\r\n        this.document.visual.update();\r\n        this._tempShapes = undefined;\r\n    }\r\n\r\n    pointerDown(view: IView, event: PointerEvent): void {\r\n        if (event.pointerType === \"mouse\" && event.button === 0) {\r\n            if (this._snaped) {\r\n                this.handleSuccess();\r\n            } else {\r\n                PubSub.default.pub(\"showToast\", \"toast.snap.notFoundValidPoint\");\r\n            }\r\n        }\r\n    }\r\n\r\n    pointerUp(view: IView, event: PointerEvent): void {\r\n        if (event.pointerType !== \"mouse\" && event.isPrimary && this._snaped) {\r\n            this.handleSuccess();\r\n        }\r\n    }\r\n\r\n    mouseWheel(view: IView, event: WheelEvent): void {\r\n        view.update();\r\n    }\r\n\r\n    keyDown(view: IView, event: KeyboardEvent): void {\r\n        switch (event.key) {\r\n            case \"Escape\":\r\n                this._snaped = undefined;\r\n                this.handleCancel();\r\n                break;\r\n            case \"Enter\":\r\n                this._snaped = undefined;\r\n                this.handleSuccess();\r\n                break;\r\n            default:\r\n                this.handleNumericInput(view, event);\r\n        }\r\n    }\r\n\r\n    private handleNumericInput(view: IView, event: KeyboardEvent) {\r\n        if (![\"-\", \"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"].includes(event.key)) return;\r\n\r\n        this._state = SnapState.InputMode;\r\n        PubSub.default.pub(\"showInput\", event.key, (text: string) => {\r\n            const error = this.inputError(text);\r\n            if (error) return Result.err(error);\r\n\r\n            this._snaped = this.getPointFromInput(view, text);\r\n            this.handleSuccess();\r\n            return Result.ok(text);\r\n        });\r\n    }\r\n\r\n    protected abstract getPointFromInput(view: IView, text: string): SnapResult;\r\n    protected abstract inputError(text: string): I18nKeys | undefined;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, Config, IDocument, IView, Plane, PlaneAngle, XYZ } from \"chili-core\";\r\nimport { SnapResult } from \"../snap\";\r\nimport { ObjectSnap, PlaneSnap } from \"../snaps\";\r\nimport { TrackingSnap } from \"../tracking\";\r\nimport { PointSnapData } from \"./pointSnapEventHandler\";\r\nimport { SnapEventHandler } from \"./snapEventHandler\";\r\n\r\nexport class AngleSnapEventHandler extends SnapEventHandler<PointSnapData> {\r\n    private readonly planeAngle: PlaneAngle;\r\n    private readonly plane: Plane;\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        controller: AsyncController,\r\n        private readonly center: () => XYZ,\r\n        p1: XYZ,\r\n        snapPointData: PointSnapData,\r\n    ) {\r\n        if (!snapPointData.plane) throw new Error(\"AngleSnapEventHandler: no plane\");\r\n\r\n        const objectSnap = new ObjectSnap(Config.instance.snapType, snapPointData.refPoint);\r\n        const workplaneSnap = new PlaneSnap(snapPointData.plane, center);\r\n        const trackingSnap = new TrackingSnap(center, false);\r\n        super(document, controller, [objectSnap, trackingSnap, workplaneSnap], snapPointData);\r\n\r\n        const xvec = p1.sub(center()).normalize()!;\r\n        this.plane = new Plane(center(), snapPointData.plane().normal, xvec);\r\n        this.planeAngle = new PlaneAngle(this.plane);\r\n        snapPointData.prompt ??= this.formatAnglePrompt;\r\n    }\r\n\r\n    private readonly formatAnglePrompt = (snaped?: SnapResult) => {\r\n        if (!snaped?.point) return \"\";\r\n        this.planeAngle.movePoint(snaped.point);\r\n        return `${this.planeAngle.angle.toFixed(2)} °`;\r\n    };\r\n\r\n    protected override inputError(text: string) {\r\n        const angle = Number.parseFloat(text);\r\n        return isNaN(angle) ? \"error.input.invalidNumber\" : undefined;\r\n    }\r\n\r\n    protected override getPointFromInput(view: IView, text: string): SnapResult {\r\n        const angle = (Number.parseFloat(text) * Math.PI) / 180;\r\n        const vec = this.plane.xvec.rotate(this.plane.normal, angle)!;\r\n        const point = this.center().add(vec);\r\n        return { point, view, shapes: [], plane: this.plane };\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, Config, I18nKeys, IDocument, IView, Plane, Precision, XYZ } from \"chili-core\";\r\nimport { SnapData, SnapResult } from \"../snap\";\r\nimport { AxisSnap, ObjectSnap, PlaneSnap } from \"../snaps\";\r\nimport { TrackingSnap } from \"../tracking\";\r\nimport { SnapEventHandler } from \"./snapEventHandler\";\r\n\r\nexport interface LengthAtAxisSnapData extends SnapData {\r\n    point: XYZ;\r\n    direction: XYZ;\r\n}\r\n\r\nexport interface SnapLengthAtPlaneData extends SnapData {\r\n    point: () => XYZ;\r\n    plane: (point: XYZ | undefined) => Plane;\r\n}\r\n\r\nexport class SnapLengthAtAxisHandler extends SnapEventHandler<LengthAtAxisSnapData> {\r\n    constructor(document: IDocument, controller: AsyncController, lengthData: LengthAtAxisSnapData) {\r\n        const objectSnap = new ObjectSnap(Config.instance.snapType, () => lengthData.point);\r\n        const axisSnap = new AxisSnap(lengthData.point, lengthData.direction);\r\n        super(document, controller, [objectSnap, axisSnap], lengthData);\r\n    }\r\n\r\n    protected getPointFromInput(view: IView, text: string): SnapResult {\r\n        const dist = this.calculateDistance(Number(text));\r\n        const point = this.calculatePoint(dist);\r\n        return { view, point, distance: dist, shapes: [] };\r\n    }\r\n\r\n    private calculateDistance(inputValue: number): number {\r\n        return this.shouldReverse() ? -inputValue : inputValue;\r\n    }\r\n\r\n    private calculatePoint(distance: number): XYZ {\r\n        return this.data.point.add(this.data.direction.multiply(distance));\r\n    }\r\n\r\n    private shouldReverse() {\r\n        return (\r\n            this._snaped?.point &&\r\n            this._snaped.point.sub(this.data.point).dot(this.data.direction) < -Precision.Distance\r\n        );\r\n    }\r\n\r\n    protected inputError(text: string): I18nKeys | undefined {\r\n        return Number.isNaN(Number(text)) ? \"error.input.invalidNumber\" : undefined;\r\n    }\r\n}\r\n\r\nexport class SnapLengthAtPlaneHandler extends SnapEventHandler<SnapLengthAtPlaneData> {\r\n    private workplane: Plane | undefined;\r\n\r\n    constructor(\r\n        document: IDocument,\r\n        controller: AsyncController,\r\n        readonly lengthData: SnapLengthAtPlaneData,\r\n    ) {\r\n        const objectSnap = new ObjectSnap(Config.instance.snapType, lengthData.point);\r\n        const trackingSnap = new TrackingSnap(lengthData.point, false);\r\n        const planeSnap = new PlaneSnap(lengthData.plane, lengthData.point);\r\n        super(document, controller, [objectSnap, trackingSnap, planeSnap], lengthData);\r\n    }\r\n\r\n    protected override setSnaped(view: IView, event: PointerEvent): void {\r\n        super.setSnaped(view, event);\r\n        this.updateWorkplane();\r\n    }\r\n\r\n    private updateWorkplane() {\r\n        if (this._snaped) {\r\n            this.workplane = this.lengthData.plane(this._snaped.point);\r\n            this._snaped.plane = this.workplane;\r\n        }\r\n    }\r\n\r\n    protected getPointFromInput(view: IView, text: string): SnapResult {\r\n        const plane = this.workplane ?? view.workplane;\r\n        const point = this.calculatePoint(text, plane);\r\n        return { point, view, shapes: [], plane };\r\n    }\r\n\r\n    private calculatePoint(text: string, plane: Plane): XYZ {\r\n        const numbers = text.split(\",\").map(Number);\r\n        return numbers.length === 1\r\n            ? this.calculatePointFromDistance(numbers[0])\r\n            : this.calculatePointFromCoordinates(numbers, plane);\r\n    }\r\n\r\n    private calculatePointFromDistance(distance: number): XYZ {\r\n        const vector = this._snaped?.point!.sub(this.data.point()).normalize();\r\n        return this.data.point().add(vector!.multiply(distance));\r\n    }\r\n\r\n    private calculatePointFromCoordinates(coords: number[], plane: Plane): XYZ {\r\n        return this.data.point().add(plane.xvec.multiply(coords[0])).add(plane.yvec.multiply(coords[1]));\r\n    }\r\n\r\n    protected inputError(text: string): I18nKeys | undefined {\r\n        const numbers = text.split(\",\").map(Number);\r\n        if (numbers.some(Number.isNaN) || (numbers.length !== 1 && numbers.length !== 2)) {\r\n            return \"error.input.invalidNumber\";\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    Config,\r\n    I18nKeys,\r\n    ICurve,\r\n    IDocument,\r\n    IView,\r\n    Matrix4,\r\n    Plane,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { Dimension } from \"../dimension\";\r\nimport { SnapData, SnapResult } from \"../snap\";\r\nimport { ObjectSnap, PlaneSnap, PointOnCurveSnap, WorkplaneSnap } from \"../snaps\";\r\nimport { TrackingSnap } from \"../tracking\";\r\nimport { SnapEventHandler } from \"./snapEventHandler\";\r\n\r\nexport interface PointSnapData extends SnapData {\r\n    dimension?: Dimension;\r\n    refPoint?: () => XYZ;\r\n    plane?: () => Plane;\r\n}\r\n\r\nexport interface SnapPointOnCurveData extends PointSnapData {\r\n    curve: ICurve;\r\n}\r\n\r\nexport class PointSnapEventHandler extends SnapEventHandler<PointSnapData> {\r\n    constructor(document: IDocument, controller: AsyncController, pointData: PointSnapData) {\r\n        const objectSnap = new ObjectSnap(Config.instance.snapType, pointData.refPoint);\r\n        const workplaneSnap = pointData.plane\r\n            ? new PlaneSnap(pointData.plane, pointData.refPoint)\r\n            : new WorkplaneSnap(pointData.refPoint);\r\n        const trackingSnap = new TrackingSnap(pointData.refPoint, true);\r\n        super(document, controller, [objectSnap, trackingSnap, workplaneSnap], pointData);\r\n    }\r\n\r\n    protected getPointFromInput(view: IView, text: string): SnapResult {\r\n        const dims = this.parseInputDimensions(text);\r\n        const refPoint = this.getRefPoint() ?? XYZ.zero;\r\n        const result = { point: refPoint, view, shapes: [] };\r\n\r\n        if (dims.length === 1 && this._snaped?.point) {\r\n            result.point = this.calculatePointFromDistance(refPoint, dims[0]);\r\n        } else if (dims.length > 1) {\r\n            result.point = this.calculatePointFromCoordinates(refPoint, dims);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private parseInputDimensions(text: string): number[] {\r\n        return text.split(\",\").map(Number);\r\n    }\r\n\r\n    private calculatePointFromDistance(refPoint: XYZ, distance: number): XYZ {\r\n        const vector = this._snaped!.point!.sub(refPoint).normalize()!;\r\n        return refPoint.add(vector.multiply(distance));\r\n    }\r\n\r\n    private calculatePointFromCoordinates(refPoint: XYZ, dims: number[]): XYZ {\r\n        const plane = this.data.plane?.() ?? this.snaped!.view.workplane;\r\n        let point = refPoint.add(plane.xvec.multiply(dims[0])).add(plane.yvec.multiply(dims[1]));\r\n        if (dims.length === 3) {\r\n            point = point.add(plane.normal.multiply(dims[2]));\r\n        }\r\n        return point;\r\n    }\r\n\r\n    protected inputError(text: string): I18nKeys | undefined {\r\n        const dims = this.parseInputDimensions(text);\r\n        const dimension = Dimension.from(dims.length);\r\n\r\n        if (!this.isValidDimension(dimension)) return \"error.input.unsupportedInputs\";\r\n        if (this.hasInvalidNumbers(dims)) return \"error.input.invalidNumber\";\r\n        if (this.requiresThreeNumbers(dims)) return \"error.input.threeNumberCanBeInput\";\r\n        if (this.isInvalidSingleNumber(dims)) return \"error.input.cannotInputANumber\";\r\n\r\n        return undefined;\r\n    }\r\n\r\n    private isValidDimension(dimension: Dimension): boolean {\r\n        return Dimension.contains(this.data.dimension!, dimension);\r\n    }\r\n\r\n    private hasInvalidNumbers(dims: number[]): boolean {\r\n        return dims.some(Number.isNaN);\r\n    }\r\n\r\n    private requiresThreeNumbers(dims: number[]): boolean {\r\n        const refPoint = this.getRefPoint();\r\n        return refPoint === undefined && dims.length !== 3;\r\n    }\r\n\r\n    private isInvalidSingleNumber(dims: number[]): boolean {\r\n        const refPoint = this.getRefPoint();\r\n        return dims.length === 1 && refPoint! && (!this._snaped || this._snaped.point!.isEqualTo(refPoint));\r\n    }\r\n\r\n    private getRefPoint(): XYZ | undefined {\r\n        return this.data.refPoint?.() ?? this._snaped?.refPoint;\r\n    }\r\n}\r\n\r\nexport class SnapPointOnCurveEventHandler extends SnapEventHandler<SnapPointOnCurveData> {\r\n    constructor(document: IDocument, controller: AsyncController, pointData: SnapPointOnCurveData) {\r\n        const objectSnap = new ObjectSnap(Config.instance.snapType);\r\n        const snap = new PointOnCurveSnap(pointData);\r\n        const workplaneSnap = new WorkplaneSnap();\r\n        super(document, controller, [objectSnap, snap, workplaneSnap], pointData);\r\n    }\r\n\r\n    protected override getPointFromInput(view: IView, text: string): SnapResult {\r\n        const length = this.data.curve.length();\r\n        const parameter = Number(text) / length;\r\n        return { point: this.data.curve.value(parameter), view, shapes: [] };\r\n    }\r\n\r\n    protected override inputError(text: string) {\r\n        return Number.isNaN(Number(text)) ? \"error.input.invalidNumber\" : undefined;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, I18nKeys, IDocument, XYZ } from \"chili-core\";\r\nimport { SnapData, SnapEventHandler, SnapResult } from \"../snap\";\r\n\r\nexport interface IStep {\r\n    execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined>;\r\n}\r\n\r\nexport abstract class SnapStep<D extends SnapData> implements IStep {\r\n    constructor(\r\n        readonly tip: I18nKeys,\r\n        private readonly handleStepData: () => D,\r\n        private readonly keepSelected: boolean = false,\r\n    ) {}\r\n\r\n    async execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\r\n        if (!this.keepSelected) {\r\n            document.selection.clearSelection();\r\n            document.visual.highlighter.clear();\r\n        }\r\n\r\n        const data = this.handleStepData();\r\n        this.setValidator(data);\r\n\r\n        const executorHandler = this.getEventHandler(document, controller, data);\r\n        await document.selection.pickAsync(executorHandler, this.tip, controller, false, \"draw\");\r\n\r\n        return controller.result?.status === \"success\" ? executorHandler.snaped : undefined;\r\n    }\r\n\r\n    private setValidator(data: D) {\r\n        const oldValidator = data.validator;\r\n        data.validator = (point) => {\r\n            if (oldValidator) {\r\n                return oldValidator(point) && this.validator(data, point);\r\n            }\r\n            return this.validator(data, point);\r\n        };\r\n    }\r\n\r\n    protected abstract getEventHandler(\r\n        document: IDocument,\r\n        controller: AsyncController,\r\n        data: D,\r\n    ): SnapEventHandler;\r\n\r\n    protected abstract validator(data: D, point: XYZ): boolean;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, I18nKeys, IDocument, Precision, XYZ } from \"chili-core\";\r\n\r\nimport { AngleSnapEventHandler, Dimension, PointSnapData } from \"../snap\";\r\nimport { SnapStep } from \"./step\";\r\n\r\nfunction defaultSnapedData(): PointSnapData {\r\n    return {\r\n        dimension: Dimension.D1D2D3,\r\n    };\r\n}\r\n\r\nexport class AngleStep extends SnapStep<PointSnapData> {\r\n    constructor(\r\n        tip: I18nKeys,\r\n        private readonly handleCenter: () => XYZ,\r\n        private readonly handleP1: () => XYZ,\r\n        handleP2Data: () => PointSnapData = defaultSnapedData,\r\n        keepSelected = false,\r\n    ) {\r\n        super(tip, handleP2Data, keepSelected);\r\n    }\r\n\r\n    protected getEventHandler(document: IDocument, controller: AsyncController, data: PointSnapData) {\r\n        return new AngleSnapEventHandler(document, controller, this.handleCenter, this.handleP1(), data);\r\n    }\r\n\r\n    protected validator(data: PointSnapData, point: XYZ): boolean {\r\n        return data.refPoint === undefined || data.refPoint().distanceTo(point) > Precision.Distance;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, IDocument, Precision, XYZ } from \"chili-core\";\r\nimport {\r\n    LengthAtAxisSnapData,\r\n    SnapLengthAtAxisHandler,\r\n    SnapLengthAtPlaneData,\r\n    SnapLengthAtPlaneHandler,\r\n} from \"../snap\";\r\nimport { SnapStep } from \"./step\";\r\n\r\nexport class LengthAtAxisStep extends SnapStep<LengthAtAxisSnapData> {\r\n    protected getEventHandler(document: IDocument, controller: AsyncController, data: LengthAtAxisSnapData) {\r\n        return new SnapLengthAtAxisHandler(document, controller, data);\r\n    }\r\n\r\n    protected validator(data: LengthAtAxisSnapData, point: XYZ): boolean {\r\n        return Math.abs(point.sub(data.point).dot(data.direction)) > Precision.Distance;\r\n    }\r\n}\r\n\r\nexport class LengthAtPlaneStep extends SnapStep<SnapLengthAtPlaneData> {\r\n    protected getEventHandler(\r\n        document: IDocument,\r\n        controller: AsyncController,\r\n        data: SnapLengthAtPlaneData,\r\n    ) {\r\n        return new SnapLengthAtPlaneHandler(document, controller, data);\r\n    }\r\n\r\n    protected validator(data: SnapLengthAtPlaneData, point: XYZ): boolean {\r\n        const pointAtPlane = data.plane(point).project(point);\r\n        return pointAtPlane.distanceTo(data.point()) > Precision.Distance;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AsyncController, I18nKeys, IDocument, Precision, XYZ } from \"chili-core\";\r\nimport {\r\n    Dimension,\r\n    PointSnapData,\r\n    PointSnapEventHandler,\r\n    SnapPointOnCurveData,\r\n    SnapPointOnCurveEventHandler,\r\n} from \"../snap\";\r\nimport { SnapStep } from \"./step\";\r\n\r\nfunction defaultSnapedData(): PointSnapData {\r\n    return { dimension: Dimension.D1 | Dimension.D1D2D3 };\r\n}\r\n\r\nexport class PointStep extends SnapStep<PointSnapData> {\r\n    constructor(tip: I18nKeys, handleData: () => PointSnapData = defaultSnapedData, keepSelected = false) {\r\n        super(tip, handleData, keepSelected);\r\n    }\r\n\r\n    protected getEventHandler(document: IDocument, controller: AsyncController, data: PointSnapData) {\r\n        return new PointSnapEventHandler(document, controller, data);\r\n    }\r\n\r\n    protected validator(data: PointSnapData, point: XYZ): boolean {\r\n        return data.refPoint === undefined || data.refPoint().distanceTo(point) > Precision.Distance;\r\n    }\r\n}\r\n\r\nexport class PointOnCurveStep extends SnapStep<SnapPointOnCurveData> {\r\n    constructor(tip: I18nKeys, handleData: () => SnapPointOnCurveData, keepSelected = false) {\r\n        super(tip, handleData, keepSelected);\r\n    }\r\n\r\n    protected override validator(data: SnapPointOnCurveData, point: XYZ): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected override getEventHandler(\r\n        document: IDocument,\r\n        controller: AsyncController,\r\n        data: SnapPointOnCurveData,\r\n    ) {\r\n        return new SnapPointOnCurveEventHandler(document, controller, data);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    I18nKeys,\r\n    IDocument,\r\n    INodeFilter,\r\n    IShapeFilter,\r\n    ShapeNode,\r\n    ShapeType,\r\n    VisualState,\r\n} from \"chili-core\";\r\nimport { SnapResult } from \"../snap\";\r\nimport { IStep } from \"./step\";\r\n\r\nexport interface SelectShapeOptions {\r\n    multiple?: boolean;\r\n    nodeFilter?: INodeFilter;\r\n    shapeFilter?: IShapeFilter;\r\n    selectedState?: VisualState;\r\n    keepSelection?: boolean;\r\n}\r\n\r\nexport interface SelectNodeOptions {\r\n    multiple?: boolean;\r\n    filter?: INodeFilter;\r\n    keepSelection?: boolean;\r\n}\r\n\r\nexport abstract class SelectStep implements IStep {\r\n    constructor(\r\n        readonly snapeType: ShapeType,\r\n        readonly prompt: I18nKeys,\r\n        readonly options?: SelectShapeOptions,\r\n    ) {}\r\n\r\n    async execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\r\n        const { shapeType, shapeFilter } = document.selection;\r\n        document.selection.shapeType = this.snapeType;\r\n        document.selection.shapeFilter = this.options?.shapeFilter;\r\n        if (!this.options?.keepSelection) {\r\n            document.selection.clearSelection();\r\n            document.visual.highlighter.clear();\r\n        }\r\n        try {\r\n            return await this.select(document, controller);\r\n        } finally {\r\n            document.selection.shapeType = shapeType;\r\n            document.selection.shapeFilter = shapeFilter;\r\n        }\r\n    }\r\n\r\n    abstract select(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined>;\r\n}\r\n\r\nexport class SelectShapeStep extends SelectStep {\r\n    override async select(\r\n        document: IDocument,\r\n        controller: AsyncController,\r\n    ): Promise<SnapResult | undefined> {\r\n        const shapes = await document.selection.pickShape(\r\n            this.prompt,\r\n            controller,\r\n            this.options?.multiple === true,\r\n            this.options?.selectedState,\r\n        );\r\n        if (shapes.length === 0) return undefined;\r\n        return {\r\n            view: document.application.activeView!,\r\n            shapes,\r\n            nodes: shapes.map((x) => x.owner.node),\r\n        };\r\n    }\r\n}\r\n\r\nexport class SelectNodeStep implements IStep {\r\n    constructor(\r\n        readonly prompt: I18nKeys,\r\n        readonly options?: SelectNodeOptions,\r\n    ) {}\r\n\r\n    async execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\r\n        const { nodeFilter } = document.selection;\r\n        document.selection.nodeFilter = this.options?.filter;\r\n        if (!this.options?.keepSelection) {\r\n            document.selection.clearSelection();\r\n            document.visual.highlighter.clear();\r\n        }\r\n        try {\r\n            const nodes = await document.selection.pickNode(\r\n                this.prompt,\r\n                controller,\r\n                this.options?.multiple === true,\r\n            );\r\n            if (nodes.length === 0) return undefined;\r\n            return {\r\n                view: document.application.activeView!,\r\n                shapes: [],\r\n                nodes,\r\n            };\r\n        } finally {\r\n            document.selection.nodeFilter = nodeFilter;\r\n        }\r\n    }\r\n}\r\n\r\nexport class GetOrSelectNodeStep extends SelectNodeStep {\r\n    override execute(document: IDocument, controller: AsyncController): Promise<SnapResult | undefined> {\r\n        const selected = document.selection.getSelectedNodes().filter((x) => {\r\n            if (this.options?.filter?.allow) {\r\n                return this.options.filter.allow(x);\r\n            }\r\n\r\n            return true;\r\n        });\r\n\r\n        if (selected.length > 0) {\r\n            controller.success();\r\n            return Promise.resolve({\r\n                view: document.application.activeView!,\r\n                shapes: [],\r\n                nodes: selected as ShapeNode[],\r\n            });\r\n        }\r\n\r\n        return super.execute(document, controller);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    CancelableCommand,\r\n    Config,\r\n    EdgeMeshData,\r\n    IShape,\r\n    IShapeFactory,\r\n    IView,\r\n    LineType,\r\n    Property,\r\n    Result,\r\n    VertexMeshData,\r\n    VisualConfig,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { ViewUtils } from \"chili-vis\";\r\nimport { SnapResult } from \"../snap\";\r\nimport { IStep } from \"../step\";\r\n\r\nexport abstract class MultistepCommand extends CancelableCommand {\r\n    protected stepDatas: SnapResult[] = [];\r\n\r\n    @Property.define(\"option.command.repeat\")\r\n    get repeatOperation() {\r\n        return this.getPrivateValue(\"repeatOperation\", false);\r\n    }\r\n\r\n    set repeatOperation(value: boolean) {\r\n        this.setProperty(\"repeatOperation\", value);\r\n    }\r\n\r\n    protected canExcute(): Promise<boolean> {\r\n        return Promise.resolve(true);\r\n    }\r\n\r\n    protected async executeAsync(): Promise<void> {\r\n        if (!(await this.canExcute()) || !(await this.executeSteps())) {\r\n            return;\r\n        }\r\n\r\n        this.executeMainTask();\r\n\r\n        if (this.repeatOperation) {\r\n            this.resetSteps();\r\n            await this.executeAsync();\r\n        }\r\n    }\r\n\r\n    protected async executeSteps(): Promise<boolean> {\r\n        let steps = this.getSteps();\r\n        try {\r\n            while (this.stepDatas.length < steps.length) {\r\n                this.controller = new AsyncController();\r\n                let data = await steps[this.stepDatas.length].execute(this.document, this.controller);\r\n                if (data === undefined || this.controller.result?.status !== \"success\") {\r\n                    return false;\r\n                }\r\n                this.stepDatas.push(data);\r\n            }\r\n            return true;\r\n        } finally {\r\n            this.document.selection.clearSelection();\r\n            this.document.visual.highlighter.clear();\r\n        }\r\n    }\r\n\r\n    protected resetSteps() {\r\n        this.stepDatas.length = 0;\r\n    }\r\n\r\n    protected meshPoint(point: XYZ) {\r\n        return VertexMeshData.from(point, VisualConfig.editVertexSize, VisualConfig.editVertexColor);\r\n    }\r\n\r\n    protected meshLine(start: XYZ, end: XYZ, color = VisualConfig.defaultEdgeColor, lineWith?: number) {\r\n        const data = EdgeMeshData.from(start, end, color, LineType.Solid);\r\n        if (lineWith !== undefined) {\r\n            data.lineWidth = lineWith;\r\n        }\r\n        return data;\r\n    }\r\n\r\n    protected meshCreatedShape<K extends keyof IShapeFactory>(\r\n        method: K,\r\n        ...args: Parameters<IShapeFactory[K] extends (...args: any) => any ? IShapeFactory[K] : never>\r\n    ) {\r\n        const shape = (this.application.shapeFactory as any)[method](...args);\r\n        return this.meshShape(shape);\r\n    }\r\n\r\n    protected meshShape(shape: IShape | Result<IShape>, disposeShape = true) {\r\n        if (shape instanceof Result && !shape.isOk) {\r\n            throw shape.error;\r\n        }\r\n\r\n        const s = shape instanceof Result ? shape.value : shape;\r\n        const edgeMesh = s.edgesMeshPosition();\r\n        if (disposeShape) {\r\n            s.dispose();\r\n        }\r\n\r\n        return edgeMesh;\r\n    }\r\n\r\n    protected readonly findPlane = (view: IView, origin: XYZ, point: XYZ | undefined) => {\r\n        if (point === undefined || !Config.instance.dynamicWorkplane) {\r\n            return view.workplane.translateTo(origin);\r\n        }\r\n\r\n        return ViewUtils.raycastClosestPlane(view, origin, point);\r\n    };\r\n\r\n    protected transformdFirstShape(step: SnapResult, shouldDispose = true) {\r\n        const shape = step.shapes[0].shape.transformedMul(step.shapes[0].transform);\r\n        if (shouldDispose) this.disposeStack.add(shape);\r\n        return shape;\r\n    }\r\n\r\n    protected abstract getSteps(): IStep[];\r\n\r\n    protected abstract executeMainTask(): void;\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IShape, PubSub, Result, ShapeNode, ShapeType, Transaction, command } from \"chili-core\";\r\nimport { BooleanNode } from \"../bodys/boolean\";\r\nimport { IStep, SelectShapeStep } from \"../step\";\r\nimport { MultistepCommand } from \"./multistepCommand\";\r\n\r\nexport abstract class BooleanOperate extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, \"boolean\", () => {\r\n            const shape1 = this.transformdFirstShape(this.stepDatas[0]);\r\n            const shape2 = this.transformdFirstShape(this.stepDatas[1]);\r\n            const booleanType = this.getBooleanOperateType();\r\n\r\n            const booleanShape = this.getBooleanShape(booleanType, shape1, shape2);\r\n            if (!booleanShape.isOk) {\r\n                PubSub.default.pub(\"showToast\", \"error.default:{0}\", \"boolean failed\");\r\n                return;\r\n            }\r\n            const node = new BooleanNode(this.document, booleanShape.value);\r\n            this.document.rootNode.add(node);\r\n            this.stepDatas.forEach((x) => x.nodes?.[0]?.parent?.remove(x.nodes[0]));\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    private getBooleanShape(\r\n        type: \"common\" | \"cut\" | \"fuse\",\r\n        shape1: IShape,\r\n        shape2: IShape,\r\n    ): Result<IShape> {\r\n        switch (type) {\r\n            case \"common\":\r\n                return this.application.shapeFactory.booleanCommon(shape1, shape2);\r\n            case \"cut\":\r\n                return this.application.shapeFactory.booleanCut(shape1, shape2);\r\n            default:\r\n                return this.application.shapeFactory.booleanFuse(shape1, shape2);\r\n        }\r\n    }\r\n\r\n    protected abstract getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\";\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                nodeFilter: { allow: (node) => node instanceof ShapeNode },\r\n            }),\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                nodeFilter: {\r\n                    allow: (node) => {\r\n                        if (!(node instanceof ShapeNode)) {\r\n                            return false;\r\n                        }\r\n\r\n                        return !this.stepDatas[0].nodes\r\n                            ?.map((x) => (x as ShapeNode).shape.value)\r\n                            .includes(node.shape.value);\r\n                    },\r\n                },\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"boolean.common\",\r\n    icon: \"icon-booleanCommon\",\r\n})\r\nexport class BooleanCommon extends BooleanOperate {\r\n    protected override getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\" {\r\n        return \"common\";\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"boolean.cut\",\r\n    icon: \"icon-booleanCut\",\r\n})\r\nexport class BooleanCut extends BooleanOperate {\r\n    protected override getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\" {\r\n        return \"cut\";\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"boolean.join\",\r\n    icon: \"icon-booleanFuse\",\r\n})\r\nexport class BooleanFuse extends BooleanOperate {\r\n    protected override getBooleanOperateType(): \"common\" | \"cut\" | \"fuse\" {\r\n        return \"fuse\";\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IShape,\r\n    ParameterShapeNode,\r\n    Property,\r\n    Result,\r\n    Serializer,\r\n    XYZ,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"normal\", \"center\", \"start\", \"angle\"])\r\nexport class ArcNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.arc\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"circle.center\")\r\n    get center() {\r\n        return this.getPrivateValue(\"center\");\r\n    }\r\n    set center(center: XYZ) {\r\n        this.setPropertyEmitShapeChanged(\"center\", center);\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"arc.start\")\r\n    get start(): XYZ {\r\n        return this.getPrivateValue(\"start\");\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get normal(): XYZ {\r\n        return this.getPrivateValue(\"normal\");\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    @Property.define(\"arc.angle\")\r\n    get angle() {\r\n        return this.getPrivateValue(\"angle\");\r\n    }\r\n    set angle(value: number) {\r\n        this.setPropertyEmitShapeChanged(\"angle\", value);\r\n    }\r\n\r\n    constructor(document: IDocument, normal: XYZ, center: XYZ, start: XYZ, angle: number) {\r\n        super(document);\r\n        this.setPrivateValue(\"normal\", normal);\r\n        this.setPrivateValue(\"center\", center);\r\n        this.setPrivateValue(\"start\", start);\r\n        this.setPrivateValue(\"angle\", angle);\r\n    }\r\n\r\n    generateShape(): Result<IShape, string> {\r\n        return this.document.application.shapeFactory.arc(this.normal, this.center, this.start, this.angle);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Property, Transaction } from \"chili-core\";\r\nimport { MultistepCommand } from \"./multistepCommand\";\r\n\r\nlet count = 1;\r\n\r\nexport abstract class CreateCommand extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            let node = this.geometryNode();\r\n            this.document.addNode(node);\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected abstract geometryNode(): GeometryNode;\r\n}\r\n\r\nexport abstract class CreateNodeCommand extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            this.document.addNode(this.getNode());\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected abstract getNode(): GeometryNode;\r\n}\r\n\r\nexport abstract class CreateFaceableCommand extends CreateCommand {\r\n    protected _isFace: boolean = false;\r\n    @Property.define(\"option.command.isFace\")\r\n    public get isFace() {\r\n        return this._isFace;\r\n    }\r\n    public set isFace(value: boolean) {\r\n        this.setProperty(\"isFace\", value);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Plane, PlaneAngle, Precision, ShapeMeshData, XYZ, command } from \"chili-core\";\r\nimport { ArcNode } from \"../../bodys/arc\";\r\nimport { Dimension, SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { AngleStep, IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.arc\",\r\n    icon: \"icon-arc\",\r\n})\r\nexport class Arc extends CreateCommand {\r\n    private _planeAngle: PlaneAngle | undefined;\r\n\r\n    getSteps(): IStep[] {\r\n        return [\r\n            new PointStep(\"prompt.pickCircleCenter\"),\r\n            new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData),\r\n            new AngleStep(\r\n                \"prompt.pickNextPoint\",\r\n                () => this.stepDatas[0].point!,\r\n                () => this.stepDatas[1].point!,\r\n                this.getAngleData,\r\n            ),\r\n        ];\r\n    }\r\n\r\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\r\n        const { point, view } = this.stepDatas[0];\r\n        return {\r\n            point: () => point!,\r\n            preview: this.circlePreview,\r\n            plane: (p: XYZ | undefined) => this.findPlane(view, point!, p),\r\n            validator: (p: XYZ) => {\r\n                if (p.distanceTo(point!) < Precision.Distance) return false;\r\n                return p.sub(point!).isParallelTo(this.stepDatas[0].view.workplane.normal) === false;\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly getAngleData = () => {\r\n        const [center, p1] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\r\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, center, p1);\r\n        const points: ShapeMeshData[] = [this.meshPoint(center), this.meshPoint(p1)];\r\n        this._planeAngle = new PlaneAngle(new Plane(center, plane.normal, p1.sub(center)));\r\n        return {\r\n            dimension: Dimension.D1D2,\r\n            preview: (point: XYZ | undefined) => this.anglePreview(point, center, p1, points),\r\n            plane: () => plane,\r\n            validators: [this.angleValidator(center, plane)],\r\n        };\r\n    };\r\n\r\n    private anglePreview(\r\n        point: XYZ | undefined,\r\n        center: XYZ,\r\n        p1: XYZ,\r\n        points: ShapeMeshData[],\r\n    ): ShapeMeshData[] {\r\n        point = point ?? p1;\r\n        this._planeAngle!.movePoint(point);\r\n        const result = [...points];\r\n        if (Math.abs(this._planeAngle!.angle) > Precision.Angle) {\r\n            result.push(\r\n                this.meshCreatedShape(\r\n                    \"arc\",\r\n                    this._planeAngle!.plane.normal,\r\n                    center,\r\n                    p1,\r\n                    this._planeAngle!.angle,\r\n                ),\r\n            );\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private angleValidator(center: XYZ, plane: Plane) {\r\n        return (p: XYZ) =>\r\n            p.distanceTo(center) >= Precision.Distance && !p.sub(center).isParallelTo(plane.normal);\r\n    }\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const [p0, p1] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\r\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, p0, p1);\r\n        this._planeAngle?.movePoint(this.stepDatas[2].point!);\r\n        return new ArcNode(this.document, plane.normal, p0, p1, this._planeAngle!.angle);\r\n    }\r\n\r\n    private readonly circlePreview = (end: XYZ | undefined) => {\r\n        const visualCenter = this.meshPoint(this.stepDatas[0].point!);\r\n        if (!end) return [visualCenter];\r\n        const { point, view } = this.stepDatas[0];\r\n        const plane = this.findPlane(view, point!, end);\r\n        return [\r\n            visualCenter,\r\n            this.meshLine(this.stepDatas[0].point!, end),\r\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\r\n        ];\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    EdgeMeshData,\r\n    EditableShapeNode,\r\n    GeometryNode,\r\n    I18n,\r\n    LineType,\r\n    Precision,\r\n    ShapeMeshData,\r\n    VisualConfig,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\nimport { Dimension, PointSnapData, SnapResult } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.bezier\",\r\n    icon: \"icon-bezier\",\r\n})\r\nexport class BezierCommand extends CreateCommand {\r\n    protected override geometryNode(): GeometryNode {\r\n        let bezier = this.application.shapeFactory.bezier(this.stepDatas.map((x) => x.point!));\r\n        return new EditableShapeNode(this.document, I18n.translate(\"command.create.bezier\"), bezier.value);\r\n    }\r\n\r\n    protected override async executeSteps() {\r\n        const steps = this.getSteps();\r\n        let firstStep = true;\r\n        while (true) {\r\n            const step = firstStep ? steps[0] : steps[1];\r\n            if (firstStep) firstStep = false;\r\n            this.controller = new AsyncController();\r\n            const data = await step.execute(this.document, this.controller);\r\n            if (data === undefined) {\r\n                return this.controller.result?.status === \"success\";\r\n            }\r\n            this.stepDatas.push(data);\r\n            if (this.isClose(data)) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    private isClose(data: SnapResult) {\r\n        console.log(this.stepDatas[0].point!.distanceTo(data.point!));\r\n        return (\r\n            this.stepDatas.length > 1 &&\r\n            this.stepDatas[0].point!.distanceTo(data.point!) <= Precision.Distance\r\n        );\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\r\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getNextData);\r\n        return [firstStep, secondStep];\r\n    }\r\n\r\n    private readonly getNextData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas.at(-1)!.point!,\r\n            dimension: Dimension.D1D2D3,\r\n            validator: this.validator,\r\n            preview: this.preview,\r\n            featurePoints: [\r\n                {\r\n                    point: this.stepDatas.at(0)!.point!,\r\n                    prompt: I18n.translate(\"prompt.polygon.close\"),\r\n                    when: () => this.stepDatas.length > 2,\r\n                },\r\n            ],\r\n        };\r\n    };\r\n\r\n    private readonly preview = (point: XYZ | undefined): ShapeMeshData[] => {\r\n        let ps: ShapeMeshData[] = this.stepDatas.map((data) => this.meshPoint(data.point!));\r\n        let points = this.stepDatas.map((data) => data.point) as XYZ[];\r\n        if (point) {\r\n            points.push(point);\r\n        }\r\n        if (points.length > 1) {\r\n            ps.push(...this.previewLines(points));\r\n            ps.push(this.meshCreatedShape(\"bezier\", points));\r\n        }\r\n\r\n        return ps;\r\n    };\r\n\r\n    private readonly previewLines = (points: XYZ[]): ShapeMeshData[] => {\r\n        if (points.length < 2) {\r\n            return [];\r\n        }\r\n        let res: ShapeMeshData[] = [];\r\n        for (let i = 1; i < points.length; i++) {\r\n            res.push(this.meshHandle(points[i - 1], points[i]));\r\n        }\r\n        return res;\r\n    };\r\n\r\n    protected meshHandle(start: XYZ, end: XYZ) {\r\n        return EdgeMeshData.from(start, end, VisualConfig.temporaryEdgeColor, LineType.Dash);\r\n    }\r\n\r\n    private readonly validator = (point: XYZ): boolean => {\r\n        for (const data of this.stepDatas) {\r\n            if (point.distanceTo(data.point!) < 0.001) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Config, GeometryNode, MathUtils, Plane, Property, XYZ, command } from \"chili-core\";\r\nimport { ViewUtils } from \"chili-vis\";\r\nimport { RectNode } from \"../../bodys\";\r\nimport { SnapLengthAtPlaneData, SnapResult } from \"../../snap\";\r\nimport { IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\nexport interface RectData {\r\n    plane: Plane;\r\n    dx: number;\r\n    dy: number;\r\n    p1: XYZ;\r\n    p2: XYZ;\r\n}\r\n\r\nexport namespace RectData {\r\n    export function get(atPlane: Plane, start: XYZ, end: XYZ): RectData {\r\n        let plane = new Plane(start, atPlane.normal, atPlane.xvec);\r\n        let vector = end.sub(start);\r\n        let dx = vector.dot(plane.xvec);\r\n        let dy = vector.dot(plane.yvec);\r\n        return { plane, dx, dy, p1: start, p2: end };\r\n    }\r\n}\r\n\r\nexport abstract class RectCommandBase extends CreateCommand {\r\n    protected getSteps(): IStep[] {\r\n        return [\r\n            new PointStep(\"prompt.pickFistPoint\"),\r\n            new LengthAtPlaneStep(\"prompt.pickNextPoint\", this.nextSnapData),\r\n        ];\r\n    }\r\n\r\n    private readonly nextSnapData = (): SnapLengthAtPlaneData => {\r\n        const { point, view } = this.stepDatas[0];\r\n        return {\r\n            point: () => point!,\r\n            preview: this.previewRect,\r\n            plane: (tmp: XYZ | undefined) => this.findPlane(view, point!, tmp),\r\n            validator: this.handleValid,\r\n            prompt: (snaped: SnapResult) => {\r\n                let data = this.rectDataFromTemp(snaped.point!);\r\n                return `${data.dx.toFixed(2)}, ${data.dy.toFixed(2)}`;\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly handleValid = (end: XYZ) => {\r\n        const data = this.rectDataFromTemp(end);\r\n        return data !== undefined && !MathUtils.anyEqualZero(data.dx, data.dy);\r\n    };\r\n\r\n    protected previewRect = (end: XYZ | undefined) => {\r\n        if (end === undefined) return [this.meshPoint(this.stepDatas[0].point!)];\r\n        const { plane, dx, dy } = this.rectDataFromTemp(end);\r\n\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(end),\r\n            this.meshCreatedShape(\"rect\", plane, dx, dy),\r\n        ];\r\n    };\r\n\r\n    protected rectDataFromTemp(tmp: XYZ): RectData {\r\n        const { view, point } = this.stepDatas[0];\r\n        const plane = Config.instance.dynamicWorkplane\r\n            ? ViewUtils.raycastClosestPlane(view, point!, tmp)\r\n            : this.stepDatas[0].view.workplane.translateTo(point!);\r\n        return RectData.get(plane, point!, tmp);\r\n    }\r\n\r\n    protected rectDataFromTwoSteps() {\r\n        let rect: RectData;\r\n        if (this.stepDatas[1].plane) {\r\n            rect = RectData.get(this.stepDatas[1].plane, this.stepDatas[0].point!, this.stepDatas[1].point!);\r\n        } else {\r\n            rect = this.rectDataFromTemp(this.stepDatas[1].point!);\r\n        }\r\n        return rect;\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"create.rect\",\r\n    icon: \"icon-rect\",\r\n})\r\nexport class Rect extends RectCommandBase {\r\n    @Property.define(\"option.command.isFace\")\r\n    public get isFace() {\r\n        return this.getPrivateValue(\"isFace\", false);\r\n    }\r\n    public set isFace(value: boolean) {\r\n        this.setProperty(\"isFace\", value);\r\n    }\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const { plane, dx, dy } = this.rectDataFromTwoSteps();\r\n        const node = new RectNode(this.document, plane, dx, dy);\r\n        node.isFace = this.isFace;\r\n        return node;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Plane, Precision, XYZ, command } from \"chili-core\";\r\nimport { BoxNode } from \"../../bodys\";\r\nimport { LengthAtAxisSnapData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep } from \"../../step\";\r\nimport { RectCommandBase } from \"./rect\";\r\n\r\n@command({\r\n    key: \"create.box\",\r\n    icon: \"icon-box\",\r\n})\r\nexport class Box extends RectCommandBase {\r\n    protected override getSteps(): IStep[] {\r\n        let steps = super.getSteps();\r\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\r\n        return [...steps, third];\r\n    }\r\n\r\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\r\n        const plane = this.stepDatas[1].plane;\r\n        if (plane === undefined) {\r\n            throw new Error(\"plane is undefined, please report bug\");\r\n        }\r\n        return {\r\n            point: this.stepDatas[1].point!,\r\n            direction: plane.normal,\r\n            preview: this.previewBox,\r\n        };\r\n    };\r\n\r\n    private readonly previewBox = (end: XYZ | undefined) => {\r\n        if (!end) {\r\n            return this.previewRect(this.stepDatas[1].point);\r\n        }\r\n\r\n        const { plane, dx, dy } = this.rectDataFromTwoSteps();\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(this.stepDatas[1].point!),\r\n            this.meshCreatedShape(\"box\", plane, dx, dy, this.getHeight(plane, end)),\r\n        ];\r\n    };\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const rect = this.rectDataFromTwoSteps();\r\n        const dz = this.getHeight(rect.plane, this.stepDatas[2].point!);\r\n        return new BoxNode(this.document, rect.plane, rect.dx, rect.dy, dz);\r\n    }\r\n\r\n    private getHeight(plane: Plane, point: XYZ): number {\r\n        const h = point.sub(this.stepDatas[1].point!).dot(plane.normal);\r\n        if (Math.abs(h) < Precision.Distance) {\r\n            return h < 0 ? -0.00001 : 0.00001;\r\n        }\r\n        return h;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Precision, XYZ, command } from \"chili-core\";\r\nimport { CircleNode } from \"../../bodys\";\r\nimport { SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateFaceableCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.circle\",\r\n    icon: \"icon-circle\",\r\n})\r\nexport class Circle extends CreateFaceableCommand {\r\n    getSteps(): IStep[] {\r\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\r\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\r\n        return [centerStep, radiusStep];\r\n    }\r\n\r\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\r\n        const { point, view } = this.stepDatas[0];\r\n        return {\r\n            point: () => point!,\r\n            preview: this.circlePreview,\r\n            plane: (tmp: XYZ | undefined) => this.findPlane(view, point!, tmp),\r\n            validator: (p: XYZ) => {\r\n                if (p.distanceTo(point!) < Precision.Distance) return false;\r\n                const plane = this.findPlane(view, point!, p);\r\n                return p.sub(point!).isParallelTo(plane.normal) === false;\r\n            },\r\n        };\r\n    };\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const [p1, p2] = [this.stepDatas[0].point!, this.stepDatas[1].point!];\r\n        const plane = this.stepDatas[1].plane ?? this.findPlane(this.stepDatas[1].view, p1, p2);\r\n        const body = new CircleNode(this.document, plane.normal, p1, plane.projectDistance(p1, p2));\r\n        body.isFace = this.isFace;\r\n        return body;\r\n    }\r\n\r\n    private readonly circlePreview = (end: XYZ | undefined) => {\r\n        if (!end) return [this.meshPoint(this.stepDatas[0].point!)];\r\n\r\n        const { point, view } = this.stepDatas[0];\r\n        const plane = this.findPlane(view, point!, end);\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshLine(point!, end),\r\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\r\n        ];\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EdgeMeshData,\r\n    GeometryNode,\r\n    LineType,\r\n    Plane,\r\n    Precision,\r\n    VisualConfig,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\nimport { ConeNode } from \"../../bodys\";\r\nimport { LengthAtAxisSnapData, SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.cone\",\r\n    icon: \"icon-cone\",\r\n})\r\nexport class Cone extends CreateCommand {\r\n    protected override getSteps(): IStep[] {\r\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\r\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\r\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\r\n        return [centerStep, radiusStep, third];\r\n    }\r\n\r\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\r\n        const point = this.stepDatas[0].point!;\r\n        return {\r\n            point: () => point,\r\n            preview: this.circlePreview,\r\n            plane: (p: XYZ | undefined) => this.findPlane(this.stepDatas[0].view, point, p),\r\n            validator: (p: XYZ) => {\r\n                if (p.distanceTo(point) < Precision.Distance) return false;\r\n                const plane = this.findPlane(this.stepDatas[0].view, point, p);\r\n                return p.sub(point).isParallelTo(plane.normal) === false;\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly circlePreview = (point: XYZ | undefined) => {\r\n        if (!point) return [this.meshPoint(this.stepDatas[0].point!)];\r\n\r\n        const start = this.stepDatas[0].point!;\r\n        const plane = this.findPlane(this.stepDatas[0].view, start, point);\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshLine(start, point),\r\n            this.meshCreatedShape(\"circle\", plane.normal, start, plane.projectDistance(start, point)),\r\n        ];\r\n    };\r\n\r\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\r\n        return {\r\n            point: this.stepDatas[0].point!,\r\n            direction: this.stepDatas[1].plane!.normal,\r\n            preview: this.previewCone,\r\n        };\r\n    };\r\n\r\n    private readonly previewCone = (end: XYZ | undefined) => {\r\n        if (!end) {\r\n            return this.circlePreview(this.stepDatas[1].point);\r\n        }\r\n        const center = this.stepDatas[0].point!;\r\n        const p1Visual = this.meshPoint(center);\r\n        const plane = this.stepDatas[1].plane!;\r\n        const radius = plane.projectDistance(center, this.stepDatas[1].point!);\r\n        const up = center.add(plane.normal.multiply(this.getHeight(plane, end)));\r\n        return [\r\n            p1Visual,\r\n            this.meshCreatedShape(\"circle\", plane.normal, center, radius),\r\n            this.meshLine(center.add(plane.xvec.multiply(radius)), up),\r\n            this.meshLine(center.add(plane.xvec.multiply(-radius)), up),\r\n            this.meshLine(center.add(plane.yvec.multiply(radius)), up),\r\n            this.meshLine(center.add(plane.yvec.multiply(-radius)), up),\r\n        ];\r\n    };\r\n\r\n    protected override meshLine(start: XYZ, end: XYZ) {\r\n        return EdgeMeshData.from(start, end, VisualConfig.defaultEdgeColor, LineType.Solid);\r\n    }\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const plane = this.stepDatas[1].plane!;\r\n        const radius = plane.projectDistance(this.stepDatas[0].point!, this.stepDatas[1].point!);\r\n        const height = this.getHeight(plane, this.stepDatas[2].point!);\r\n        return new ConeNode(\r\n            this.document,\r\n            height < 0 ? plane.normal.reverse() : plane.normal,\r\n            this.stepDatas[0].point!,\r\n            radius,\r\n            Math.abs(height),\r\n        );\r\n    }\r\n\r\n    private getHeight(plane: Plane, point: XYZ): number {\r\n        return point.sub(this.stepDatas[0].point!).dot(plane.normal);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    I18nKeys,\r\n    IDocument,\r\n    IEdge,\r\n    IShape,\r\n    IWire,\r\n    ParameterShapeNode,\r\n    Result,\r\n    Serializer,\r\n    ShapeType,\r\n} from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"shapes\"])\r\nexport class FaceNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.face\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get shapes(): IEdge[] | IWire[] {\r\n        return this.getPrivateValue(\"shapes\");\r\n    }\r\n    set shapes(values: IEdge[] | IWire[]) {\r\n        this.setPropertyEmitShapeChanged(\"shapes\", values);\r\n    }\r\n\r\n    constructor(document: IDocument, shapes: IEdge[] | IWire[]) {\r\n        super(document);\r\n        this.setPrivateValue(\"shapes\", shapes);\r\n    }\r\n\r\n    private isAllClosed(): boolean {\r\n        return this.shapes.every((shape) => shape.isClosed() || shape.shapeType === ShapeType.Wire);\r\n    }\r\n\r\n    private getWires(): IWire[] {\r\n        let wires: IWire[] = [];\r\n        if (this.isAllClosed()) {\r\n            this.addClosedEdges(wires, this.shapes as IEdge[]);\r\n        } else {\r\n            this.addUnclosedEdges(wires, this.shapes as IEdge[]);\r\n        }\r\n\r\n        for (let i = 1; i < wires.length; i++) {\r\n            wires[i].reserve();\r\n        }\r\n\r\n        return wires;\r\n    }\r\n\r\n    private addClosedEdges(wires: IWire[], edges: IEdge[]): void {\r\n        for (const shape of this.shapes) {\r\n            if (shape.shapeType === ShapeType.Wire) {\r\n                wires.push(shape as IWire);\r\n            } else {\r\n                this.addUnclosedEdges(wires, [shape as IEdge]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private addUnclosedEdges(wires: IWire[], edges: IEdge[]): void {\r\n        let wire = this.document.application.shapeFactory.wire(edges);\r\n        if (!wire.isOk) throw new Error(\"Cannot create wire from open shapes\");\r\n        wires.push(wire.value);\r\n    }\r\n\r\n    override generateShape(): Result<IShape> {\r\n        if (this.shapes.length === 0) return Result.err(\"No shapes to create face\");\r\n\r\n        let wires = this.getWires();\r\n        return this.document.application.shapeFactory.face(wires);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { I18nKeys, IDocument, IEdge, IShape, ParameterShapeNode, Result, Serializer } from \"chili-core\";\r\n\r\n@Serializer.register([\"document\", \"edges\"])\r\nexport class WireNode extends ParameterShapeNode {\r\n    override display(): I18nKeys {\r\n        return \"body.wire\";\r\n    }\r\n\r\n    @Serializer.serialze()\r\n    get edges(): IEdge[] {\r\n        return this.getPrivateValue(\"edges\");\r\n    }\r\n    set edges(values: IEdge[]) {\r\n        this.setPropertyEmitShapeChanged(\"edges\", values);\r\n    }\r\n\r\n    constructor(document: IDocument, edges: IEdge[]) {\r\n        super(document);\r\n        this.setPrivateValue(\"edges\", edges);\r\n    }\r\n\r\n    override generateShape(): Result<IShape> {\r\n        return this.document.application.shapeFactory.wire(this.edges);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    CancelableCommand,\r\n    EditableShapeNode,\r\n    GeometryNode,\r\n    IDocument,\r\n    IEdge,\r\n    IFace,\r\n    INode,\r\n    IShape,\r\n    IShapeFilter,\r\n    IShell,\r\n    PubSub,\r\n    Result,\r\n    ShapeNode,\r\n    ShapeNodeFilter,\r\n    ShapeType,\r\n    Transaction,\r\n    command,\r\n} from \"chili-core\";\r\nimport { FaceNode } from \"../../bodys/face\";\r\nimport { WireNode } from \"../../bodys/wire\";\r\nimport { SelectNodeStep } from \"../../step\";\r\n\r\nabstract class ConvertCommand extends CancelableCommand {\r\n    async executeAsync(): Promise<void> {\r\n        const models = await this.getOrPickModels(this.document);\r\n        if (!models) {\r\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\r\n            return;\r\n        }\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const node = this.create(this.document, models);\r\n            if (!node.isOk) {\r\n                PubSub.default.pub(\"showToast\", \"toast.converter.error\");\r\n            } else {\r\n                this.document.rootNode.add(node.value);\r\n                this.document.visual.update();\r\n                PubSub.default.pub(\"showToast\", \"toast.success\");\r\n            }\r\n\r\n            models.forEach((x) => x.parent?.remove(x));\r\n        });\r\n    }\r\n\r\n    protected abstract create(document: IDocument, models: INode[]): Result<GeometryNode>;\r\n    protected shapeFilter(): IShapeFilter {\r\n        return {\r\n            allow: (shape: IShape) =>\r\n                shape.shapeType === ShapeType.Edge || shape.shapeType === ShapeType.Wire,\r\n        };\r\n    }\r\n\r\n    async getOrPickModels(document: IDocument) {\r\n        const filter = this.shapeFilter();\r\n        let models = this._getSelectedModels(document, filter);\r\n        document.selection.clearSelection();\r\n        if (models.length > 0) return models;\r\n\r\n        const step = new SelectNodeStep(\"prompt.select.models\", {\r\n            filter: new ShapeNodeFilter(filter),\r\n            multiple: true,\r\n        });\r\n        this.controller = new AsyncController();\r\n        const data = await step.execute(document, this.controller);\r\n        document.selection.clearSelection();\r\n        return data?.nodes;\r\n    }\r\n\r\n    private _getSelectedModels(document: IDocument, filter?: IShapeFilter) {\r\n        return document.selection\r\n            .getSelectedNodes()\r\n            .map((x) => x as ShapeNode)\r\n            .filter((x) => {\r\n                if (x === undefined) return false;\r\n                let shape = x.shape.value;\r\n                if (shape === undefined) return false;\r\n                if (filter !== undefined && !filter.allow(shape)) return false;\r\n                return true;\r\n            });\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"convert.toWire\",\r\n    icon: \"icon-toPoly\",\r\n})\r\nexport class ConvertToWire extends ConvertCommand {\r\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\r\n        const edges = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IEdge[];\r\n        const wireBody = new WireNode(document, edges);\r\n        const shape = wireBody.generateShape();\r\n        if (!shape.isOk) return Result.err(shape.error);\r\n\r\n        return Result.ok(wireBody);\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"convert.toFace\",\r\n    icon: \"icon-toFace\",\r\n})\r\nexport class ConvertToFace extends ConvertCommand {\r\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\r\n        const edges = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IEdge[];\r\n        const wireBody = new FaceNode(document, edges);\r\n        const shape = wireBody.generateShape();\r\n        if (!shape.isOk) return Result.err(shape.error);\r\n\r\n        return Result.ok(wireBody);\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"convert.toShell\",\r\n    icon: \"icon-toShell\",\r\n})\r\nexport class ConvertToShell extends ConvertCommand {\r\n    protected override shapeFilter(): IShapeFilter {\r\n        return {\r\n            allow: (shape: IShape) => shape.shapeType === ShapeType.Face,\r\n        };\r\n    }\r\n\r\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\r\n        const faces = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IFace[];\r\n        const shape = this.application.shapeFactory.shell(faces);\r\n        faces.forEach((x) => x.dispose());\r\n        if (!shape.isOk) return Result.err(shape.error);\r\n\r\n        const shell = new EditableShapeNode(document, \"shell\", shape);\r\n        return Result.ok(shell);\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"convert.toSolid\",\r\n    icon: \"icon-toSolid\",\r\n})\r\nexport class ConvertToSolid extends ConvertCommand {\r\n    protected override shapeFilter(): IShapeFilter {\r\n        return {\r\n            allow: (shape: IShape) => shape.shapeType === ShapeType.Shell,\r\n        };\r\n    }\r\n\r\n    protected override create(document: IDocument, models: ShapeNode[]): Result<GeometryNode> {\r\n        const faces = models.map((x) => x.shape.value.transformedMul(x.worldTransform())) as IShell[];\r\n        const shape = this.application.shapeFactory.solid(faces);\r\n        faces.forEach((x) => x.dispose());\r\n        if (!shape.isOk) return Result.err(shape.error);\r\n\r\n        const solid = new EditableShapeNode(document, \"solid\", shape);\r\n        return Result.ok(solid);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { EditableShapeNode, PubSub, ShapeType, Transaction, command } from \"chili-core\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"create.copyShape\",\r\n    icon: \"icon-subShape\",\r\n})\r\nexport class CopySubShapeCommand extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            this.stepDatas[0].shapes.forEach((x) => {\r\n                const subShape = x.shape.clone();\r\n                const model = new EditableShapeNode(\r\n                    this.document,\r\n                    ShapeType.stringValue(subShape.shapeType),\r\n                    subShape,\r\n                );\r\n\r\n                const node = x.owner.node;\r\n                model.transform = node.transform;\r\n                node.parent!.insertAfter(node, model);\r\n            });\r\n            this.document.visual.update();\r\n            PubSub.default.pub(\"showToast\", \"toast.success\");\r\n        });\r\n    }\r\n\r\n    protected override getSteps() {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Face, \"prompt.select.shape\", { multiple: true }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Plane, Precision, XYZ, command } from \"chili-core\";\r\nimport { CylinderNode } from \"../../bodys\";\r\nimport { LengthAtAxisSnapData, SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.cylinder\",\r\n    icon: \"icon-cylinder\",\r\n})\r\nexport class Cylinder extends CreateCommand {\r\n    protected override getSteps(): IStep[] {\r\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\r\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\r\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\r\n        return [centerStep, radiusStep, third];\r\n    }\r\n\r\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\r\n        const { point, view } = this.stepDatas[0];\r\n        return {\r\n            point: () => point!,\r\n            preview: this.circlePreview,\r\n            plane: (tmp: XYZ | undefined) => this.findPlane(view, point!, tmp),\r\n            validator: (p: XYZ) => {\r\n                if (p.distanceTo(point!) < Precision.Distance) return false;\r\n                const plane = this.findPlane(view, point!, p);\r\n                return p.sub(point!).isParallelTo(plane.normal) === false;\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly circlePreview = (point: XYZ | undefined) => {\r\n        if (!point) return [this.meshPoint(this.stepDatas[0].point!)];\r\n\r\n        const start = this.stepDatas[0].point!;\r\n        const plane = this.findPlane(this.stepDatas[0].view, start, point);\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshLine(start, point),\r\n            this.meshCreatedShape(\"circle\", plane.normal, start, plane.projectDistance(start, point)),\r\n        ];\r\n    };\r\n\r\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\r\n        return {\r\n            point: this.stepDatas[0].point!,\r\n            direction: this.stepDatas[1].plane!.normal,\r\n            preview: this.previewCylinder,\r\n            validator: (p: XYZ) => {\r\n                return Math.abs(this.getHeight(this.stepDatas[1].plane!, p)) > 0.001;\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly previewCylinder = (end: XYZ | undefined) => {\r\n        if (!end) {\r\n            return this.circlePreview(this.stepDatas[1].point);\r\n        }\r\n\r\n        const plane = this.stepDatas[1].plane!;\r\n        const radius = plane.projectDistance(this.stepDatas[0].point!, this.stepDatas[1].point!);\r\n        const height = this.getHeight(plane, end);\r\n\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshCreatedShape(\r\n                \"cylinder\",\r\n                height < 0 ? plane.normal.reverse() : plane.normal,\r\n                this.stepDatas[0].point!,\r\n                radius,\r\n                Math.abs(height),\r\n            ),\r\n        ];\r\n    };\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const plane = this.stepDatas[1].plane!;\r\n        const radius = plane.projectDistance(this.stepDatas[0].point!, this.stepDatas[1].point!);\r\n        const dz = this.getHeight(plane, this.stepDatas[2].point!);\r\n        return new CylinderNode(\r\n            this.document,\r\n            dz < 0 ? plane.normal.reverse() : plane.normal,\r\n            this.stepDatas[0].point!,\r\n            radius,\r\n            Math.abs(dz),\r\n        );\r\n    }\r\n\r\n    private getHeight(plane: Plane, point: XYZ): number {\r\n        return point.sub(this.stepDatas[0].point!).dot(plane.normal);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Precision, XYZ, command } from \"chili-core\";\r\nimport { EllipseNode } from \"../../bodys/ellipse\";\r\nimport { LengthAtAxisSnapData, SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateFaceableCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.ellipse\",\r\n    icon: \"icon-ellipse\",\r\n})\r\nexport class Ellipse extends CreateFaceableCommand {\r\n    getSteps(): IStep[] {\r\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\r\n        let radiusStepX = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadius1Data);\r\n        let radiusStepY = new LengthAtAxisStep(\"prompt.pickRadius\", this.getRadius2Data);\r\n        return [centerStep, radiusStepX, radiusStepY];\r\n    }\r\n\r\n    private readonly getRadius1Data = (): SnapLengthAtPlaneData => {\r\n        const point = this.stepDatas[0].point!;\r\n        return {\r\n            point: () => point,\r\n            preview: this.previewCircle,\r\n            plane: (tmp: XYZ | undefined) => this.findPlane(this.stepDatas[0].view, point, tmp),\r\n            validator: this.validatePoint,\r\n        };\r\n    };\r\n\r\n    private readonly validatePoint = (point: XYZ) => {\r\n        const center = this.stepDatas[0].point!;\r\n        if (point.distanceTo(center) < Precision.Distance) return false;\r\n        const plane = this.findPlane(this.stepDatas[0].view, center, point);\r\n        return point.sub(center).isParallelTo(plane.normal) === false;\r\n    };\r\n\r\n    protected previewCircle = (end: XYZ | undefined) => {\r\n        if (end === undefined) return [this.meshPoint(this.stepDatas[0].point!)];\r\n\r\n        const plane = this.findPlane(this.stepDatas[0].view, this.stepDatas[0].point!, end);\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(end),\r\n            this.meshCreatedShape(\r\n                \"circle\",\r\n                plane.normal,\r\n                this.stepDatas[0].point!,\r\n                end.distanceTo(this.stepDatas[0].point!),\r\n            ),\r\n        ];\r\n    };\r\n\r\n    private readonly getRadius2Data = (): LengthAtAxisSnapData => {\r\n        const point = this.stepDatas[0].point!;\r\n        const plane = this.stepDatas[1].plane!;\r\n        const direction = plane.normal.cross(this.stepDatas[1].point!.sub(point)).normalize()!;\r\n        return {\r\n            point: point,\r\n            preview: this.ellipsePreview,\r\n            direction,\r\n            validator: this.validatePoint,\r\n        };\r\n    };\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const [p0, p1, p2] = [this.stepDatas[0].point!, this.stepDatas[1].point!, this.stepDatas[2].point!];\r\n        const plane = this.stepDatas[1].plane!;\r\n        const d1 = plane.projectDistance(p0, p1);\r\n        const d2 = plane.projectDistance(p0, p2);\r\n        const body = new EllipseNode(this.document, plane.normal, p0, p1.sub(p0), d1, d2 > d1 ? d1 : d2);\r\n        return body;\r\n    }\r\n\r\n    private readonly ellipsePreview = (point: XYZ | undefined) => {\r\n        if (!point) return this.previewCircle(this.stepDatas[1].point);\r\n\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(this.stepDatas[1].point!),\r\n            this.createEllipse(point),\r\n        ];\r\n    };\r\n\r\n    private createEllipse(p2: XYZ) {\r\n        const p0 = this.stepDatas[0].point!;\r\n        const p1 = this.stepDatas[1].point!;\r\n        const plane = this.stepDatas[1].plane!;\r\n\r\n        const d1 = plane.projectDistance(p0, p1);\r\n        const d2 = plane.projectDistance(p0, p2);\r\n        return this.meshCreatedShape(\"ellipse\", plane.normal, p0, p1.sub(p0), d1, d2 > d1 ? d1 : d2);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, IFace, Precision, ShapeType, command } from \"chili-core\";\r\nimport { PrismNode } from \"../../bodys\";\r\nimport { LengthAtAxisSnapData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"convert.fuse\",\r\n    icon: \"icon-circle\",\r\n})\r\nexport class Fuse extends CreateCommand {\r\n    protected override geometryNode(): GeometryNode {\r\n        let shape = this.stepDatas[0].shapes[0].shape as IFace; // todo assert\r\n        let [point, normal] = shape.normal(0, 0);\r\n        let dist = this.stepDatas[1].point!.sub(point).dot(normal);\r\n        return new PrismNode(this.document, shape, dist);\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\"),\r\n            new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getLengthStepData),\r\n        ];\r\n    }\r\n\r\n    private getLengthStepData = (): LengthAtAxisSnapData => {\r\n        let shape = this.stepDatas[0].shapes[0].shape as IFace; // todo assert\r\n        let [point, normal] = shape.normal(0, 0);\r\n        return {\r\n            point,\r\n            direction: normal,\r\n            preview: (p) => {\r\n                if (!p) return [];\r\n                let dist = p.sub(point).dot(normal);\r\n                if (Math.abs(dist) < Precision.Float) return [];\r\n                let vec = normal.multiply(dist);\r\n                return [this.application.shapeFactory.prism(shape, vec).value.mesh.edges!];\r\n            },\r\n        };\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { button, div, input, label, XYZConverter } from \"chili-controls\";\r\nimport {\r\n    AsyncController,\r\n    Binding,\r\n    command,\r\n    Component,\r\n    ComponentNode,\r\n    DialogResult,\r\n    IApplication,\r\n    ICommand,\r\n    IDocument,\r\n    Localize,\r\n    Observable,\r\n    PubSub,\r\n    Transaction,\r\n    VisualNode,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { GetOrSelectNodeStep, IStep, PointStep } from \"../../step\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\nclass GroupDefinition extends Observable {\r\n    get name() {\r\n        return this.getPrivateValue(\"name\", \"unnamed\");\r\n    }\r\n    set name(value: string) {\r\n        this.setProperty(\"name\", value);\r\n    }\r\n\r\n    get insert() {\r\n        return this.getPrivateValue(\"insert\", XYZ.zero);\r\n    }\r\n    set insert(value: XYZ) {\r\n        this.setProperty(\"insert\", value);\r\n    }\r\n\r\n    get convertInstance() {\r\n        return this.getPrivateValue(\"convertInstance\", true);\r\n    }\r\n    set convertInstance(value: boolean) {\r\n        this.setProperty(\"convertInstance\", value);\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"create.group\",\r\n    icon: \"icon-group\",\r\n})\r\nexport class GroupCommand extends MultistepCommand {\r\n    protected override getSteps(): IStep[] {\r\n        return [new GetOrSelectNodeStep(\"prompt.select.shape\", { multiple: true })];\r\n    }\r\n\r\n    protected override executeMainTask(): void {\r\n        const nodes = this.stepDatas[0].nodes?.filter((node) => node instanceof VisualNode);\r\n        if (!nodes || nodes.length === 0) {\r\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\r\n            return;\r\n        }\r\n\r\n        let definition = new GroupDefinition();\r\n\r\n        PubSub.default.pub(\"showDialog\", \"command.create.group\", this.dialog(definition), (r) => {\r\n            if (r === DialogResult.ok) this.createGroup(definition, nodes);\r\n        });\r\n    }\r\n\r\n    private createGroup(definition: GroupDefinition, nodes: VisualNode[]) {\r\n        Transaction.execute(this.document, \"create group\", () => {\r\n            for (const node of nodes) {\r\n                const worldTransform = node.worldTransform();\r\n                node.parent?.transfer(node);\r\n                node.transform = worldTransform;\r\n            }\r\n\r\n            const component = new Component(definition.name, this.stepDatas[0].nodes!, definition.insert);\r\n            this.document.components.push(component);\r\n\r\n            if (definition.convertInstance) {\r\n                const group = new ComponentNode(\r\n                    this.document,\r\n                    definition.name,\r\n                    component.id,\r\n                    component.origin,\r\n                );\r\n                this.document.rootNode.add(group);\r\n            }\r\n        });\r\n    }\r\n\r\n    private readonly pickInsertPoint = async (definition: GroupDefinition, e: MouseEvent) => {\r\n        const dialog = this.findDialog(e.target as HTMLElement);\r\n        if (!dialog) return;\r\n        dialog.close();\r\n\r\n        const command = new PickInsertPointCommand(this.document, definition);\r\n        try {\r\n            if (this.document.application.executingCommand) {\r\n                throw new Error(\"Command is executing\");\r\n            }\r\n            this.document.application.executingCommand = command;\r\n            await command.execute(this.document.application);\r\n        } finally {\r\n            dialog.showModal();\r\n            this.document.application.executingCommand = undefined;\r\n        }\r\n    };\r\n\r\n    private readonly findDialog = (e: HTMLElement): HTMLDialogElement | undefined => {\r\n        if (e instanceof HTMLDialogElement) return e;\r\n        if (!e.parentElement) return undefined;\r\n\r\n        return this.findDialog(e.parentElement);\r\n    };\r\n\r\n    private dialog(definition: GroupDefinition) {\r\n        return div(\r\n            {\r\n                style: {\r\n                    display: \"flex\",\r\n                    flexDirection: \"column\",\r\n                    gap: \"10px\",\r\n                },\r\n            },\r\n            label(\r\n                {\r\n                    textContent: new Localize(\"common.name\"),\r\n                },\r\n                \": \",\r\n            ),\r\n            input({\r\n                value: new Binding(definition, \"name\"),\r\n                onkeydown: (e) => {\r\n                    e.stopPropagation();\r\n                },\r\n                onblur: (e) => {\r\n                    definition.name = (e.target as HTMLInputElement).value;\r\n                },\r\n            }),\r\n            label(\r\n                {\r\n                    textContent: new Localize(\"option.command.insertPoint\"),\r\n                },\r\n                \": \",\r\n            ),\r\n            div(\r\n                {\r\n                    style: {\r\n                        display: \"inline-flex\",\r\n                        flexDirection: \"row\",\r\n                        padding: \"10px\",\r\n                        backgroundColor: \"#eee\",\r\n                        borderRadius: \"5px\",\r\n                        gap: \"6px\",\r\n                    },\r\n                },\r\n                input({\r\n                    value: new Binding(definition, \"insert\", new XYZConverter()),\r\n                    onkeydown: (e) => {\r\n                        e.stopPropagation();\r\n                    },\r\n                }),\r\n                button({\r\n                    textContent: new Localize(\"option.command.insertPoint\"),\r\n                    onclick: (e) => this.pickInsertPoint(definition, e),\r\n                }),\r\n            ),\r\n            div(\r\n                input({\r\n                    type: \"checkbox\",\r\n                    id: \"instanceID\",\r\n                    checked: new Binding(definition, \"convertInstance\"),\r\n                    onchange: (e) => {\r\n                        definition.convertInstance = (e.target as HTMLInputElement).checked;\r\n                    },\r\n                }),\r\n                \" \",\r\n                label({\r\n                    textContent: new Localize(\"option.command.isConvertInstance\"),\r\n                    htmlFor: \"instanceID\",\r\n                }),\r\n            ),\r\n        );\r\n    }\r\n}\r\n\r\nclass PickInsertPointCommand implements ICommand {\r\n    constructor(\r\n        readonly document: IDocument,\r\n        readonly defination: GroupDefinition,\r\n    ) {}\r\n\r\n    async execute(application: IApplication): Promise<void> {\r\n        const pickPointStep = new PointStep(\"option.command.insertPoint\");\r\n        const controller = new AsyncController();\r\n        const result = await pickPointStep.execute(this.document, controller);\r\n\r\n        if (result?.point) {\r\n            this.defination.insert = result.point;\r\n        }\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Precision, Property, XYZ, command } from \"chili-core\";\r\nimport { LineNode } from \"../../bodys\";\r\nimport { Dimension, PointSnapData } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.line\",\r\n    icon: \"icon-line\",\r\n})\r\nexport class Line extends CreateCommand {\r\n    @Property.define(\"option.command.isConnected\", {\r\n        dependencies: [{ property: \"repeatOperation\", value: true }],\r\n    })\r\n    get isContinue() {\r\n        return this.getPrivateValue(\"isContinue\", false);\r\n    }\r\n    set isContinue(value: boolean) {\r\n        this.setProperty(\"isContinue\", value);\r\n    }\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        return new LineNode(this.document, this.stepDatas[0].point!, this.stepDatas[1].point!);\r\n    }\r\n\r\n    getSteps(): IStep[] {\r\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\r\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData);\r\n        return [firstStep, secondStep];\r\n    }\r\n\r\n    protected override resetSteps() {\r\n        if (this.isContinue) {\r\n            this.stepDatas[0] = this.stepDatas[1];\r\n            this.stepDatas.length = 1;\r\n        } else {\r\n            this.stepDatas.length = 0;\r\n        }\r\n    }\r\n\r\n    private readonly getSecondPointData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas[0].point!,\r\n            dimension: Dimension.D1D2D3,\r\n            validator: (point: XYZ) => {\r\n                return this.stepDatas[0].point!.distanceTo(point) > Precision.Distance;\r\n            },\r\n            preview: this.linePreview,\r\n        };\r\n    };\r\n\r\n    private readonly linePreview = (point: XYZ | undefined) => {\r\n        if (!point) {\r\n            return [this.meshPoint(this.stepDatas[0].point!)];\r\n        }\r\n        return [this.meshPoint(this.stepDatas[0].point!), this.meshLine(this.stepDatas[0].point!, point)];\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    I18n,\r\n    IEdge,\r\n    IFace,\r\n    IShape,\r\n    IWire,\r\n    JoinType,\r\n    ShapeMeshData,\r\n    ShapeType,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\nimport { GeoUtils } from \"chili-geo\";\r\nimport { IStep, LengthAtAxisStep, SelectShapeStep } from \"../../step\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"create.offset\",\r\n    icon: \"icon-offset\",\r\n})\r\nexport class OffsetCommand extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        const normal = this.getAxis().normal;\r\n        const shape = this.createOffsetShape(normal, this.stepDatas[1].distance!);\r\n        const node = new EditableShapeNode(\r\n            this.document,\r\n            I18n.translate(\"command.create.offset\"),\r\n            shape.value,\r\n        );\r\n        this.document.rootNode.add(node);\r\n        this.document.visual.update();\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire | ShapeType.Face, \"prompt.select.shape\"),\r\n            new LengthAtAxisStep(\"common.length\", () => {\r\n                let ax = this.getAxis();\r\n                return {\r\n                    point: ax.point,\r\n                    direction: ax.direction,\r\n                    preview: (point: XYZ | undefined) => this.preview(ax, point),\r\n                };\r\n            }),\r\n        ];\r\n    }\r\n\r\n    private preview(\r\n        ax: { point: XYZ; direction: XYZ; normal: XYZ },\r\n        point: XYZ | undefined,\r\n    ): ShapeMeshData[] {\r\n        let res: ShapeMeshData[] = [this.meshPoint(ax.point)];\r\n        if (point !== undefined) {\r\n            res.push(this.meshLine(ax.point, point));\r\n            let distance = point.sub(ax.point).dot(ax.direction);\r\n            let shape = this.createOffsetShape(ax.normal, distance);\r\n            if (shape.isOk) {\r\n                res.push(shape.value.edgesMeshPosition());\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    private getAxis(): { direction: XYZ; point: XYZ; normal: XYZ } {\r\n        let start = this.stepDatas[0].shapes[0].point!;\r\n        let shape = this.transformdFirstShape(this.stepDatas[0]);\r\n        if (shape.shapeType === ShapeType.Edge) {\r\n            return this.getEdgeAxis(shape as IEdge, start);\r\n        }\r\n\r\n        return this.getFaceOrWireAxis(shape, start);\r\n    }\r\n\r\n    private getFaceOrWireAxis(shape: IShape, start: XYZ) {\r\n        let face = shape as IFace;\r\n        if (shape.shapeType === ShapeType.Wire) {\r\n            face = (shape as IWire).toFace().value;\r\n        }\r\n        const normal = face.normal(0, 0)[1];\r\n        const { nearest, direction } = this.getNearstPointAndDirection(shape, start, normal);\r\n        return {\r\n            point: nearest.point,\r\n            normal,\r\n            direction: direction.cross(normal).normalize()!,\r\n        };\r\n    }\r\n\r\n    private getEdgeAxis(edge: IEdge, start: XYZ) {\r\n        const curve = edge.curve;\r\n        const direction = curve.dn(curve.parameter(start, 1e-3)!, 1);\r\n        const normal = GeoUtils.normal(edge);\r\n        return {\r\n            point: start,\r\n            normal,\r\n            direction: direction.cross(normal).normalize()!,\r\n        };\r\n    }\r\n\r\n    private getNearstPointAndDirection(shape: IShape, start: XYZ, normal: XYZ) {\r\n        let wire = shape as IWire;\r\n        if (shape.shapeType === ShapeType.Face) {\r\n            wire = (shape as IFace).outerWire();\r\n        }\r\n        const nearest = GeoUtils.nearestPoint(wire, start);\r\n        const nextEdge = GeoUtils.findNextEdge(wire, nearest.edge).value;\r\n        let direction = nearest.edge.curve.dn(0, 1);\r\n        const scale = nearest.edge.orientation() === nextEdge.orientation() ? 1 : -1;\r\n        const nextDirection = nextEdge.curve.dn(0, 1).multiply(scale);\r\n        if (direction.cross(nextDirection).normalize()?.isOppositeTo(normal)) {\r\n            direction = direction.multiply(-1);\r\n        }\r\n        return { nearest, direction };\r\n    }\r\n\r\n    private createOffsetShape(normal: XYZ, distance: number) {\r\n        let shape = this.transformdFirstShape(this.stepDatas[0]);\r\n        if (shape.shapeType === ShapeType.Edge) {\r\n            return (shape as IEdge).offset(distance, normal);\r\n        }\r\n\r\n        let wire = shape as IWire;\r\n        if (shape.shapeType === ShapeType.Face) {\r\n            wire = (shape as IFace).outerWire();\r\n        }\r\n        return wire.offset(distance, JoinType.intersection);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    EdgeMeshDataBuilder,\r\n    GeometryNode,\r\n    I18n,\r\n    Precision,\r\n    ShapeMeshData,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\nimport { PolygonNode } from \"../../bodys\";\r\nimport { Dimension, PointSnapData, SnapResult } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { CreateFaceableCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.polygon\",\r\n    icon: \"icon-polygon\",\r\n})\r\nexport class Polygon extends CreateFaceableCommand {\r\n    protected override geometryNode(): GeometryNode {\r\n        let node = new PolygonNode(\r\n            this.document,\r\n            this.stepDatas.map((step) => step.point!),\r\n        );\r\n        node.isFace = this.isFace;\r\n        return node;\r\n    }\r\n\r\n    protected override async executeSteps(): Promise<boolean> {\r\n        let steps = this.getSteps();\r\n        let firstStep = true;\r\n        while (true) {\r\n            let step = firstStep ? steps[0] : steps[1];\r\n            if (firstStep) firstStep = false;\r\n            this.controller = new AsyncController();\r\n            let data = await step.execute(this.document, this.controller);\r\n            if (data === undefined) {\r\n                return this.controller.result?.status === \"success\";\r\n            }\r\n            this.stepDatas.push(data);\r\n            if (this.isClose(data)) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    private isClose(data: SnapResult) {\r\n        return (\r\n            this.stepDatas.length > 1 &&\r\n            this.stepDatas[0].point!.distanceTo(data.point!) <= Precision.Distance\r\n        );\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\r\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getNextData);\r\n        return [firstStep, secondStep];\r\n    }\r\n\r\n    private readonly getNextData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas.at(-1)!.point!,\r\n            dimension: Dimension.D1D2D3,\r\n            validator: this.validator,\r\n            preview: this.preview,\r\n            featurePoints: [\r\n                {\r\n                    point: this.stepDatas.at(0)!.point!,\r\n                    prompt: I18n.translate(\"prompt.polygon.close\"),\r\n                    when: () => this.stepDatas.length > 2,\r\n                },\r\n            ],\r\n        };\r\n    };\r\n\r\n    private readonly preview = (point: XYZ | undefined): ShapeMeshData[] => {\r\n        let ps = this.stepDatas.map((data) => this.meshPoint(data.point!));\r\n        let edges = new EdgeMeshDataBuilder();\r\n        this.stepDatas.forEach((data) => edges.addPosition(data.point!.x, data.point!.y, data.point!.z));\r\n        if (point) {\r\n            edges.addPosition(point.x, point.y, point.z);\r\n        }\r\n        return [...ps, edges.build()];\r\n    };\r\n\r\n    private readonly validator = (point: XYZ): boolean => {\r\n        for (const data of this.stepDatas) {\r\n            if (point.distanceTo(data.point!) < 0.001) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, IShape, Precision, ShapeType, command } from \"chili-core\";\r\nimport { GeoUtils } from \"chili-geo\";\r\nimport { PrismNode } from \"../../bodys\";\r\nimport { LengthAtAxisSnapData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.extrude\",\r\n    icon: \"icon-prism\",\r\n})\r\nexport class Prism extends CreateCommand {\r\n    protected override geometryNode(): GeometryNode {\r\n        const shape = this.transformdFirstShape(this.stepDatas[0], false);\r\n        const { point, normal } = this.getAxis(shape);\r\n        const dist = this.stepDatas[1].point!.sub(point).dot(normal);\r\n        return new PrismNode(this.document, shape, dist);\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Face | ShapeType.Edge | ShapeType.Wire, \"prompt.select.shape\"),\r\n            new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getLengthStepData, true),\r\n        ];\r\n    }\r\n\r\n    private readonly getLengthStepData = (): LengthAtAxisSnapData => {\r\n        const shape = this.transformdFirstShape(this.stepDatas[0]);\r\n        const { point, normal } = this.getAxis(shape);\r\n        return {\r\n            point,\r\n            direction: normal,\r\n            preview: (p) => {\r\n                if (!p) return [];\r\n                const dist = p.sub(point).dot(normal);\r\n                if (Math.abs(dist) < Precision.Float) return [];\r\n                const vec = normal.multiply(dist);\r\n                return [this.meshCreatedShape(\"prism\", shape, vec)];\r\n            },\r\n        };\r\n    };\r\n\r\n    private getAxis(shape: IShape) {\r\n        const point = this.stepDatas[0].shapes[0].point!;\r\n        const normal = GeoUtils.normal(shape as any);\r\n        return { point, normal };\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Plane, XYZ, command } from \"chili-core\";\r\nimport { PyramidNode } from \"../../bodys\";\r\nimport { LengthAtAxisSnapData } from \"../../snap\";\r\nimport { IStep, LengthAtAxisStep } from \"../../step\";\r\nimport { RectCommandBase } from \"./rect\";\r\n\r\n@command({\r\n    key: \"create.pyramid\",\r\n    icon: \"icon-pyramid\",\r\n})\r\nexport class Pyramid extends RectCommandBase {\r\n    protected override getSteps(): IStep[] {\r\n        let steps = super.getSteps();\r\n        let third = new LengthAtAxisStep(\"prompt.pickNextPoint\", this.getHeightStepData);\r\n        return [...steps, third];\r\n    }\r\n\r\n    private readonly getHeightStepData = (): LengthAtAxisSnapData => {\r\n        const plane = this.stepDatas[1].plane;\r\n        if (plane === undefined) {\r\n            throw new Error(\"plane is undefined, please report bug\");\r\n        }\r\n        const point = this.stepDatas[1].point!.add(this.stepDatas[0].point!).multiply(0.5);\r\n        return {\r\n            point,\r\n            direction: plane.normal,\r\n            preview: this.previewPyramid,\r\n        };\r\n    };\r\n\r\n    private readonly previewPyramid = (end: XYZ | undefined) => {\r\n        if (!end) {\r\n            return this.previewRect(this.stepDatas[1].point);\r\n        }\r\n\r\n        const data = this.rectDataFromTwoSteps();\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(this.stepDatas[1].point!),\r\n            this.meshCreatedShape(\"pyramid\", data.plane, data.dx, data.dy, this.getHeight(data.plane, end)),\r\n        ];\r\n    };\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const rect = this.rectDataFromTwoSteps();\r\n        const dz = this.getHeight(rect.plane, this.stepDatas[2].point!);\r\n        return new PyramidNode(this.document, rect.plane, rect.dx, rect.dy, dz);\r\n    }\r\n\r\n    private getHeight(plane: Plane, point: XYZ): number {\r\n        return point.sub(plane.origin).dot(plane.normal);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    GeometryNode,\r\n    ICurve,\r\n    IEdge,\r\n    ILine,\r\n    IShape,\r\n    IShapeFilter,\r\n    Property,\r\n    Ray,\r\n    ShapeType,\r\n    command,\r\n} from \"chili-core\";\r\nimport { RevolvedNode } from \"../../bodys\";\r\nimport { IStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"convert.revol\",\r\n    icon: \"icon-revolve\",\r\n})\r\nexport class Revolve extends CreateCommand {\r\n    @Property.define(\"common.angle\")\r\n    public get angle() {\r\n        return this.getPrivateValue(\"angle\", 360);\r\n    }\r\n    public set angle(value: number) {\r\n        this.setProperty(\"angle\", value);\r\n    }\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const shape = this.transformdFirstShape(this.stepDatas[0], false);\r\n        const edge = (this.stepDatas[1].shapes[0].shape as IEdge).curve.basisCurve as ILine;\r\n        const transform = this.stepDatas[1].shapes[0].transform;\r\n        const axis = new Ray(transform.ofPoint(edge.value(0)), transform.ofVector(edge.direction));\r\n        return new RevolvedNode(this.document, shape, axis, this.angle);\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Face | ShapeType.Wire, \"prompt.select.shape\"),\r\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\", {\r\n                shapeFilter: new LineFilter(),\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n\r\nclass LineFilter implements IShapeFilter {\r\n    allow(shape: IShape): boolean {\r\n        if (shape.shapeType === ShapeType.Edge) {\r\n            let edge = shape as IEdge;\r\n            let curve = edge.curve.basisCurve;\r\n            return ICurve.isLine(curve);\r\n        }\r\n        return false;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { EditableShapeNode, I18n, ShapeType, VisualState, command } from \"chili-core\";\r\nimport { IStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"create.section\",\r\n    icon: \"icon-section\",\r\n})\r\nexport class Section extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        let shape = this.transformdFirstShape(this.stepDatas[0]);\r\n        let path = this.transformdFirstShape(this.stepDatas[1]);\r\n        let section = shape.section(path);\r\n        const node = new EditableShapeNode(this.document, I18n.translate(\"command.create.section\"), section);\r\n        this.document.rootNode.add(node);\r\n        this.document.visual.update();\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                selectedState: VisualState.faceTransparent,\r\n            }),\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", { keepSelection: true }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, Precision, XYZ, command } from \"chili-core\";\r\nimport { SphereNode } from \"../../bodys\";\r\nimport { SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"create.sphere\",\r\n    icon: \"icon-sphere\",\r\n})\r\nexport class Sphere extends CreateCommand {\r\n    protected override getSteps(): IStep[] {\r\n        let centerStep = new PointStep(\"prompt.pickCircleCenter\");\r\n        let radiusStep = new LengthAtPlaneStep(\"prompt.pickRadius\", this.getRadiusData);\r\n        return [centerStep, radiusStep];\r\n    }\r\n\r\n    private readonly getRadiusData = (): SnapLengthAtPlaneData => {\r\n        const point = this.stepDatas[0].point!;\r\n        return {\r\n            point: () => point,\r\n            preview: this.previewSphere,\r\n            plane: () => this.stepDatas[0].view.workplane.translateTo(point),\r\n            validator: (p: XYZ) => p.distanceTo(point) > Precision.Distance,\r\n        };\r\n    };\r\n\r\n    private readonly previewSphere = (end: XYZ | undefined) => {\r\n        if (!end) {\r\n            return [this.meshPoint(this.stepDatas[0].point!)];\r\n        }\r\n\r\n        const radius = this.stepDatas[0].point?.distanceTo(end)!;\r\n        return [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshCreatedShape(\"circle\", XYZ.unitZ, this.stepDatas[0].point!, radius),\r\n            this.meshCreatedShape(\"circle\", XYZ.unitY, this.stepDatas[0].point!, radius),\r\n        ];\r\n    };\r\n\r\n    protected override geometryNode(): GeometryNode {\r\n        const radius = this.stepDatas[0].point!.distanceTo(this.stepDatas[1].point!);\r\n        return new SphereNode(this.document, this.stepDatas[0].point!, radius);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { GeometryNode, IWire, ShapeType, command } from \"chili-core\";\r\nimport { SweepedNode } from \"../../bodys\";\r\nimport { IStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { CreateCommand } from \"../createCommand\";\r\n\r\n@command({\r\n    key: \"convert.sweep\",\r\n    icon: \"icon-sweep\",\r\n})\r\nexport class Sweep extends CreateCommand {\r\n    protected override geometryNode(): GeometryNode {\r\n        const shape = this.transformdFirstShape(this.stepDatas[0], false);\r\n        const path = this.transformdFirstShape(this.stepDatas[1], false) as IWire;\r\n        return new SweepedNode(this.document, shape, path);\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire | ShapeType.Face, \"prompt.select.shape\"),\r\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Wire, \"prompt.select.edges\", {\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { EditableShapeNode, I18n, Property, PubSub, ShapeType, Transaction, command } from \"chili-core\";\r\nimport { IStep, SelectShapeStep } from \"../../step\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"create.thickSolid\",\r\n    icon: \"icon-thickSolid\",\r\n})\r\nexport class ThickSolidCommand extends MultistepCommand {\r\n    @Property.define(\"option.command.thickness\")\r\n    get thickness() {\r\n        return this.getPrivateValue(\"thickness\", 10);\r\n    }\r\n    set thickness(value: number) {\r\n        this.setProperty(\"thickness\", value);\r\n    }\r\n\r\n    protected override executeMainTask(): void {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            this.stepDatas[0].shapes.forEach((x) => {\r\n                const subShape = this.application.shapeFactory.makeThickSolidBySimple(\r\n                    x.shape,\r\n                    this.thickness,\r\n                );\r\n                if (!subShape.isOk) {\r\n                    PubSub.default.pub(\"showToast\", \"toast.converter.error\");\r\n                    return;\r\n                }\r\n                const model = new EditableShapeNode(\r\n                    this.document,\r\n                    I18n.translate(\"command.create.thickSolid\"),\r\n                    subShape,\r\n                );\r\n\r\n                const node = x.owner.node;\r\n                model.transform = node.transform;\r\n                node.parent!.insertAfter(node, model);\r\n            });\r\n            this.document.visual.update();\r\n            PubSub.default.pub(\"showToast\", \"toast.success\");\r\n        });\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { multiple: true })];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Act, I18n, IApplication, ICommand, command } from \"chili-core\";\r\n\r\nlet index = 0;\r\n\r\n@command({\r\n    key: \"act.alignCamera\",\r\n    icon: \"icon-act\",\r\n})\r\nexport class ActAlignCameraCommand implements ICommand {\r\n    async execute(application: IApplication): Promise<void> {\r\n        const view = application.activeView;\r\n        if (!view) return;\r\n\r\n        view.document.acts.push(\r\n            new Act(\r\n                `${I18n.translate(\"ribbon.group.act\")} ${index++}`,\r\n                view.cameraController.cameraPosition,\r\n                view.cameraController.cameraTarget,\r\n                view.cameraController.cameraUp,\r\n            ),\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, INode, PubSub, Transaction } from \"chili-core\";\r\nimport { GetOrSelectNodeStep, IStep } from \"../step\";\r\nimport { MultistepCommand } from \"./multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.deleteNode\",\r\n    icon: \"icon-delete\",\r\n})\r\nexport class Delete extends MultistepCommand {\r\n    protected override executeMainTask(): void {\r\n        const nodes: INode[] | undefined = this.stepDatas[0].nodes;\r\n        if (!nodes || nodes.length === 0) {\r\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\r\n            return;\r\n        }\r\n\r\n        if (this.document.currentNode && nodes.includes(this.document.currentNode)) {\r\n            this.document.currentNode = this.document.rootNode;\r\n        }\r\n\r\n        this.document.selection.clearSelection();\r\n        Transaction.execute(this.document, \"delete\", () => {\r\n            nodes.forEach((model) => model.parent?.remove(model));\r\n        });\r\n        this.document.visual.update();\r\n        PubSub.default.pub(\"showToast\", \"toast.delete{0}Objects\", nodes.length);\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [new GetOrSelectNodeStep(\"prompt.select.models\", { multiple: true })];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, FolderNode, IApplication, ICommand } from \"chili-core\";\r\n\r\nlet index = 1;\r\n\r\n@command({\r\n    key: \"create.folder\",\r\n    icon: \"icon-folder-plus\",\r\n})\r\nexport class NewFolder implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        const document = app.activeView?.document!;\r\n        const folder = new FolderNode(document, `Folder${index++}`);\r\n        document.addNode(folder);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    CancelableCommand,\r\n    Combobox,\r\n    command,\r\n    download,\r\n    I18n,\r\n    IApplication,\r\n    ICommand,\r\n    Property,\r\n    PubSub,\r\n    readFilesAsync,\r\n} from \"chili-core\";\r\nimport { SelectNodeStep } from \"../step\";\r\nimport { importFiles } from \"../utils\";\r\n\r\n@command({\r\n    key: \"file.import\",\r\n    icon: \"icon-import\",\r\n})\r\nexport class Import implements ICommand {\r\n    async execute(application: IApplication): Promise<void> {\r\n        const extenstions = application.dataExchange.importFormats().join(\",\");\r\n        const files = await readFilesAsync(extenstions, true);\r\n        if (!files.isOk || files.value.length === 0) {\r\n            alert(files.error);\r\n            return;\r\n        }\r\n        importFiles(application, files.value);\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"file.export\",\r\n    icon: \"icon-export\",\r\n})\r\nexport class Export extends CancelableCommand {\r\n    @Property.define(\"file.format\")\r\n    public get formats() {\r\n        return this.getPrivateValue(\"formats\", this.initCombobox());\r\n    }\r\n    public set formats(value: Combobox<string>) {\r\n        this.setProperty(\"formats\", value);\r\n    }\r\n\r\n    private initCombobox() {\r\n        const box = new Combobox<string>();\r\n        box.items.push(...this.application.dataExchange.exportFormats());\r\n        return box;\r\n    }\r\n\r\n    protected async executeAsync() {\r\n        const nodes = await this.selectNodesAsync();\r\n        if (!nodes || nodes.length === 0) {\r\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\r\n            return;\r\n        }\r\n\r\n        PubSub.default.pub(\r\n            \"showPermanent\",\r\n            async () => {\r\n                const format = this.formats.selectedItem;\r\n                if (format === undefined) return;\r\n\r\n                const data = await this.application.dataExchange.export(format, nodes);\r\n                if (!data) return;\r\n\r\n                PubSub.default.pub(\"showToast\", \"toast.downloading\");\r\n                download(data, `${nodes[0].name}${format}`);\r\n            },\r\n            \"toast.excuting{0}\",\r\n            I18n.translate(\"command.file.export\"),\r\n        );\r\n    }\r\n\r\n    private async selectNodesAsync() {\r\n        this.controller = new AsyncController();\r\n        const step = new SelectNodeStep(\"prompt.select.models\", { multiple: true, keepSelection: true });\r\n        const data = await step.execute(this.application.activeView?.document!, this.controller);\r\n        if (!data?.nodes) {\r\n            PubSub.default.pub(\"showToast\", \"prompt.select.noModelSelected\");\r\n            return undefined;\r\n        }\r\n        return data.nodes;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, Precision, ShapeMeshData, VisualConfig, XYZ } from \"chili-core\";\r\nimport { Dimension, PointSnapData, SnapResult } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\nconst ARC_POSITION = 0.5;\r\n\r\n@command({\r\n    key: \"measure.angle\",\r\n    icon: \"icon-measureAngle\",\r\n})\r\nexport class AngleMeasure extends MultistepCommand {\r\n    protected override getSteps(): IStep[] {\r\n        const firstStep = new PointStep(\"prompt.pickFistPoint\");\r\n        const secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData);\r\n        const thirdStep = new PointStep(\"prompt.pickNextPoint\", this.getThirdPointData);\r\n        return [firstStep, secondStep, thirdStep];\r\n    }\r\n\r\n    private readonly getSecondPointData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas[0].point!,\r\n            dimension: Dimension.D1D2D3,\r\n            validator: (point: XYZ) => {\r\n                return this.stepDatas[0].point!.distanceTo(point) > Precision.Distance;\r\n            },\r\n            preview: this.linePreview,\r\n        };\r\n    };\r\n\r\n    private readonly linePreview = (point: XYZ | undefined) => {\r\n        if (!point) {\r\n            return [this.meshPoint(this.stepDatas[0].point!)];\r\n        }\r\n        return [this.meshPoint(this.stepDatas[0].point!), this.meshLine(this.stepDatas[0].point!, point)];\r\n    };\r\n\r\n    private readonly getThirdPointData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas[0].point!,\r\n            dimension: Dimension.D1D2D3,\r\n            prompt: (result: SnapResult) => this.anglePrompt(result.point!),\r\n            validator: (point: XYZ) => {\r\n                return (\r\n                    this.stepDatas[0].point!.distanceTo(point) > Precision.Distance &&\r\n                    this.stepDatas[1].point!.distanceTo(point) > Precision.Distance\r\n                );\r\n            },\r\n            preview: this.arcPreview,\r\n        };\r\n    };\r\n\r\n    private readonly anglePrompt = (point: XYZ) => {\r\n        const { rad } = this.arcInfo(point);\r\n        return ((rad * 180) / Math.PI).toFixed(2) + \"°\";\r\n    };\r\n\r\n    private readonly arcPreview = (point: XYZ | undefined) => {\r\n        const meshes: ShapeMeshData[] = [\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(this.stepDatas[1].point!),\r\n            this.meshLine(\r\n                this.stepDatas[0].point!,\r\n                this.stepDatas[1].point!,\r\n                VisualConfig.highlightEdgeColor,\r\n                3,\r\n            ),\r\n        ];\r\n        if (!point) return meshes;\r\n\r\n        const { v1, rad, normal } = this.arcInfo(point);\r\n        const angle = (rad * 180) / Math.PI;\r\n        if (angle < Precision.Angle) return meshes;\r\n\r\n        const line2 = this.meshLine(this.stepDatas[0].point!, point, VisualConfig.highlightEdgeColor, 3);\r\n        const arc = this.application.shapeFactory\r\n            .arc(\r\n                normal,\r\n                this.stepDatas[0].point!,\r\n                this.stepDatas[0].point!.add(v1.multiply(this.lineLength(point) * ARC_POSITION)),\r\n                angle,\r\n            )\r\n            .unchecked()?.mesh.edges!;\r\n        arc.lineWidth = 3;\r\n        arc.color = VisualConfig.highlightEdgeColor;\r\n        return [line2, arc, ...meshes];\r\n    };\r\n\r\n    private lineLength(point: XYZ | undefined) {\r\n        const d1 = this.stepDatas[0].point!.distanceTo(this.stepDatas[1].point!);\r\n        if (!point) {\r\n            return d1;\r\n        }\r\n        const d2 = this.stepDatas[0].point!.distanceTo(point);\r\n        return Math.min(d1, d2);\r\n    }\r\n\r\n    private arcInfo(point: XYZ) {\r\n        const v1 = this.stepDatas[1].point!.sub(this.stepDatas[0].point!).normalize()!;\r\n        const v2 = point.sub(this.stepDatas[0].point!).normalize()!;\r\n        const rad = v1.angleTo(v2)!;\r\n        const normal = v1.cross(v2).normalize()!;\r\n        return {\r\n            v1,\r\n            v2,\r\n            rad,\r\n            normal,\r\n        };\r\n    }\r\n\r\n    protected override executeMainTask(): void {\r\n        const { v1, rad, normal } = this.arcInfo(this.stepDatas[2].point!);\r\n        const arcMid = v1\r\n            .rotate(normal, rad * 0.5)!\r\n            .multiply(this.lineLength(this.stepDatas[2].point) * ARC_POSITION)\r\n            .add(this.stepDatas[0].point!);\r\n        const visualId = this.document.visual.context.displayMesh(\r\n            this.meshPoint(this.stepDatas[2].point!),\r\n            ...this.arcPreview(this.stepDatas[2].point),\r\n        );\r\n        this.application.activeView?.htmlText(((rad * 180) / Math.PI).toFixed(2) + \"°\", arcMid, {\r\n            onDispose: () => {\r\n                this.document.visual.context.removeMesh(visualId);\r\n            },\r\n        });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, Precision, VisualConfig, XYZ } from \"chili-core\";\r\nimport { Dimension, PointSnapData } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"measure.length\",\r\n    icon: \"icon-measureLength\",\r\n})\r\nexport class LengthMeasure extends MultistepCommand {\r\n    protected override getSteps(): IStep[] {\r\n        let firstStep = new PointStep(\"prompt.pickFistPoint\");\r\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData);\r\n        return [firstStep, secondStep];\r\n    }\r\n\r\n    private readonly getSecondPointData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas[0].point!,\r\n            dimension: Dimension.D1D2D3,\r\n            validator: (point: XYZ) => {\r\n                return this.stepDatas[0].point!.distanceTo(point) > Precision.Distance;\r\n            },\r\n            preview: this.linePreview,\r\n        };\r\n    };\r\n\r\n    private readonly linePreview = (point: XYZ | undefined) => {\r\n        if (!point) {\r\n            return [this.meshPoint(this.stepDatas[0].point!)];\r\n        }\r\n        return [this.meshPoint(this.stepDatas[0].point!), this.meshLine(this.stepDatas[0].point!, point)];\r\n    };\r\n\r\n    protected override executeMainTask(): void {\r\n        const firstPoint = this.stepDatas[0].point!;\r\n        const secondPoint = this.stepDatas[1].point!;\r\n        const distance = firstPoint.distanceTo(secondPoint);\r\n        const visualId = this.document.visual.context.displayMesh(\r\n            this.meshPoint(firstPoint),\r\n            this.meshLine(firstPoint, secondPoint, VisualConfig.highlightEdgeColor, 3),\r\n            this.meshPoint(secondPoint),\r\n        );\r\n        this.application.activeView?.htmlText(\r\n            distance.toFixed(2),\r\n            firstPoint.add(secondPoint).multiply(0.5),\r\n            {\r\n                onDispose: () => {\r\n                    this.document.visual.context.removeMesh(visualId);\r\n                },\r\n            },\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { div, h1, h2, span, ul } from \"chili-controls\";\r\nimport {\r\n    AsyncController,\r\n    BoundingBox,\r\n    CancelableCommand,\r\n    Combobox,\r\n    command,\r\n    I18nKeys,\r\n    IDisposable,\r\n    IEdge,\r\n    IFace,\r\n    ISolid,\r\n    Localize,\r\n    Matrix4,\r\n    Property,\r\n    ShapeType,\r\n    VisualConfig,\r\n    VisualShapeData,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { SelectShapeStep } from \"../../step\";\r\nimport style from \"./select.module.css\";\r\n\r\n@command({\r\n    key: \"measure.select\",\r\n    icon: \"icon-measureSelect\",\r\n})\r\nexport class SelectMeasure extends CancelableCommand {\r\n    #isChangedType = false;\r\n    #sum = 0;\r\n    #sumUI?: {\r\n        container: HTMLDivElement;\r\n        header: HTMLHeadingElement;\r\n        list: HTMLUListElement;\r\n        value: HTMLSpanElement;\r\n    };\r\n    readonly #disposeSet: Set<IDisposable> = new Set();\r\n\r\n    #category?: Combobox<I18nKeys>;\r\n    @Property.define(\"common.type\")\r\n    public get category(): Combobox<I18nKeys> {\r\n        if (!this.#category) {\r\n            this.#category = this.initCombobox();\r\n        }\r\n        return this.#category;\r\n    }\r\n    public set category(value: Combobox<I18nKeys>) {\r\n        this.#category?.clearPropertyChanged();\r\n        this.#category = value;\r\n        this.#category.onPropertyChanged(this.onTypeChange);\r\n    }\r\n\r\n    private initCombobox() {\r\n        const box = new Combobox<I18nKeys>();\r\n        box.items.push(\"common.length\", \"common.area\", \"common.volume\");\r\n        box.onPropertyChanged(this.onTypeChange);\r\n        return box;\r\n    }\r\n\r\n    private readonly onTypeChange = () => {\r\n        this.#isChangedType = true;\r\n        this.controller?.cancel();\r\n        this.#sumUI?.container.remove();\r\n        this.#sumUI = undefined;\r\n        this.#disposeSet.forEach((d) => d.dispose());\r\n        this.#disposeSet.clear();\r\n        this.#sum = 0;\r\n    };\r\n\r\n    private initSumUI() {\r\n        if (this.#sumUI) {\r\n            this.#sumUI.container.remove();\r\n        }\r\n        this.#sumUI = {\r\n            container: div({\r\n                className: style.selectSum,\r\n            }),\r\n            header: h1({ textContent: new Localize(this.#category!.selectedItem!) }),\r\n            list: ul(),\r\n            value: span({\r\n                textContent: \"0.00\",\r\n            }),\r\n        };\r\n        this.#sumUI.container.append(this.#sumUI.header, this.#sumUI.list, h2(this.#sumUI.value));\r\n\r\n        this.application.activeView?.dom?.append(this.#sumUI.container);\r\n    }\r\n\r\n    private addSumItem(item: number) {\r\n        this.#sum += item;\r\n        if (!this.#sumUI) {\r\n            this.initSumUI();\r\n        }\r\n\r\n        const li = document.createElement(\"li\");\r\n        li.textContent = item.toFixed(2);\r\n        this.#sumUI!.list.append(li);\r\n        this.#sumUI!.value.textContent = this.#sum.toFixed(2);\r\n    }\r\n\r\n    protected override afterExecute(): void {\r\n        super.afterExecute();\r\n        this.category?.clearPropertyChanged();\r\n        this.#disposeSet.forEach((d) => d.dispose());\r\n        this.#disposeSet.clear();\r\n        this.#sumUI?.container.remove();\r\n    }\r\n\r\n    protected override async executeAsync(): Promise<void> {\r\n        while (true) {\r\n            this.controller = new AsyncController();\r\n            let type: [ShapeType, I18nKeys] = [ShapeType.Edge, \"prompt.select.edges\"];\r\n            if (this.category.selectedIndex === 1) {\r\n                type = [ShapeType.Face, \"prompt.select.faces\"];\r\n            } else if (this.category.selectedIndex === 2) {\r\n                type = [ShapeType.Solid, \"prompt.select.solids\"];\r\n            }\r\n\r\n            const step = new SelectShapeStep(type[0], type[1]);\r\n            const result = await step.execute(this.document, this.controller);\r\n            if (this.controller.result?.status !== \"success\") {\r\n                if (this.#isChangedType) {\r\n                    this.#isChangedType = false;\r\n                    continue;\r\n                } else {\r\n                    return;\r\n                }\r\n            }\r\n            this.createMeasure(result?.shapes[0]);\r\n        }\r\n    }\r\n\r\n    private readonly createMeasure = (shape: VisualShapeData | undefined) => {\r\n        if (!shape) return;\r\n        if (shape.shape.shapeType === ShapeType.Edge) {\r\n            this.edgeMeasure(shape.shape as IEdge, shape.transform);\r\n        } else if (shape.shape.shapeType === ShapeType.Face) {\r\n            this.faceMeasure(shape.shape as IFace, shape.transform);\r\n        } else if (shape.shape.shapeType === ShapeType.Solid) {\r\n            this.solidMeasure(\r\n                shape.shape as ISolid,\r\n                shape.transform,\r\n                BoundingBox.center(shape.owner.boundingBox()),\r\n            );\r\n        }\r\n    };\r\n\r\n    private edgeMeasure(edge: IEdge, transform: Matrix4) {\r\n        edge = edge.transformedMul(transform) as IEdge;\r\n        const start = edge.curve.startPoint();\r\n        const end = edge.curve.endPoint();\r\n        const length = edge.length();\r\n        this.addSumItem(length);\r\n        const mesh = edge.mesh.edges!;\r\n        edge.dispose();\r\n        mesh.lineWidth = 3;\r\n        mesh.color = VisualConfig.highlightEdgeColor;\r\n\r\n        const id = this.document.visual.context.displayMesh(mesh);\r\n        this.#disposeSet.add(\r\n            this.application.activeView!.htmlText(length.toFixed(2), start.add(end).multiply(0.5), {\r\n                hideDelete: true,\r\n                onDispose: () => {\r\n                    this.document.visual.context.removeMesh(id);\r\n                },\r\n            }),\r\n        );\r\n    }\r\n\r\n    private faceMeasure(face: IFace, transform: Matrix4) {\r\n        const wire = face.outerWire();\r\n        const mesh = wire.mesh.edges!;\r\n        wire.dispose();\r\n        mesh.lineWidth = 3;\r\n        mesh.color = VisualConfig.highlightEdgeColor;\r\n        mesh.position = new Float32Array(transform.ofPoints(mesh.position));\r\n\r\n        const area = face.area();\r\n        this.addSumItem(area);\r\n        const center = this.wireCenter(mesh.position);\r\n        const id = this.document.visual.context.displayMesh(mesh);\r\n        this.#disposeSet.add(\r\n            this.application.activeView!.htmlText(area.toFixed(2), center, {\r\n                hideDelete: true,\r\n                onDispose: () => {\r\n                    this.document.visual.context.removeMesh(id);\r\n                },\r\n            }),\r\n        );\r\n    }\r\n\r\n    private wireCenter(points: ArrayLike<number>) {\r\n        const center = { x: 0, y: 0, z: 0 };\r\n        for (let i = 0; i < points.length; i += 3) {\r\n            center.x += points[i];\r\n            center.y += points[i + 1];\r\n            center.z += points[i + 2];\r\n        }\r\n\r\n        const length = points.length / 3;\r\n        center.x /= length;\r\n        center.y /= length;\r\n        center.z /= length;\r\n        return center;\r\n    }\r\n\r\n    private solidMeasure(solid: ISolid, transform: Matrix4, center: XYZ) {\r\n        const mesh = solid.mesh.edges!;\r\n        mesh.lineWidth = 3;\r\n        mesh.color = VisualConfig.highlightEdgeColor;\r\n        mesh.position = new Float32Array(transform.ofPoints(mesh.position));\r\n\r\n        const volume = solid.volume();\r\n        this.addSumItem(volume);\r\n        const id = this.document.visual.context.displayMesh(mesh);\r\n        this.#disposeSet.add(\r\n            this.application.activeView!.htmlText(volume.toFixed(2), transform.ofPoint(center), {\r\n                hideDelete: true,\r\n                onDispose: () => {\r\n                    this.document.visual.context.removeMesh(id);\r\n                },\r\n            }),\r\n        );\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    IEdge,\r\n    ITrimmedCurve,\r\n    ShapeNode,\r\n    ShapeType,\r\n    Transaction,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\nimport { Dimension } from \"../../snap\";\r\nimport { IStep, PointOnCurveStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.break\",\r\n    icon: \"icon-break\",\r\n})\r\nexport class Break extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const shape = this.stepDatas[0].shapes[0].shape as IEdge;\r\n            const curve = shape.curve;\r\n            const point = this.stepDatas[0].shapes[0].owner.node\r\n                .worldTransform()\r\n                .invert()!\r\n                .ofPoint(this.stepDatas[1].point!);\r\n            const parameter = curve.parameter(point, 1e-3);\r\n            if (parameter === undefined) return;\r\n\r\n            const curve2 = curve.trim(parameter, curve.lastParameter());\r\n            curve.setTrim(curve.firstParameter(), parameter);\r\n            shape.update(curve);\r\n\r\n            const model = this.stepDatas[0].nodes![0] as ShapeNode;\r\n            const model1 = new EditableShapeNode(this.document, `${model.name}_1`, shape);\r\n            const model2 = new EditableShapeNode(this.document, `${model.name}_2`, curve2.makeEdge());\r\n            model1.transform = model.transform;\r\n            model2.transform = model.transform;\r\n            model.parent?.insertAfter(model, model1);\r\n            model.parent?.insertAfter(model1, model2);\r\n            model.parent?.remove(model);\r\n\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.edges\", {\r\n                shapeFilter: { allow: (s) => s.shapeType === ShapeType.Edge },\r\n            }),\r\n            new PointOnCurveStep(\"prompt.pickFistPoint\", this.handlePointData, true),\r\n        ];\r\n    }\r\n\r\n    private readonly handlePointData = () => {\r\n        const edge = this.stepDatas[0].shapes[0].shape as IEdge;\r\n        const curve = edge.curve.transformed(\r\n            edge.matrix.multiply(this.stepDatas[0].shapes[0].transform),\r\n        ) as ITrimmedCurve;\r\n        this.disposeStack.add(curve);\r\n\r\n        return {\r\n            curve,\r\n            dimension: Dimension.D1,\r\n            preview: (point: XYZ | undefined) => {\r\n                if (!point) return [];\r\n                let project = curve.project(point).at(0);\r\n                return [this.meshPoint(project ?? point)];\r\n            },\r\n        };\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, GeometryNode, ISubFaceShape, Property, ShapeType, Transaction } from \"chili-core\";\r\nimport { IStep, SelectNodeStep, SelectShapeStep } from \"../../step\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.brushAdd\",\r\n    icon: \"icon-addBrush\",\r\n})\r\nexport class AddBrushCommand extends MultistepCommand {\r\n    @Property.define(\"common.material\", { type: \"materialId\" })\r\n    get materialId(): string {\r\n        return this.getPrivateValue(\"materialId\", this.document.materials.at(0)?.id);\r\n    }\r\n    set materialId(value: string) {\r\n        this.setProperty(\"materialId\", value);\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { multiple: true })];\r\n    }\r\n    protected override executeMainTask(): void {\r\n        const nodeMatiralMape = new Map<GeometryNode, { faceIndex: number; materialId: string }[]>();\r\n\r\n        this.stepDatas[0].shapes.forEach((x) => {\r\n            if (x.owner.node instanceof GeometryNode) {\r\n                if (!nodeMatiralMape.has(x.owner.node)) {\r\n                    nodeMatiralMape.set(x.owner.node, []);\r\n                }\r\n                nodeMatiralMape.get(x.owner.node)!.push({\r\n                    faceIndex: (x.shape as ISubFaceShape).index,\r\n                    materialId: this.materialId,\r\n                });\r\n            }\r\n        });\r\n\r\n        Transaction.execute(this.document, \"add face material\", () => {\r\n            nodeMatiralMape.forEach((value, key) => {\r\n                key.addFaceMaterial(value);\r\n            });\r\n        });\r\n\r\n        this.document.visual.update();\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"modify.brushRemove\",\r\n    icon: \"icon-removeBrush\",\r\n})\r\nexport class RemoveBrushCommand extends MultistepCommand {\r\n    protected override getSteps(): IStep[] {\r\n        return [new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", { multiple: true })];\r\n    }\r\n\r\n    protected override executeMainTask(): void {\r\n        const nodeMatiralMape = new Map<GeometryNode, number[]>();\r\n\r\n        this.stepDatas[0].shapes.forEach((x) => {\r\n            if (x.owner.node instanceof GeometryNode) {\r\n                if (!nodeMatiralMape.has(x.owner.node)) {\r\n                    nodeMatiralMape.set(x.owner.node, []);\r\n                }\r\n                nodeMatiralMape.get(x.owner.node)!.push((x.shape as ISubFaceShape).index);\r\n            }\r\n        });\r\n\r\n        Transaction.execute(this.document, \"remove face material\", () => {\r\n            nodeMatiralMape.forEach((value, key) => {\r\n                key.removeFaceMaterial(value);\r\n            });\r\n        });\r\n\r\n        this.document.visual.update();\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"modify.brushClear\",\r\n    icon: \"icon-clearBrush\",\r\n})\r\nexport class ClearBrushCommand extends MultistepCommand {\r\n    protected override getSteps(): IStep[] {\r\n        return [new SelectNodeStep(\"prompt.select.shape\", { multiple: true, keepSelection: true })];\r\n    }\r\n\r\n    protected override executeMainTask(): void {\r\n        Transaction.execute(this.document, \"clear face material\", () => {\r\n            this.stepDatas[0].nodes?.forEach((x) => {\r\n                if (x instanceof GeometryNode) {\r\n                    x.clearFaceMaterial();\r\n                }\r\n            });\r\n        });\r\n\r\n        this.document.visual.update();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    ISubEdgeShape,\r\n    Property,\r\n    ShapeNode,\r\n    ShapeType,\r\n    Transaction,\r\n    VisualState,\r\n    command,\r\n} from \"chili-core\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.chamfer\",\r\n    icon: \"icon-chamfer\",\r\n})\r\nexport class ChamferCommand extends MultistepCommand {\r\n    @Property.define(\"common.length\")\r\n    get length() {\r\n        return this.getPrivateValue(\"length\", 10);\r\n    }\r\n\r\n    set length(value: number) {\r\n        this.setProperty(\"length\", value);\r\n    }\r\n\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\r\n            const edges = this.stepDatas.at(-1)!.shapes.map((x) => (x.shape as ISubEdgeShape).index);\r\n            const filetShape = this.document.application.shapeFactory.chamfer(\r\n                node.shape.value,\r\n                edges,\r\n                this.length,\r\n            );\r\n\r\n            const model = new EditableShapeNode(this.document, node.name, filetShape, node.materialId);\r\n            model.transform = node.transform;\r\n\r\n            (node.parent ?? this.document.rootNode).add(model);\r\n            node.parent?.remove(node);\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected override getSteps() {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                shapeFilter: {\r\n                    allow: (shape) => {\r\n                        return (\r\n                            shape.shapeType === ShapeType.Solid ||\r\n                            shape.shapeType === ShapeType.Compound ||\r\n                            shape.shapeType === ShapeType.CompoundSolid\r\n                        );\r\n                    },\r\n                },\r\n                selectedState: VisualState.faceTransparent,\r\n            }),\r\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\", {\r\n                multiple: true,\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    ComponentNode,\r\n    EditableShapeNode,\r\n    GroupNode,\r\n    IShape,\r\n    MultiShapeNode,\r\n    ShapeNode,\r\n    ShapeType,\r\n    Transaction,\r\n    command,\r\n} from \"chili-core\";\r\nimport { IStep } from \"../../step\";\r\nimport { GetOrSelectNodeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.explode\",\r\n    icon: \"icon-explode\",\r\n})\r\nexport class Explode extends MultistepCommand {\r\n    protected override getSteps(): IStep[] {\r\n        return [new GetOrSelectNodeStep(\"prompt.select.shape\", { multiple: true })];\r\n    }\r\n\r\n    protected override executeMainTask() {\r\n        this.document.selection.clearSelection();\r\n\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            this.stepDatas[0].nodes?.forEach((x) => {\r\n                if (x instanceof ShapeNode) {\r\n                    this.explodeShapeNode(x);\r\n                } else if (x instanceof ComponentNode) {\r\n                    this.explodeComponentNode(x);\r\n                } else if (x instanceof MultiShapeNode) {\r\n                    this.explodeMultiShapeNode(x);\r\n                }\r\n            });\r\n        });\r\n\r\n        this.document.visual.update();\r\n    }\r\n\r\n    private explodeShapeNode(x: ShapeNode) {\r\n        let subShapes = x.shape.value.iterShape();\r\n        if (subShapes.length === 1) {\r\n            const subShapeNode = new EditableShapeNode(this.document, x.name, subShapes[0], x.materialId);\r\n            subShapeNode.transform = x.transform;\r\n            x.parent?.insertAfter(x.previousSibling, subShapeNode);\r\n        } else {\r\n            this.groupShapes(x, subShapes);\r\n        }\r\n\r\n        x.parent?.remove(x);\r\n    }\r\n\r\n    private groupShapes(node: ShapeNode, subShapes: IShape[]) {\r\n        const folder = new GroupNode(this.document, node.name);\r\n        folder.transform = node.transform;\r\n        node.parent?.insertAfter(node.previousSibling, folder);\r\n\r\n        let i = 1;\r\n        for (const subShape of subShapes) {\r\n            const name = `${ShapeType.stringValue(subShape.shapeType)} ${i++}`;\r\n            let subShapeNode = new EditableShapeNode(this.document, name, subShape);\r\n            folder.add(subShapeNode);\r\n        }\r\n    }\r\n\r\n    private explodeComponentNode(x: ComponentNode) {\r\n        for (const node of x.component.nodes) {\r\n            const newNode = node.clone();\r\n            newNode.transform = node.transform.multiply(x.transform);\r\n            x.parent?.insertAfter(x.previousSibling, newNode);\r\n        }\r\n\r\n        x.parent?.remove(x);\r\n    }\r\n\r\n    private explodeMultiShapeNode(x: MultiShapeNode) {\r\n        for (const shape of x.shapes) {\r\n            const node = new EditableShapeNode(this.document, x.name, shape.transformed(x.transform));\r\n            x.parent?.insertAfter(x.previousSibling, node);\r\n        }\r\n\r\n        x.parent?.remove(x);\r\n        x.shapes.forEach((x) => x.dispose());\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    ISubEdgeShape,\r\n    Property,\r\n    ShapeNode,\r\n    ShapeType,\r\n    Transaction,\r\n    VisualState,\r\n    command,\r\n} from \"chili-core\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.fillet\",\r\n    icon: \"icon-fillet\",\r\n})\r\nexport class FilletCommand extends MultistepCommand {\r\n    @Property.define(\"circle.radius\")\r\n    get radius() {\r\n        return this.getPrivateValue(\"radius\", 10);\r\n    }\r\n\r\n    set radius(value: number) {\r\n        this.setProperty(\"radius\", value);\r\n    }\r\n\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\r\n            const edges = this.stepDatas.at(-1)!.shapes.map((x) => (x.shape as ISubEdgeShape).index);\r\n            const filetShape = this.document.application.shapeFactory.fillet(\r\n                node.shape.value,\r\n                edges,\r\n                this.radius,\r\n            );\r\n\r\n            const model = new EditableShapeNode(this.document, node.name, filetShape, node.materialId);\r\n            model.transform = node.transform;\r\n            (node.parent ?? this.document.rootNode).add(model);\r\n            node.parent?.remove(node);\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected override getSteps() {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                shapeFilter: {\r\n                    allow: (shape) => {\r\n                        return (\r\n                            shape.shapeType === ShapeType.Solid ||\r\n                            shape.shapeType === ShapeType.Compound ||\r\n                            shape.shapeType === ShapeType.CompoundSolid\r\n                        );\r\n                    },\r\n                },\r\n                selectedState: VisualState.faceTransparent,\r\n            }),\r\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\", {\r\n                multiple: true,\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    BoundingBox,\r\n    ComponentNode,\r\n    EdgeMeshData,\r\n    GeometryNode,\r\n    LineType,\r\n    Matrix4,\r\n    MeshNode,\r\n    Property,\r\n    PubSub,\r\n    Transaction,\r\n    VisualConfig,\r\n    VisualNode,\r\n    XYZ,\r\n} from \"chili-core\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\nexport abstract class TransformedCommand extends MultistepCommand {\r\n    protected models?: VisualNode[];\r\n    protected positions?: number[];\r\n\r\n    @Property.define(\"common.clone\")\r\n    get isClone() {\r\n        return this.getPrivateValue(\"isClone\", false);\r\n    }\r\n    set isClone(value: boolean) {\r\n        this.setProperty(\"isClone\", value);\r\n    }\r\n\r\n    protected abstract transfrom(p2: XYZ): Matrix4;\r\n\r\n    protected transformPreview = (point: XYZ): EdgeMeshData => {\r\n        const transform = this.transfrom(point);\r\n        const positions = transform.ofPoints(this.positions!);\r\n        return {\r\n            position: new Float32Array(positions),\r\n            lineType: LineType.Solid,\r\n            color: VisualConfig.defaultEdgeColor,\r\n            range: [],\r\n        };\r\n    };\r\n\r\n    private async ensureSelectedModels() {\r\n        this.models = this.document.selection.getSelectedNodes().filter((x) => x instanceof VisualNode);\r\n        if (this.models.length > 0) return true;\r\n\r\n        this.controller = new AsyncController();\r\n        this.models = await this.document.selection.pickNode(\"prompt.select.models\", this.controller, true);\r\n\r\n        if (this.models.length > 0) return true;\r\n        if (this.controller.result?.status === \"success\") {\r\n            PubSub.default.pub(\"showToast\", \"toast.select.noSelected\");\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected override async canExcute(): Promise<boolean> {\r\n        if (!(await this.ensureSelectedModels())) return false;\r\n\r\n        this.positions = this.models!.flatMap((model) => {\r\n            if (model instanceof MeshNode) {\r\n                return model.mesh.position ? model.transform.ofPoints(model.mesh.position) : [];\r\n            } else if (model instanceof GeometryNode) {\r\n                return model.mesh.edges?.position ? model.transform.ofPoints(model.mesh.edges.position) : [];\r\n            } else if (model instanceof ComponentNode) {\r\n                return Array.from(BoundingBox.wireframe(model.boundingBox()!).position);\r\n            }\r\n            return [];\r\n        });\r\n        return true;\r\n    }\r\n\r\n    protected getTempLineData(start: XYZ, end: XYZ) {\r\n        return EdgeMeshData.from(start, end, VisualConfig.temporaryEdgeColor, LineType.Solid);\r\n    }\r\n\r\n    protected executeMainTask(): void {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const models = this.isClone ? this.models?.map((x) => x.clone()) : this.models;\r\n            const transform = this.transfrom(this.stepDatas.at(-1)!.point!);\r\n\r\n            models?.forEach((x) => {\r\n                x.transform = x.transform.multiply(transform);\r\n            });\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Matrix4, Plane, ShapeMeshData, XYZ, command } from \"chili-core\";\r\nimport { Dimension, PointSnapData } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { TransformedCommand } from \"./transformedCommand\";\r\n\r\n@command({\r\n    key: \"modify.mirror\",\r\n    icon: \"icon-mirror\",\r\n})\r\nexport class Mirror extends TransformedCommand {\r\n    protected override transfrom(point: XYZ): Matrix4 {\r\n        const center = this.stepDatas[0].point!;\r\n        const xvec = this.stepDatas[0].view.workplane.normal;\r\n        const yvec = point.sub(center);\r\n        const normal = yvec.cross(xvec);\r\n        const plane = new Plane(center, normal, xvec);\r\n        return Matrix4.createMirrorWithPlane(plane);\r\n    }\r\n\r\n    getSteps(): IStep[] {\r\n        let firstStep = new PointStep(\"prompt.pickFistPoint\", undefined, true);\r\n        let secondStep = new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData, true);\r\n        return [firstStep, secondStep];\r\n    }\r\n\r\n    private readonly getSecondPointData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas[0].point!,\r\n            dimension: Dimension.D1D2,\r\n            preview: this.mirrorPreview,\r\n            validator: (p) => {\r\n                const vec = p.sub(this.stepDatas[0].point!);\r\n                return vec.length() > 1e-3 && !vec.isParallelTo(this.stepDatas[0].view.workplane.normal);\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly mirrorPreview = (point: XYZ | undefined): ShapeMeshData[] => {\r\n        const p1 = this.meshPoint(this.stepDatas[0].point!);\r\n        if (!point) return [p1];\r\n        const shape = this.transformPreview(point);\r\n        const offset = point.sub(this.stepDatas[0].point!).normalize()!.multiply(1e6);\r\n        const line = this.getTempLineData(this.stepDatas[0].point!.sub(offset), point.add(offset));\r\n        return [p1, shape, line];\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Matrix4, XYZ, command } from \"chili-core\";\r\nimport { Dimension, PointSnapData } from \"../../snap\";\r\nimport { IStep, PointStep } from \"../../step\";\r\nimport { TransformedCommand } from \"./transformedCommand\";\r\n\r\n@command({\r\n    key: \"modify.move\",\r\n    icon: \"icon-move\",\r\n})\r\nexport class Move extends TransformedCommand {\r\n    getSteps(): IStep[] {\r\n        return [\r\n            new PointStep(\"prompt.pickFistPoint\", undefined, true),\r\n            new PointStep(\"prompt.pickNextPoint\", this.getSecondPointData, true),\r\n        ];\r\n    }\r\n\r\n    private readonly getSecondPointData = (): PointSnapData => {\r\n        return {\r\n            refPoint: () => this.stepDatas[0].point!,\r\n            dimension: Dimension.D1D2D3,\r\n            preview: this.movePreview,\r\n        };\r\n    };\r\n\r\n    private readonly movePreview = (point: XYZ | undefined) => {\r\n        const p1 = this.meshPoint(this.stepDatas[0].point!);\r\n        if (!point) return [p1];\r\n        return [p1, this.transformPreview(point), this.getTempLineData(this.stepDatas[0].point!, point)];\r\n    };\r\n\r\n    protected override transfrom(point: XYZ): Matrix4 {\r\n        const { x, y, z } = point.sub(this.stepDatas[0].point!);\r\n        return Matrix4.fromTranslation(x, y, z);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    IFace,\r\n    ShapeNode,\r\n    ShapeType,\r\n    Transaction,\r\n    VisualState,\r\n    command,\r\n} from \"chili-core\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.removeFeature\",\r\n    icon: \"icon-removeFeature\",\r\n})\r\nexport class RemoveFaceCommand extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\r\n            const faces = this.stepDatas.at(-1)!.shapes.map((x) => x.shape as IFace);\r\n            const filetShape = this.document.application.shapeFactory.removeFeature(node.shape.value, faces);\r\n\r\n            const model = new EditableShapeNode(this.document, node.name, filetShape, node.materialId);\r\n            model.transform = node.transform;\r\n\r\n            this.document.addNode(model);\r\n            node.parent?.remove(node);\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected override getSteps() {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                shapeFilter: {\r\n                    allow: (shape) => {\r\n                        return (\r\n                            shape.shapeType === ShapeType.Solid ||\r\n                            shape.shapeType === ShapeType.Compound ||\r\n                            shape.shapeType === ShapeType.CompoundSolid\r\n                        );\r\n                    },\r\n                },\r\n                selectedState: VisualState.faceTransparent,\r\n            }),\r\n            new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\", {\r\n                multiple: true,\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { EditableShapeNode, ShapeNode, ShapeType, Transaction, VisualState, command } from \"chili-core\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.removeShapes\",\r\n    icon: \"icon-removeSubShape\",\r\n})\r\nexport class RemoveSubShapesCommand extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const node = this.stepDatas[0].shapes[0].owner.node as ShapeNode;\r\n            const subShapes = this.stepDatas.at(-1)!.shapes.map((x) => x.shape);\r\n            const shape = this.document.application.shapeFactory.removeSubShape(node.shape.value, subShapes);\r\n\r\n            const model = new EditableShapeNode(this.document, node.name, shape, node.materialId);\r\n            model.transform = node.transform;\r\n\r\n            node.parent?.insertAfter(node.previousSibling, model);\r\n            node.parent?.remove(node);\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    protected override getSteps() {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                shapeFilter: {\r\n                    allow: (shape) => {\r\n                        return shape.shapeType !== ShapeType.Vertex && shape.shapeType !== ShapeType.Edge;\r\n                    },\r\n                },\r\n                selectedState: VisualState.faceTransparent,\r\n            }),\r\n            new SelectShapeStep(ShapeType.Edge | ShapeType.Face, \"prompt.select.shape\", {\r\n                multiple: true,\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Matrix4, Precision, ShapeMeshData, XYZ, command } from \"chili-core\";\r\nimport { Dimension, PointSnapData, SnapLengthAtPlaneData } from \"../../snap\";\r\nimport { AngleStep, IStep, LengthAtPlaneStep, PointStep } from \"../../step\";\r\nimport { TransformedCommand } from \"./transformedCommand\";\r\n\r\n@command({\r\n    key: \"modify.rotate\",\r\n    icon: \"icon-rotate\",\r\n})\r\nexport class Rotate extends TransformedCommand {\r\n    protected override transfrom(point: XYZ): Matrix4 {\r\n        const normal = this.stepDatas[1].plane!.normal;\r\n        const center = this.stepDatas[0].point!;\r\n        const angle = this.getAngle(point);\r\n        return Matrix4.fromAxisRad(center, normal, angle);\r\n    }\r\n\r\n    getSteps(): IStep[] {\r\n        let firstStep = new PointStep(\"prompt.pickFistPoint\", undefined, true);\r\n        let secondStep = new LengthAtPlaneStep(\"prompt.pickNextPoint\", this.getSecondPointData, true);\r\n        let thirdStep = new AngleStep(\r\n            \"prompt.pickNextPoint\",\r\n            () => this.stepDatas[0].point!,\r\n            () => this.stepDatas[1].point!,\r\n            this.getThirdPointData,\r\n            true,\r\n        );\r\n        return [firstStep, secondStep, thirdStep];\r\n    }\r\n\r\n    private readonly getSecondPointData = (): SnapLengthAtPlaneData => {\r\n        const { point, view } = this.stepDatas[0];\r\n        return {\r\n            point: () => point!,\r\n            preview: this.circlePreview,\r\n            plane: (p: XYZ | undefined) => this.findPlane(view, point!, p),\r\n            validator: (p: XYZ) => {\r\n                if (p.distanceTo(point!) < Precision.Distance) return false;\r\n                return p.sub(point!).isParallelTo(this.stepDatas[0].view.workplane.normal) === false;\r\n            },\r\n        };\r\n    };\r\n\r\n    private readonly circlePreview = (end: XYZ | undefined) => {\r\n        const visualCenter = this.meshPoint(this.stepDatas[0].point!);\r\n        if (!end) return [visualCenter];\r\n        const { point, view } = this.stepDatas[0];\r\n        const plane = this.findPlane(view, point!, end);\r\n        return [\r\n            visualCenter,\r\n            this.meshLine(this.stepDatas[0].point!, end),\r\n            this.meshCreatedShape(\"circle\", plane.normal, point!, plane.projectDistance(point!, end)),\r\n        ];\r\n    };\r\n\r\n    private readonly getThirdPointData = (): PointSnapData => {\r\n        return {\r\n            dimension: Dimension.D1D2,\r\n            preview: this.anglePreview,\r\n            plane: () => this.stepDatas[1].plane!,\r\n            validator: (p) => {\r\n                return (\r\n                    p.distanceTo(this.stepDatas[0].point!) > 1e-3 &&\r\n                    p.distanceTo(this.stepDatas[1].point!) > 1e-3\r\n                );\r\n            },\r\n        };\r\n    };\r\n\r\n    private getAngle(point: XYZ) {\r\n        const normal = this.stepDatas[1].plane!.normal;\r\n        const center = this.stepDatas[0].point!;\r\n        const p1 = this.stepDatas[1].point!;\r\n        const v1 = p1.sub(center);\r\n        const v2 = point.sub(center);\r\n        return v1.angleOnPlaneTo(v2, normal)!;\r\n    }\r\n\r\n    private readonly anglePreview = (point: XYZ | undefined): ShapeMeshData[] => {\r\n        point = point ?? this.stepDatas[1].point!;\r\n        const result = [\r\n            this.transformPreview(point),\r\n            this.meshPoint(this.stepDatas[0].point!),\r\n            this.meshPoint(this.stepDatas[1].point!),\r\n            this.getRayData(this.stepDatas[1].point!),\r\n            this.getRayData(point),\r\n        ];\r\n\r\n        const angle = this.getAngle(point);\r\n        if (Math.abs(angle) > Precision.Angle) {\r\n            result.push(\r\n                this.meshCreatedShape(\r\n                    \"arc\",\r\n                    this.stepDatas[1].plane!.normal,\r\n                    this.stepDatas[0].point!,\r\n                    this.stepDatas[1].point!,\r\n                    (angle * 180) / Math.PI,\r\n                ),\r\n            );\r\n        }\r\n        return result;\r\n    };\r\n\r\n    private getRayData(end: XYZ) {\r\n        let center = this.stepDatas[0].point!;\r\n        let rayEnd = center.add(end.sub(center).normalize()!.multiply(1e6));\r\n        return this.getTempLineData(center, rayEnd);\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    IEdge,\r\n    IVisualObject,\r\n    ShapeType,\r\n    Transaction,\r\n    VisualState,\r\n    command,\r\n} from \"chili-core\";\r\nimport { IStep } from \"../../step\";\r\nimport { SelectShapeStep } from \"../../step/selectStep\";\r\nimport { MultistepCommand } from \"../multistepCommand\";\r\n\r\n@command({\r\n    key: \"modify.split\",\r\n    icon: \"icon-split\",\r\n})\r\nexport class Split extends MultistepCommand {\r\n    private splitedShape() {\r\n        const shape1 = this.stepDatas[0].shapes[0].shape;\r\n        const invertTransform = this.stepDatas[0].shapes[0].transform.invert()!;\r\n        const edges = this.stepDatas[1].shapes.map((x) =>\r\n            x.shape.transformedMul(x.transform.multiply(invertTransform)),\r\n        ) as IEdge[];\r\n        const result = shape1.split(edges);\r\n\r\n        edges.forEach((x) => x.dispose());\r\n\r\n        return result;\r\n    }\r\n\r\n    protected override executeMainTask() {\r\n        Transaction.execute(this.document, `excute ${Object.getPrototypeOf(this).data.name}`, () => {\r\n            const old = this.stepDatas[0].nodes![0];\r\n            const shape = this.splitedShape();\r\n\r\n            const model = new EditableShapeNode(this.document, old.name, shape);\r\n            model.transform = old.transform;\r\n            old.parent?.add(model);\r\n\r\n            this.removeModels(\r\n                this.stepDatas[0].shapes[0].owner,\r\n                ...this.stepDatas[1].shapes.map((x) => x.owner),\r\n            );\r\n            this.document.visual.update();\r\n        });\r\n    }\r\n\r\n    private removeModels(...shapes: IVisualObject[]) {\r\n        shapes.forEach((x) => {\r\n            const model = this.document.visual.context.getNode(x);\r\n            model?.parent?.remove(model);\r\n        });\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Shape, \"prompt.select.shape\", {\r\n                selectedState: VisualState.faceTransparent,\r\n            }),\r\n            new SelectShapeStep(ShapeType.Wire | ShapeType.Edge, \"prompt.select.shape\", {\r\n                multiple: true,\r\n                keepSelection: true,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    AsyncController,\r\n    BoundingBox,\r\n    CancelableCommand,\r\n    EditableShapeNode,\r\n    GeometryNode,\r\n    I18n,\r\n    ICurve,\r\n    IDisposable,\r\n    IDocument,\r\n    IEdge,\r\n    IShape,\r\n    IShapeFilter,\r\n    ITrimmedCurve,\r\n    IView,\r\n    IVisualGeometry,\r\n    ShapeNode,\r\n    ShapeType,\r\n    Transaction,\r\n    VisualConfig,\r\n    VisualShapeData,\r\n    command,\r\n} from \"chili-core\";\r\nimport { GeoUtils } from \"chili-geo\";\r\nimport { ShapeSelectionHandler } from \"chili-vis\";\r\n\r\n@command({\r\n    key: \"modify.trim\",\r\n    icon: \"icon-trim\",\r\n})\r\nexport class Trim extends CancelableCommand {\r\n    protected override async executeAsync() {\r\n        let transaction = new Transaction(this.document, I18n.translate(\"command.modify.trim\"));\r\n        transaction.start();\r\n        try {\r\n            await this.trimAsync();\r\n        } catch (e) {\r\n            transaction.rollback();\r\n            throw e;\r\n        }\r\n        transaction.commit();\r\n    }\r\n\r\n    private async trimAsync() {\r\n        this.document.visual.highlighter.clear();\r\n        this.document.selection.clearSelection();\r\n\r\n        while (!this.isCompleted) {\r\n            this.controller = new AsyncController();\r\n            let handler = new PickTrimEdgeEventHandler(this.document, this.controller);\r\n            await this.document.selection.pickAsync(\r\n                handler,\r\n                \"prompt.select.edges\",\r\n                this.controller,\r\n                false,\r\n                \"select.default\",\r\n            );\r\n            if (this.controller.result?.status !== \"success\" || !handler.selected) {\r\n                break;\r\n            }\r\n            this.trimEdge(handler.selected);\r\n            handler.dispose();\r\n        }\r\n    }\r\n\r\n    private trimEdge(selected: TrimEdge) {\r\n        let model = this.document.visual.context.getNode(selected.edge.owner);\r\n        let materialId = (model as GeometryNode)?.materialId;\r\n        selected.segments.retainSegments.forEach((segment) => {\r\n            let newEdge = selected.curve.trim(segment.start, segment.end).makeEdge();\r\n            model?.parent?.add(new EditableShapeNode(this.document, model.name, newEdge, materialId));\r\n        });\r\n        model?.parent?.remove(model);\r\n    }\r\n}\r\n\r\nexport class EdgeFilter implements IShapeFilter {\r\n    allow(shape: IShape): boolean {\r\n        return shape.shapeType === ShapeType.Edge;\r\n    }\r\n}\r\n\r\ninterface TrimEdge {\r\n    edge: VisualShapeData;\r\n    curve: ICurve;\r\n    segments: {\r\n        deleteSegment: {\r\n            start: number;\r\n            end: number;\r\n        };\r\n        retainSegments: {\r\n            start: number;\r\n            end: number;\r\n        }[];\r\n    };\r\n}\r\n\r\nexport class PickTrimEdgeEventHandler extends ShapeSelectionHandler {\r\n    #selected: TrimEdge | undefined;\r\n    private highlightedEdge: number | undefined;\r\n    private highlight: undefined | TrimEdge;\r\n    private readonly releaseStack = new Set<IDisposable>();\r\n\r\n    get selected() {\r\n        return this.#selected;\r\n    }\r\n\r\n    constructor(document: IDocument, controller: AsyncController) {\r\n        super(document, ShapeType.Shape, false, controller, new EdgeFilter());\r\n    }\r\n\r\n    protected override highlightDetecteds(view: IView, detecteds: VisualShapeData[]): void {\r\n        this.cleanHighlights();\r\n        if (detecteds.length !== 1 || detecteds[0].shape.shapeType !== ShapeType.Edge) return;\r\n\r\n        const box = BoundingBox.transformed(detecteds[0].owner.boundingBox()!, detecteds[0].transform);\r\n        const edges = this.filterByBoundingBox(box, view, detecteds[0].shape.id);\r\n        const edge = detecteds[0].shape.transformedMul(detecteds[0].transform) as IEdge;\r\n        this.releaseStack.add(edge);\r\n\r\n        let segments = findSegments(edge.curve, edge, edges, detecteds);\r\n        let mesh = edge.trim(segments.deleteSegment.start, segments.deleteSegment.end).mesh.edges!;\r\n        mesh.color = VisualConfig.highlightEdgeColor;\r\n        mesh.lineWidth = 3;\r\n        this.highlightedEdge = view.document.visual.highlighter.highlightMesh(mesh);\r\n        this.highlight = { edge: detecteds[0], segments, curve: edge.curve };\r\n        view.update();\r\n    }\r\n\r\n    protected override cleanHighlights(): void {\r\n        if (this.highlightedEdge !== undefined) {\r\n            this.document.visual.highlighter.removeHighlightMesh(this.highlightedEdge);\r\n            this.highlightedEdge = undefined;\r\n            this.highlight = undefined;\r\n            this.document.application.activeView?.update();\r\n        }\r\n    }\r\n\r\n    protected override clearSelected(document: IDocument): void {\r\n        this.#selected = undefined;\r\n    }\r\n\r\n    protected override select(view: IView, event: PointerEvent): number {\r\n        this.#selected = this.highlight;\r\n        return this.#selected ? 1 : 0;\r\n    }\r\n\r\n    private filterByBoundingBox(box: BoundingBox, view: IView, currentId: string) {\r\n        let boundingBox = BoundingBox.expand(box, 1e-3);\r\n        return view.document.visual.context\r\n            .boundingBoxIntersectFilter(boundingBox, new EdgeFilter())\r\n            .map((x) => {\r\n                const node = (x as IVisualGeometry)?.geometryNode;\r\n                const shape = (node as ShapeNode)?.shape.value;\r\n                if (shape.id === currentId) return undefined;\r\n                const edge = shape.transformedMul(node.worldTransform()) as IEdge;\r\n                this.releaseStack.add(edge);\r\n                return edge;\r\n            })\r\n            .filter((x) => x !== undefined);\r\n    }\r\n\r\n    override disposeInternal(): void {\r\n        super.disposeInternal();\r\n\r\n        this.releaseStack.forEach((x) => x.dispose());\r\n        this.releaseStack.clear();\r\n    }\r\n}\r\n\r\nfunction findSegments(curve: ITrimmedCurve, edge: IEdge, otherEdges: IEdge[], detecteds: VisualShapeData[]) {\r\n    let intersections = GeoUtils.intersects(edge, otherEdges).map((x) => x.parameter);\r\n    intersections.push(curve.firstParameter(), curve.lastParameter());\r\n    intersections = Array.from(new Set(intersections)).sort((a, b) => a - b);\r\n\r\n    if (intersections.length === 2) return allSegment(intersections);\r\n\r\n    let parameter = curve.parameter(detecteds[0].point!, 5)!;\r\n    for (let i = 1; i < intersections.length; i++) {\r\n        if (parameter < intersections[i]) {\r\n            if (i === 1) {\r\n                return startSegment(intersections);\r\n            } else if (i === intersections.length - 1) {\r\n                return lastSegment(intersections);\r\n            } else {\r\n                return centerSegment(intersections, i);\r\n            }\r\n        }\r\n    }\r\n\r\n    return allSegment(intersections);\r\n}\r\n\r\nfunction allSegment(intersections: number[]) {\r\n    return {\r\n        deleteSegment: {\r\n            start: intersections[0],\r\n            end: intersections.at(-1)!,\r\n        },\r\n        retainSegments: [],\r\n    };\r\n}\r\n\r\nfunction centerSegment(intersections: number[], i: number) {\r\n    return {\r\n        deleteSegment: {\r\n            start: intersections.at(i - 1)!,\r\n            end: intersections.at(i)!,\r\n        },\r\n        retainSegments: [\r\n            {\r\n                start: intersections[0],\r\n                end: intersections[i - 1],\r\n            },\r\n            {\r\n                start: intersections[i],\r\n                end: intersections.at(-1)!,\r\n            },\r\n        ],\r\n    };\r\n}\r\n\r\nfunction lastSegment(intersections: number[]) {\r\n    return {\r\n        deleteSegment: {\r\n            start: intersections.at(-2)!,\r\n            end: intersections.at(-1)!,\r\n        },\r\n        retainSegments: [\r\n            {\r\n                start: intersections[0],\r\n                end: intersections.at(-2)!,\r\n            },\r\n        ],\r\n    };\r\n}\r\n\r\nfunction startSegment(intersections: number[]) {\r\n    return {\r\n        deleteSegment: {\r\n            start: intersections[0],\r\n            end: intersections[1],\r\n        },\r\n        retainSegments: [\r\n            {\r\n                start: intersections[1],\r\n                end: intersections.at(-1)!,\r\n            },\r\n        ],\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, IApplication, ICommand } from \"chili-core\";\r\n\r\n@command({\r\n    key: \"edit.redo\",\r\n    icon: \"icon-redo\",\r\n})\r\nexport class Redo implements ICommand {\r\n    async execute(app: IApplication): Promise<void> {\r\n        const document = app.activeView?.document;\r\n        document?.history.redo();\r\n        document?.visual.update();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { command, IApplication, ICommand } from \"chili-core\";\r\n\r\n@command({\r\n    key: \"edit.undo\",\r\n    icon: \"icon-undo\",\r\n})\r\nexport class Undo implements ICommand {\r\n    async execute(application: IApplication): Promise<void> {\r\n        const document = application.activeView?.document;\r\n        document?.history.undo();\r\n        document?.visual.update();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { RadioGroup, div } from \"chili-controls\";\r\nimport {\r\n    AsyncController,\r\n    DialogResult,\r\n    I18n,\r\n    IApplication,\r\n    ICommand,\r\n    ICurve,\r\n    IEdge,\r\n    IFace,\r\n    Observable,\r\n    Plane,\r\n    Property,\r\n    PubSub,\r\n    SelectMode,\r\n    SelectableItems,\r\n    ShapeType,\r\n    XYZ,\r\n    command,\r\n} from \"chili-core\";\r\nimport { Dimension } from \"../snap\";\r\nimport { IStep, PointOnCurveStep, SelectShapeStep } from \"../step\";\r\nimport { MultistepCommand } from \"./multistepCommand\";\r\n\r\nexport class WorkingPlaneViewModel extends Observable {\r\n    @Property.define(\"dialog.title.selectWorkingPlane\")\r\n    planes: SelectableItems<string> = new SelectableItems([\"XOY\", \"YOZ\", \"ZOX\"], SelectMode.radio, [\"XOY\"]);\r\n}\r\n\r\n@command({\r\n    key: \"workingPlane.set\",\r\n    icon: \"icon-setWorkingPlane\",\r\n})\r\nexport class SetWorkplane implements ICommand {\r\n    async execute(application: IApplication): Promise<void> {\r\n        const view = application.activeView;\r\n        if (!view) return;\r\n\r\n        const vm = new WorkingPlaneViewModel();\r\n        PubSub.default.pub(\"showDialog\", \"dialog.title.selectWorkingPlane\", this.ui(vm), (result) => {\r\n            if (result === DialogResult.ok) {\r\n                const planes = [Plane.XY, Plane.YZ, Plane.ZX];\r\n                view.workplane = planes[vm.planes.selectedIndexes[0]];\r\n            }\r\n        });\r\n    }\r\n\r\n    private ui(vm: WorkingPlaneViewModel) {\r\n        return div(\r\n            ...Property.getProperties(vm).map((x) => {\r\n                const value = (vm as any)[x.name];\r\n                if (value instanceof SelectableItems) {\r\n                    return new RadioGroup(I18n.translate(x.display), value);\r\n                }\r\n                return \"\";\r\n            }),\r\n        );\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"workingPlane.alignToPlane\",\r\n    icon: \"icon-alignWorkingPlane\",\r\n})\r\nexport class AlignToPlane implements ICommand {\r\n    async execute(application: IApplication): Promise<void> {\r\n        const view = application.activeView;\r\n        if (!view) return;\r\n        view.document.selection.clearSelection();\r\n        const controller = new AsyncController();\r\n        const data = await new SelectShapeStep(ShapeType.Face, \"prompt.select.faces\").execute(\r\n            view.document,\r\n            controller,\r\n        );\r\n        controller.dispose();\r\n        if (!data || data.shapes.length === 0) return;\r\n        view.document.visual.highlighter.clear();\r\n        const face = data.shapes[0].shape.transformedMul(data.shapes[0].transform) as IFace;\r\n        const [point, normal] = face.normal(0, 0);\r\n        face.dispose();\r\n        let xvec = XYZ.unitX;\r\n        if (!normal.isParallelTo(XYZ.unitZ)) {\r\n            xvec = XYZ.unitZ.cross(normal).normalize()!;\r\n        }\r\n        view.workplane = new Plane(point, normal, xvec);\r\n    }\r\n}\r\n\r\n@command({\r\n    key: \"workingPlane.fromSection\",\r\n    icon: \"icon-fromSection\",\r\n})\r\nexport class FromSection extends MultistepCommand {\r\n    protected override executeMainTask() {\r\n        const curve = this.transformedCurve();\r\n        const point = this.stepDatas[1].point!;\r\n\r\n        const parameter = curve.parameter(point, 1e-3);\r\n        if (parameter === undefined) return;\r\n        const direction = curve.d1(parameter).vec.normalize()!;\r\n        let xvec: XYZ = this.findXVec(direction);\r\n        const plane = new Plane(point, direction, xvec);\r\n        const view = this.application.activeView;\r\n        if (!view) return;\r\n        view.workplane = plane;\r\n    }\r\n\r\n    private findXVec(direction: XYZ) {\r\n        let xvec: XYZ;\r\n        if (direction.isEqualTo(XYZ.unitZ)) {\r\n            xvec = XYZ.unitX;\r\n        } else if (direction.isEqualTo(new XYZ(0, 0, -1))) {\r\n            xvec = XYZ.unitY;\r\n        } else {\r\n            xvec = direction.cross(XYZ.unitZ).normalize()!;\r\n        }\r\n        return xvec;\r\n    }\r\n\r\n    protected override getSteps(): IStep[] {\r\n        return [\r\n            new SelectShapeStep(ShapeType.Edge, \"prompt.select.edges\"),\r\n            new PointOnCurveStep(\"prompt.pickFistPoint\", this.handlePointData, true),\r\n        ];\r\n    }\r\n\r\n    private transformedCurve() {\r\n        const shape = this.stepDatas[0].shapes[0].shape as IEdge;\r\n        const matrix = shape.matrix.multiply(this.stepDatas[0].shapes[0].transform);\r\n        const curve = shape.curve.transformed(matrix) as ICurve;\r\n        this.disposeStack.add(curve);\r\n        return curve;\r\n    }\r\n\r\n    private readonly handlePointData = () => {\r\n        const curve = this.transformedCurve();\r\n        return {\r\n            curve,\r\n            dimension: Dimension.D1,\r\n            preview: (point: XYZ | undefined) => {\r\n                if (!point) return [];\r\n                let project = curve.project(point).at(0);\r\n                return [this.meshPoint(project ?? point)];\r\n            },\r\n        };\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IDocument, INode, PubSub } from \"chili-core\";\r\nimport { NodeSelectionHandler } from \"chili-vis\";\r\n\r\nexport class EditEventHandler extends NodeSelectionHandler {\r\n    constructor(\r\n        document: IDocument,\r\n        readonly selectedNodes: INode[],\r\n    ) {\r\n        super(document, true);\r\n        PubSub.default.pub(\"showProperties\", document, selectedNodes);\r\n    }\r\n\r\n    override disposeInternal() {\r\n        PubSub.default.pub(\"showProperties\", this.document, []);\r\n        super.disposeInternal();\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Command, CommandKeys, IApplication, ICommand, IService, IView, Logger, PubSub } from \"chili-core\";\r\n\r\nconst ApplicationCommands: CommandKeys[] = [\"doc.new\", \"doc.open\", \"doc.save\"];\r\n\r\nexport class CommandService implements IService {\r\n    private _lastCommand: CommandKeys | undefined;\r\n    private _checking: boolean = false;\r\n    private _app: IApplication | undefined;\r\n\r\n    private get app(): IApplication {\r\n        if (this._app === undefined) {\r\n            throw new Error(\"Executor is not initialized\");\r\n        }\r\n        return this._app;\r\n    }\r\n\r\n    start(): void {\r\n        PubSub.default.sub(\"executeCommand\", this.executeCommand);\r\n        PubSub.default.sub(\"activeViewChanged\", this.onActiveViewChanged);\r\n        Logger.info(`${CommandService.name} started`);\r\n    }\r\n\r\n    stop(): void {\r\n        PubSub.default.remove(\"executeCommand\", this.executeCommand);\r\n        PubSub.default.remove(\"activeViewChanged\", this.onActiveViewChanged);\r\n        Logger.info(`${CommandService.name} stoped`);\r\n    }\r\n\r\n    register(app: IApplication) {\r\n        this._app = app;\r\n        Logger.info(`${CommandService.name} registed`);\r\n    }\r\n\r\n    private readonly onActiveViewChanged = async (view: IView | undefined) => {\r\n        if (this.app.executingCommand && ICommand.isCancelableCommand(this.app.executingCommand))\r\n            await this.app.executingCommand.cancel();\r\n    };\r\n\r\n    private readonly executeCommand = async (commandName: CommandKeys) => {\r\n        const command = commandName === \"special.last\" ? this._lastCommand : commandName;\r\n        if (!command || !(await this.canExecute(command))) return;\r\n        Logger.info(`executing command ${command}`);\r\n        await this.executeAsync(command);\r\n    };\r\n\r\n    private async executeAsync(commandName: CommandKeys) {\r\n        const commandCtor = Command.get(commandName)!;\r\n        const command = new commandCtor();\r\n        this.app.executingCommand = command;\r\n        PubSub.default.pub(\"showProperties\", this.app.activeView?.document!, []);\r\n        try {\r\n            await command.execute(this.app);\r\n        } catch (err) {\r\n            PubSub.default.pub(\"displayError\", err as string);\r\n            Logger.error(err);\r\n        } finally {\r\n            this._lastCommand = commandName;\r\n            this.app.executingCommand = undefined;\r\n        }\r\n    }\r\n\r\n    private async canExecute(commandName: CommandKeys) {\r\n        if (this._checking) return false;\r\n        this._checking = true;\r\n        const result = await this.checking(commandName);\r\n        this._checking = false;\r\n        return result;\r\n    }\r\n\r\n    private async checking(commandName: CommandKeys) {\r\n        if (!Command.get(commandName)) {\r\n            Logger.error(`Can not find ${commandName} command`);\r\n            return false;\r\n        }\r\n        if (!ApplicationCommands.includes(commandName) && this.app.activeView === undefined) {\r\n            Logger.error(\"No active document\");\r\n            return false;\r\n        }\r\n        if (!this.app.executingCommand) {\r\n            return true;\r\n        }\r\n        if (Command.getData(this.app.executingCommand)?.key === commandName) {\r\n            PubSub.default.pub(\"showToast\", \"toast.command.{0}excuting\", commandName);\r\n            return false;\r\n        }\r\n        if (ICommand.isCancelableCommand(this.app.executingCommand)) {\r\n            await this.app.executingCommand.cancel();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { IApplication, IDocument, IEventHandler, INode, IService, Logger, PubSub } from \"chili-core\";\r\n\r\nexport class EditorService implements IService {\r\n    private editHandler?: IEventHandler;\r\n\r\n    constructor(readonly factory: (document: IDocument, selected: INode[]) => IEventHandler) {}\r\n\r\n    register(_app: IApplication): void {\r\n        Logger.info(`${EditorService.name} registed`);\r\n    }\r\n\r\n    start(): void {\r\n        PubSub.default.sub(\"selectionChanged\", this.handleSelectionChanged);\r\n        Logger.info(`${EditorService.name} started`);\r\n    }\r\n\r\n    stop(): void {\r\n        PubSub.default.remove(\"selectionChanged\", this.handleSelectionChanged);\r\n        Logger.info(`${EditorService.name} stopped`);\r\n    }\r\n\r\n    private readonly handleSelectionChanged = (document: IDocument, selected: INode[]) => {\r\n        this.editHandler?.dispose();\r\n        this.editHandler = undefined;\r\n\r\n        if (document.application.executingCommand) return;\r\n\r\n        if (selected.length > 0) {\r\n            this.editHandler = this.factory(document, selected);\r\n            document.visual.eventHandler = this.editHandler;\r\n        } else {\r\n            document.visual.resetEventHandler();\r\n        }\r\n    };\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { CommandKeys, IApplication, IService, Logger, PubSub } from \"chili-core\";\r\n\r\nexport interface Keys {\r\n    key: string;\r\n    ctrlKey?: boolean;\r\n    shiftKey?: boolean;\r\n    altKey?: boolean;\r\n}\r\n\r\nexport interface HotkeyMap {\r\n    [key: string]: CommandKeys;\r\n}\r\n\r\nconst DefaultKeyMap: HotkeyMap = {\r\n    Delete: \"modify.deleteNode\",\r\n    Backspace: \"modify.deleteNode\",\r\n    \" \": \"special.last\",\r\n    Enter: \"special.last\",\r\n    \"ctrl+z\": \"edit.undo\",\r\n    \"ctrl+y\": \"edit.redo\",\r\n};\r\n\r\nexport class HotkeyService implements IService {\r\n    private app?: IApplication;\r\n    private readonly _keyMap = new Map<string, CommandKeys>();\r\n\r\n    constructor() {\r\n        this.addMap(DefaultKeyMap);\r\n    }\r\n\r\n    register(app: IApplication): void {\r\n        this.app = app;\r\n        Logger.info(`${HotkeyService.name} registed`);\r\n    }\r\n\r\n    start(): void {\r\n        window.addEventListener(\"keydown\", this.eventHandlerKeyDown);\r\n        window.addEventListener(\"keydown\", this.commandKeyDown);\r\n        Logger.info(`${HotkeyService.name} started`);\r\n    }\r\n\r\n    stop(): void {\r\n        window.removeEventListener(\"keydown\", this.eventHandlerKeyDown);\r\n        window.removeEventListener(\"keydown\", this.commandKeyDown);\r\n        Logger.info(`${HotkeyService.name} stoped`);\r\n    }\r\n\r\n    private readonly eventHandlerKeyDown = (e: KeyboardEvent) => {\r\n        e.preventDefault();\r\n        let visual = this.app?.activeView?.document?.visual;\r\n        let view = this.app?.activeView;\r\n        if (view && visual) {\r\n            visual.eventHandler.keyDown(view, e);\r\n            visual.viewHandler.keyDown(view, e);\r\n            if (this.app!.executingCommand) e.stopImmediatePropagation();\r\n        }\r\n    };\r\n\r\n    private readonly commandKeyDown = (e: KeyboardEvent) => {\r\n        e.preventDefault();\r\n        let command = this.getCommand(e);\r\n        if (command !== undefined) {\r\n            PubSub.default.pub(\"executeCommand\", command);\r\n        }\r\n    };\r\n\r\n    getKey(keys: Keys): string {\r\n        let key = keys.key;\r\n        if (keys.ctrlKey) key = \"ctrl+\" + key;\r\n        if (keys.shiftKey) key = \"shift+\" + key;\r\n        if (keys.altKey) key = \"alt+\" + key;\r\n        return key;\r\n    }\r\n\r\n    map(command: CommandKeys, keys: Keys) {\r\n        let key = this.getKey(keys);\r\n        this._keyMap.set(key, command);\r\n    }\r\n\r\n    getCommand(keys: Keys): CommandKeys | undefined {\r\n        let key = this.getKey(keys);\r\n        return this._keyMap.get(key);\r\n    }\r\n\r\n    addMap(map: HotkeyMap) {\r\n        let keys = Object.keys(map);\r\n        keys.forEach((key) => {\r\n            this._keyMap.set(key, map[key]);\r\n        });\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport {\r\n    EditableShapeNode,\r\n    I18n,\r\n    IDataExchange,\r\n    IDocument,\r\n    IShape,\r\n    PubSub,\r\n    Result,\r\n    ShapeNode,\r\n    VisualNode,\r\n} from \"chili-core\";\r\n\r\nasync function importBrep(document: IDocument, file: File) {\r\n    const shape = document.application.shapeFactory.converter.convertFromBrep(await file.text());\r\n    if (!shape.isOk) {\r\n        return Result.err(shape.error);\r\n    }\r\n    return Result.ok(new EditableShapeNode(document, file.name, shape.value));\r\n}\r\n\r\nasync function exportBrep(document: IDocument, shapes: IShape[]) {\r\n    const comp = document.application.shapeFactory.combine(shapes);\r\n    if (!comp.isOk) {\r\n        return Result.err(comp.error);\r\n    }\r\n    return document.application.shapeFactory.converter.convertToBrep(comp.value);\r\n}\r\n\r\nexport class DefaultDataExchange implements IDataExchange {\r\n    importFormats(): string[] {\r\n        return [\".step\", \".stp\", \".iges\", \".igs\", \".brep\"];\r\n    }\r\n\r\n    exportFormats(): string[] {\r\n        return [\".step\", \".iges\", \".brep\"];\r\n    }\r\n\r\n    async import(document: IDocument, files: FileList | File[]): Promise<void> {\r\n        for (const file of files) {\r\n            await this.handleSingleFileImport(document, file);\r\n        }\r\n    }\r\n\r\n    private async handleSingleFileImport(document: IDocument, file: File) {\r\n        const nodeResult = file.name.endsWith(\".brep\")\r\n            ? await importBrep(document, file)\r\n            : await this.handleStepIgesImport(document, file);\r\n\r\n        if (!nodeResult?.isOk) return;\r\n\r\n        const node = nodeResult.value;\r\n        node.name = file.name;\r\n        document.addNode(node);\r\n        document.visual.update();\r\n    }\r\n\r\n    private async handleStepIgesImport(document: IDocument, file: File) {\r\n        const content = new Uint8Array(await file.arrayBuffer());\r\n\r\n        if (this.isStepFile(file.name)) {\r\n            return document.application.shapeFactory.converter.convertFromSTEP(document, content);\r\n        }\r\n\r\n        if (this.isIgesFile(file.name)) {\r\n            return document.application.shapeFactory.converter.convertFromIGES(document, content);\r\n        }\r\n\r\n        alert(I18n.translate(\"error.import.unsupportedFileType:{0}\", file.name));\r\n        return undefined;\r\n    }\r\n\r\n    async export(type: string, nodes: VisualNode[]): Promise<BlobPart[] | undefined> {\r\n        if (!this.validateExportType(type)) return;\r\n\r\n        const shapes = this.getExportShapes(nodes);\r\n        if (!shapes.length) return;\r\n\r\n        const shapeResult = await this.convertShapes(type, nodes[0].document, shapes);\r\n        shapes.forEach((x) => x.dispose());\r\n\r\n        return this.handleExportResult(shapeResult);\r\n    }\r\n\r\n    private validateExportType(type: string): boolean {\r\n        const isValid = this.exportFormats().includes(type);\r\n        !isValid && PubSub.default.pub(\"showToast\", \"error.import.unsupportedFileType:{0}\", type);\r\n        return isValid;\r\n    }\r\n\r\n    private getExportShapes(nodes: VisualNode[]): IShape[] {\r\n        const shapes = nodes\r\n            .filter((x): x is ShapeNode => x instanceof ShapeNode)\r\n            .map((x) => x.shape.value.transformedMul(x.worldTransform()));\r\n\r\n        !shapes.length && PubSub.default.pub(\"showToast\", \"error.export.noNodeCanBeExported\");\r\n        return shapes;\r\n    }\r\n\r\n    private async convertShapes(type: string, doc: IDocument, shapes: IShape[]) {\r\n        if (type === \".step\") return this.handleStepExport(doc, shapes);\r\n        if (type === \".iges\") return this.handleIgesExport(doc, shapes);\r\n        return exportBrep(doc, shapes);\r\n    }\r\n\r\n    private handleStepExport(doc: IDocument, shapes: IShape[]) {\r\n        return doc.application.shapeFactory.converter.convertToSTEP(...shapes);\r\n    }\r\n\r\n    private handleIgesExport(doc: IDocument, shapes: IShape[]) {\r\n        return doc.application.shapeFactory.converter.convertToIGES(...shapes);\r\n    }\r\n\r\n    private handleExportResult(result: Result<string> | undefined) {\r\n        if (!result?.isOk) {\r\n            PubSub.default.pub(\"showToast\", \"error.default:{0}\", result?.error);\r\n            return undefined;\r\n        }\r\n        return [result.value];\r\n    }\r\n\r\n    private isStepFile(filename: string) {\r\n        return filename.endsWith(\".step\") || filename.endsWith(\".stp\");\r\n    }\r\n\r\n    private isIgesFile(filename: string) {\r\n        return filename.endsWith(\".iges\") || filename.endsWith(\".igs\");\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { Application, CommandService, EditEventHandler, EditorService, HotkeyService } from \"chili\";\r\nimport {\r\n    I18n,\r\n    IDataExchange,\r\n    IDocument,\r\n    INode,\r\n    IService,\r\n    IShapeFactory,\r\n    IStorage,\r\n    IVisualFactory,\r\n    IWindow,\r\n    Logger,\r\n} from \"chili-core\";\r\nimport { IAdditionalModule } from \"./additionalModule\";\r\nimport { DefaultDataExchange } from \"./defaultDataExchange\";\r\n\r\nexport class AppBuilder {\r\n    protected readonly _inits: (() => Promise<void>)[] = [];\r\n    protected readonly _additionalModules: IAdditionalModule[] = [];\r\n    protected _storage?: IStorage;\r\n    protected _visualFactory?: IVisualFactory;\r\n    protected _shapeFactory?: IShapeFactory;\r\n    protected _window?: IWindow;\r\n\r\n    useIndexedDB() {\r\n        this._inits.push(async () => {\r\n            Logger.info(\"initializing IndexedDBStorage\");\r\n\r\n            let db = await import(\"chili-storage\");\r\n            this._storage = new db.IndexedDBStorage();\r\n        });\r\n        return this;\r\n    }\r\n\r\n    useWasmOcc() {\r\n        this._inits.push(async () => {\r\n            Logger.info(\"initializing wasm occ\");\r\n\r\n            let wasm = await import(\"chili-wasm\");\r\n            await wasm.initWasm();\r\n            this._shapeFactory = new wasm.ShapeFactory();\r\n        });\r\n        return this;\r\n    }\r\n\r\n    useThree(): this {\r\n        this._inits.push(async () => {\r\n            Logger.info(\"initializing three\");\r\n\r\n            let three = await import(\"chili-three\");\r\n            this._visualFactory = new three.ThreeVisulFactory();\r\n        });\r\n        return this;\r\n    }\r\n\r\n    useUI(): this {\r\n        this._inits.push(async () => {\r\n            Logger.info(\"initializing MainWindow\");\r\n\r\n            this.loadAdditionalI18n();\r\n\r\n            let ui = await import(\"chili-ui\");\r\n            this._window = new ui.MainWindow(await this.getRibbonTabs());\r\n        });\r\n        return this;\r\n    }\r\n\r\n    addAdditionalModules(...modules: IAdditionalModule[]): this {\r\n        this._additionalModules.push(...modules);\r\n        return this;\r\n    }\r\n\r\n    async getRibbonTabs() {\r\n        let defaultRibbon = await import(\"./ribbon\");\r\n        return defaultRibbon.DefaultRibbon;\r\n    }\r\n\r\n    async build(): Promise<void> {\r\n        for (const init of this._inits) {\r\n            await init();\r\n        }\r\n        this.ensureNecessary();\r\n\r\n        let app = this.createApp();\r\n        this._window?.init(app);\r\n\r\n        this.loadAdditionalCommands();\r\n\r\n        Logger.info(\"Application build completed\");\r\n    }\r\n\r\n    createApp() {\r\n        return new Application({\r\n            storage: this._storage!,\r\n            shapeFactory: this._shapeFactory!,\r\n            visualFactory: this._visualFactory!,\r\n            services: this.getServices(),\r\n            mainWindow: this._window,\r\n            dataExchange: this.initDataExchange(),\r\n        });\r\n    }\r\n\r\n    initDataExchange(): IDataExchange {\r\n        return new DefaultDataExchange();\r\n    }\r\n\r\n    private ensureNecessary() {\r\n        if (this._shapeFactory === undefined) {\r\n            throw new Error(\"ShapeFactory not set\");\r\n        }\r\n        if (this._visualFactory === undefined) {\r\n            throw new Error(\"VisualFactory not set\");\r\n        }\r\n        if (this._storage === undefined) {\r\n            throw new Error(\"storage has not been initialized\");\r\n        }\r\n    }\r\n\r\n    private loadAdditionalI18n() {\r\n        for (const module of this._additionalModules) {\r\n            module.i18n().forEach((local) => {\r\n                I18n.combineTranslation(local.code, local.translation);\r\n            });\r\n        }\r\n    }\r\n\r\n    private loadAdditionalCommands() {\r\n        for (const module of this._additionalModules) {\r\n            if (this._window) {\r\n                module.ribbonCommands().forEach((command) => {\r\n                    this._window!.registerRibbonCommand(command.tabName, command.groupName, command.command);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    protected getServices(): IService[] {\r\n        return [\r\n            new CommandService(),\r\n            new HotkeyService(),\r\n            new EditorService((document: IDocument, selected: INode[]) => {\r\n                return new EditEventHandler(document, selected);\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nexport class Loading extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this.initSpinner();\r\n        this.initLabel();\r\n        this.initAnimation();\r\n        this.style.cssText = `\r\n            position: fixed;\r\n            display: block;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            z-index: 9999;\r\n            background-color: rgba(0, 0, 0, 0.5);\r\n        `;\r\n    }\r\n\r\n    private initSpinner() {\r\n        let text = document.createElement(\"div\");\r\n        text.style.cssText = `\r\n            position: absolute;\r\n            top: 40%;\r\n            left: 50%;\r\n            transform: translate(-50%, -50%);\r\n            width: 50px;\r\n            height: 50px;\r\n            border-radius: 50%;\r\n            border: 5px solid #fff;\r\n            border-top-color: #000;\r\n            animation: spin 1s infinite linear;\r\n        `;\r\n        this.appendChild(text);\r\n    }\r\n\r\n    private initAnimation() {\r\n        let styleSheet = document.createElement(\"style\");\r\n        styleSheet.innerHTML = `\r\n          @keyframes spin {\r\n            from { transform: rotate(0deg); }\r\n            to { transform: rotate(360deg); }\r\n          }\r\n        `;\r\n        document.head.appendChild(styleSheet);\r\n    }\r\n\r\n    private initLabel() {\r\n        let text = document.createElement(\"div\");\r\n        text.innerText = \"Loading...\";\r\n        text.style.cssText = `\r\n        color: white;\r\n        font-size: 16px;\r\n        position: relative;\r\n        top: calc(40% + 100px);\r\n        left: calc(50% + 25px);\r\n        transform: translate(-50%, -50%);\r\n        width: 50px;\r\n        height: 50px;\r\n        `;\r\n        this.appendChild(text);\r\n    }\r\n}\r\n\r\ncustomElements.define(\"chili-loading\", Loading);\r\n","// Part of the Chili3d Project, under the AGPL-3.0 License.\r\n// See LICENSE file in the project root for full license information.\r\n\r\nimport { AppBuilder } from \"chili-builder\";\r\nimport { Logger } from \"chili-core\";\r\nimport { Loading } from \"./loading\";\r\n\r\nlet loading = new Loading();\r\ndocument.body.appendChild(loading);\r\n\r\n// prettier-ignore\r\nnew AppBuilder()\r\n    .useIndexedDB()\r\n    .useWasmOcc()\r\n    .useThree()\r\n    .useUI()\r\n    .build()\r\n    .then(x => {\r\n        document.body.removeChild(loading)\r\n    })\r\n    .catch((err) => {\r\n        Logger.error(err);\r\n    });\r\n"],"names":["UrlStringConverter","value","Result","createControl","tag","props","children","e","document","Node","setProperties","c","left","prop","key","Localize","PathBinding","div","span","input","button","label","select","option","a","h1","h2","ul","img","svg","ns","child","className","String","addTitle","setSVGIcon","newIcon","title","collection","options","Collection","HTMLElement","Map","args","CollectionAction","Error","item","items","Array","ObservableCollection","x","from","to","item1","item2","index","i","customElements","ColorConverter","result","parseInt","Number","NumberConverter","n","StringConverter","XYConverter","vs","isFinite","XY","XYZConverter","XYZ","Expander","style","header","text","node","nodes","RadioGroup","context","target","Set","AsyncController","message","listeners","status","undefined","listener","registry","FinalizationRegistry","binding","source","path","converter","property","element","WeakRef","sourceProperty","converted","Binding","SelectMode","NodeAction","ClassMap","Serializer","MessageType","Precision","Command","ObjectSnapType","CurveType","Continuity","ICurve","GeometryType","LineType","ShapeMeshData","EdgeMeshData","Orientation","JoinType","ShapeType","SurfaceType","ButtonSize","DialogResult","ViewMode","VisualState","itemSet","callback","Symbol","predicate","fromIndex","SelectableItems","indexes","mode","selectedItems","History","record","removed","action","previousState","PropertyHistoryRecord","object","oldValue","newValue","NodeLinkedListHistoryRecord","records","ArrayRecord","name","r","Logger","optionalParams","console","Transaction","WeakMap","arrayRecord","trans","transactionName","isPropertyChanged","obj","Observable","pubKey","defaultValue","privateKey","onPropertyChanged","equals","cb","handler","HistoryObservable","classNameToClass","serializeTypeArray","TypeArray","buffer","save","ctor","getClass","cls","propertiesMap","reflectMap","Float32Array","Uint32Array","serialze","keys","register","ctorParamNames","deserialize","serialize","deserializeObject","data","instance","deserializeInstance","deserializeProperties","properties","parameters","deserilizeParameters","deserialValue","v","ignores","Object","serializeObject","classKey","serializeProperties","getAllKeysOfPrototypeChain","serializePropertyValue","type","map","prototype","k","isOk","error","predict","DeepObserver","parts","sourceHandler","prefix","subSource","handlerMap","deepHandler","sources","IDisposable","isDisposable","Deletable","isDeletable","gc","resources","resource","Id","size","id","alphabet","Math","PubSub","callbacks","event","debounce","fun","ms","timeout","clearTimeout","window","download","blob","Blob","url","URL","isIOS","navigator","readFilesAsync","accept","multiple","Promise","resolve","cleanup","readFileAsync","method","filesResult","readInputedFiles","files","fileDataPromises","file","readFileDataAsync","reader","FileReader","PropertyKeyMap","Property","until","getProperty","define","display","getProperties","getOwnProperties","ICommand","isCancelableCommand","command","CancelableCommand","setTimeout","application","commandRegistry","metadata","constructor","getData","get","has","snapTypes","targetType","add","remove","VisualConfig","Config","snapType","Constants","DOCUMENT_FILE_EXTENSION","I18nId","I18nArgs","I18n","en","zh","_currentLanguage","combineTranslation","language","translations","local","translate","_","isI18nKey","changeLanguage","newLanguage","html","currentLanguage","set","dom","isConic","curve","isCircle","circle","isLine","isTrimmed","MeshGroup","start","count","materialIndex","Mesh","positionSize","indexSize","mesh","concatTypedArrays","arrays","totalLength","acc","arr","offset","isVertex","isEdge","isFace","VertexMeshData","point","color","end","lineType","merge","other","otherRange","range","FaceMeshData","groups","group","MeshDataBuilder","g","b","EdgeMeshDataBuilder","shape","y","z","isWhole","stringValue","hasCompound","hasCompoundSolid","hasSolid","hasShell","hasFace","hasWire","hasEdge","hasVertex","MathUtils","degrees","radians","values","tolerance","min","max","right","scalar","d","dx","dy","dz","p1","p2","cross","dot","normal","angle","vec","cos","BoundingBox","box","matrix","box1","box2","points","Infinity","Quaternion","w","q","w1","x1","y1","z1","w2","x2","y2","z2","qw","qx","qy","qz","sqw","sqx","sqy","sqz","unit","test","sig","xx2","xy2","xz2","yy2","yz2","zz2","sy2","sz2","sx2","Matrix4","roll","pitch","yaw","halfRoll","halfPitch","halfYaw","cr","sr","cp","sp","cy","sy","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","b4","b5","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","array","j","cx","sx","cz","sz","position","TypeError","s","t","plane","temp","temp2","temp3","vector","vectors","m","m11","m12","m13","m22","m23","m32","m33","rotation","scale","quaternion","te","xx","xy","xz","yy","yz","zz","wx","wy","wz","Plane","origin","xvec","location","ray","containsExtension","len","dp1","dp2","PlaneAngle","vectorToPoint","projectionX","projectionY","angleInDegrees","angleInRadians","isMovingUpward","isMovingDownward","isCrossingX","Ray","direction","Texture","Material","material","PhongMaterial","PhysicalMaterial","INode","isLinkedListNode","serialized","cloned","getNodesFromPath","path1","path2","commonIndex","nodeOrChildrenAppendToNodes","path1ToCommonNodes","commonToPath2Nodes","next","nextParent","getNodesFromParentToChild","containsDescendant","parent","currentAtBack","preNode","curNode","getCommonParentIndex","prePath","curPath","getPathToRoot","getNodesBetween","node1","node2","findTopLevelNodes","NodeSerializer","serializeNodeToArray","parentId","nodeMap","VisualNode","visual","MeshNode","materialId","FaceMaterialPair","faceIndex","GeometryNode","oldMaterisl","Face","oldMaterial","oldFacePair","pairs","faceIndexs","toDelete","pair","MeshUtils","newMaterisl","ShapeNode","SHAPE_UNDEFINED","oldShape","MultiShapeMesh","totleMatrix","MultiShapeNode","shapes","meshes","ParameterShapeNode","EditableShapeNode","createComponentMesh","createComponentSize","Component","faceMaterialPair","ComponentNode","transform","totleTransform","materialIndexMap","materialONMap","materialIds","materials","componentId","insert","FacebaseNode","FolderNode","nullifyParent","prev","newParent","previousSibling","cache","GroupNode","ShapeNodeFilter","shapeFilter","Combobox","Act","view","cameraPosition","cameraTarget","cameraUp","IView","screenDistance","mx","my","IVisualObject","isGeometry","addState","removeState","hasState","testState","materialMap","arr1","arr2","grouped","groupStart","worldTransform","oldIndex","indices","indiceStart","indiceEnd","face","pointsMap","entry","GeoUtils","wire","nearest","minDistance","edge","tempPoint","firstEdge","testCurve","otherEdges","intersect","SelectionRectStyle","SelectionHandler","document1","multiMode","controller","rect","NodeSelectionHandler","filter","models","detected","detecteds","ShapeSelectionHandler","shapeType","SubshapeSelectionHandler","ViewUtils","planes","distances","p","app","Dimension","Selection","prompt","selectedState","showControl","cursor","oldHandler","reject","toggle","publish","selected","unSelected","Document","__DOCUMENT_VERSION__","image","Date","views","alert","rootNode","observer","importFiles","Application","ev","opens","imports","json","JSON","lightGray","deepGray","BoxNode","CircleNode","center","radius","ConeNode","CylinderNode","EllipseNode","majorRadius","minorRadius","LineNode","pnt","PolygonNode","PrismNode","length","PyramidNode","RectNode","RevolvedNode","profile","axis","SphereNode","SweepedNode","NewDocument","OpenDocument","PerformanceTestCommand","performance","distance","OccPerformanceTestCommand","SaveDocument","SaveDocumentToFile","ToggleDynamicWorkplaneCommand","WeChatGroup","BooleanNode","contains","d1","d2","mapping","AxisSnap","dist","lineDats","BaseSnap","referencePoint","ids","meshId","highlighter","FeaturePointStrategy","_snapType","infos","addPoint","info","ObjectSnap","snaped","snap","featurePoints","ordered","basisCurve","temporary","current","s1","s2","e1","e2","intersections","PlaneSnapBase","refPoint","WorkplaneSnap","PlaneSnap","PointOnCurveSnap","pointData","Axis","containsZ","createAxis","axies","TrackingBase","trackingZ","AxisTracking","testAngle","ObjectTracking","axes","currentTrackings","existingTracking","snaps","pointId","TrackingSnap","trackingAxisZ","trackingDatas","lines","newEnd","objectTrackingRays","snapedName","dir","SnapEventHandler","featurePoint","minDist","msg","AngleSnapEventHandler","snapPointData","objectSnap","isNaN","SnapLengthAtAxisHandler","lengthData","inputValue","SnapLengthAtPlaneHandler","numbers","coords","PointSnapEventHandler","dims","dimension","SnapPointOnCurveEventHandler","parameter","SnapStep","tip","handleStepData","keepSelected","executorHandler","oldValidator","defaultSnapedData","AngleStep","handleCenter","handleP1","handleP2Data","LengthAtAxisStep","LengthAtPlaneStep","pointAtPlane","PointStep","handleData","PointOnCurveStep","SelectStep","snapeType","SelectShapeStep","SelectNodeStep","nodeFilter","GetOrSelectNodeStep","MultistepCommand","steps","lineWith","disposeShape","edgeMesh","step","shouldDispose","BooleanOperate","shape1","shape2","booleanType","booleanShape","BooleanCommon","BooleanCut","BooleanFuse","ArcNode","CreateCommand","CreateFaceableCommand","Arc","p0","visualCenter","BezierCommand","bezier","firstStep","ps","res","RectData","atPlane","RectCommandBase","tmp","Rect","Box","h","Circle","body","Cone","p1Visual","up","height","FaceNode","wires","edges","WireNode","ConvertCommand","ConvertToWire","wireBody","ConvertToFace","ConvertToShell","faces","shell","ConvertToSolid","solid","CopySubShapeCommand","subShape","model","Cylinder","Ellipse","Fuse","GroupDefinition","GroupCommand","definition","component","dialog","PickInsertPointCommand","HTMLDialogElement","defination","pickPointStep","Line","OffsetCommand","ax","nextEdge","nextDirection","Polygon","Prism","Pyramid","Revolve","LineFilter","Section","section","Sphere","Sweep","ThickSolidCommand","ActAlignCameraCommand","Delete","NewFolder","folder","Import","extenstions","Export","format","AngleMeasure","rad","v1","line2","arc","v2","arcMid","visualId","LengthMeasure","firstPoint","secondPoint","SelectMeasure","li","area","volume","Break","curve2","model1","model2","project","AddBrushCommand","nodeMatiralMape","RemoveBrushCommand","ClearBrushCommand","ChamferCommand","filetShape","Explode","subShapes","subShapeNode","newNode","FilletCommand","TransformedCommand","Mirror","yvec","Move","RemoveFaceCommand","RemoveSubShapesCommand","Rotate","rayEnd","Split","invertTransform","old","Trim","transaction","PickTrimEdgeEventHandler","segment","newEdge","EdgeFilter","segments","findSegments","currentId","boundingBox","allSegment","startSegment","lastSegment","centerSegment","Redo","Undo","WorkingPlaneViewModel","SetWorkplane","vm","AlignToPlane","FromSection","EditEventHandler","selectedNodes","ApplicationCommands","CommandService","commandName","err","EditorService","factory","_app","DefaultKeyMap","HotkeyService","importBrep","exportBrep","comp","DefaultDataExchange","nodeResult","content","Uint8Array","shapeResult","isValid","doc","filename","AppBuilder","db","wasm","three","ui","modules","defaultRibbon","init","module","Loading","styleSheet","loading"],"mappings":"+FAKO,IAAMA,mBAAN,MAAMA,mBACT,QAAQC,CAAa,CAAkB,CACnC,OAAOC,EAAAA,EAAAA,CAAAA,EAAS,CAAC,CAAC,KAAK,EAAED,EAAM,EAAE,CAAC,CACtC,CACJ,C,yWCFO,SAASE,cAAqDC,CAAM,EACvE,MAAO,CACHC,EACA,GAAGC,KAEH,IAAMC,EAA8BC,SAAS,aAAa,CAACJ,GAS3D,OARIC,IACI,AAAiB,UAAjB,OAAOA,GAAsBA,aAAiBI,KAC9CF,EAAE,MAAM,CAACF,GAETK,cAAcH,EAAGF,IAGzBC,EAAS,OAAO,CAAC,AAACK,GAAMJ,EAAE,MAAM,CAACI,IAC1BJ,CACX,CACJ,CAEO,SAASG,cAA8CE,CAAO,CAAEC,CAAkB,EACrF,IAAK,IAAMC,KAAOD,EAAM,CACpB,IAAMZ,EAAQY,CAAI,CAACC,EAAI,AACnBb,CAAAA,aAAiBc,EAAAA,EAAQA,EAAKD,CAAAA,AAAQ,gBAARA,GAAyBA,AAAQ,UAARA,CAAc,EACrEb,EAAM,GAAG,CAACW,EAAME,GACTb,aAAiBe,EAAAA,EAAWA,CACnCf,EAAM,UAAU,CAACW,EAAME,GAChB,AAAiB,UAAjB,OAAOb,GAAsB,AAAqB,UAArB,OAAOW,CAAI,CAACE,EAAI,CACpDJ,cAAcE,CAAI,CAACE,EAAI,CAAEb,GAExBW,CAAY,CAACE,EAAI,CAAGb,CAE7B,CACJ,CAEO,IAAMgB,EAAMd,cAAc,OACpBe,EAAOf,cAAc,QACrBgB,EAAQhB,cAAc,SACtBiB,EAASjB,cAAc,UACvBkB,EAAQlB,cAAc,SACXA,cAAc,YAC/B,IAAMmB,EAASnB,cAAc,UACvBoB,EAASpB,cAAc,UACvBqB,EAAIrB,cAAc,KAClBsB,EAAKtB,cAAc,MACnBuB,EAAKvB,cAAc,MACdA,cAAc,MACfA,cAAc,KACxB,IAAMwB,EAAKxB,cAAc,MACdA,cAAc,MACzB,IAAMyB,EAAMzB,cAAc,OAM1B,SAAS0B,aAAIxB,CAAgD,EAChE,IAAMyB,EAAK,6BACLC,EAAQvB,SAAS,eAAe,CAACsB,EAAI,OAC3CC,EAAM,cAAc,CAAC,+BAAgC,aAAc,CAAC,CAAC,EAAE1B,EAAM,IAAI,CAAC,CAAC,EACnF,IAAMwB,EAAMrB,SAAS,eAAe,CAACsB,EAAI,OACzCD,EAAI,MAAM,CAACE,GACX,IAAMC,EAAYC,OAAO5B,EAAM,SAAS,EAOxC,OANA,OAAOA,EAAM,SAAS,CACtBK,cAAcmB,EAAKxB,GACnBwB,EAAI,SAAS,CAAC,GAAG,CAACG,GACd3B,EAAM,KAAK,EACX6B,SAAS7B,EAAOwB,GAEbA,CACX,CAEO,SAASM,WAAWN,CAAkB,CAAEO,CAAe,EAC1D,IAAML,EAAQF,EAAI,UAAU,CAC5BE,GAAO,eAAe,+BAAgC,aAAc,CAAC,CAAC,EAAEK,EAAQ,CAAC,CACrF,CAEA,SAASF,SAAS7B,CAAgD,CAAEwB,CAAkB,EAClF,IAAMQ,EAAQ7B,SAAS,eAAe,CAAC,6BAA8B,QACjEH,CAAAA,EAAM,KAAK,YAAYU,EAAAA,EAAQA,CAC/BV,EAAM,KAAK,CAAC,GAAG,CAACgC,EAAc,eACvB,AAAuB,UAAvB,OAAOhC,EAAM,KAAK,CACzBgC,EAAM,WAAW,CAAGhC,EAAM,KAAK,CAE/BA,EAAM,KAAK,EAAE,WAAWgC,EAAO,eAGnCR,EAAI,WAAW,CAACQ,EACpB,CArCsBlC,cAAc,UACdA,cAAc,UACjBA,cAAc,OACbA,cAAc,QAoC3B,IAAMmC,WAAa,AAAIC,GAAgC,IAAIC,WAAWD,GCnFtE,IAAMC,WAAN,MAAMA,mBAAsBC,Y,KACd,SAAqD,AACtE,aAAqBpC,CAAyB,CAAE,CAC5C,KAAK,QADYA,KAAK,CAALA,EAAAA,IAAAA,CADJ,QAAQ,CAAG,IAAIqC,IAAAA,IAAAA,CAwBf,oBAAoB,CAAG,AAACC,IACrC,OAAQA,EAAK,MAAM,EACf,KAAKC,EAAAA,EAAAA,CAAAA,GAAoB,CACrB,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,SAAS,CAACD,EAAK,KAAK,GACxC,KACJ,MAAKC,EAAAA,EAAAA,CAAAA,MAAuB,CACxB,IAAI,CAAC,WAAW,CAACD,EAAK,KAAK,EAC3B,KACJ,MAAKC,EAAAA,EAAAA,CAAAA,IAAqB,CACtB,IAAI,CAAC,SAAS,CAACD,EAAK,IAAI,CAAEA,EAAK,EAAE,EACjC,KACJ,MAAKC,EAAAA,EAAAA,CAAAA,OAAwB,CACzB,IAAI,CAAC,YAAY,CAACD,EAAK,KAAK,CAAEA,EAAK,IAAI,CAAEA,EAAK,KAAK,EACnD,KACJ,SACI,MAAM,AAAIE,MAAM,4BACxB,CACJ,EAtCInC,cAAc,IAAI,CAAEL,EACxB,CAEA,QAAQyC,CAAO,CAA2C,CACtD,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACA,EAC7B,CAEA,mBAAoB,CAChB,IAAMC,EAAQC,MAAM,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAC/F,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,SAAS,CAACD,IAC1B,IAAI,CAAC,KAAK,CAAC,OAAO,YAAYE,EAAAA,EAAoBA,EAClD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,oBAAoB,CACxE,CAEA,sBAAuB,CACnB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,AAACC,GAAMA,EAAE,MAAM,IACrC,IAAI,CAAC,QAAQ,CAAC,KAAK,GACf,IAAI,CAAC,KAAK,CAAC,OAAO,YAAYD,EAAAA,EAAoBA,EAClD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,uBAAuB,CAAC,IAAI,CAAC,oBAAoB,CAC5E,CAEiB,oBAiBf,AAEM,WAAUE,CAAY,CAAEC,CAAU,CAAE,CACxC,IAAMC,EAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAACF,GAC3BG,EAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAACF,EAC7BC,CAAAA,GAASC,GAAO,IAAI,CAAC,YAAY,CAACD,EAAOC,EACjD,CAEQ,aAAaC,CAAa,CAAET,CAAO,CAAEC,CAAU,CAAE,CACrD,IAAMhB,EAAQ,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACe,GAC5Bf,IACAgB,EAAM,OAAO,CAAC,CAACD,EAAMU,KACjB,IAAMjD,EAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAACuC,EAAMS,EAAQC,GAC5C,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACV,EAAMvC,GACxB,IAAI,CAAC,YAAY,CAACA,EAAGwB,EACzB,GACA,IAAI,CAAC,WAAW,CAAC,CAACe,EAAK,EAE/B,CAEQ,UAAUC,CAAU,CAAE,CAC1B,IAAMQ,EAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAChC,OAAOR,EAAM,GAAG,CAAC,CAACD,EAAMU,KACpB,GAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACV,GAAO,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACA,GACtD,IAAMvC,EAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAACuC,EAAMS,EAAQC,GAE5C,OADA,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACV,EAAMvC,GACjBA,CACX,EACJ,CAEQ,YAAYwC,CAAU,CAAE,CAC5BA,EAAM,OAAO,CAAC,AAACD,IACX,IAAMf,EAAQ,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACe,GAC5Bf,IACAA,EAAM,MAAM,GACZ,IAAI,CAAC,QAAQ,CAAC,MAAM,CAACe,GAE7B,EACJ,CACJ,EAEAW,eAAe,MAAM,CAAC,mBAAoBjB,YC1FnC,IAAMkB,eAAN,MAAMA,eACT,QAAQzD,CAAsB,CAAkB,CAC5C,OAAOC,EAAAA,EAAAA,CAAAA,EAAS,CAAC,AAAiB,UAAjB,OAAOD,EAAqBA,EAAQ,CAAC,CAAC,EAAEA,EAAM,QAAQ,CAAC,IAAI,QAAQ,CAAC,EAAG,KAAK,CAAC,CAClG,CAEA,YAAYA,CAAa,CAAkB,CAEvC,IAAM0D,EAASC,SADE3D,EAAM,UAAU,CAAC,KAAOA,EAAM,SAAS,CAAC,GAAKA,EAC5B,IAClC,OAAO4D,OAAO,KAAK,CAACF,GAAUzD,EAAAA,EAAAA,CAAAA,GAAU,CAAC,CAAC,oBAAoB,EAAED,EAAM,CAAC,EAAIC,EAAAA,EAAAA,CAAAA,EAAS,CAACyD,EACzF,CACJ,ECVO,IAAMG,gBAAN,MAAMA,gBACT,QAAQ7D,CAAa,CAAkB,CACnC,OAAO4D,OAAO,KAAK,CAAC5D,GAASC,EAAAA,EAAAA,CAAAA,GAAU,CAAC,iBAAmBA,EAAAA,EAAAA,CAAAA,EAAS,CAAC+B,OAAOhC,GAChF,CAEA,YAAYA,CAAa,CAAkB,CACvC,IAAM8D,EAAIF,OAAO5D,GACjB,OAAO4D,OAAO,KAAK,CAACE,GAAK7D,EAAAA,EAAAA,CAAAA,GAAU,CAAC,CAAC,EAAED,EAAM,0BAA0B,CAAC,EAAIC,EAAAA,EAAAA,CAAAA,EAAS,CAAC6D,EAC1F,CACJ,ECTO,IAAMC,gBAAN,MAAMA,gBACT,QAAQ/D,CAAa,CAAkB,CACnC,OAAOC,EAAAA,EAAAA,CAAAA,EAAS,CAACD,EACrB,CACA,YAAYA,CAAa,CAAkB,CACvC,OAAOC,EAAAA,EAAAA,CAAAA,EAAS,CAACD,EACrB,CACJ,ECPO,IAAMgE,YAAN,MAAMA,YACT,QAAQhE,CAAS,CAAE,CACf,OAAOC,EAAAA,EAAAA,CAAAA,EAAS,CAAC,CAAC,EAAED,EAAM,CAAC,CAAC,CAAC,EAAEA,EAAM,CAAC,CAAC,CAAC,CAC5C,CAEA,YAAYA,CAAa,CAAc,CACnC,IAAMiE,EAAKjE,EAAM,KAAK,CAAC,KAAK,GAAG,CAAC4D,QAAQ,MAAM,CAACM,UAC/C,OAAOD,AAAc,IAAdA,EAAG,MAAM,CACVhE,EAAAA,EAAAA,CAAAA,EAAS,CAAC,IAAIkE,EAAAA,EAAEA,CAACF,CAAE,CAAC,EAAE,CAAEA,CAAE,CAAC,EAAE,GAC7BhE,EAAAA,EAAAA,CAAAA,GAAU,CAAC,CAAC,EAAED,EAAM,oBAAoB,CAAC,CACnD,CACJ,EAEO,IAAMoE,aAAN,MAAMA,aACT,QAAQpE,CAAU,CAAE,CAChB,OAAOC,EAAAA,EAAAA,CAAAA,EAAS,CAAC,CAAC,EAAED,EAAM,CAAC,CAAC,CAAC,EAAEA,EAAM,CAAC,CAAC,CAAC,EAAEA,EAAM,CAAC,CAAC,CAAC,CACvD,CAEA,YAAYA,CAAa,CAAe,CACpC,IAAMiE,EAAKjE,EAAM,KAAK,CAAC,KAAK,GAAG,CAAC4D,QAAQ,MAAM,CAACM,UAC/C,OAAOD,AAAc,IAAdA,EAAG,MAAM,CACVhE,EAAAA,EAAAA,CAAAA,EAAS,CAAC,IAAIoE,EAAAA,EAAGA,CAACJ,CAAE,CAAC,EAAE,CAAEA,CAAE,CAAC,EAAE,CAAEA,CAAE,CAAC,EAAE,GACrChE,EAAAA,EAAAA,CAAAA,GAAU,CAAC,CAAC,EAAED,EAAM,qBAAqB,CAAC,CACpD,CACJ,E,wBCtBO,IAAMsE,SAAN,MAAMA,iBAAiB9B,YAClB,YAAc,EAAK,AACV,aAA4B,AAC5B,aAAcxB,EAAI,CAAE,UAAWuD,EAAAA,WAAiB,AAAC,EAAG,AAC5D,eAAgBvD,EAAI,CAAE,UAAWuD,EAAAA,YAAkB,AAAC,EAAG,AAEhE,aAAYC,CAAgB,CAAE,CAC1B,KAAK,GACL,IAAI,CAAC,SAAS,CAAGD,EAAAA,SAAe,CAChC,IAAI,CAAC,YAAY,CAAG3C,aAAI,CACpB,KAAM,IAAI,CAAC,eAAe,GAC1B,UAAW2C,EAAAA,YAAkB,CAC7B,QAAS,IAAI,CAAC,oBAAoB,AACtC,GACA,IAAME,EAAOrD,EAAM,CACf,YAAa,IAAIN,EAAAA,EAAQA,CAAC0D,GAC1B,UAAWD,EAAAA,UAAgB,AAC/B,GACA,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAEE,GAC3C,KAAK,CAAC,OAAO,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,aAAa,CACrD,CAES,YAA4BC,CAAO,CAAK,CAC7C,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW,CAACA,EAC1C,CAES,OAAO,GAAGC,CAAa,CAAQ,CACpC,IAAI,CAAC,aAAa,CAAC,MAAM,IAAIA,EACjC,CAES,YAA4B7C,CAAQ,CAAK,CAC9C,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW,CAACA,EAC1C,CAEA,QAAQ,GAAG6C,CAAa,CAAE,CAEtB,OADA,IAAI,CAAC,MAAM,IAAIA,GACR,IAAI,AACf,CAEQ,iBAAkB,CACtB,OAAO,IAAI,CAAC,WAAW,CAAG,kBAAoB,kBAClD,CAEiB,qBAAuB,AAACrE,IACrCA,EAAE,eAAe,GACjB,IAAI,CAAC,WAAW,CAAG,CAAC,IAAI,CAAC,WAAW,CACpC4B,WAAW,IAAI,CAAC,YAAY,CAAE,IAAI,CAAC,eAAe,IAClD,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAACqC,EAAAA,MAAY,CAAE,CAAC,IAAI,CAAC,WAAW,CACvE,CAAE,AACN,EAEAf,eAAe,MAAM,CAAC,iBAAkBc,U,cCnDjC,IAAMM,WAAN,MAAMA,mBAAmBpC,Y,cAC5B,aACagC,CAAc,CACdK,CAA6B,CACxC,CACE,KAAK,QAHIL,MAAM,CAANA,EAAAA,IAAAA,CACAK,OAAO,CAAPA,EAAAA,IAAAA,CAgCI,QAAQ,CAAG,AAACvE,IACzB,IAAMwE,EAASxE,EAAE,MAAM,CACnBwE,GAAQ,OAAS,UACjB,IAAI,CAAC,gBAAgB,CAAC,SAAS,OAAO,CAAC,AAAC7B,GAAOA,EAAE,OAAO,CAAGA,IAAM6B,GACjE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAG,IAAIC,IAAI,CAACD,EAAO,KAAK,CAAC,EAE3D,EAnCI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,GAChC,CAEA,QAAS,CACL,OAAO9D,EACH,CAAE,UAAWuD,EAAAA,UAAgB,AAAC,KAC3B,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAACtB,EAAGM,IAAM,CACpCrC,EAAM,CACF,KAAM,QACN,MAAO+B,EACP,QAAS,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,GAAG,CAACA,GACxC,GAAI,CAAC,MAAM,EAAEM,EAAE,CAAC,AACpB,GACAnC,EAAM,CACF,QAAS,CAAC,MAAM,EAAEmC,EAAE,CAAC,CACrB,YAAaN,CACjB,GACH,EAET,CAEA,mBAAoB,CAChB,IAAI,CAAC,gBAAgB,CAAC,QAAS,IAAI,CAAC,QAAQ,CAChD,CAEA,sBAAuB,CACnB,IAAI,CAAC,mBAAmB,CAAC,QAAS,IAAI,CAAC,QAAQ,CACnD,CAEiB,QAMf,AACN,EAEAO,eAAe,MAAM,CAAC,eAAgBoB,W,g1CCzC/B,IAAMI,gBAAN,MAAMA,gBACQ,eAAiB,IAAID,GAAoC,AACzD,mBAAoB,IAAIA,GAAoC,AACrE,QAAiC,AAEzC,KAAI,QAAS,CACT,OAAO,IAAI,CAAC,OAAO,AACvB,CAES,KAAO,AAACE,IACb,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,cAAc,CAAE,OAAQA,EACtD,CAAE,AAEO,QAAS,AAACA,IACf,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,cAAc,CAAE,SAAUA,EACxD,CAAE,AAEO,SAAU,AAACA,IAChB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,iBAAiB,CAAE,UAAWA,EAC5D,CAAE,AAEM,iBACJC,CAA6C,CAC7CC,CAA6B,CAC7BF,CAAgB,CAClB,CACuBG,KAAAA,IAAjB,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,OAAO,CAAG,CAAED,OAAAA,EAAQF,QAAAA,CAAQ,EACjCC,EAAU,OAAO,CAAC,AAACG,GAAaA,EAAS,IAAI,CAAC,OAAO,GAE7D,CAEA,YAAYA,CAAuC,CAAQ,CACvD,IAAI,CAAC,cAAc,CAAC,GAAG,CAACA,EAC5B,CAEA,YAAYA,CAAuC,CAAQ,CACvD,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAACA,EAC/B,CAEA,SAAU,CACN,IAAI,CAAC,cAAc,CAAC,KAAK,GACzB,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAChC,CACJ,EChDA,IAAMC,EAAW,IAAIC,qBAAqB,AAACC,IACvCA,EAAQ,aAAa,EACzB,GAWO,IAAMzE,YAAN,MAAMA,Y,qBACD,QAA8D,AAC9D,gBAAmE,AACnE,cAA+D,AAEvE,aACa0E,CAAS,CACTC,CAAY,CACdC,CAAsB,CAC/B,C,KAHWF,MAAM,CAANA,E,KACAC,IAAI,CAAJA,E,KACFC,SAAS,CAATA,E,KAiBM,4BAA4B,CAAG,CAACC,EAAkBH,KAC3D,IAAI,CAAC,mBAAmB,CAACG,EAAUH,KACnC,IAAI,CAAC,4BAA4B,GACjC,IAAI,CAAC,yBAAyB,GAEtC,E,KAEiB,qBAAqB,CAAG,CAACG,EAAkBH,KACpD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAACG,IAAa,IAAI,CAAC,OAAO,EAC5C,IAAI,CAAC,QAAQ,CAACH,EAAQG,EAE9B,CA3BG,CAEH,WAA6BC,CAAU,CAAED,CAAiB,CAAE,CACxD,GAAI,IAAI,CAAC,OAAO,CAAE,MAAM,AAAIhD,MAAM,sBAClC,KAAI,CAAC,OAAO,CAAG,CAAE,QAAS,IAAIkD,QAAQD,GAAUD,SAAAA,CAAS,EACzDN,EAAS,QAAQ,CAACO,EAAS,IAAI,EAC/B,IAAI,CAAC,yBAAyB,EAClC,CAEA,eAAgB,CACZ,IAAMA,EAAU,IAAI,CAAC,OAAO,EAAE,QAAQ,OAClCA,CAAAA,GAASP,EAAS,UAAU,CAACO,GACjC,IAAI,CAAC,OAAO,CAAGT,KAAAA,EACf,IAAI,CAAC,4BAA4B,EACrC,CAEiB,4BAKf,AAEe,sBAIf,AAEM,qBAAoBQ,CAAgB,CAAEH,CAAW,CAAE,OACvD,GAA6BL,KAAAA,IAAzB,IAAI,CAAC,eAAe,EAKpB,IAAI,CAAC,eAAe,CAAC,IAAI,CACrB,AAACS,GAAYA,EAAQ,QAAQ,GAAKD,GAAYC,EAAQ,MAAM,GAAKJ,MAMpE,IAAI,CAAC,aAAa,EACZ,IAAI,CAAC,IAAI,CAAC,QAAQ,CAACG,EAIlC,CAEQ,2BAA4B,CAChC,IAAMxF,EAAQ,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAC1BqF,EAAc,IAAI,CAAC,MAAM,AAC7B,KAAI,CAAC,eAAe,CAAG,EAAE,CACzB,IAAK,IAAIlC,EAAI,EACT,AADYA,EAAInD,EAAM,MAAM,EACvBqF,GAAYrF,CAAK,CAACmD,EAAE,GAAIkC,EADClC,IAAK,CAGnC,IAAMwC,EAAiB,CAAEN,OAAAA,EAAQ,SAAUrF,CAAK,CAACmD,EAAE,AAAC,EACpD,GAAIA,IAAMnD,EAAM,MAAM,CAAG,EAAG,CACxB,IAAI,CAAC,QAAQ,CAACqF,EAAQrF,CAAK,CAACmD,EAAE,EAC9B,IAAI,CAAC,aAAa,CAAGwC,EACrBN,EAAO,iBAAiB,CAAC,IAAI,CAAC,qBAAqB,EACnD,KACJ,CAEAA,EAAO,iBAAiB,CAAC,IAAI,CAAC,4BAA4B,EAC1D,IAAI,CAAC,eAAe,CAAC,IAAI,CAACM,GAC1BN,EAASA,CAAM,CAACrF,CAAK,CAACmD,EAAE,CAAC,AAC7B,CACJ,CAEQ,8BAA+B,CAC9B,IAAI,CAAC,eAAe,GACzB,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,AAACsC,GAC1BA,EAAQ,MAAM,CAAC,qBAAqB,CAAC,IAAI,CAAC,4BAA4B,GAE1E,IAAI,CAAC,aAAa,EAAE,OAAO,sBAAsB,IAAI,CAAC,qBAAqB,EAC3E,IAAI,CAAC,aAAa,CAAGT,KAAAA,EACrB,IAAI,CAAC,eAAe,CAAGA,KAAAA,EAC3B,CAEQ,SAASK,CAAW,CAAEG,CAAgB,CAAE,CAC5C,GAAI,CAAC,IAAI,CAAC,OAAO,CAAE,OACnB,IAAMC,EAAU,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,GAC1C,GAAI,CAACA,EAAS,OAEd,IAAM7F,EAAQyF,CAAM,CAACG,EAAS,CAC9B,GAAI,IAAI,CAAC,SAAS,CAAE,CAChB,IAAMI,EAAY,IAAI,CAAC,SAAS,CAAC,OAAO,CAAChG,EACrCgG,CAAAA,EAAU,IAAI,EAAGH,CAAAA,CAAe,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAGG,EAAU,KAAK,AAAD,CAChF,MACKH,CAAe,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAG7F,CAElD,CAEA,kBAAmB,CACf,OAAO,IAAI,CAAC,aAAa,CAClB,IAAI,CAAC,aAAa,CAAC,MAAc,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAC/DoF,KAAAA,CACV,CACJ,EAEO,IAAMa,QAAN,MAAMA,gBAA+DlF,YACxE,YAAY0E,CAAS,CAAEC,CAAa,CAAEC,CAAsB,CAAE,CAC1D,KAAK,CAACF,EAAQC,EAAK,QAAQ,GAAIC,EACnC,CACJ,EChIO,IAyKKO,ECvEAC,EClGKC,ECyCAC,EC3CLC,ECAKC,ECuBAC,ECvBLC,EAgBKA,ECZLC,EAaAC,EAwIKC,ECtJLC,ECHAC,ECmFKC,EA6CAC,ECzHLC,EA2DAC,EClEAC,EAYKA,ECRLC,ECFAC,ECFAC,ECSAC,ECTAC,EAOKA,ElBLL7E,E,oCAAAA,G,CAAAA,E,sFAAAA,GAiCL,IAAMK,qBAAN,MAAMA,qBACQ,WAAa,IAAI+B,GAA6C,AACvE,OAAY,AAEpB,aAAY,GAAGjC,CAAU,CAAE,CACvB,IAAI,CAAC,MAAM,CAAG,IAAIA,EAAM,AAC5B,CAEA,KAAK,GAAGA,CAAU,CAAE,CACK,IAAjBA,EAAM,MAAM,GAChB,IAAI,CAAC,MAAM,CAAC,IAAI,IAAIA,GACpB,IAAI,CAAC,YAAY,CAAC,CACd,OAAQ,EACRA,MAAAA,CACJ,GACJ,CAEA,OAAO,GAAGA,CAAU,CAAE,CAClB,GAAIA,AAAiB,IAAjBA,EAAM,MAAM,CAAQ,OACxB,IAAM2E,EAAU,IAAI1C,IAAIjC,EACxB,KAAI,CAAC,MAAM,CAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,AAACD,GAAS,CAAC4E,EAAQ,GAAG,CAAC5E,IACxD,IAAI,CAAC,YAAY,CAAC,CACd,OAAQ,EACRC,MAAAA,CACJ,EACJ,CAEA,KAAKI,CAAY,CAAEC,CAAU,CAAE,CAC3B,GAAI,CAAC,IAAI,CAAC,WAAW,CAACD,EAAMC,GAAK,OAEjC,IAAML,EAAQ,IAAI,CAAC,MAAM,CAAC,MAAM,CAACI,EAAM,GACvC,IAAI,CAAC,MAAM,CAAC,MAAM,CAACA,EAAOC,EAAKA,EAAK,EAAIA,EAAI,KAAML,GAClD,IAAI,CAAC,YAAY,CAAC,CACd,OAAQ,EACRI,KAAAA,EACAC,GAAAA,CACJ,EACJ,CAEQ,YAAYD,CAAY,CAAEC,CAAU,CAAW,CACnD,OAAOD,IAASC,GAAMD,GAAQ,GAAKA,EAAO,IAAI,CAAC,MAAM,CAAC,MAAM,EAAIC,GAAM,GAAKA,EAAK,IAAI,CAAC,MAAM,CAAC,MAAM,AACtG,CAEA,OAAQ,CACJ,GAAI,AAAuB,IAAvB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAQ,OAC9B,IAAML,EAAQ,IAAI,IAAI,CAAC,MAAM,CAAC,AAC9B,KAAI,CAAC,MAAM,CAAG,EAAE,CAChB,IAAI,CAAC,YAAY,CAAC,CACd,OAAQ,EACRA,MAAAA,CACJ,EACJ,CAEA,IAAI,QAAS,CACT,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,AAC7B,CAEA,QAAQQ,CAAa,CAAE,GAAGR,CAAU,CAAE,CAClC,GAAI,CAAC,IAAI,CAAC,YAAY,CAACQ,GAAQ,OAE/B,IAAMT,EAAO,IAAI,CAAC,MAAM,CAACS,EAAM,CAC/B,IAAI,CAAC,MAAM,CAAC,MAAM,CAACA,EAAO,KAAMR,GAChC,IAAI,CAAC,YAAY,CAAC,CACd,OAAQ,EACRQ,MAAAA,EACAT,KAAAA,EACAC,MAAAA,CACJ,EACJ,CAEQ,aAAaQ,CAAa,CAAW,CACzC,OAAOA,GAAS,GAAKA,EAAQ,IAAI,CAAC,MAAM,CAAC,MAAM,AACnD,CAEQ,aAAaZ,CAA2B,CAAE,CAC9C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,AAACgF,GAAaA,EAAShF,GACnD,CAEA,QAAQgF,CAA0C,CAAE,CAChD,IAAI,CAAC,KAAK,CAAC,OAAO,CAACA,EACvB,CAEA,IAAIA,CAAyC,CAAE,CAC3C,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAACA,EAC1B,CAEA,IAAI,OAAQ,CACR,MAAO,IAAI,IAAI,CAAC,MAAM,CAAC,AAC3B,CAEA,CAACC,OAAO,QAAQ,CAAC,EAAG,CAChB,OAAO,IAAI,CAAC,KAAK,CAACA,OAAO,QAAQ,CAAC,EACtC,CAEA,KAAKrE,CAAa,CAAE,CAChB,OAAO,IAAI,CAAC,MAAM,CAACA,EAAM,AAC7B,CAEA,GAAGA,CAAa,CAAE,CACd,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAACA,EAC1B,CAEA,OAAOsE,CAA2D,CAAE,CAChE,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAACA,EAC9B,CAEA,KAAKA,CAA2D,CAAE,CAC9D,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAACA,EAC5B,CAEA,QAAQ/E,CAAO,CAAEgF,CAAkB,CAAE,CACjC,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAChF,EAAMgF,EACrC,CAEA,SAAShF,CAAO,CAAE,CACd,OAAO,AAA8B,KAA9B,IAAI,CAAC,MAAM,CAAC,OAAO,CAACA,EAC/B,CAEA,IAAI,OAAQ,CACR,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,AAC7B,CAEA,oBAAoB6E,CAA+C,CAAQ,CACvE,IAAI,CAAC,UAAU,CAAC,GAAG,CAACA,EACxB,CAEA,wBAAwBA,CAA+C,CAAQ,CAC3E,IAAI,CAAC,UAAU,CAAC,MAAM,CAACA,EAC3B,CAEA,SAAU,CACN,IAAI,CAAC,UAAU,CAAC,KAAK,GACrB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,CACzB,CACJ,EAEO,IAAKxB,G,CAAAA,E,iEAAAA,GAML,IAAM4B,gBAAN,MAAMA,gB,IACA,MAAwB,AACjC,cAAsB,AAEtB,KAAI,iBAA4B,CAC5B,IAAIC,EAAoB,EAAE,CAO1B,OANA,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,AAAC9E,IACxB,IAAIK,EAAQ,IAAI,CAAC,KAAK,CAAC,OAAO,CAACL,EAC3BK,CAAAA,EAAQ,IACRyE,EAAQ,IAAI,CAACzE,EAErB,GACOyE,CACX,CAEA,mBAAoB,CAChB,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,GAAG,KAAK,AACnD,CAEA,YACIjF,CAAU,CACDkF,EAAAA,CAAmC,CAC5CC,CAAmB,CACrB,C,KAFWD,IAAI,CAAJA,EAGT,IAAI,CAAC,KAAK,CAAGlF,EACb,IAAI,CAAC,aAAa,CAAG,IAAIiC,IAAIkD,GAAiB,EAAE,CACpD,CACJ,ECnMO,IAAMC,QAAN,MAAMA,QACQ,OAA2B,EAAE,AAAC,AAC9B,QAA2B,EAAE,AAAC,AAE/C,UAAW,EAAM,AACjB,YAAa,EAAG,AAEhB,UAAgB,CACZ,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,AAACC,GAAWA,EAAO,OAAO,IAC9C,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,AAACA,GAAWA,EAAO,OAAO,IAC9C,IAAI,CAAC,KAAK,EACd,CAEQ,OAAc,CAClB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,EACrB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,CACzB,CAEA,IAAIA,CAAsB,CAAE,CACxB,IAAI,IAAI,CAAC,QAAQ,GAEjB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,EACrB,IAAI,CAAC,MAAM,CAAC,IAAI,CAACA,GAEb,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,IAAI,CAAC,UAAU,EAAE,CACtC,IAAMC,EAAU,IAAI,CAAC,MAAM,CAAC,KAAK,GACjCA,GAAS,SACb,CACJ,CAEA,WAAY,CACR,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,AAC7B,CAEA,WAAY,CACR,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,AAC7B,CAEA,MAAO,CACH,IAAI,CAAC,UAAU,CAAC,KACZ,IAAMD,EAAS,IAAI,CAAC,MAAM,CAAC,GAAG,GACzBA,IAELA,EAAO,IAAI,GACX,IAAI,CAAC,MAAM,CAAC,IAAI,CAACA,GACrB,EACJ,CAEA,MAAO,CACH,IAAI,CAAC,UAAU,CAAC,KACZ,IAAMA,EAAS,IAAI,CAAC,MAAM,CAAC,GAAG,GACzBA,IAELA,EAAO,IAAI,GACX,IAAI,CAAC,MAAM,CAAC,IAAI,CAACA,GACrB,EACJ,CAEQ,WAAWE,CAAkB,CAAE,CACnC,IAAMC,EAAgB,IAAI,CAAC,QAAQ,AACnC,KAAI,CAAC,QAAQ,CAAG,GAChB,GAAI,CACAD,GACJ,QAAU,CACN,IAAI,CAAC,QAAQ,CAAGC,CACpB,CACJ,CACJ,EAEO,IAAMC,sBAAN,MAAMA,sB,iCACA,KAAa,AACtB,aACaC,CAAW,CACX5C,CAAkC,CAClC6C,CAAa,CACbC,CAAa,CACxB,C,KAJWF,MAAM,CAANA,E,KACA5C,QAAQ,CAARA,E,KACA6C,QAAQ,CAARA,E,KACAC,QAAQ,CAARA,EAET,IAAI,CAAC,IAAI,CAAG,CAAC,OAAO,EAAE1G,OAAO4D,GAAU,SAAS,CAAC,AACrD,CAEA,SAAgB,CAAC,CAEjB,MAAa,CACT,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAG,IAAI,CAAC,QAAQ,AAC9C,CAEA,MAAa,CACT,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAG,IAAI,CAAC,QAAQ,AAC9C,CACJ,EAEO,IAAKO,G,CAAAA,E,4JAAAA,GAsBL,IAAMwC,4BAAN,MAAMA,4B,OACA,KAAa,AAEtB,aAAqBC,CAAqB,CAAE,C,KAAvBA,OAAO,CAAPA,EACjB,IAAI,CAAC,IAAI,CAAG,aAChB,CAEA,SAAgB,CACZ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,AAACT,IACdA,AAAkB,IAAlBA,EAAO,MAAM,EACbA,EAAO,IAAI,CAAC,OAAO,EAE3B,GACA,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,CAC1B,CAEQ,WAAWA,CAAkB,CAAQ,CACzC,OAAQA,EAAO,MAAM,EACjB,KAAK,EAYL,KAAK,EAGL,KAAK,EAdDA,EAAO,SAAS,EAAE,OAAOA,EAAO,IAAI,EACpC,KACJ,MAAK,EAGL,KAAK,EAFDA,EAAO,SAAS,EAAE,IAAIA,EAAO,IAAI,EACjC,KAIJ,MAAK,EACDA,EAAO,SAAS,EAAE,KAAKA,EAAO,IAAI,CAAEA,EAAO,SAAS,CAAGA,EAAO,WAAW,CAQjF,CACJ,CAEQ,WAAWA,CAAkB,CAAQ,CACzC,OAAQA,EAAO,MAAM,EACjB,KAAK,EACDA,EAAO,SAAS,EAAE,IAAIA,EAAO,IAAI,EACjC,KACJ,MAAK,EACDA,EAAO,SAAS,EAAE,OAAOA,EAAO,IAAI,EACpC,KACJ,MAAK,EACDA,EAAO,SAAS,EAAE,SAASA,EAAO,IAAI,EACtC,KACJ,MAAK,EACDA,EAAO,SAAS,EAAE,KAAKA,EAAO,IAAI,CAAEA,EAAO,SAAS,CAAGA,EAAO,WAAW,EACzE,KACJ,MAAK,EACDA,EAAO,SAAS,EAAE,YAAYA,EAAO,WAAW,CAAEA,EAAO,IAAI,EAC7D,KACJ,MAAK,EACDA,EAAO,SAAS,EAAE,aAAaA,EAAO,WAAW,EAAE,YAAaA,EAAO,IAAI,CAEnF,CACJ,CAEA,MAAa,CACT,IAAK,IAAI5E,EAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,EAAGA,GAAK,EAAGA,IAC1C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAACA,EAAE,CAEvC,CAEA,MAAa,CACT,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,AAAC4E,GAAW,IAAI,CAAC,UAAU,CAACA,GACrD,CACJ,EAEO,IAAMU,YAAN,MAAMA,Y,IACA,QAAoC,AAE7C,aAAqBC,CAAY,CAAE,C,KAAdA,IAAI,CAAJA,E,KAFZ,OAAO,CAA0B,EAAE,AAER,CAEpC,SAAgB,CACZ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,AAACC,GAAMA,EAAE,OAAO,GACzC,CAEA,MAAO,CACH,IAAK,IAAIzF,EAAQ,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,EAAGA,GAAS,EAAGA,IAClD,IAAI,CAAC,OAAO,CAACA,EAAM,CAAC,IAAI,EAEhC,CAEA,MAAO,CACH,IAAK,IAAM6E,KAAU,IAAI,CAAC,OAAO,CAC7BA,EAAO,IAAI,EAEnB,CACJ,EkBvNO,IAAMa,OAAN,MAAMA,OACT,OAAO,MAAM/D,CAAa,CAAE,GAAGgE,CAAqB,CAAE,CAClDC,QAAQ,GAAG,CAACjE,KAAYgE,EAC5B,CAEA,OAAO,KAAKhE,CAAa,CAAE,GAAGgE,CAAqB,CAAE,CACjDC,QAAQ,GAAG,CAACjE,KAAYgE,EAC5B,CAEA,OAAO,KAAKhE,CAAa,CAAE,GAAGgE,CAAqB,CAAE,CACjDC,QAAQ,IAAI,CAACjE,KAAYgE,EAC7B,CAEA,OAAO,MAAMhE,CAAa,CAAE,GAAGgE,CAAqB,CAAE,CAClDC,QAAQ,KAAK,CAACjE,KAAYgE,EAC9B,CACJ,CAGAD,CAAAA,OAAO,IAAI,CAAGE,QAAQ,GAAG,CACzBF,OAAO,IAAI,CAAGE,QAAQ,IAAI,CAC1BF,OAAO,KAAK,CAAGE,QAAQ,GAAG,CAC1BF,OAAO,KAAK,CAAGE,QAAQ,KAAK,CClBrB,IAAMC,YAAN,MAAMA,Y,aACT,QAAwB,gBAAmD,IAAIC,OAAU,AAEzF,aACa7I,CAAmB,CACnBuI,CAAY,CACvB,C,KAFWvI,QAAQ,CAARA,E,KACAuI,IAAI,CAAJA,CACV,CAEH,OAAO,IAAIvI,CAAmB,CAAE4H,CAAsB,CAAE,CACpD,GAAI5H,EAAS,OAAO,CAAC,QAAQ,CAAE,OAC/B,IAAI8I,EAAcF,YAAY,eAAe,CAAC,GAAG,CAAC5I,EAC9C8I,AAAgBjE,MAAAA,IAAhBiE,EACAA,EAAY,OAAO,CAAC,IAAI,CAAClB,GAEzBgB,YAAY,YAAY,CAAC5I,EAAU4H,EAE3C,CAEA,OAAO,aAAa5H,CAAmB,CAAE4H,CAAsB,CAAE,CAC7D5H,EAAS,OAAO,CAAC,GAAG,CAAC4H,GACrBa,OAAO,IAAI,CAAC,CAAC,cAAc,EAAEb,EAAO,IAAI,CAAC,CAAC,CAC9C,CAEA,OAAO,QAAQ5H,CAAmB,CAAEuI,CAAY,CAAET,CAAkB,CAAE,CAClE,IAAIiB,EAAQ,IAAIH,YAAY5I,EAAUuI,GACtCQ,EAAM,KAAK,GACX,GAAI,CACAjB,IACAiB,EAAM,MAAM,EAChB,CAAE,MAAOhJ,EAAG,CAER,MADAgJ,EAAM,QAAQ,GACRhJ,CACV,CACJ,CAEA,aAAa,aAAaC,CAAmB,CAAEuI,CAAY,CAAET,CAA2B,CAAE,CACtF,IAAMiB,EAAQ,IAAIH,YAAY5I,EAAUuI,GACxCQ,EAAM,KAAK,GACX,GAAI,CACA,MAAMjB,IACNiB,EAAM,MAAM,EAChB,CAAE,MAAOhJ,EAAG,CAER,MADAgJ,EAAM,QAAQ,GACRhJ,CACV,CACJ,CAEA,MAAMwI,CAAa,CAAE,CACjB,IAAMS,EAAkBT,GAAQ,IAAI,CAAC,IAAI,CACzC,GAAIK,YAAY,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAC7C,MAAM,AAAIvG,MAAM,CAAC,uCAAuC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAEzEuG,YAAY,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAIN,YAAYU,GACnE,CAEA,QAAS,CACL,IAAMF,EAAcF,YAAY,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EACjE,GAAI,CAACE,EACD,MAAM,AAAIzG,MAAM,8BAEhByG,CAAAA,EAAY,OAAO,CAAC,MAAM,CAAG,GAAGF,YAAY,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAEE,GAC5EF,YAAY,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CACpD,CAEA,UAAW,CACPA,YAAY,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,OAChDA,YAAY,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CACpD,CACJ,ECzDO,SAASK,kBAAkBC,CAAW,EACzC,OACIA,GACA,AAAuD,YAAvD,OAAQA,EAAyB,iBAAiB,EAClD,AAA2D,YAA3D,OAAQA,EAAyB,qBAAqB,AAE9D,CAEO,IAAMC,WAAN,MAAMA,WACU,wBAA0B,IAAI3E,GAAwC,AAC/E,aAAc,EAAM,AAEtB,eAAoC4E,CAAS,CAAE,CACnD,MAAO,CAAC,CAAC,EAAE3H,OAAO2H,GAAQ,CAAC,AAC/B,CAEU,gBAAsCA,CAAS,CAAEC,CAAsB,CAAW,CACxF,IAAMC,EAAa,IAAI,CAAC,aAAa,CAACF,GACtC,OAAOE,KAAc,IAAI,CAClB,IAAI,CAACA,EAAW,CACjB,IAAI,CAAC,sBAAsB,CAACF,EAAQC,EAC9C,CAEQ,uBAA6CD,CAAS,CAAEC,CAAsB,CAAW,QAC7F,AAAIA,AAAiBxE,KAAAA,IAAjBwE,OACAZ,OAAO,IAAI,CACP,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,gBAAgB,EAAEhH,OAAO2H,GAAQ,sDAAsD,CAAC,GAMxH,IAAY,CADM,IAAI,CAAC,aAAa,CAACA,GACb,CAAGC,EACrBA,EACX,CAEU,gBAAsCD,CAAS,CAAEjB,CAAiB,CAAQ,CAC/E,IAAY,CAAC,IAAI,CAAC,aAAa,CAACiB,GAAQ,CAAGjB,CAChD,CAOU,YACN9C,CAAW,CACX8C,CAAiB,CACjBoB,CAA4D,CAC5DC,CAAmC,CAC5B,CACP,IAAMtB,EAAW,IAAI,CAAC7C,EAAS,OAC/B,CAAI,IAAI,CAAC,QAAQ,CAAC6C,EAAUC,EAAUqB,KAEtC,IAAI,CAAC,eAAe,CAACnE,EAAU8C,GAC/BoB,IAAoBlE,EAAU6C,GAC9B,IAAI,CAAC,mBAAmB,CAAC7C,EAAU6C,GAC5B,GACX,CAEQ,SACJA,CAAiB,CACjBC,CAAiB,CACjBqB,CAAmC,CAC5B,CACP,OAAOA,EAASA,EAAO,MAAM,CAACtB,EAAUC,GAAYD,IAAaC,CACrE,CAEU,oBAA0C9C,CAAW,CAAE6C,CAAiB,CAAE,CAChF1F,MAAM,IAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,OAAO,CAAC,AAACiH,GAAOA,EAAGpE,EAAU,IAAI,CAAE6C,GAChF,CAEA,kBAAwCwB,CAAwC,CAAE,CAC9E,IAAI,CAAC,uBAAuB,CAAC,GAAG,CAACA,EACrC,CAEA,sBAA4CA,CAAwC,CAAE,CAClF,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAACA,EACxC,CAEA,sBAA6B,CACzB,IAAI,CAAC,uBAAuB,CAAC,KAAK,EACtC,CAES,QAAU,KACX,IAAI,CAAC,WAAW,GACpB,IAAI,CAAC,WAAW,CAAG,GACnB,IAAI,CAAC,eAAe,GACxB,CAAE,AAEQ,kBAAkB,CACxB,IAAI,CAAC,uBAAuB,CAAC,KAAK,EACtC,CACJ,EAEO,IAAeC,kBAAf,MAAeA,0BAA0BR,WACpC,SAAqB,AAE7B,KAAI,UAAsB,CACtB,OAAO,IAAI,CAAC,SAAS,AACzB,CAEA,YAAYnJ,CAAmB,CAAE,CAC7B,KAAK,GACL,IAAI,CAAC,SAAS,CAAGA,CACrB,CAEmB,YACfqF,CAAW,CACX8C,CAAiB,CACjBoB,CAA4D,CAC5DC,CAAmC,CAC5B,CACP,OAAO,KAAK,CAAC,YACTnE,EACA8C,EACA,CAAC9C,EAAU6C,KACPqB,IAAoBlE,EAAU6C,GAC9BU,YAAY,GAAG,CACX,IAAI,CAAC,QAAQ,CACb,IAAIZ,sBAAsB,IAAI,CAAE3C,EAAU6C,EAAUC,GAE5D,EACAqB,EAER,CAES,iBAAkB,CACvB,KAAK,CAAC,kBACN,IAAI,CAAC,SAAS,CAAG,IACrB,CACJ,EnBlJA,IAAMI,EAAmB,IAAI1H,ICuBtB,SAAS2H,mBAAmBC,CAA8D,EAC7F,MAAO,CACH,KAAMA,EACN,eAAgB,CAAC,SAAS,CAC1B,UAAW,AAACvF,GACD,EACH,OAAQ/B,MAAM,IAAI,CAAC+B,EACvB,GAEJ,YAAa,AAACwF,GACH,IAAID,EAAUC,EAE7B,CACJ,C,CDlCiBlE,EAAAA,GAAAA,CAAAA,EAAQA,CAAAA,IACLmE,IAAI,CAAb,SAAcxI,CAAiB,CAAEyI,CAAiC,EACrE,GAAIL,EAAiB,GAAG,CAACpI,GAAY,MAAM,AAAIa,MAAM,CAAC,MAAM,EAAEb,EAAU,mBAAmB,CAAC,EAC5FoI,EAAiB,GAAG,CAACpI,EAAWyI,EACpC,E,EAEgBC,QAAQ,CAAjB,SAAkB1I,CAAiB,EACtC,IAAM2I,EAAMP,EAAiB,GAAG,CAACpI,GACjC,GAAI2I,EAAK,OAAOA,CAChB,OAAM,AAAI9H,MAAM,CAAC,KAAK,EAAEb,EAAU,4DAA4D,CAAC,CACnG,EC0BJ,IAAM4I,EAAgB,IAAIlI,IACpBmI,GAAa,IAAInI,I,gVACvBmI,GAAW,GAAG,CAAC,eAAgBR,mBAAmBS,eAClDD,GAAW,GAAG,CAAC,cAAeR,mBAAmBU,c,CAEhCzE,EAAAA,GAAAA,CAAAA,EAAUA,CAAAA,IACP0E,QAAQ,CAAjB,WACH,MAAO,CAACjG,EAAac,KACjB,IAAIoF,EAAOL,EAAc,GAAG,CAAC7F,EAChBM,MAAAA,IAAT4F,IACAA,EAAO,IAAIjG,IACX4F,EAAc,GAAG,CAAC7F,EAAQkG,IAE9BA,EAAK,GAAG,CAACpF,EACb,CACJ,E,EAEgBqF,QAAQ,CAAjB,SACHC,CAAoC,CACpCC,CAAmC,CACnCC,CAAkD,EAElD,OAAO,AAACtG,IACJsB,EAAAA,IAAa,CAACtB,EAAO,IAAI,CAAEA,GAC3B8F,GAAW,GAAG,CAAC9F,EAAO,IAAI,CAAE,CACxB,KAAMA,EACNoG,eAAAA,EACAE,UAAAA,EACAD,YAAAA,CACJ,EACJ,CACJ,E,SAGa9E,CAAU,EAahB,SAASgF,kBAAkB9K,CAAmB,CAAE+K,CAAgB,EACnE,IAAIC,EAAWC,oBAAoBjL,EAAU+K,EAAK,QAAQ,CAAEA,EAAK,UAAU,EAE3E,OADAG,sBAAsBlL,EAAUgL,EAAUD,GACnCC,CACX,CAEA,SAASC,oBACLjL,CAAmB,CACnBwB,CAAiB,CACjB2J,CAAqC,EAErC,GAAI,CAACd,GAAW,GAAG,CAAC7I,GAChB,MAAM,AAAIa,MACN,CAAC,EAAEb,EAAU,iFAAiF,CAAC,EAIvG,GAAM,CAAEyI,KAAAA,CAAI,CAAEU,eAAAA,CAAc,CAAEC,YAAAA,CAAW,CAAE,CAAGP,GAAW,GAAG,CAAC7I,GACvD4J,EAAaC,qBAAqBrL,EAAU2K,EAAgBQ,EAAY3J,UAC9E,AAAIoJ,EACOA,KAAeD,EAAe,GAAG,CAAC,AAACjI,GAAM0I,CAAU,CAAC1I,EAAE,GAE1D,IAAIuH,KAAQU,EAAe,GAAG,CAAC,AAACjI,GAAM0I,CAAU,CAAC1I,EAAE,EAC9D,CAEA,SAAS2I,qBACLrL,CAAmB,CACnB2K,CAAqB,CACrBQ,CAAqC,CACrC3J,CAAiB,EAEjB,IAAM4J,EAAwC,CAAC,EAE/C,IAAK,IAAM9K,KADX8K,EAAW,QAAW,CAAGpL,EACP2K,GACVrK,KAAO6K,EACHA,AAAoBtG,KAAAA,IAApBsG,CAAU,CAAC7K,EAAI,EACf8K,CAAAA,CAAU,CAAC9K,EAAI,CAAGgL,cAActL,EAAUmL,CAAU,CAAC7K,EAAI,GAC9C,aAARA,IACP8K,CAAU,CAAC9K,EAAI,CAAGuE,KAAAA,EAClB8D,QAAQ,IAAI,CAAC,CAAC,EAAEnH,EAAU,uBAAuB,EAAElB,EAAI,WAAW,CAAC,GAG3E,OAAO8K,CACX,CAEA,SAASE,cAActL,CAAmB,CAAEP,CAAU,EAClD,GAAIA,AAAUoF,KAAAA,IAAVpF,SAGJ,AAAI+C,MAAM,OAAO,CAAC/C,GACPA,EAAM,GAAG,CAAC,AAAC8L,GACP,AAAa,UAAb,OAAOA,EAAiBT,kBAAkB9K,EAAUuL,GAAKA,GAGhE9L,EAAqB,QAAQ,CAAGqL,kBAAkB9K,EAAUP,GAASA,CACjF,CAEA,SAASyL,sBACLlL,CAAmB,CACnBgL,CAAa,CACbD,CAAgB,CAChBS,CAAkB,EAElB,GAAI,CAAEb,eAAAA,CAAc,CAAE,CAAGN,GAAW,GAAG,CAACU,EAAK,QAAQ,EAKrD,IAAK,IAAMzK,KADAmL,OAAO,IAAI,CAACV,EAAK,UAAU,EAAE,MAAM,CAH/B,AAACzK,GACL,CAACqK,EAAe,QAAQ,CAACrK,IAAQ,CAACkL,GAAS,SAASlL,IAI3D0K,CAAQ,CAAC1K,EAAI,CAAGgL,cAActL,EAAU+K,EAAK,UAAU,CAACzK,EAAI,CAEpE,CAxEC,EACewK,iBAAiB,CAAjBA,iBAwEpB,EArFiBhF,GAAAA,CAAAA,EAAUA,CAAAA,I,SAuFVA,CAAU,EAChB,SAAS4F,gBAAgBnH,CAAc,EAC1C,IAAIoH,EAAWpH,EAAO,WAAW,CAAC,IAAI,CACtC,GAAI,CAAC8F,GAAW,GAAG,CAACsB,GAGhB,MAFAhD,QAAQ,GAAG,CAACpE,GAEN,AAAIlC,MACN,CAAC,KAAK,EAAEkC,EAAO,WAAW,CAAC,IAAI,CAAC,kEAAkE,CAAC,EAG3G,IAAIwG,EAAOV,GAAW,GAAG,CAACsB,GAE1B,MAAO,CACHA,SAAAA,EACAR,WAHaJ,EAAK,SAAS,GAAGxG,IAAWqH,oBAAoBrH,EAIjE,CACJ,CAEO,SAASqH,oBAAoBrH,CAAc,EAC9C,IAAIwG,EAAkC,CAAC,EAEvC,IAAK,IAAMzK,KADAuL,2BAA2BtH,EAAQ6F,GACtB,CACpB,IAAI3K,EAAS8E,CAAc,CAACjE,EAAI,CAC5BkC,MAAM,OAAO,CAAC/C,GACdsL,CAAI,CAACzK,EAAI,CAAGb,EAAM,GAAG,CAAC,AAAC8L,GAAMO,uBAAuBP,IAEpDR,CAAI,CAACzK,EAAI,CAAGwL,uBAAuBrM,EAE3C,CACA,OAAOsL,CACX,CAEA,SAASe,uBAAuBrM,CAAU,EACtC,IAAIsM,EAAO,OAAOtM,EAClB,GAAIsM,AAAS,WAATA,EACA,OAAOL,gBAAgBjM,GAE3B,GAAIsM,AAAS,aAATA,GAAuBA,AAAS,WAATA,EACvB,OAAOtM,CAEX,OAAM,AAAI4C,MAAM,CAAC,+BAA+B,EAAE5C,EAAM,CAAC,CAC7D,CAEA,SAASoM,2BAA2BtH,CAAc,CAAEyH,CAAkD,EAClG,IAAIvB,EAAiB,EAAE,CACnBwB,EAAYR,OAAO,cAAc,CAAClH,GACtC,KAAO0H,AAAc,OAAdA,GAAoB,CACvB,IAAIC,EAAIF,EAAI,GAAG,CAACC,EACZC,CAAAA,GAAGzB,EAAK,IAAI,IAAIyB,EAAE,MAAM,IAC5BD,EAAYR,OAAO,cAAc,CAACQ,EACtC,CACA,OAAO,IAAIzH,IAAIiG,EACnB,C,EAnDgBiB,eAAe,CAAfA,gB,EAiBAE,mBAAmB,CAAnBA,mBAmCpB,EArDiB9F,GAAAA,CAAAA,EAAUA,CAAAA,ImB1JpB,IAAMpG,OAAN,MAAMA,OACA,EAAK,AAAU,AACf,GAAM,AAAgB,AACtB,GAAM,AAAgB,AAE/B,KACI,MAAgB,CAChB,OAAO,IAAI,CAAC,EAAK,AACrB,CAEA,IACI,OAAW,CAEX,OADI,AAAC,IAAI,CAAC,EAAK,EAAE+I,OAAO,IAAI,CAAC,mBACtB,IAAI,CAAC,EAAM,AACtB,CAEA,IACI,OAAW,CAEX,OADI,IAAI,CAAC,EAAK,EAAEA,OAAO,IAAI,CAAC,gBACrB,IAAI,CAAC,EAAM,AACtB,CAEA,YAAY0D,CAAa,CAAE1M,CAAoB,CAAE2M,CAAoB,CAAE,CACnE,IAAI,CAAC,EAAK,CAAGD,EACb,IAAI,CAAC,EAAM,CAAG1M,EACd,IAAI,CAAC,EAAM,CAAG2M,CAClB,CAEA,OAAyB,CACrB,OAAO1M,OAAO,GAAG,CAAC,IAAI,CAAC,EAAM,CACjC,CAEA,QAAQ2M,CAA8B,CAAW,CAC7C,OAAO,IAAI,CAAC,EAAK,EAAIA,EAAQ,IAAI,CAAC,EAAM,CAC5C,CAEA,UAAUA,CAA8B,CAAW,CAC/C,MAAO,CAAC,IAAI,CAAC,EAAK,EAAIA,EAAQ,IAAI,CAAC,EAAM,CAC7C,CAEA,WAA2B,CACvB,OAAO,IAAI,CAAC,EAAM,AACtB,CAEA,OAAO,GAAM5M,CAAQ,CAAoB,CACrC,OAAO,IAAIC,OAAO,GAAMD,EAAOoF,KAAAA,EACnC,CAEA,OAAO,IAAOuH,CAAQ,CAAkB,CACpC,OAAO,IAAI1M,OAAO,GAAOmF,KAAAA,EAAWuH,EACxC,CACJ,E,wBA9CwB,G,uDAKA,G,wDAMA,G,+DAjBJ,CAAC,CAAC,OAAQ,QAAS,Q,WCShC,IAAME,aAAN,MAAMA,aACT,OAAwB,SAAW,IAAIpK,GAGnC,AAEJ,QAAO,aAAa8I,CAA0B,CAAE7F,CAAY,CAAe,CACvE,IAAMoH,EAAQpH,EAAK,KAAK,CAAC,KAErB1F,EAAQuL,EACZ,IAAK,IAAIhI,EAAI,EAAGA,EAAIuJ,EAAM,MAAM,CAAEvJ,IAE9B,GADAvD,EAASA,CAAa,CAAC8M,CAAK,CAACvJ,EAAE,CAAC,CAC5BA,EAAIuJ,EAAM,MAAM,CAAG,GAAK,CAACtD,kBAAkBxJ,GAC3C,OAAOC,OAAO,GAAG,CAAC,CAAC,KAAK,EAAEyF,EAAK,aAAa,CAAC,EAIrD,OAAOzF,OAAO,EAAE,CAACD,EACrB,CAEA,OAAO,8BAA8BuL,CAA0B,CAAEtB,CAAmC,CAAE,CAClG,IAAM8C,EAAgBF,aAAa,gBAAgB,CAACtB,EAAUtB,GAC9D,IAAI,CAAC,yBAAyB,CAAC8C,EAAexB,EAClD,CAEA,OAAO,0BACHwB,CAA4B,CAC5BtH,CAAwB,CACxBuH,CAAe,CACjB,CAKE,IAAK,IAAMnM,KAJX4E,EAAO,iBAAiB,CAACsH,EAAc,OAAO,EAC9CA,EAAc,OAAO,CAAC,IAAI,CAAC,CAAEtH,OAAAA,EAAQuH,OAAAA,CAAO,GAEjChB,OAAO,IAAI,CAACA,OAAO,yBAAyB,CAACA,OAAO,cAAc,CAACvG,MACtD,CACpB,GAAI5E,AAAQ,gBAARA,GAAyBA,EAAI,UAAU,CAAC,KACxC,SAEJ,IAAIoM,EAAaxH,CAAc,CAAC5E,EAAI,AAChC2I,CAAAA,kBAAkByD,IAClB,IAAI,CAAC,yBAAyB,CAACF,EAAeE,EAAWD,EAAS,CAAC,EAAEA,EAAO,CAAC,EAAEnM,EAAI,CAAC,CAAGA,EAE/F,CACJ,CAEA,OAAO,iCACH0K,CAA0B,CAC1BtB,CAAmC,CACrC,CACE,IAAIiD,EAAa,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC3B,GACnC,GAAI,CAAC2B,EACD,OAGJ,IAAIH,EAAgBG,EAAW,GAAG,CAACjD,GACnC,GAAI,CAAC8C,EAAe,YAChB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAACxB,GAIzBwB,EAAc,OAAO,CAAC,OAAO,CAAC,AAAClK,IAC3BA,EAAK,MAAM,CAAC,qBAAqB,CAACkK,EAAc,OAAO,CAC3D,GAEAG,EAAW,MAAM,CAACjD,GACdiD,AAAoB,IAApBA,EAAW,IAAI,EACf,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC3B,EAE7B,CAEA,OAAe,iBAAiBA,CAA0B,CAAE4B,CAAuC,CAAE,CACjG,IAAID,EAAaL,aAAa,QAAQ,CAAC,GAAG,CAACtB,GACtC2B,IACDA,EAAa,IAAIzK,IACjBoK,aAAa,QAAQ,CAAC,GAAG,CAACtB,EAAU2B,IAGxC,IAAIH,EAAgBG,EAAW,GAAG,CAACC,GASnC,OARIJ,GACAA,EAAc,OAAO,CAAC,OAAO,CAAC,AAAClK,IAC3BA,EAAK,MAAM,CAAC,qBAAqB,CAACkK,EAAe,OAAO,CAC5D,GAGJA,EAAgB,IAAI,CAAC,iBAAiB,CAACxB,EAAU4B,GACjDD,EAAW,GAAG,CAACC,EAAaJ,GACrBA,CACX,CAEA,OAAe,kBAAkBxB,CAA0B,CAAE4B,CAAuC,CAAE,CAiBlG,MAAO,CACHlD,QAjBY,CAACrE,EAAkBd,EAA0B2D,KACzD,IAAIsE,EAAgB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAACxB,IAAW,IAAI4B,GACrD,GAAI,CAACJ,EACD,OAGJ,IAAItH,EAASsH,EAAc,OAAO,CAAC,IAAI,CAAC,AAAC9J,GAAMA,EAAE,MAAM,GAAK6B,GAC5D,GAAI,CAACW,EACD,OAGJ,IAAIuH,EAASvH,EAAO,MAAM,CAAG,CAAC,EAAEA,EAAO,MAAM,CAAC,CAAC,EAAEG,EAAS,CAAC,CAAGA,EAC9D,IAAI,CAAC,cAAc,CAACmH,EAAejI,EAAQc,EAAUoH,GAErDG,EAAYH,EAAQzB,EAAU9C,EAClC,EAGI,QAAS,EAAE,AACf,CACJ,CAEA,OAAe,eACXsE,CAA4B,CAC5BjI,CAAwB,CACxBc,CAAgB,CAChBoH,CAA0B,CAC5B,CACE,IAAMhN,EAAS8E,CAAc,CAACc,EAAS,CACvC,GAAI5F,AAAUoF,KAAAA,IAAVpF,GAAuBgN,AAAU5H,KAAAA,GAAV4H,EAAqB,CAC5C,IAAMI,EAAU,EAAE,CAClB,IAAK,IAAM3H,KAAUsH,EAAc,OAAO,CAClCtH,EAAO,MAAM,EAAE,WAAWuH,GAC1BvH,EAAO,MAAM,CAAC,qBAAqB,CAACsH,EAAc,OAAO,EAEzDK,EAAQ,IAAI,CAAC3H,EAGrBsH,CAAAA,EAAc,OAAO,CAAGK,EACxB,MACJ,CAEI5D,kBAAkBxJ,IAClB,IAAI,CAAC,yBAAyB,CAAC+M,EAAe/M,EAAOgN,EAE7D,CACJ,C,CCjJiBK,CAAAA,GAAAA,CAAAA,EAAWA,CAAAA,EAAAA,EACRC,YAAY,CAArB,SAAsBtN,CAAc,EACvC,OACIA,AAAS,MAATA,GACA,AAAiB,UAAjB,OAAOA,GACP,YAAaA,GACb,AAA0C,YAA1C,OAAQA,EAAsB,OAAO,EACpCA,AAAyC,IAAzCA,EAAsB,OAAO,CAAC,MAAM,AAE7C,E,ACPauN,CAAAA,GAAAA,CAAAA,EAASA,CAAAA,EAAAA,EACNC,WAAW,CAApB,SAAqBxN,CAAc,EACtC,MAAO,AAAkC,YAAlC,OAAQA,GAAe,QAA0BA,AAAgC,IAAhCA,EAAc,MAAM,CAAC,MAAM,AACvF,EAGG,IAAMyN,GAAK,AAAIpF,IAClB,IAAMqF,EAAY,IAAI3I,IAOtB,GAAI,CACA,OAAOsD,EANa,AAAoCsF,IACxDD,EAAU,GAAG,CAACC,GACPA,GAKX,QAAU,CACN,IAAK,IAAMA,KAAYD,EACfH,EAAU,WAAW,CAACI,GACtBA,EAAS,MAAM,GACRN,EAAAA,YAAwB,CAACM,IAChCA,EAAS,OAAO,GAGxBD,EAAU,KAAK,EACnB,CACJ,ECtBO,IAAME,GAAN,MAAMA,GACT,OAAO,SAASC,EAAO,EAAE,CAAE,CACvB,IAAIC,EAAK,GAELvK,EAAIsK,EACR,KAAOtK,KAEHuK,GAAMC,AATH,kEASW,CAAEC,AAAgB,GAAhBA,KAAK,MAAM,GAAW,EAAE,CAE5C,OAAOF,CACX,CACJ,EtBrBO,IAAKxH,I,CAAAA,E,6DAAAA,E,ECAKC,EAAAA,GAAAA,CAAAA,EAASA,CAAAA,IACT,QAAQ,CAAG,K,EACX,KAAK,CAAG,K,EACR,KAAK,CAAG,KsByClB,IAAM0H,OAAN,MAAMA,OACT,OAAgB,QAAU,IAAIA,MAAS,AACtB,QAAmB,IAAIxL,GAAM,AAE9C,UAAgB,CACZ,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,AAACyL,GAAcA,EAAU,KAAK,IAClD,IAAI,CAAC,MAAM,CAAC,KAAK,EACrB,CAEA,IAAoCC,CAAQ,CAAEzG,CAA2B,CAAQ,CAC7E,IAAMwG,EAAY,IAAI,CAAC,MAAM,CAAC,GAAG,CAACC,IAAU,IAAIpJ,IAChDmJ,EAAU,GAAG,CAACxG,GACd,IAAI,CAAC,MAAM,CAAC,GAAG,CAACyG,EAAOD,EAC3B,CAEA,IAAoCC,CAAQ,CAAE,GAAGzL,CAAmC,CAAQ,CACxF,IAAI,CAAC,MAAM,CAAC,GAAG,CAACyL,IAAQ,QAAQ,AAACzG,GAAaA,KAAYhF,GAC9D,CAEA,OAAuCyL,CAAQ,CAAEzG,CAA2B,CAAQ,CAChF,IAAI,CAAC,MAAM,CAAC,GAAG,CAACyG,IAAQ,OAAOzG,EACnC,CAEA,UAA0CyG,CAAQ,CAAQ,CACtD,IAAI,CAAC,MAAM,CAAC,GAAG,CAACA,IAAQ,OAC5B,CACJ,ECtEO,IAAMC,SAAW,CACpBC,EACAC,KAEA,IAAIC,EACJ,MAAO,CAAC,GAAG7L,KACH6L,GACAC,aAAaD,GAEjBA,EAAUE,OAAO,UAAU,CAAC,KACxBJ,KAAO3L,GACP6L,EAAUnJ,KAAAA,CACd,EAAGkJ,EACP,CACJ,ECdO,SAASI,SAASpD,CAAgB,CAAExC,CAAY,EACnD,IAAI6F,EAAO,IAAIC,KAAKtD,GACduD,EAAMC,IAAI,eAAe,CAACH,GAChC,GAAI,CACA,IAAIpN,EAAIhB,SAAS,aAAa,CAAC,IAC/BgB,CAAAA,EAAE,KAAK,CAAC,UAAU,CAAG,SACrBA,EAAE,IAAI,CAAGsN,EACTtN,EAAE,QAAQ,CAAGuH,EACbvH,EAAE,KAAK,EACX,QAAU,CACNuN,IAAI,eAAe,CAACD,EACxB,CACJ,CCVA,IAAME,GACF,mBAAmB,IAAI,CAACC,UAAU,SAAS,CAAC,WAAW,KACtDA,UAAU,cAAc,CAAG,GAAK,cAAc,IAAI,CAACA,UAAU,SAAS,EAEpE,eAAeC,eAAeC,CAAc,CAAEC,CAAiB,EAClE,OAAO,IAAIC,QAAQ,AAACC,IAChB,IAAMnO,EAAQX,SAAS,aAAa,CAAC,QACrCW,CAAAA,EAAM,IAAI,CAAG,OACbA,EAAM,QAAQ,CAAGiO,EACb,AAACJ,IACD7N,CAAAA,EAAM,MAAM,CAAGgO,CAAK,EAExBhO,EAAM,KAAK,CAAC,UAAU,CAAG,SAEzB,IAAMoO,QAAU,IAAM/O,SAAS,IAAI,CAAC,WAAW,CAACW,EAEhDA,CAAAA,EAAM,QAAQ,CAAG,KACboO,UACAD,EAAQnO,EAAM,KAAK,CAAGjB,OAAO,EAAE,CAACiB,EAAM,KAAK,EAAIjB,OAAO,GAAG,CAAC,qBAC9D,EAEAiB,EAAM,QAAQ,CAAG,KACboO,UACAD,EAAQpP,OAAO,GAAG,CAAC,UACvB,EAEAM,SAAS,IAAI,CAAC,WAAW,CAACW,GAC1BA,EAAM,KAAK,EACf,EACJ,CAOO,eAAeqO,cAClBL,CAAc,CACdC,CAAiB,CACjBK,EAAyC,YAAY,EAErD,IAAMC,EAAc,MAAMR,eAAeC,EAAQC,GACjD,OAAOM,EAAY,IAAI,CAAGC,iBAAiBD,EAAY,KAAK,CAAED,GAAUC,EAAY,KAAK,EAC7F,CAEA,eAAeC,iBACXC,CAAe,CACfH,CAAsC,EAEtC,IAAMI,EAAmB7M,MAAM,IAAI,CAAC4M,GAAO,GAAG,CAAC,MAAOE,IAClD,IAAMvE,EAAO,MAAMwE,kBAAkBD,EAAML,GAC3C,GAAI,CAAClE,EACD,MAAM,AAAI1I,MAAM,CAAC,6BAA6B,EAAEiN,EAAK,IAAI,CAAC,CAAC,EAE/D,MAAO,CAAE,SAAUA,EAAK,IAAI,CAAEvE,KAAAA,CAAK,CACvC,GAEA,GAAI,CACA,IAAM5H,EAAS,MAAM0L,QAAQ,GAAG,CAACQ,GACjC,OAAO3P,OAAO,EAAE,CAACyD,EACrB,CAAE,MAAOiJ,EAAO,CACZ,OAAO1M,OAAO,GAAG,CAAE0M,EAAgB,OAAO,CAC9C,CACJ,CAEA,SAASmD,kBAAkBD,CAAU,CAAEL,CAAsC,EACzE,OAAO,IAAIJ,QAAQ,AAACC,IAChB,IAAMU,EAAS,IAAIC,UAEnBD,CAAAA,EAAO,MAAM,CAAG,AAACzP,IACTA,EAAE,MAAM,EAAE,aAAe0P,WAAW,IAAI,EACxCX,EAAQ/O,EAAE,MAAM,CAAC,MAAM,CAE/B,EAEAyP,EAAO,OAAO,CAAG,IAAMV,EAAQ,MAC/BU,CAAM,CAACP,EAAO,CAACK,EACnB,EACJ,CC9DA,IAAMI,GAAiB,IAAIxN,QAEVyN,GAAAA,GAAAA,CAAAA,EAAQA,CAAAA,GAsBrB,SAAS9D,2BAA2BtH,CAAW,CAAE4G,CAAsB,CAAEyE,CAAc,EAC9ErL,GAAUA,IAAWqL,IACtBF,GAAe,GAAG,CAACnL,IACnB4G,EAAW,MAAM,CAAC,EAAG,KAAMuE,GAAe,GAAG,CAACnL,GAAS,MAAM,IAEjEsH,2BAA2BJ,OAAO,cAAc,CAAClH,GAAS4G,EAAYyE,GAC1E,CAEO,SAASC,YAA8BtL,CAAS,CAAEc,CAAiB,EACtE,GAAI,CAACd,EAAQ,OACb,IAAIyH,EAAM0D,GAAe,GAAG,CAACnL,UAC7B,AAAIyH,GAAK,IAAI3G,GAAkB2G,EAAI,GAAG,CAAC3G,GAChCwK,YAAYpE,OAAO,cAAc,CAAClH,GAASc,EACtD,C,0VAlCgByK,MAAM,CAAf,SAAgBC,CAAiB,CAAE3E,CAA+C,EACrF,MAAO,CAAC7G,EAAgBgE,KAChB,AAACmH,GAAe,GAAG,CAACnL,IACpBmL,GAAe,GAAG,CAACnL,EAAQ,IAAIrC,KAEnCwN,GAAe,GAAG,CAACnL,IAAS,IAAIgE,EAAM,CAAEwH,QAAAA,EAASxH,KAAAA,EAAM,GAAG6C,CAAU,AAAC,EACzE,CACJ,E,GAEgB4E,aAAa,CAAtB,SAAuBzL,CAAW,CAAEqL,CAAc,EACrD,IAAMzM,EAAqB,EAAE,CAE7B,OADA0I,2BAA2BtH,EAAQpB,EAAQyM,GACpCzM,CACX,E,GAEgB8M,gBAAgB,CAAzB,SAA0B1L,CAAW,EACxC,IAAM4G,EAAauE,GAAe,GAAG,CAACnL,UACtC,AAAK4G,EACE,IAAIA,EAAW,MAAM,GAAG,CADP,EAAE,AAE9B,E,GAUgB0E,WAAW,CAAXA,Y,ACtCHK,CAAAA,GAAAA,CAAAA,EAAQA,CAAAA,EAAAA,EACLC,mBAAmB,CAA5B,SAA6BC,CAAiB,EACjD,MAAO,WAAYA,CACvB,EAGG,IAAeC,kBAAf,MAAeA,0BAA0BlH,WAC5C,OAAwB,iBAAqC,IAAIjH,GAAM,AACpD,cAAiC,IAAIsC,GAAM,AAEtD,cAAwB,EAAM,AACtC,KAAI,aAAc,CACd,OAAO,IAAI,CAAC,YAAY,AAC5B,CAEQ,YAAuC,AAC/C,KAAI,aAAc,CACd,GAAI,CAAC,IAAI,CAAC,YAAY,CAClB,MAAM,AAAInC,MAAM,0BAEpB,OAAO,IAAI,CAAC,YAAY,AAC5B,CAEA,IAAI,UAAW,CACX,OAAO,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,QACxC,CAEA,EAAW,AAAmB,AAC9B,KAAc,YAAa,CACvB,OAAO,IAAI,CAAC,EAAW,AAC3B,CACA,IAAc,WAAW5C,CAAkC,CAAE,CACrD,IAAI,CAAC,EAAW,GAAKA,IACzB,IAAI,CAAC,EAAW,EAAE,UAClB,IAAI,CAAC,EAAW,CAAGA,EACvB,CAEA,MACM,QAAS,CAEX,IADA,IAAI,CAAC,UAAU,EAAE,SACV,CAAC,IAAI,CAAC,YAAY,EACrB,MAAM,IAAIoP,QAAQ,AAACrG,GAAM8H,WAAW9H,EAAG,IAE/C,CAEA,MAAM,QAAQ+H,CAAyB,CAAiB,CACpD,GAAKA,EAAY,UAAU,EAAE,UAC7B,IAAI,CAAC,YAAY,CAAGA,EACpB,GAAI,CACA,IAAI,CAAC,aAAa,GAClB,MAAM,IAAI,CAAC,YAAY,EAC3B,QAAU,CACN,IAAI,CAAC,YAAY,EACrB,EACJ,CAIU,eAAgB,CACtB,IAAI,CAAC,cAAc,GACnB7C,OAAAA,OAAAA,CAAAA,GAAkB,CAAC,qBAAsB,IAAI,CACjD,CAEU,cAAe,CACrB,IAAI,CAAC,cAAc,GACnBA,OAAAA,OAAAA,CAAAA,GAAkB,CAAC,uBACnB,IAAI,CAAC,UAAU,EAAE,UACjB,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,AAAChL,GAAMA,EAAE,OAAO,IAC1C,IAAI,CAAC,YAAY,CAAC,KAAK,GACvB,IAAI,CAAC,YAAY,CAAG,EACxB,CAEQ,gBAAiB,CACrBiN,EAAAA,aAAsB,CAAC,IAAI,EAAE,OAAO,CAAC,AAACjN,IAClC,IAAIpC,EAAM,IAAI,CAAC,kBAAkB,CAACoC,EAC9B2N,CAAAA,kBAAkB,gBAAgB,CAAC,GAAG,CAAC/P,IACtC,KAAY,CAACA,EAAI,CAAG+P,kBAAkB,gBAAgB,CAAC,GAAG,CAAC/P,EAAG,CAEvE,EACJ,CAEQ,gBAAiB,CACrBqP,EAAAA,aAAsB,CAAC,IAAI,EAAE,OAAO,CAAC,AAACjN,IAClC,IAAIpC,EAAM,IAAI,CAAC,kBAAkB,CAACoC,GAC9BrC,EAAQ,IAAY,CAACC,EAAI,AACT,aAAhB,OAAOD,GACXgQ,kBAAkB,gBAAgB,CAAC,GAAG,CAAC/P,EAAKD,EAChD,EACJ,CAEQ,mBAAmBgF,CAAkB,CAAE,CAC3C,OAAOA,EAAS,IAAI,AACxB,CACJ,E,6BAxDoB,CAAC,iB,4C1B7CrB,IAAMmL,GAAkB,IAAItO,IAYrB,SAASkO,kBAAsCK,CAAqB,EACvE,OAAO,AAACC,IACJF,GAAgB,GAAG,CAACC,EAAS,GAAG,CAAEC,GAClCA,EAAY,SAAS,CAAC,IAAI,CAAGD,CACjC,CACJ,C,CAEiBxK,EAAAA,GAAAA,CAAAA,EAAOA,CAAAA,IACJ0K,OAAO,CAAhB,SAAiBpM,CAA8C,EAClE,GAAI,AAAkB,UAAlB,OAAOA,EAAqB,CAC5B,IAAMmM,EAAcF,GAAgB,GAAG,CAACjM,GACxC,OAAOmM,GAAa,UAAU,IAClC,CAIA,MAAOzE,AAFW,CAAkB,YAAlB,OAAO1H,EAAwBA,EAAO,SAAS,CAAGkH,OAAO,cAAc,CAAClH,EAAM,EAE/E,IAAI,AACzB,E,EAEgBqM,GAAG,CAAZ,SAAarI,CAAiB,EACjC,OAAOiI,GAAgB,GAAG,CAACjI,EAC/B,ECrCG,IAAKrC,I,CAAAA,E,kWAAAA,E,EAgBKA,EAAAA,IAAAA,CAAAA,GAAcA,CAAAA,IACX2K,GAAG,CAAZ,SAAaC,CAAyB,CAAEC,CAA0B,EACrE,MAAQD,AAAAA,CAAAA,EAAYC,CAAS,IAAOA,CACxC,E,EAEgBC,GAAG,CAAZ,SAAaF,CAAyB,CAAEC,CAA0B,EACrE,OAAOD,EAAYC,CACvB,E,EAEgBE,MAAM,CAAf,SAAgBH,CAAyB,CAAEC,CAA0B,EACxE,OAAOD,EAAY,CAACC,CACxB,E0BxBG,IAAMG,GAAe,CACxB,iBAAkB,QAClB,iBAAkB,SAClB,mBAAoB,QACpB,mBAAoB,QACpB,kBAAmB,IACnB,kBAAmB,IACnB,eAAgB,EAChB,gBAAiB,IACjB,eAAgB,EAChB,gBAAiB,IACjB,mBAAoB,EACpB,oBAAqB,IACrB,oBAAqB,EACrB,qBAAsB,IACtB,mBAAoB,GACxB,EAEO,IAAMC,OAAN,MAAMA,eAAehI,WACxB,OAAgB,EAAS,CAAG,IAAIgI,MAAS,AAEzC,YAAW,UAAW,CAClB,OAAO,IAAI,CAAC,EAAS,AACzB,CAEA,IAAI,UAAW,CACX,OAAO,IAAI,CAAC,eAAe,CACvB,WACAjL,GAAAA,QAAuB,CACnBA,GAAAA,QAAuB,CACvBA,GAAAA,MAAqB,CACrBA,GAAAA,aAA4B,CAC5BA,GAAAA,YAA2B,CAC3BA,GAAAA,OAAsB,CAElC,CACA,IAAI,SAASkL,CAAwB,CAAE,CACnC,IAAI,CAAC,WAAW,CAAC,WAAYA,EACjC,CAEA,IAAI,oBAAqB,CACrB,OAAO,IAAI,CAAC,eAAe,CAAC,qBAAsB,GACtD,CACA,IAAI,mBAAmB3R,CAAc,CAAE,CACnC,IAAI,CAAC,WAAW,CAAC,qBAAsBA,EAC3C,CAEA,IAAI,YAAa,CACb,OAAO,IAAI,CAAC,eAAe,CAAC,aAAc,GAC9C,CACA,IAAI,WAAWA,CAAc,CAAE,CAC3B,IAAI,CAAC,WAAW,CAAC,aAAcA,EACnC,CAEA,IAAI,kBAAmB,CACnB,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAoB,GACpD,CACA,IAAI,iBAAiBA,CAAc,CAAE,CACjC,IAAI,CAAC,WAAW,CAAC,mBAAoBA,EACzC,CAES,aAAuB,CAAE,AAElC,cAAsB,CAClB,KAAK,EACT,CACJ,ECrEO,IAAM4R,UAAN,MAAMA,UACT,OAAgB,OAAS,YAAa,AACtC,QAAgB,cAAgB,WAAY,AAC5C,QAAgB,YAAc,SAAU,AAC5C,ECWO,IAAMC,GAA0B,MCbvC,GAAe,CACX,QAAS,UACT,KAAM,KACN,YAAa,CACT,YAAa,QACb,YAAa,QACb,SAAU,SACV,SAAU,SACV,SAAU,SACV,WAAY,MACZ,cAAe,UACf,WAAY,MACZ,eAAgB,UAChB,gBAAiB,WACjB,YAAa,OACb,aAAc,QACd,cAAe,SACf,eAAgB,UAChB,cAAe,SACf,YAAa,OACb,YAAa,OACb,gBAAiB,WACjB,YAAa,OACb,eAAgB,UAChB,aAAc,QACd,YAAa,YACb,aAAc,UACd,aAAc,QACd,YAAa,OACb,SAAU,SACV,SAAU,QACV,SAAU,SACV,qBAAsB,iBACtB,gBAAiB,YACjB,kBAAmB,cACnB,gBAAiB,SACjB,gBAAiB,SACjB,oBAAqB,UACrB,oBAAqB,UACrB,oBAAqB,UACrB,sBAAuB,cACvB,sBAAuB,cACvB,0BAA2B,cAC3B,yBAA0B,YAC1B,sBAAuB,MACvB,uBAAwB,OACxB,uBAAwB,OACxB,wBAAyB,UACzB,wBAAyB,QACzB,yBAA0B,SAC1B,0BAA2B,UAC3B,0BAA2B,UAC3B,yBAA0B,SAC1B,qBAAsB,MACtB,wBAAyB,SACzB,qBAAsB,MACtB,wBAAyB,SACzB,sBAAuB,OACvB,2BAA4B,YAC5B,0BAA2B,WAC3B,yBAA0B,UAC1B,2BAA4B,YAC5B,yBAA0B,UAC1B,wBAAyB,SACzB,uBAAwB,eACxB,sBAAuB,OACvB,wBAAyB,SACzB,yBAA0B,UAC1B,yBAA0B,UAC1B,sBAAuB,YACvB,yBAA0B,UAC1B,wBAAyB,SACzB,4BAA6B,aAC7B,kBAAmB,eACnB,mBAAoB,gBACpB,mBAAoB,gBACpB,yBAA0B,aAC1B,oBAAqB,OACrB,oBAAqB,OACrB,sBAAuB,SACvB,sBAAuB,SACvB,wBAAyB,QACzB,yBAA0B,SAC1B,yBAA0B,SAC1B,uBAAwB,QACxB,uBAAwB,QACxB,0BAA2B,WAC3B,6BAA8B,cAC9B,4BAA6B,aAC7B,yBAA0B,UAC1B,4BAA6B,aAC7B,yBAA0B,UAC1B,wBAAyB,SACzB,wBAAyB,SACzB,sBAAuB,OACvB,+BAAgC,gBAChC,8BAA+B,eAC/B,wBAAyB,SACzB,uBAAwB,QACxB,sBAAuB,OACvB,uBAAwB,mBACxB,0BAA2B,mBAC3B,uBAAwB,SACxB,oCAAqC,QACrC,mCAAoC,UACpC,2BAA4B,MAC5B,qCAAsC,SACtC,eAAgB,QAChB,cAAe,OACf,cAAe,OACf,gBAAiB,SACjB,eAAgB,QAChB,eAAgB,QAChB,iBAAkB,UAClB,iBAAkB,UAClB,gBAAiB,SACjB,kBAAmB,WACnB,gBAAiB,SACjB,cAAe,OACf,gBAAiB,SACjB,iBAAkB,UAClB,mBAAoB,YACpB,cAAe,OACf,gBAAiB,SACjB,kCAAmC,uBACnC,kBAAmB,kBACnB,mBAAoB,mBACpB,oBAAqB,aACrB,iCAAkC,2DAClC,4BAA6B,8CAC7B,oCAAqC,0DACrC,gCAAiC,uCACjC,uCAAwC,6BACxC,mCAAoC,0BACpC,cAAe,SACf,cAAe,SACf,eAAgB,qBAChB,eAAgB,QAChB,oBAAqB,SACrB,uBAAwB,aACxB,uBAAwB,aACxB,yBAA0B,eAC1B,WAAY,MACZ,aAAc,QACd,iBAAkB,OAClB,kBAAmB,QACnB,yBAA0B,QAC1B,4BAA6B,WAC7B,yBAA0B,SAC1B,yBAA0B,SAC1B,0BAA2B,SAC3B,0BAA2B,SAC3B,eAAgB,MAChB,oBAAqB,WACrB,qBAAsB,YACtB,oBAAqB,WACrB,uBAAwB,eACxB,qBAAsB,aACtB,mBAAoB,UACpB,wBAAyB,gBACzB,uBAAwB,eACxB,qBAAsB,YACtB,wBAAyB,gBACzB,qBAAsB,YACtB,gBAAiB,UACjB,wBAAyB,SACzB,wBAAyB,OACzB,2BAA4B,YAC5B,6BAA8B,YAC9B,mCAAoC,mBACpC,6BAA8B,eAC9B,iBAAkB,SAClB,iBACI,uHACJ,2BAA4B,6BAC5B,0BAA2B,iCAC3B,uBAAwB,sCACxB,uBAAwB,qCACxB,oBAAqB,kCACrB,uBAAwB,QACxB,yBAA0B,0CAC1B,sBAAuB,sBACvB,sBAAuB,sBACvB,uBAAwB,uBACxB,gCAAiC,oBACjC,sBAAuB,sBACvB,uBAAwB,uBACxB,yBAA0B,yBAC1B,sBAAuB,sBACvB,gCAAiC,iBACjC,6BAA8B,YAC9B,oBAAqB,aACrB,wBAAyB,cACzB,UAAW,SACX,UAAW,QACX,kBAAmB,KACnB,kBAAmB,KACnB,mBAAoB,MACpB,uBAAwB,UACxB,yBAA0B,YAC1B,oBAAqB,UACrB,4BAA6B,gBAC7B,uBAAwB,UACxB,sBAAuB,SACvB,qBAAsB,QACtB,yBAA0B,YAC1B,qBAAsB,QACtB,4BAA6B,gBAC7B,kBAAmB,UACnB,kBAAmB,OACnB,mBAAoB,QACpB,qBAAsB,UACtB,cAAe,SACf,WAAY,MACZ,oBAAqB,eACrB,WAAY,SACZ,qBAAsB,gBACtB,eAAgB,UAChB,iBAAkB,OAClB,qBAAsB,WACtB,4BAA6B,wBAC7B,wBAAyB,kBACzB,+BAAgC,uBAChC,yBAA0B,sBAC1B,6BAA8B,wBAC9B,uBAAwB,iBACxB,oBAAqB,cACrB,oBAAqB,eACrB,aAAc,OACd,mBAAoB,aACpB,0BAA2B,cAC3B,gBAAiB,UACjB,qBAAsB,WACtB,kBAAmB,QACnB,wBAAyB,cACzB,eAAgB,OACpB,CACJ,EC7OA,GAAe,CACX,QAAS,OACT,KAAM,QACN,YAAa,CACT,YAAa,KACb,YAAa,KACb,SAAU,MACV,SAAU,MACV,SAAU,MACV,WAAY,KACZ,cAAe,KACf,WAAY,MACZ,eAAgB,KAChB,gBAAiB,KACjB,YAAa,KACb,aAAc,IACd,cAAe,KACf,eAAgB,KAChB,cAAe,KACf,YAAa,IACb,YAAa,KACb,gBAAiB,QACjB,YAAa,KACb,eAAgB,MAChB,aAAc,KACd,YAAa,KACb,aAAc,KACd,aAAc,KACd,YAAa,KACb,qBAAsB,SACtB,gBAAiB,OACjB,kBAAmB,MACnB,SAAU,IACV,SAAU,IACV,SAAU,IACV,gBAAiB,KACjB,gBAAiB,KACjB,oBAAqB,MACrB,oBAAqB,MACrB,oBAAqB,MACrB,sBAAuB,KACvB,sBAAuB,KACvB,0BAA2B,OAC3B,yBAA0B,KAC1B,sBAAuB,KACvB,uBAAwB,KACxB,uBAAwB,KACxB,wBAAyB,KACzB,wBAAyB,KACzB,yBAA0B,MAC1B,0BAA2B,MAC3B,0BAA2B,MAC3B,yBAA0B,OAC1B,qBAAsB,KACtB,wBAAyB,MACzB,qBAAsB,MACtB,wBAAyB,KACzB,sBAAuB,KACvB,2BAA4B,OAC5B,0BAA2B,KAC3B,yBAA0B,KAC1B,2BAA4B,MAC5B,yBAA0B,KAC1B,wBAAyB,MACzB,uBAAwB,MACxB,sBAAuB,KACvB,wBAAyB,KACzB,yBAA0B,MAC1B,yBAA0B,MAC1B,sBAAuB,KACvB,yBAA0B,KAC1B,wBAAyB,KACzB,4BAA6B,KAC7B,kBAAmB,OACnB,mBAAoB,OACpB,mBAAoB,OACpB,yBAA0B,QAC1B,oBAAqB,KACrB,oBAAqB,KACrB,sBAAuB,KACvB,sBAAuB,KACvB,wBAAyB,KACzB,yBAA0B,KAC1B,yBAA0B,KAC1B,uBAAwB,KACxB,uBAAwB,KACxB,0BAA2B,OAC3B,6BAA8B,OAC9B,4BAA6B,OAC7B,yBAA0B,KAC1B,4BAA6B,OAC7B,yBAA0B,KAC1B,wBAAyB,KACzB,wBAAyB,KACzB,sBAAuB,KACvB,+BAAgC,OAChC,8BAA+B,OAC/B,wBAAyB,KACzB,uBAAwB,KACxB,sBAAuB,KACvB,uBAAwB,UACxB,0BAA2B,OAC3B,uBAAwB,MACxB,oCAAqC,KACrC,mCAAoC,MACpC,2BAA4B,KAC5B,qCAAsC,KACtC,eAAgB,KAChB,cAAe,KACf,cAAe,KACf,gBAAiB,KACjB,eAAgB,OAChB,eAAgB,KAChB,iBAAkB,KAClB,iBAAkB,KAClB,gBAAiB,KACjB,kBAAmB,KACnB,gBAAiB,KACjB,cAAe,KACf,gBAAiB,MACjB,iBAAkB,OAClB,mBAAoB,KACpB,cAAe,KACf,gBAAiB,KACjB,kCAAmC,SACnC,kBAAmB,QACnB,mBAAoB,QACpB,oBAAqB,UACrB,iCAAkC,mBAClC,4BAA6B,qBAC7B,oCAAqC,kBACrC,gCAAiC,UACjC,uCAAwC,gBACxC,mCAAoC,WACpC,cAAe,OACf,cAAe,OACf,eAAgB,eAChB,eAAgB,KAChB,oBAAqB,KACrB,uBAAwB,OACxB,uBAAwB,MACxB,yBAA0B,OAC1B,WAAY,KACZ,aAAc,KACd,iBAAkB,KAClB,kBAAmB,MACnB,yBAA0B,KAC1B,4BAA6B,KAC7B,yBAA0B,SAC1B,yBAA0B,SAC1B,0BAA2B,KAC3B,0BAA2B,KAC3B,eAAgB,KAChB,oBAAqB,KACrB,qBAAsB,OACtB,oBAAqB,MACrB,uBAAwB,OACxB,qBAAsB,OACtB,mBAAoB,OACpB,wBAAyB,QACzB,uBAAwB,QACxB,qBAAsB,MACtB,wBAAyB,QACzB,qBAAsB,MACtB,gBAAiB,KACjB,wBAAyB,KACzB,wBAAyB,IACzB,2BAA4B,KAC5B,6BAA8B,KAC9B,mCAAoC,OACpC,6BAA8B,MAC9B,iBAAkB,IAClB,iBAAkB,mCAClB,2BAA4B,aAC5B,0BAA2B,mBAC3B,uBAAwB,qBACxB,uBAAwB,qBACxB,oBAAqB,kBACrB,uBAAwB,KACxB,yBAA0B,iBAC1B,sBAAuB,OACvB,sBAAuB,OACvB,uBAAwB,QACxB,gCAAiC,UACjC,sBAAuB,OACvB,uBAAwB,QACxB,yBAA0B,OAC1B,sBAAuB,OACvB,gCAAiC,UACjC,6BAA8B,KAC9B,oBAAqB,KACrB,wBAAyB,MACzB,UAAW,IACX,UAAW,IACX,kBAAmB,KACnB,kBAAmB,KACnB,mBAAoB,KACpB,uBAAwB,OACxB,yBAA0B,KAC1B,oBAAqB,KACrB,4BAA6B,QAC7B,uBAAwB,KACxB,sBAAuB,KACvB,qBAAsB,KACtB,yBAA0B,KAC1B,qBAAsB,KACtB,4BAA6B,OAC7B,kBAAmB,KACnB,kBAAmB,KACnB,mBAAoB,KACpB,qBAAsB,KACtB,cAAe,KACf,WAAY,KACZ,oBAAqB,KACrB,WAAY,KACZ,qBAAsB,KACtB,eAAgB,MAChB,iBAAkB,KAClB,qBAAsB,KACtB,4BAA6B,YAC7B,wBAAyB,OACzB,+BAAgC,QAChC,yBAA0B,cAC1B,6BAA8B,UAC9B,uBAAwB,QACxB,oBAAqB,OACrB,oBAAqB,UACrB,aAAc,KACd,mBAAoB,OACpB,0BAA2B,UAC3B,gBAAiB,KACjB,qBAAsB,KACtB,kBAAmB,KACnB,wBAAyB,KACzB,eAAgB,GACpB,CACJ,EC1OMC,GAAS,WACTC,GAAW,IAAI3I,QAgBd,IAAMtI,SAAN,MAAMA,S,GACT,aAAqBD,CAAa,CAAE,C,KAAfA,GAAG,CAAHA,CAAgB,CAErC,IAAIP,CAAc,CAAEoF,CAAc,CAAE,CAChCsM,EAAK,GAAG,CAAC1R,EAAGoF,EAAM,IAAI,CAAC,GAAG,CAC9B,CACJ,G,SAIiBsM,CAAI,E,EACJ,SAAS,CAAG,IAAIvP,IAA0B,CACnD,CAAC,KAAMwP,GAAG,CACV,CAAC,QAASC,GAAG,CAChB,EAED,IAAIC,EAAiCnD,AAAqC,UAArCA,UAAU,QAAQ,CAAC,WAAW,GAAiB,QAAU,KAMvF,SAASoD,mBAAmBC,CAAsB,CAAEC,CAAoC,EAC3F,IAAIC,EAAQ,YAAU,GAAG,CAACF,EACtBE,CAAAA,GACAA,CAAAA,EAAM,WAAW,CAAG,CAChB,GAAGA,EAAM,WAAW,CACpB,GAAGD,CAAY,AACnB,EAER,CAEO,SAASE,UAAU3R,CAAa,CAAE,GAAG6B,CAAW,EAEnD,IAAI+B,EAAO4N,AADI,YAAU,GAAG,CAACF,GACT,WAAW,CAACtR,EAAI,EAAI,YAAU,GAAG,CAAC,SAAU,WAAW,CAACA,EAAI,CAIhF,OAHI6B,EAAK,MAAM,CAAG,GACd+B,CAAAA,EAAOA,EAAK,OAAO,CAAC,aAAc,CAACgO,EAAGnP,IAAUZ,CAAI,CAACY,EAAM,GAExDmB,CACX,CAEO,SAASiO,UAAU7R,CAAW,EACjC,OAAOA,KAAO,YAAU,GAAG,CAAC,SAAU,WAAW,AACrD,CAYO,SAAS8R,eAAerP,CAAa,EACxC,GAAIA,EAAQ,GAAKA,GAAS,YAAU,IAAI,CAAE,OAE1C,IAAIsP,EAAc7P,MAAM,IAAI,CAAC,YAAU,IAAI,GAAG,CAACO,EAAM,CACjDsP,IAAgBT,IACpBA,EAAmBS,EAEnBrS,SAAS,gBAAgB,CAAC,CAAC,MAAM,EAAEuR,GAAO,CAAC,CAAC,EAAE,OAAO,CAAC,AAACxR,IAEnD,IAAIgL,EADOhL,GACM,OAAO,CAACwR,GAAO,EAAE,MAnBzB,OAoBT,GAAIxG,GAAM,SAAW,EAAG,OACxB,IAAI5I,EAAOqP,GAAS,GAAG,CAHZzR,IAGsB,EAAE,AACnCuS,CAJWvS,CAIP,CAACgL,CAAI,CAAC,EAAE,CAAa,CAAGkH,UAAUlH,CAAI,CAAC,EAAE,IAAiB5I,EAClE,GACJ,C,EAnDgBoQ,eAAe,CAAxB,WACH,OAAOX,CACX,E,EAEgBC,kBAAkB,CAAlBA,mB,EAUAI,SAAS,CAATA,U,EASAE,SAAS,CAATA,U,EAMAK,GAAG,CAAZ,SAAaC,CAAgB,CAAEtN,CAAc,CAAE7E,CAAa,CAAE,GAAG6B,CAAW,EAC/EsQ,CAAG,CAACtN,EAAK,CAAG8M,UAAU3R,KAAQ6B,GAC9BsQ,EAAI,OAAO,CAAClB,GAAO,CAAG,GAAGjR,OAAiB6E,GAAM,CAC5ChD,EAAK,MAAM,CAAG,GACdqP,GAAS,GAAG,CAACiB,EAAKtQ,EAE1B,E,EAEgBiQ,cAAc,CAAdA,cAepB,EA5DiBX,GAAAA,CAAAA,EAAIA,CAAAA,I9B3Bd,IAAKtL,I,CAAAA,E,oSAAAA,GAaAC,I,CAAAA,E,2GAAAA,E,EAwIKC,EAAAA,GAAAA,CAAAA,EAAMA,CAAAA,IACHqM,OAAO,CAAhB,SAAiBC,CAAa,EACjC,OAAQA,AAA0B9N,KAAAA,IAA1B8N,EAAiB,IAAI,AACjC,E,EAEgBC,QAAQ,CAAjB,SAAkBD,CAAa,EAElC,OAAOE,AAAkBhO,KAAAA,IAAlBgO,AADMF,EACC,MAAM,EAAkBE,AAAkBhO,KAAAA,IAAlBgO,AADzBF,EACgC,MAAM,AACvD,E,EAEgBG,MAAM,CAAf,SAAgBH,CAAa,EAChC,OAAQA,AAA8B9N,KAAAA,IAA9B8N,EAAgB,SAAS,AACrC,E,EAEgBI,SAAS,CAAlB,SAAmBJ,CAAa,EACnC,OAAQA,AAAuC9N,KAAAA,IAAvC8N,EAAwB,UAAU,AAC9C,ECtKG,IAAKrM,I,CAAAA,E,gDAAAA,GCHAC,I,CAAAA,E,0CAAAA,G,wVCOL,IAAMyM,UAAN,MAAMA,UAET,KAAc,AAEd,MAAc,AAEd,cAAsB,AAEtB,aAAYC,CAAa,CAAEC,CAAa,CAAEC,CAAqB,CAAE,CAC7D,IAAI,CAAC,KAAK,CAAGF,EACb,IAAI,CAAC,KAAK,CAAGC,EACb,IAAI,CAAC,aAAa,CAAGC,CACzB,CACJ,E,gCAZwB,G,qEAEA,G,qEAEA,G,uFANJ,CAAC,CAAC,QAAS,QAAS,gB,cAmBjC,IAAMC,KAAN,MAAMA,KACT,OAAO,cAAcC,CAAoB,CAAEC,CAAiB,CAAE,CAC1D,IAAIC,EAAO,IAAIH,KAMf,OALAG,EAAK,QAAQ,CAAG,UAChBA,EAAK,MAAM,CAAG,IAAIjJ,aAAa+I,AAAe,EAAfA,GAC/BE,EAAK,EAAE,CAAG,IAAIjJ,aAAa+I,AAAe,EAAfA,GAC3BE,EAAK,QAAQ,CAAG,IAAIjJ,aAAa+I,AAAe,EAAfA,GACjCE,EAAK,KAAK,CAAG,IAAIhJ,YAAY+I,GACtBC,CACX,CAEA,OAAO,mBAAmBjG,CAAY,CAAE,CACpC,IAAIiG,EAAO,IAAIH,KAGf,OAFAG,EAAK,QAAQ,CAAG,eAChBA,EAAK,QAAQ,CAAG,IAAIjJ,aAAagD,AAAO,EAAPA,GAC1BiG,CACX,CAGA,SAAqB,cAAe,AAGpC,SAAmC,AAGnC,QAAmC1O,KAAAA,CAAU,AAG7C,OAAiCA,KAAAA,CAAU,AAG3C,OAA2B,IAAM,AAGjC,IAA+BA,KAAAA,CAAU,AAGzC,QAAsB,EAAE,AAAC,AAC7B,EAsDO,SAAS2O,kBAAwDC,CAAW,EAC/E,IAAMC,EAAcD,EAAO,MAAM,CAAC,CAACE,EAAKC,IAAQD,EAAMC,EAAI,MAAM,CAAE,GAC5DzQ,EAAS,IAAKsQ,CAAM,CAAC,EAAE,CAAC,WAAW,CAA+BC,GACpEG,EAAS,EACb,IAAK,IAAMD,KAAOH,EACdtQ,EAAO,GAAG,CAACyQ,EAAKC,GAChBA,GAAUD,EAAI,MAAM,CAExB,OAAOzQ,CACX,C,gCAnFwB,G,mEAGA,G,mEAGA,G,iEAGA,G,gEAGA,G,gEAGA,G,6DAGA,G,sEArCJ,CAAC,EAAE,E,QA2DNqD,EAAAA,GAAAA,CAAAA,EAAaA,CAAAA,IACVsN,QAAQ,CAAjB,SAAkB/I,CAAmB,EACxC,OAAQA,GAAyB,OAASlG,KAAAA,CAC9C,E,EAEgBkP,MAAM,CAAf,SAAgBhJ,CAAmB,EACtC,OAAQA,GAAuB,WAAalG,KAAAA,CAChD,E,EAEgBmP,MAAM,CAAf,SAAgBjJ,CAAmB,EACtC,OAAQA,GAAuB,QAAUlG,KAAAA,CAC7C,E,AAOaoP,CAAAA,GAAAA,CAAAA,EAAcA,CAAAA,EAAAA,EACXtR,IAAI,CAAb,SAAcuR,CAAU,CAAE5G,CAAY,CAAE6G,CAAa,EACxD,MAAO,CACH,SAAU,IAAI7J,aAAa,CAAC4J,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAC,EACtD,MAAO,EAAE,CACTC,MAAAA,EACA7G,KAAAA,CACJ,CACJ,E,CAmBa7G,EAAAA,GAAAA,CAAAA,EAAYA,CAAAA,IACT9D,IAAI,CAAb,SAAcsQ,CAAU,CAAEmB,CAAQ,CAAED,CAAa,CAAEE,CAAkB,EACxE,MAAO,CACH,SAAU,IAAI/J,aAAa,CAAC2I,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAEmB,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAC,EAC3ED,MAAAA,EACAE,SAAAA,EACA,MAAO,EAAE,AACb,CACJ,E,EAEgBC,KAAK,CAAd,SAAevJ,CAAkB,CAAEwJ,CAAmB,EACzD,IAAMC,EAAaD,EAAM,KAAK,CAAC,GAAG,CAAC,AAACE,GACzB,EACH,MAAOA,EAAM,KAAK,CAAG1J,EAAK,QAAQ,CAAC,MAAM,CAAG,EAC5C,MAAO0J,EAAM,KAAK,CAClB,MAAOA,EAAM,KAAK,CAClB,UAAWA,EAAM,SAAS,AAC9B,IAEJ,MAAO,CACH,SAAUjB,kBAAkB,CAACzI,EAAK,QAAQ,CAAEwJ,EAAM,QAAQ,CAAC,EAC3D,MAAOxJ,EAAK,KAAK,CAAC,MAAM,CAACyJ,GACzB,MAAOzJ,EAAK,KAAK,CACjB,SAAUA,EAAK,QAAQ,CACvB,UAAWA,EAAK,SAAS,AAC7B,CACJ,E,AAUa2J,CAAAA,GAAAA,CAAAA,EAAYA,CAAAA,EAAAA,EACTJ,KAAK,CAAd,SAAevJ,CAAkB,CAAEwJ,CAAmB,EACzD,IAAMC,EAAaD,EAAM,KAAK,CAAC,GAAG,CAAC,AAACE,GACzB,EACH,MAAOA,EAAM,KAAK,CAAG1J,EAAK,QAAQ,CAAC,MAAM,CAAG,EAC5C,MAAO0J,EAAM,KAAK,CAClB,MAAOA,EAAM,KAAK,CAClB,UAAWA,EAAM,SAAS,AAC9B,IAEEE,EAASJ,EAAM,MAAM,CAAC,GAAG,CAAC,AAACK,GACtB,EACH,MAAOA,EAAM,KAAK,CAAG7J,EAAK,KAAK,CAAC,MAAM,CACtC,MAAO6J,EAAM,KAAK,CAClB,cAAeA,EAAM,aAAa,AACtC,IAEJ,MAAO,CACH,SAAUpB,kBAAkB,CAACzI,EAAK,QAAQ,CAAEwJ,EAAM,QAAQ,CAAC,EAC3D,MAAOxJ,EAAK,KAAK,CAAC,MAAM,CAACyJ,GACzB,MAAOhB,kBAAkB,CAACzI,EAAK,KAAK,CAAEwJ,EAAM,KAAK,CAAC,EAClD,OAAQf,kBAAkB,CAACzI,EAAK,MAAM,CAAEwJ,EAAM,MAAM,CAAC,EACrD,GAAIf,kBAAkB,CAACzI,EAAK,EAAE,CAAEwJ,EAAM,EAAE,CAAC,EACzC,MAAOxJ,EAAK,KAAK,CACjB4J,OAAAA,CACJ,CACJ,EAGG,IAAeE,gBAAf,MAAeA,gBACC,WAAuB,EAAE,AAAC,AAC1B,SAA4B,EAAE,AAAC,AACxC,OAA2B,AAC3B,aAAmC,AAE7C,UAASV,CAAa,CAAE,CACpB,IAAI,CAAC,MAAM,CAAGA,CAClB,CAEA,SAAS3L,CAAS,CAAEsM,CAAS,CAAEC,CAAS,CAAE,CAGtC,OAFA,IAAI,CAAC,YAAY,GAAK,EAAE,CACxB,IAAI,CAAC,YAAY,CAAC,IAAI,CAACvM,EAAGsM,EAAGC,GACtB,IAAI,AACf,CAEU,UAAW,CACjB,IAAIZ,EAAuC,IAAI,CAAC,YAAY,CAI5D,OAHI,IAAI,CAAC,YAAY,EAAE,SAAW,IAAI,CAAC,UAAU,CAAC,MAAM,EACpDA,CAAAA,EAAQ,IAAI,CAAC,MAAM,AAAD,EAEfA,CACX,CASJ,EAKO,IAAMa,oBAAN,MAAMA,4BAA4BH,gBAC3B,eAAyB,CAAE,AAC7B,iBAAwDhQ,KAAAA,CAAU,AAClE,WAAsB0B,GAAAA,KAAc,AAAC,AAE7C,cAAc,CACV,KAAK,GACL,IAAI,CAAC,MAAM,CAAG2K,GAAa,gBAAgB,AAC/C,CAEA,QAAQnF,CAAc,CAAE,CACpB,IAAI,CAAC,SAAS,CAAGA,CACrB,CAES,UAAW,CAGhB,OAFA,IAAI,CAAC,cAAc,CAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAC5C,IAAI,CAAC,eAAe,CAAGlH,KAAAA,EAChB,IAAI,AACf,CAES,SAASoQ,CAAgB,CAAE,CAMhC,OALA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CACd,MAAO,IAAI,CAAC,cAAc,CAAG,EAC7B,MAAQ,KAAI,CAAC,UAAU,CAAC,MAAM,CAAG,IAAI,CAAC,cAAa,EAAK,EACxDA,MAAAA,CACJ,GACO,IAAI,AACf,CAES,YAAYvS,CAAS,CAAEwS,CAAS,CAAEC,CAAS,CAAE,CAKlD,OAJI,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,IAAI,CAAC,eAAe,CAAEzS,EAAGwS,EAAGC,GAExD,IAAI,CAAC,eAAe,CAAG,CAACzS,EAAGwS,EAAGC,EAAE,CACzB,IAAI,AACf,CAES,OAAsB,CAC3B,IAAIhB,EAAQ,IAAI,CAAC,QAAQ,GACzB,MAAO,CACH,SAAU,IAAI7J,aAAa,IAAI,CAAC,UAAU,EAC1C,MAAO,IAAI,CAAC,OAAO,CACnB,SAAU,IAAI,CAAC,SAAS,CACxB6J,MAAAA,CACJ,CACJ,CACJ,EC5QO,IAAKzN,I,CAAAA,E,4GAAAA,GA2DAC,I,CAAAA,E,+EAAAA,GClEAC,I,CAAAA,E,sNAAAA,E,EAYKA,EAAAA,IAAAA,CAAAA,GAASA,CAAAA,IACNwO,OAAO,CAAhB,SAAiBrJ,CAAe,EACnC,OACIA,AAAS,IAATA,GACAA,AAAS,IAATA,GACAA,AAAS,IAATA,GACAA,AAAS,IAATA,CAER,E,EAEgBsJ,WAAW,CAApB,SAAqBtJ,CAAe,EACvC,OAAQA,GACJ,KAAK,EACD,MAAO,OACX,MAAK,EACD,MAAO,UACX,MAAK,EACD,MAAO,eACX,MAAK,EACD,MAAO,OACX,MAAK,EACD,MAAO,OACX,MAAK,GACD,MAAO,MACX,MAAK,GACD,MAAO,MACX,MAAK,GACD,MAAO,MACX,MAAK,IACD,MAAO,QACX,SACI,MAAO,SACf,CACJ,E,EAEgBuJ,WAAW,CAApB,SAAqBvJ,CAAe,EACvC,MAAQA,AAAAA,CAAAA,AAAO,EAAPA,CAAO,GAAwB,CAC3C,E,EACgBwJ,gBAAgB,CAAzB,SAA0BxJ,CAAe,EAC5C,MAAQA,AAAAA,CAAAA,AAAO,EAAPA,CAAO,GAA6B,CAChD,E,EACgByJ,QAAQ,CAAjB,SAAkBzJ,CAAe,EACpC,MAAQA,AAAAA,CAAAA,AAAO,EAAPA,CAAO,GAAqB,CACxC,E,EACgB0J,QAAQ,CAAjB,SAAkB1J,CAAe,EACpC,MAAQA,AAAAA,CAAAA,AAAO,EAAPA,CAAO,GAAqB,CACxC,E,EACgB2J,OAAO,CAAhB,SAAiB3J,CAAe,EACnC,MAAQA,AAAAA,CAAAA,AAAO,GAAPA,CAAAA,GAA2B,CACvC,E,EACgB4J,OAAO,CAAhB,SAAiB5J,CAAe,EACnC,MAAQA,AAAAA,CAAAA,AAAO,GAAPA,CAAAA,GAA2B,CACvC,E,EACgB6J,OAAO,CAAhB,SAAiB7J,CAAe,EACnC,MAAQA,AAAAA,CAAAA,AAAO,GAAPA,CAAAA,GAA2B,CACvC,E,EACgB8J,SAAS,CAAlB,SAAmB9J,CAAe,EACrC,MAAQA,AAAAA,CAAAA,AAAO,IAAPA,CAAAA,GAA6B,CACzC,EClEG,IAAKlF,I,CAAAA,E,0WAAAA,GyBFL,IAAMiP,UAAN,MAAMA,UACT,OAAO,SAASC,CAAe,CAAE,CAC7B,OAAOA,AAAWtI,KAAK,EAAE,CAAG,IAArBsI,CACX,CAEA,OAAO,SAASC,CAAe,CAAE,CAC7B,OAAOA,AAAW,IAAMvI,KAAK,EAAC,CAAvBuI,CACX,CAEA,OAAO,aAAa,GAAGC,CAAgB,CAAE,CACrC,OAAOA,EAAO,IAAI,CAAC,AAACxW,GAAUgO,KAAK,GAAG,CAAChO,GAASuG,EAAAA,KAAe,CACnE,CAEA,OAAO,aAAa,GAAGiQ,CAAgB,CAAE,CACrC,OAAOA,EAAO,KAAK,CAAC,AAACxW,GAAUgO,KAAK,GAAG,CAAChO,GAASuG,EAAAA,KAAe,CACpE,CAEA,OAAO,YAAYhF,CAAS,CAAE+T,CAAS,CAAEmB,EAAY,IAAI,CAAE,CACvD,OAAOzI,KAAK,GAAG,CAACzM,EAAI+T,GAAKmB,CAC7B,CAEA,OAAO,MAAMzW,CAAa,CAAE0W,CAAW,CAAEC,CAAW,CAAE,CAClD,OAAO3I,KAAK,GAAG,CAAC0I,EAAK1I,KAAK,GAAG,CAAC2I,EAAK3W,GACvC,CAEA,OAAO,OAAOwW,CAAyB,CAAE,CACrC,GAAIA,AAAkB,IAAlBA,EAAO,MAAM,CAAQ,OAEzB,IAAIE,EAAMF,CAAM,CAAC,EAAE,CACfG,EAAMH,CAAM,CAAC,EAAE,CAEnB,IAAK,IAAIjT,EAAI,EAAGA,EAAIiT,EAAO,MAAM,CAAEjT,IAAK,CACpC,IAAMvD,EAAQwW,CAAM,CAACjT,EAAE,AACnBvD,CAAAA,EAAQ0W,GAAKA,CAAAA,EAAM1W,CAAI,EACvBA,EAAQ2W,GAAKA,CAAAA,EAAM3W,CAAI,CAC/B,CAEA,MAAO,CAAE0W,IAAAA,EAAKC,IAAAA,CAAI,CACtB,CACJ,E,mVClCO,IAAMtS,IAAN,MAAMA,IACT,OAAgB,KAAO,IAAIA,IAAI,EAAG,EAAG,EAAG,AACxC,QAAgB,MAAQ,IAAIA,IAAI,EAAG,EAAG,EAAG,AACzC,QAAgB,MAAQ,IAAIA,IAAI,EAAG,EAAG,EAAG,AACzC,QAAgB,MAAQ,IAAIA,IAAI,EAAG,EAAG,EAAG,AACzC,QAAgB,IAAM,IAAIA,IAAI,EAAG,EAAG,EAAG,AAG9B,EAAU,AAEV,EAAU,AAEV,EAAU,AAEnB,aAAYpB,CAAS,CAAEwS,CAAS,CAAEC,CAAS,CAAE,CACzC,IAAI,CAAC,CAAC,CAAGzS,EACT,IAAI,CAAC,CAAC,CAAGwS,EACT,IAAI,CAAC,CAAC,CAAGC,CACb,CAEA,UAAW,CACP,MAAO,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,AAC5C,CAEA,SAAoB,CAChB,MAAO,CAAC,IAAI,CAAC,CAAC,CAAE,IAAI,CAAC,CAAC,CAAE,IAAI,CAAC,CAAC,CAAC,AACnC,CAEA,MAAMkB,CAAc,CAAO,CACvB,OAAO,IAAIvS,IACP,IAAI,CAAC,CAAC,CAAGuS,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CACnC,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CACnC,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAE3C,CAEA,IAAIA,CAAc,CAAU,CACxB,OAAO,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,AACjE,CAEA,QAAQC,CAAc,CAAmB,CACrC,IAAI7I,CAAAA,KAAK,GAAG,CAAC6I,GAAUtQ,EAAAA,KAAe,AAAfA,EACvB,OAAO,IAAIlC,IAAI,IAAI,CAAC,CAAC,CAAGwS,EAAQ,IAAI,CAAC,CAAC,CAAGA,EAAQ,IAAI,CAAC,CAAC,CAAGA,EAC9D,CAEA,SAAe,CACX,OAAO,IAAIxS,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC,CAC5C,CAEA,SAASwS,CAAc,CAAO,CAC1B,OAAO,IAAIxS,IAAI,IAAI,CAAC,CAAC,CAAGwS,EAAQ,IAAI,CAAC,CAAC,CAAGA,EAAQ,IAAI,CAAC,CAAC,CAAGA,EAC9D,CAEA,IAAID,CAAc,CAAO,CACrB,OAAO,IAAIvS,IAAI,IAAI,CAAC,CAAC,CAAGuS,EAAM,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CACvE,CAEA,IAAIA,CAAc,CAAO,CACrB,OAAO,IAAIvS,IAAI,IAAI,CAAC,CAAC,CAAGuS,EAAM,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CACvE,CAEA,WAA6B,CACzB,IAAME,EAAI,IAAI,CAAC,MAAM,GACrB,OAAOA,EAAIvQ,EAAAA,KAAe,CAAGnB,KAAAA,EAAY,IAAIf,IAAI,IAAI,CAAC,CAAC,CAAGyS,EAAG,IAAI,CAAC,CAAC,CAAGA,EAAG,IAAI,CAAC,CAAC,CAAGA,EACtF,CAEA,WAAWF,CAAc,CAAU,CAC/B,IAAMG,EAAK,IAAI,CAAC,CAAC,CAAGH,EAAM,CAAC,CACrBI,EAAK,IAAI,CAAC,CAAC,CAAGJ,EAAM,CAAC,CACrBK,EAAK,IAAI,CAAC,CAAC,CAAGL,EAAM,CAAC,CAC3B,OAAO5I,KAAK,IAAI,CAAC+I,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EAC9C,CAEA,OAAO,OAAOC,CAAW,CAAEC,CAAW,CAAO,CACzC,OAAO,IAAI9S,IAAK6S,AAAAA,CAAAA,EAAG,CAAC,CAAGC,EAAG,CAAC,AAAD,EAAK,EAAID,AAAAA,CAAAA,EAAG,CAAC,CAAGC,EAAG,CAAC,AAAD,EAAK,EAAID,AAAAA,CAAAA,EAAG,CAAC,CAAGC,EAAG,CAAC,AAAD,EAAK,EACzE,CAEA,UAAmB,CACf,OAAO,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,AAC9D,CAEA,QAAiB,CACb,OAAOnJ,KAAK,IAAI,CAAC,IAAI,CAAC,QAAQ,GAClC,CAOA,QAAQ4I,CAAc,CAAsB,CACxC,GAAI,IAAI,CAAC,SAAS,CAACvS,IAAI,IAAI,GAAKA,IAAI,IAAI,CAAC,SAAS,CAACuS,GAAQ,OAC3D,IAAIQ,EAAQ,IAAI,CAAC,KAAK,CAACR,GACnBS,EAAM,IAAI,CAAC,GAAG,CAACT,GAEnB,OAAO5I,KAAK,KAAK,CAACoJ,EAAM,MAAM,GAAIC,EACtC,CAQA,eAAeT,CAAc,CAAEU,CAAe,CAAsB,CAChE,IAAMC,EAAQ,IAAI,CAAC,OAAO,CAACX,GAC3B,GAAIW,AAAUnS,KAAAA,IAAVmS,GAAuBlT,IAAI,IAAI,CAAC,SAAS,CAACiT,GAAS,OACvD,IAAME,EAAM,IAAI,CAAC,KAAK,CAACZ,GAAO,SAAS,GACvC,OAAOY,GAAK,aAAaF,GAAUtJ,AAAU,EAAVA,KAAK,EAAE,CAAOuJ,EAAQA,CAC7D,CAQA,OAAOD,CAAW,CAAEC,CAAa,CAAmB,CAChD,IAAMzT,EAAIwT,EAAO,SAAS,GAC1B,GAAIxT,AAAMsB,KAAAA,IAANtB,EAAiB,OACrB,IAAM2T,EAAMzJ,KAAK,GAAG,CAACuJ,GACrB,OAAO,IAAI,CAAC,QAAQ,CAACE,GAChB,GAAG,CAAC3T,EAAE,QAAQ,CAAE,GAAI2T,CAAE,EAAK3T,EAAE,GAAG,CAAC,IAAI,IACrC,GAAG,CAACA,EAAE,KAAK,CAAC,IAAI,EAAE,QAAQ,CAACkK,KAAK,GAAG,CAACuJ,IAC7C,CAEA,UAAUX,CAAc,CAAEH,EAAoB,IAAI,CAAE,CAChD,OACIJ,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,CAAEO,EAAM,CAAC,CAAEH,IACvCJ,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,CAAEO,EAAM,CAAC,CAAEH,IACvCJ,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,CAAEO,EAAM,CAAC,CAAEH,EAE/C,CAEA,aAAaG,CAAc,CAAEH,EAAoB,IAAI,CAAuB,CACxE,IAAMc,EAAQ,IAAI,CAAC,OAAO,CAACX,GAC3B,OAAOW,AAAUnS,KAAAA,IAAVmS,EAAsBnS,KAAAA,EAAYmS,GAASd,GAAazI,KAAK,EAAE,CAAGuJ,GAASd,CACtF,CAEA,aAAaG,CAAc,CAAEH,EAAoB,IAAI,CAAuB,CACxE,IAAMc,EAAQ,IAAI,CAAC,OAAO,CAACX,GAC3B,OAAOW,AAAUnS,KAAAA,IAAVmS,EAAsBnS,KAAAA,EAAY4I,KAAK,EAAE,CAAGuJ,GAASd,CAChE,CACJ,E,2BAxIwB,G,sDAEA,G,sDAEA,G,0DAZJ,CAAC,CAAC,IAAK,IAAK,I,QCAzB,IAAMiB,YAAN,MAAMA,Y,OACT,aACahB,CAAc,CACdC,CAAc,CACzB,C,KAFWD,GAAG,CAAHA,E,KACAC,GAAG,CAAHA,CACV,CAEH,OAAgB,KAAO,IAAIe,YAAY,IAAIrT,IAAI,EAAG,EAAG,GAAI,IAAIA,IAAI,EAAG,EAAG,GAAI,AAE3E,QAAO,YAAYsT,CAAgB,CAAEC,CAAe,CAAE,CAIlD,OAAO,IAAIF,YAHCE,EAAO,OAAO,CAACD,EAAI,GAAG,EACtBC,EAAO,OAAO,CAACD,EAAI,GAAG,EAGtC,CAEA,OAAO,OAAOA,CAA4B,CAAE,CACxC,GAAI,CAACA,EACD,OAAOtT,IAAI,IAAI,CAGnB,IAAMpB,EAAK0U,AAAAA,CAAAA,EAAI,GAAG,CAAC,CAAC,CAAGA,EAAI,GAAG,CAAC,CAAC,AAAD,EAAK,EAC9BlC,EAAKkC,AAAAA,CAAAA,EAAI,GAAG,CAAC,CAAC,CAAGA,EAAI,GAAG,CAAC,CAAC,AAAD,EAAK,EAC9BjC,EAAKiC,AAAAA,CAAAA,EAAI,GAAG,CAAC,CAAC,CAAGA,EAAI,GAAG,CAAC,CAAC,AAAD,EAAK,EAEpC,OAAO,IAAItT,IAAIpB,EAAGwS,EAAGC,EACzB,CAEA,OAAO,OAAOiC,CAAgB,CAAE3X,CAAa,CAAE,CAY3C,OAAO,IAAI0X,YAXC,CACR,EAAGC,EAAI,GAAG,CAAC,CAAC,CAAG3X,EACf,EAAG2X,EAAI,GAAG,CAAC,CAAC,CAAG3X,EACf,EAAG2X,EAAI,GAAG,CAAC,CAAC,CAAG3X,CACnB,EACY,CACR,EAAG2X,EAAI,GAAG,CAAC,CAAC,CAAG3X,EACf,EAAG2X,EAAI,GAAG,CAAC,CAAC,CAAG3X,EACf,EAAG2X,EAAI,GAAG,CAAC,CAAC,CAAG3X,CACnB,EAGJ,CAEA,OAAO,UAAU2X,CAAgB,CAAgB,CAC7C,GAAM,CAAEjB,IAAAA,CAAG,CAAEC,IAAAA,CAAG,CAAE,CAAGgB,EAerB,MAAO,CACH,SAAU,IAAI9M,aAfD,CACb6L,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEC,EAAI,CAAC,CACxCD,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAEA,EAAI,CAAC,CACxCD,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CACxCA,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CACxCC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CACxCA,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CACxCA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAED,EAAI,CAAC,CACxCC,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEA,EAAI,CAAC,CACxCA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEA,EAAI,CAAC,CACxCA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CACxCD,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAEA,EAAI,CAAC,CACxCD,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAED,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAEA,EAAI,CAAC,CAAED,EAAI,CAAC,CAC3C,EAGG,SAAU5P,GAAAA,KAAc,CACxB,MAAO,EAAE,AACb,CACJ,CAEA,OAAO,QAAQ6Q,CAAgB,CAAE,CAC7B,OAAOA,EAAI,GAAG,CAAC,CAAC,EAAIA,EAAI,GAAG,CAAC,CAAC,EAAIA,EAAI,GAAG,CAAC,CAAC,EAAIA,EAAI,GAAG,CAAC,CAAC,EAAIA,EAAI,GAAG,CAAC,CAAC,EAAIA,EAAI,GAAG,CAAC,CAAC,AACrF,CAEA,OAAO,cAAcA,CAAgB,CAAElD,CAAgB,CAAE,CACrD,GAAM,CAAEiC,IAAAA,CAAG,CAAEC,IAAAA,CAAG,CAAE,CAAGgB,CACrBjB,CAAAA,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjC,EAAM,CAAC,EAC/BiC,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjC,EAAM,CAAC,EAC/BiC,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjC,EAAM,CAAC,EAC/BkC,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElC,EAAM,CAAC,EAC/BkC,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElC,EAAM,CAAC,EAC/BkC,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElC,EAAM,CAAC,CACnC,CAEA,OAAO,QAAQoD,CAA6B,CAAEC,CAA6B,CAAE,QACzE,AAAKA,EAIAD,EAcE,IAAIH,YAVC,CACR,EAAG1J,KAAK,GAAG,CAAC6J,EAAK,GAAG,CAAC,CAAC,CAAEC,EAAK,GAAG,CAAC,CAAC,EAClC,EAAG9J,KAAK,GAAG,CAAC6J,EAAK,GAAG,CAAC,CAAC,CAAEC,EAAK,GAAG,CAAC,CAAC,EAClC,EAAG9J,KAAK,GAAG,CAAC6J,EAAK,GAAG,CAAC,CAAC,CAAEC,EAAK,GAAG,CAAC,CAAC,CACtC,EACY,CACR,EAAG9J,KAAK,GAAG,CAAC6J,EAAK,GAAG,CAAC,CAAC,CAAEC,EAAK,GAAG,CAAC,CAAC,EAClC,EAAG9J,KAAK,GAAG,CAAC6J,EAAK,GAAG,CAAC,CAAC,CAAEC,EAAK,GAAG,CAAC,CAAC,EAClC,EAAG9J,KAAK,GAAG,CAAC6J,EAAK,GAAG,CAAC,CAAC,CAAEC,EAAK,GAAG,CAAC,CAAC,CACtC,GAZWA,EAJAD,CAkBf,CAEA,OAAO,YAAYE,CAAyB,CAAe,CACvD,IAAMrB,EAAM,CAAE,EAAGsB,IAAU,EAAGA,IAAU,EAAGA,GAAS,EAC9CrB,EAAM,CAAE,EAAG,CAACqB,IAAU,EAAG,CAACA,IAAU,EAAG,CAACA,GAAS,EAEvD,IAAK,IAAIzU,EAAI,EAAGA,EAAIwU,EAAO,MAAM,CAAExU,GAAK,EAAG,CACvC,IAAMN,EAAI8U,CAAM,CAACxU,EAAE,CACbkS,EAAIsC,CAAM,CAACxU,EAAI,EAAE,CACjBmS,EAAIqC,CAAM,CAACxU,EAAI,EAAE,AAEvBmT,CAAAA,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEzT,GACxByT,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjB,GACxBiB,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEhB,GACxBiB,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAE1T,GACxB0T,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElB,GACxBkB,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAEjB,EAC5B,CACA,OAAO,IAAIgC,YAAYhB,EAAKC,EAChC,CAEA,OAAO,WAAWoB,CAAmB,CAAe,CAChD,IAAMrB,EAAM,CAAE,EAAGsB,IAAU,EAAGA,IAAU,EAAGA,GAAS,EAC9CrB,EAAM,CAAE,EAAG,CAACqB,IAAU,EAAG,CAACA,IAAU,EAAG,CAACA,GAAS,EAEvD,IAAK,IAAMvD,KAASsD,EAChBrB,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjC,EAAM,CAAC,EAC/BiC,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjC,EAAM,CAAC,EAC/BiC,EAAI,CAAC,CAAG1I,KAAK,GAAG,CAAC0I,EAAI,CAAC,CAAEjC,EAAM,CAAC,EAC/BkC,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElC,EAAM,CAAC,EAC/BkC,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElC,EAAM,CAAC,EAC/BkC,EAAI,CAAC,CAAG3I,KAAK,GAAG,CAAC2I,EAAI,CAAC,CAAElC,EAAM,CAAC,EAEnC,OAAO,IAAIiD,YAAYhB,EAAKC,EAChC,CACJ,EC1IO,IAAMsB,WAAN,MAAMA,WACA,CAAU,AACV,EAAU,AACV,EAAU,AACV,EAAU,AACnB,aAAYC,EAAI,CAAC,CAAEjV,EAAI,CAAC,CAAEwS,EAAI,CAAC,CAAEC,EAAI,CAAC,CAAE,CACpC,IAAI,CAAC,CAAC,CAAGwC,EACT,IAAI,CAAC,CAAC,CAAGjV,EACT,IAAI,CAAC,CAAC,CAAGwS,EACT,IAAI,CAAC,CAAC,CAAGC,CACb,CACA,IAAIyC,CAAa,CAAc,CAC3B,OAAO,IAAIF,WAAW,IAAI,CAAC,CAAC,CAAGE,EAAE,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAE,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAE,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAE,CAAC,CAChF,CACA,SAASA,CAAa,CAAc,CAChC,OAAO,IAAIF,WAAW,IAAI,CAAC,CAAC,CAAGE,EAAE,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAE,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAE,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAE,CAAC,CAChF,CACA,SAASA,CAAa,CAAc,CAChC,GAAM,CAAE,EAAGC,CAAE,CAAE,EAAGC,CAAE,CAAE,EAAGC,CAAE,CAAE,EAAGC,CAAE,CAAE,CAAG,IAAI,CACrC,CAAE,EAAGC,CAAE,CAAE,EAAGC,CAAE,CAAE,EAAGC,CAAE,CAAE,EAAGC,CAAE,CAAE,CAAGR,EAEvC,OAAO,IAAIF,WACPG,EAAKI,EAAKH,EAAKI,EAAKH,EAAKI,EAAKH,EAAKI,EACnCP,EAAKK,EAAKJ,EAAKG,EAAKF,EAAKK,EAAKJ,EAAKG,EACnCN,EAAKM,EAAKL,EAAKM,EAAKL,EAAKE,EAAKD,EAAKE,EACnCL,EAAKO,EAAKN,EAAKK,EAAKJ,EAAKG,EAAKF,EAAKC,EAE3C,CACA,SAA+C,CAE3C,GAAI,CAACI,EAAIC,EAAIC,EAAIC,EAAG,CAAG,CAAC,IAAI,CAAC,CAAC,CAAE,IAAI,CAAC,CAAC,CAAE,IAAI,CAAC,CAAC,CAAE,IAAI,CAAC,CAAC,CAAC,CACnD,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAACP,EAAKA,EAAIC,EAAKA,EAAIC,EAAKA,EAAIC,EAAKA,EAAG,CAC3DK,EAAOH,EAAME,EAAMD,EAAMF,EACzBK,EAAOR,EAAKE,EAAKD,EAAKF,SAC1B,AAAIS,EAAOC,AALD,KAKOF,EACN,CACH,EAAG,EACH,EAAGpL,KAAK,EAAE,CAAG,EACb,EAAGA,AAAqB,EAArBA,KAAK,KAAK,CAAC6K,EAAID,EACtB,EACOS,EAAO,MAAOD,EACd,CACH,EAAG,EACH,EAAG,CAACpL,KAAK,EAAE,CAAG,EACd,EAAGA,AAAqB,EAArBA,KAAK,KAAK,CAAC6K,EAAID,EACtB,EAEO,CACH,EAAG5K,KAAK,KAAK,CAAC,EAAK,EAAC8K,EAAKC,EAAKF,EAAKD,CAAC,EAAI,EAAI,EAAKK,CAAAA,EAAMC,CAAE,GACzD,EAAGlL,KAAK,IAAI,CAAC,EAAK6K,CAAAA,EAAKE,EAAKD,EAAKF,CAAC,GAClC,EAAG5K,KAAK,KAAK,CAAC,EAAK,EAAC6K,EAAKC,EAAKC,EAAKH,CAAC,EAAI,EAAI,EAAKM,CAAAA,EAAMC,CAAE,EAC7D,CAER,CACA,WAAqB,CACjB,IAAMV,EAAK,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CACpBC,EAAK,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CACpBC,EAAK,IAAI,CAAC,CAAC,CAAG,IAAI,CAAC,CAAC,CAEpBY,EAAMd,EAAK,IAAI,CAAC,CAAC,CACjBe,EAAMf,EAAK,IAAI,CAAC,CAAC,CACjBgB,EAAMhB,EAAK,IAAI,CAAC,CAAC,CAEjBiB,EAAMhB,EAAK,IAAI,CAAC,CAAC,CACjBiB,EAAMjB,EAAK,IAAI,CAAC,CAAC,CACjBkB,EAAMjB,EAAK,IAAI,CAAC,CAAC,CAEjBkB,EAAMnB,EAAK,IAAI,CAAC,CAAC,CACjBoB,EAAMnB,EAAK,IAAI,CAAC,CAAC,CACjBoB,EAAMtB,EAAK,IAAI,CAAC,CAAC,CAEvB,OAAOuB,QAAQ,SAAS,CAAC,CACrB,EAAIN,EAAME,EACVJ,EAAMM,EACNL,EAAMI,EACN,EACAL,EAAMM,EACN,EAAIP,EAAMK,EACVD,EAAMI,EACN,EACAN,EAAMI,EACNF,EAAMI,EACN,EAAIR,EAAMG,EACV,EACA,EACA,EACA,EACA,EACH,CACL,CACA,OAAO,UAAUO,CAAY,CAAEC,CAAa,CAAEC,CAAW,CAAc,CACnE,IAAMC,EAAWH,AAAO,GAAPA,EACXI,EAAYH,AAAQ,GAARA,EACZI,EAAUH,AAAM,GAANA,EAEVI,EAAKvM,KAAK,GAAG,CAACoM,GACdI,EAAKxM,KAAK,GAAG,CAACoM,GACdK,EAAKzM,KAAK,GAAG,CAACqM,GACdK,EAAK1M,KAAK,GAAG,CAACqM,GACdM,EAAK3M,KAAK,GAAG,CAACsM,GACdM,EAAK5M,KAAK,GAAG,CAACsM,GAEpB,OAAO,IAAIrC,WACP,CAACuC,EAAKE,EAAKE,EAAKL,EAAKE,EAAKE,EAC1BH,EAAKC,EAAKE,EAAKJ,EAAKG,EAAKE,EACzB,CAACJ,EAAKC,EAAKG,EAAKL,EAAKG,EAAKC,EAC1BJ,EAAKE,EAAKG,EAAKJ,EAAKE,EAAKC,EAEjC,CACJ,E,uVCnGO,IAAMX,QAAN,MAAMA,QACQ,OAAuB,IAAInP,aAAa,GAAI,AAC7D,KACI,OAA+B,CAC/B,MAAO,IAAI,IAAI,CAAC,MAAM,CAAC,AAC3B,CAEO,aAAsB,CACzB,GAAI,CAACgQ,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CACvF,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CACvF,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CACzF,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAE3FC,EAAKhB,EAAMK,EAAMJ,EAAMG,EACvBa,EAAKjB,EAAMM,EAAMJ,EAAME,EACvBc,EAAKjB,EAAMK,EAAMJ,EAAMG,EACvBc,EAAKX,EAAMK,EAAMJ,EAAMG,EACvBQ,EAAKZ,EAAMM,EAAMJ,EAAME,EACvBS,EAAKZ,EAAMK,EAAMJ,EAAMG,EAM3B,OAAON,EALEP,CAAAA,EAAMqB,EAAKpB,EAAMmB,EAAKlB,EAAMiB,CAAC,EAKpBhB,EAJTC,CAAAA,EAAMiB,EAAKhB,EAAMe,EAAKd,EAAMa,CAAC,EAITJ,EAHpBP,CAAAA,EAAMU,EAAKT,EAAMQ,EAAKP,EAAMM,CAAC,EAGEL,EAF/BC,CAAAA,EAAMM,EAAKL,EAAMI,EAAKH,EAAME,CAAC,CAG1C,CAEO,SAA6B,CAChC,MAAO,IAAI,IAAI,CAAC,MAAM,CAAC,AAC3B,CAEO,IAAI/G,CAAc,CAAW,CAChC,IAAIpR,EAAS,IAAIsW,QACjB,IAAK,IAAI1W,EAAQ,EAAGA,EAAQ,GAAIA,IAC5BI,EAAO,MAAM,CAACJ,EAAM,CAAG,IAAI,CAAC,MAAM,CAACA,EAAM,CAAGwR,EAAM,MAAM,CAACxR,EAAM,CAEnE,OAAOI,CACX,CAEO,QAA8B,CACjC,GAAI,CAACmX,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CACvF,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CACvF,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CACzF,CAACC,EAAKC,EAAKC,EAAKC,EAAI,CAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAC3FO,EAAMtB,EAAMK,EAAMJ,EAAMG,EACxBmB,EAAMvB,EAAMM,EAAMJ,EAAME,EACxBoB,EAAMxB,EAAMO,EAAMJ,EAAMC,EACxBqB,EAAMxB,EAAMK,EAAMJ,EAAMG,EACxBqB,EAAMzB,EAAMM,EAAMJ,EAAME,EACxBsB,EAAMzB,EAAMK,EAAMJ,EAAMG,EACxBsB,EAAMpB,EAAMK,EAAMJ,EAAMG,EACxBiB,EAAMrB,EAAMM,EAAMJ,EAAME,EACxBkB,EAAMtB,EAAMO,EAAMJ,EAAMC,EACxBmB,EAAMtB,EAAMK,EAAMJ,EAAMG,EACxBmB,EAAMvB,EAAMM,EAAMJ,EAAME,EACxBoB,EAAMvB,EAAMK,EAAMJ,EAAMG,EAExBoB,EAAMZ,EAAMW,EAAMV,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EAC5E,GAAIM,AAAQ,IAARA,EAGJ,OAFAA,EAAM,EAAMA,EAEL/C,QAAQ,SAAS,CAAC,CACpBkB,AAAAA,CAAAA,EAAM4B,EAAM3B,EAAM0B,EAAMzB,EAAMwB,CAAE,EAAKG,EACrChC,AAAAA,CAAAA,EAAM8B,EAAM/B,EAAMgC,EAAM9B,EAAM4B,CAAE,EAAKG,EACrCrB,AAAAA,CAAAA,EAAMc,EAAMb,EAAMY,EAAMX,EAAMU,CAAE,EAAKS,EACrCxB,AAAAA,CAAAA,EAAMgB,EAAMjB,EAAMkB,EAAMhB,EAAMc,CAAE,EAAKS,EACrC5B,AAAAA,CAAAA,EAAMwB,EAAM1B,EAAM6B,EAAM1B,EAAMsB,CAAE,EAAKK,EACrClC,AAAAA,CAAAA,EAAMiC,EAAM/B,EAAM4B,EAAM3B,EAAM0B,CAAE,EAAKK,EACrCpB,AAAAA,CAAAA,EAAMU,EAAMZ,EAAMe,EAAMZ,EAAMQ,CAAE,EAAKW,EACrC1B,AAAAA,CAAAA,EAAMmB,EAAMjB,EAAMc,EAAMb,EAAMY,CAAE,EAAKW,EACrC9B,AAAAA,CAAAA,EAAM4B,EAAM3B,EAAMyB,EAAMvB,EAAMqB,CAAE,EAAKM,EACrCjC,AAAAA,CAAAA,EAAM6B,EAAM9B,EAAMgC,EAAM7B,EAAMyB,CAAE,EAAKM,EACrCtB,AAAAA,CAAAA,EAAMc,EAAMb,EAAMW,EAAMT,EAAMO,CAAE,EAAKY,EACrCzB,AAAAA,CAAAA,EAAMe,EAAMhB,EAAMkB,EAAMf,EAAMW,CAAE,EAAKY,EACrC7B,AAAAA,CAAAA,EAAMwB,EAAMzB,EAAM2B,EAAMzB,EAAMsB,CAAE,EAAKM,EACrClC,AAAAA,CAAAA,EAAM+B,EAAM9B,EAAM4B,EAAM3B,EAAM0B,CAAE,EAAKM,EACrCrB,AAAAA,CAAAA,EAAMU,EAAMX,EAAMa,EAAMX,EAAMQ,CAAE,EAAKY,EACrC1B,AAAAA,CAAAA,EAAMiB,EAAMhB,EAAMc,EAAMb,EAAMY,CAAE,EAAKY,EACzC,CACL,CAEO,SAASjI,CAAc,CAAW,CACrC,IAAMkI,EAAQ,AAAIja,MAAM,IAAI,IAAI,CAAC,GACjC,IAAK,IAAIQ,EAAI,EAAGA,EAAI,EAAGA,IACnB,IAAK,IAAI0Z,EAAI,EAAGA,EAAI,EAAGA,IACnB,IAAK,IAAIxQ,EAAI,EAAGA,EAAI,EAAGA,IACnBuQ,CAAK,CAACzZ,AAAI,EAAJA,EAAQ0Z,EAAE,EAAI,IAAI,CAAC,MAAM,CAAC1Z,AAAI,EAAJA,EAAQkJ,EAAE,CAAGqI,EAAM,MAAM,CAACrI,AAAI,EAAJA,EAAQwQ,EAAE,CAIhF,OAAOjD,QAAQ,SAAS,CAACgD,EAC7B,CAEO,OAAOhd,CAAc,CAAW,CACnC,IAAK,IAAIuD,EAAI,EAAGA,EAAI,GAAIA,IACpB,GAAI,CAAC8S,UAAU,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC9S,EAAE,CAAEvD,EAAM,MAAM,CAACuD,EAAE,EAAG,MAAO,GAExE,MAAO,EACX,CAEO,OAAiB,CACpB,OAAOyW,QAAQ,SAAS,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,CAC7C,CAEA,OAAc,UAAUgD,CAAwB,CAAW,CACvD,IAAItZ,EAAS,IAAIsW,QACjB,IAAK,IAAI1W,EAAQ,EAAGA,EAAQ,GAAIA,IAC5BI,EAAO,MAAM,CAACJ,EAAM,CAAG0Z,CAAK,CAAC1Z,EAAM,CAEvC,OAAOI,CACX,CAEA,OAAc,UAAoB,CAC9B,OAAOsW,QAAQ,SAAS,CAAC,CACrB,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAC9E,CACL,CAEA,OAAc,MAAgB,CAC1B,OAAOA,QAAQ,SAAS,CAAC,AAAIjX,MAAM,IAAI,IAAI,CAAC,GAChD,CAEA,OAAc,UAAUE,CAAS,CAAEwS,CAAS,CAAEC,CAAS,CAAW,CAC9D,IAAIwH,EAAKlP,KAAK,GAAG,CAAC/K,GACdka,EAAKnP,KAAK,GAAG,CAAC/K,GACd0X,EAAK3M,KAAK,GAAG,CAACyH,GACdmF,EAAK5M,KAAK,GAAG,CAACyH,GACd2H,EAAKpP,KAAK,GAAG,CAAC0H,GACd2H,EAAKrP,KAAK,GAAG,CAAC0H,GAClB,OAAOsE,QAAQ,SAAS,CAAC,CACrBW,EAAKyC,EACLF,EAAKG,EAAKF,EAAKvC,EAAKwC,EACpBD,EAAKE,EAAKH,EAAKtC,EAAKwC,EACpB,EACA,CAACzC,EAAK0C,EACNH,EAAKE,EAAKD,EAAKvC,EAAKyC,EACpBF,EAAKC,EAAKF,EAAKtC,EAAKyC,EACpB,EACAzC,EACA,CAACuC,EAAKxC,EACNuC,EAAKvC,EACL,EACA,EACA,EACA,EACA,EACH,CACL,CAEA,OAAc,YAAY2C,CAAiB,CAAEhG,CAAe,CAAEf,CAAe,CAAW,CACpF,IAAI6C,EAAO,IAAI/U,IAAIiT,EAAO,CAAC,CAAEA,EAAO,CAAC,CAAEA,EAAO,CAAC,EAAE,SAAS,GAC1D,GAAI8B,AAAShU,KAAAA,IAATgU,EAAoB,MAAM,AAAImE,UAAU,kBAE5C,GAAI,CAAEta,EAAAA,CAAC,CAAEwS,EAAAA,CAAC,CAAEC,EAAAA,CAAC,CAAE,CAAG0D,EACdoE,EAAIxP,KAAK,GAAG,CAAC,CAACuI,GACd7V,EAAIsN,KAAK,GAAG,CAAC,CAACuI,GACdkH,EAAI,EAAI/c,EAENsc,EAAQ,CACVS,EAAIxa,EAAIA,EAAIvC,EACZ+c,EAAIxa,EAAIwS,EAAIC,EAAI8H,EAChBC,EAAIxa,EAAIyS,EAAID,EAAI+H,EAChB,EACAC,EAAIxa,EAAIwS,EAAIC,EAAI8H,EAChBC,EAAIhI,EAAIA,EAAI/U,EACZ+c,EAAIhI,EAAIC,EAAIzS,EAAIua,EAChB,EACAC,EAAIxa,EAAIyS,EAAID,EAAI+H,EAChBC,EAAIhI,EAAIC,EAAIzS,EAAIua,EAChBC,EAAI/H,EAAIA,EAAIhV,EACZ,EACA,EACA,EACA,EACA,EACH,CAMD,OAJAsc,CAAK,CAAC,GAAG,CAAGM,EAAS,CAAC,CAAGA,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAAGM,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAAGM,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAC9FA,CAAK,CAAC,GAAG,CAAGM,EAAS,CAAC,CAAGA,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAAGM,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAAGM,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAC9FA,CAAK,CAAC,GAAG,CAAGM,EAAS,CAAC,CAAGA,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAAGM,EAAS,CAAC,CAAGN,CAAK,CAAC,EAAE,CAAGM,EAAS,CAAC,CAAGN,CAAK,CAAC,GAAG,CAExFhD,QAAQ,SAAS,CAACgD,EAC7B,CAEA,OAAc,UAAU/Z,CAAS,CAAEwS,CAAS,CAAEC,CAAS,CAAW,CAC9D,OAAOsE,QAAQ,SAAS,CAAC,CAAC/W,EAAG,EAAG,EAAG,EAAG,EAAGwS,EAAG,EAAG,EAAG,EAAG,EAAGC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAE,CAC7E,CAEA,OAAc,gBAAgBzS,CAAS,CAAEwS,CAAS,CAAEC,CAAS,CAAW,CACpE,OAAOsE,QAAQ,SAAS,CAAC,CAAC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK/W,EAAGwS,EAAGC,EAAG,EAAI,CACvG,CAEA,OAAc,sBAAsBgI,CAAY,CAAW,CACvD,IAAI5G,EAAI,CAAC4G,EAAM,MAAM,CAAC,GAAG,CAACA,EAAM,MAAM,EAChCza,EAAIya,EAAM,MAAM,CAAC,CAAC,CAClBjI,EAAIiI,EAAM,MAAM,CAAC,CAAC,CAClBhI,EAAIgI,EAAM,MAAM,CAAC,CAAC,CAClBC,EAAO,GAAK1a,EACZ2a,EAAQ,GAAKnI,EACboI,EAAQ,GAAKnI,EACnB,OAAOsE,QAAQ,SAAS,CAAC,CACrB2D,EAAO1a,EAAI,EACX2a,EAAQ3a,EACR4a,EAAQ5a,EACR,EACA0a,EAAOlI,EACPmI,EAAQnI,EAAI,EACZoI,EAAQpI,EACR,EACAkI,EAAOjI,EACPkI,EAAQlI,EACRmI,EAAQnI,EAAI,EACZ,EACAiI,EAAO7G,EACP8G,EAAQ9G,EACR+G,EAAQ/G,EACR,EACH,CACL,CAEO,WAAqB,CACxB,IAAIpT,EAAS,IAAIsW,QAqBjB,OApBAtW,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAElCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAElCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACjCA,EAAO,MAAM,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CACnCA,EAAO,MAAM,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAEnCA,EAAO,MAAM,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClCA,EAAO,MAAM,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClCA,EAAO,MAAM,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CACnCA,EAAO,MAAM,CAAC,GAAG,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAE5BA,CACX,CAEA,SAASqU,CAAyB,CAAY,CAC1C,IAAIrU,EAAmB,EAAE,CACzB,IAAK,IAAIH,EAAI,EAAGA,EAAIwU,EAAO,MAAM,CAAG,EAAGxU,IAAK,CACxC,IAAIN,EACA8U,CAAM,CAAC,EAAIxU,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC9BwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClCwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClC,IAAI,CAAC,MAAM,CAAC,GAAG,CACfkS,EACAsC,CAAM,CAAC,EAAIxU,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC9BwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClCwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClC,IAAI,CAAC,MAAM,CAAC,GAAG,CACfmS,EACAqC,CAAM,CAAC,EAAIxU,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC9BwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClCwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CACnC,IAAI,CAAC,MAAM,CAAC,GAAG,CACf2U,EACAH,CAAM,CAAC,EAAIxU,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC9BwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAClCwU,CAAM,CAAC,EAAIxU,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CACnC,IAAI,CAAC,MAAM,CAAC,GAAG,CACnBG,EAAO,IAAI,CAACT,EAAIiV,EAAGzC,EAAIyC,EAAGxC,EAAIwC,EAClC,CACA,OAAOxU,CACX,CAEO,QAAQ+Q,CAAc,CAAO,CAChC,IAAI/Q,EAAS,IAAI,CAAC,QAAQ,CAAC,CAAC+Q,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAC,EACtD,OAAO,IAAIpQ,IAAIX,CAAM,CAAC,EAAE,CAAEA,CAAM,CAAC,EAAE,CAAEA,CAAM,CAAC,EAAE,CAClD,CAEO,SAASoa,CAAe,CAAO,CAClC,IAAIpa,EAAS,IAAI,CAAC,SAAS,CAAC,CAACoa,EAAO,CAAC,CAAEA,EAAO,CAAC,CAAEA,EAAO,CAAC,CAAC,EAC1D,OAAO,IAAIzZ,IAAIX,CAAM,CAAC,EAAE,CAAEA,CAAM,CAAC,EAAE,CAAEA,CAAM,CAAC,EAAE,CAClD,CAEO,UAAUqa,CAA0B,CAAY,CACnD,IAAIra,EAAmB,EAAE,CACzB,IAAK,IAAIH,EAAI,EAAGA,EAAIwa,EAAQ,MAAM,CAAG,EAAGxa,IAAK,CACzC,IAAIN,EACA8a,CAAO,CAAC,EAAIxa,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC/Bwa,CAAO,CAAC,EAAIxa,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACnCwa,CAAO,CAAC,EAAIxa,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACnCkS,EACAsI,CAAO,CAAC,EAAIxa,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC/Bwa,CAAO,CAAC,EAAIxa,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACnCwa,CAAO,CAAC,EAAIxa,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACnCmS,EACAqI,CAAO,CAAC,EAAIxa,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAC/Bwa,CAAO,CAAC,EAAIxa,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CACnCwa,CAAO,CAAC,EAAIxa,EAAI,EAAE,CAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CACxCG,EAAO,IAAI,CAACT,EAAGwS,EAAGC,EACtB,CACA,OAAOhS,CACX,CAEO,iBAAuB,CAC1B,OAAO,IAAIW,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CACpE,CAEO,UAAgB,CACnB,IAAMpB,EAAI+K,KAAK,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,EAC7DyH,EAAIzH,KAAK,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,EAC7D0H,EAAI1H,KAAK,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAE,IAAI,CAAC,MAAM,CAAC,GAAG,EACpE,OAAO,IAAI3J,IAAIpB,EAAGwS,EAAGC,EACzB,CAEO,gBAA+D,CAClE,IAAMsI,EAAI,IAAI,CAAC,MAAM,CACfC,EAAMD,CAAC,CAAC,EAAE,CACZE,EAAMF,CAAC,CAAC,EAAE,CACVG,EAAMH,CAAC,CAAC,EAAE,CACRI,EAAMJ,CAAC,CAAC,EAAE,CACZK,EAAML,CAAC,CAAC,EAAE,CACRM,EAAMN,CAAC,CAAC,EAAE,CACZO,EAAMP,CAAC,CAAC,GAAG,CAEX9D,EAAQ,EACRC,EAAMnM,KAAK,IAAI,CAACqI,UAAU,KAAK,CAAC8H,EAAK,GAAI,IACzClE,EAAO,EASX,OAPIjM,AAAgB,SAAhBA,KAAK,GAAG,CAACmQ,IACTjE,EAAQlM,KAAK,KAAK,CAAC,CAACqQ,EAAKE,GACzBtE,EAAOjM,KAAK,KAAK,CAAC,CAACkQ,EAAKD,IAExB/D,EAAQlM,KAAK,KAAK,CAACsQ,EAAKF,GAGrB,CAAElE,MAAAA,EAAOC,IAAAA,EAAKF,KAAAA,CAAK,CAC9B,CAEA,OAAc,cACVqD,CAAiB,CACjBkB,CAAsD,CACtDC,CAAc,CACP,CACP,IAAMC,EAAazG,WAAW,SAAS,CAACuG,EAAS,KAAK,CAAEA,EAAS,GAAG,CAAEA,EAAS,IAAI,EAC7EG,EAAK,AAAI5b,MAAM,IAAI,IAAI,CAAC,GAExBE,EAAIyb,EAAW,CAAC,CAClBjJ,EAAIiJ,EAAW,CAAC,CAChBhJ,EAAIgJ,EAAW,CAAC,CAChBxG,EAAIwG,EAAW,CAAC,CACdjG,EAAKxV,EAAIA,EACXyV,EAAKjD,EAAIA,EACTkD,EAAKjD,EAAIA,EACPkJ,EAAK3b,EAAIwV,EACXoG,EAAK5b,EAAIyV,EACToG,EAAK7b,EAAI0V,EACPoG,EAAKtJ,EAAIiD,EACXsG,EAAKvJ,EAAIkD,EACTsG,EAAKvJ,EAAIiD,EACPuG,EAAKhH,EAAIO,EACX0G,EAAKjH,EAAIQ,EACT0G,EAAKlH,EAAIS,EAEPwE,EAAKsB,EAAM,CAAC,CACd7D,EAAK6D,EAAM,CAAC,CACZpB,EAAKoB,EAAM,CAAC,CAsBhB,OApBAE,CAAE,CAAC,EAAE,CAAI,GAAKI,CAAAA,EAAKE,CAAC,GAAM9B,EAC1BwB,CAAE,CAAC,EAAE,CAAIE,AAAAA,CAAAA,EAAKO,CAAC,EAAKjC,EACpBwB,CAAE,CAAC,EAAE,CAAIG,AAAAA,CAAAA,EAAKK,CAAC,EAAKhC,EACpBwB,CAAE,CAAC,EAAE,CAAG,EAERA,CAAE,CAAC,EAAE,CAAIE,AAAAA,CAAAA,EAAKO,CAAC,EAAKxE,EACpB+D,CAAE,CAAC,EAAE,CAAI,GAAKC,CAAAA,EAAKK,CAAC,GAAMrE,EAC1B+D,CAAE,CAAC,EAAE,CAAIK,AAAAA,CAAAA,EAAKE,CAAC,EAAKtE,EACpB+D,CAAE,CAAC,EAAE,CAAG,EAERA,CAAE,CAAC,EAAE,CAAIG,AAAAA,CAAAA,EAAKK,CAAC,EAAK9B,EACpBsB,CAAE,CAAC,EAAE,CAAIK,AAAAA,CAAAA,EAAKE,CAAC,EAAK7B,EACpBsB,CAAE,CAAC,GAAG,CAAI,GAAKC,CAAAA,EAAKG,CAAC,GAAM1B,EAC3BsB,CAAE,CAAC,GAAG,CAAG,EAETA,CAAE,CAAC,GAAG,CAAGrB,EAAS,CAAC,CACnBqB,CAAE,CAAC,GAAG,CAAGrB,EAAS,CAAC,CACnBqB,CAAE,CAAC,GAAG,CAAGrB,EAAS,CAAC,CACnBqB,CAAE,CAAC,GAAG,CAAG,EAEF3E,QAAQ,SAAS,CAAC2E,EAC7B,CACJ,E,oXAnYwB,G,wEALJ,CAAC,CAAC,Q,CAAW3B,GACtBhD,QAAQ,SAAS,CAACgD,I,UCHtB,IAAMqC,MAAN,MAAMA,MACT,OAAgB,GAAY,IAAIA,MAAMhb,IAAI,IAAI,CAAEA,IAAI,KAAK,CAAEA,IAAI,KAAK,CAAE,AACtE,QAAgB,GAAY,IAAIgb,MAAMhb,IAAI,IAAI,CAAEA,IAAI,KAAK,CAAEA,IAAI,KAAK,CAAE,AACtE,QAAgB,GAAY,IAAIgb,MAAMhb,IAAI,IAAI,CAAEA,IAAI,KAAK,CAAEA,IAAI,KAAK,CAAE,AAG7D,OAAY,AAKZ,OAAY,AAEZ,KAAU,AACV,KAAU,AACnB,aAAYib,CAAW,CAAEhI,CAAW,CAAEiI,CAAS,CAAE,CAC7C,IAAI,CAAC,MAAM,CAAGD,EACd,IAAIxb,EAAIwT,EAAO,SAAS,GACpBrU,EAAIsc,EAAK,SAAS,GACtB,GAAIzb,AAAMsB,KAAAA,IAANtB,GAAmBA,EAAE,SAAS,CAACO,IAAI,IAAI,EACvC,MAAM,AAAIzB,MAAM,0BAEpB,GAAIK,AAAMmC,KAAAA,IAANnC,GAAmBA,EAAE,SAAS,CAACoB,IAAI,IAAI,EACvC,MAAM,AAAIzB,MAAM,6BAEpB,GAAIkB,EAAE,YAAY,CAACb,GACf,MAAM,AAAIL,MAAM,oCAEpB,KAAI,CAAC,MAAM,CAAGkB,EACd,IAAI,CAAC,IAAI,CAAGb,EACZ,IAAI,CAAC,IAAI,CAAGa,EAAE,KAAK,CAACb,GAAG,SAAS,EACpC,CAEA,YAAYqc,CAAW,CAAE,CACrB,OAAO,IAAID,MAAMC,EAAQ,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,IAAI,CACnD,CAEA,QAAQ7K,CAAU,CAAO,CACrB,IAAMqJ,EAASrJ,EAAM,GAAG,CAAC,IAAI,CAAC,MAAM,EAC9B4C,EAAMyG,EAAO,GAAG,CAAC,IAAI,CAAC,MAAM,EAClC,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAACA,EAAO,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAACzG,IAC3D,CAEA,YAAYO,CAAe,CAAE,CACzB,IAAM4H,EAAW5H,EAAO,OAAO,CAAC,IAAI,CAAC,MAAM,EACrC3U,EAAI2U,EAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,EAC7BN,EAASM,EAAO,QAAQ,CAAC,IAAI,CAAC,MAAM,EAC1C,OAAO,IAAIyH,MAAMG,EAAUlI,EAAQrU,EACvC,CAEA,UAAUwc,CAAQ,CAAEC,EAA6B,EAAI,CAAmB,CACpE,IAAMlI,EAAM,IAAI,CAAC,MAAM,CAAC,GAAG,CAACiI,EAAI,QAAQ,EACxC,GAAIjI,EAAI,SAAS,CAACnT,IAAI,IAAI,EAAG,OAAO,IAAI,CAAC,MAAM,CAC/C,IAAMsb,EAAMnI,EAAI,GAAG,CAAC,IAAI,CAAC,MAAM,EACzBH,EAAMoI,EAAI,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EACzC,GAAIpJ,UAAU,WAAW,CAACgB,EAAK,GAAI,OAAOhB,UAAU,WAAW,CAACsJ,EAAK,GAAKF,EAAI,QAAQ,CAAGra,KAAAA,EACzF,IAAMqY,EAAIkC,EAAMtI,EAChB,GAAI,AAACqI,IAAqBjC,CAAAA,EAAI,GAC9B,OAAOgC,EAAI,QAAQ,CAAC,GAAG,CAACA,EAAI,SAAS,CAAC,QAAQ,CAAChC,GACnD,CAEA,gBAAgBvG,CAAO,CAAEC,CAAO,CAAE,CAC9B,IAAIyI,EAAM,IAAI,CAAC,OAAO,CAAC1I,GACnB2I,EAAM,IAAI,CAAC,OAAO,CAAC1I,GACvB,OAAOyI,EAAI,UAAU,CAACC,EAC1B,CACJ,E,6BA7DwB,G,+DAKA,G,+DAEA,G,mEAbJ,CAAC,CAAC,SAAU,SAAU,O,UCFnC,IAAMC,WAAN,MAAMA,W,KACD,MAAkB,AAClB,MAAkB,AAClB,mBAAoC,AACpC,aAAyB,AAEjC,KAAI,OAAQ,CACR,OAAO,IAAI,CAAC,YAAY,AAC5B,CAEA,YAAqBpC,CAAY,CAAE,C,KAAdA,KAAK,CAALA,E,KATb,KAAK,CAAW,E,KAChB,KAAK,CAAW,E,KAChB,kBAAkB,CAAY,G,KAC9B,YAAY,CAAW,CAMK,CAEpC,UAAUjJ,CAAU,CAAE,CAClB,IAAMsL,EAAgBtL,EAAM,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAC3CuL,EAAcD,EAAc,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAC/CE,EAAcF,EAAc,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAEjD,KAAI,CAAC,uBAAuB,CAACC,EAAaC,IAC1C,KAAI,CAAC,kBAAkB,CAAG,CAAC,IAAI,CAAC,kBAAkB,AAAD,EAGrD,IAAI,CAAC,YAAY,CAAG,IAAI,CAAC,cAAc,CAACF,GACxC,IAAI,CAAC,qBAAqB,CAACC,EAAaC,EAC5C,CAEQ,eAAenC,CAAW,CAAU,CAExC,IAAMoC,EAAkBC,AAAiB,IADlB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAACrC,EAAQ,IAAI,CAAC,KAAK,CAAC,MAAM,EAC/B9P,KAAK,EAAE,CACvD,OAAO,IAAI,CAAC,kBAAkB,CAAGkS,EAAiB,IAAMA,CAC5D,CAEQ,wBAAwBjd,CAAS,CAAEwS,CAAS,CAAW,CAC3D,IAAM2K,EAAiB,IAAI,CAAC,KAAK,CAAG,CAAC7Z,EAAAA,QAAkB,EAAIkP,EAAIlP,EAAAA,QAAkB,CAC3E8Z,EAAmB,IAAI,CAAC,KAAK,CAAG,CAAC9Z,EAAAA,QAAkB,EAAIkP,EAAI,CAAClP,EAAAA,QAAkB,CAKpF,MAAO+Z,AAHFF,CAAAA,GAAkB,IAAI,CAAC,YAAY,CAAG7Z,EAAAA,KAAe,EACrD8Z,GAAoB,IAAI,CAAC,YAAY,CAAG,CAAC9Z,EAAAA,KAAe,AAAfA,GAExB,IAAI,CAAC,KAAK,CAAG,GAAKtD,EAAI,CAChD,CAEQ,sBAAsBA,CAAS,CAAEwS,CAAS,CAAE,CAC5CzH,KAAK,GAAG,CAAC/K,GAAKsD,EAAAA,QAAkB,EAAE,KAAI,CAAC,KAAK,CAAGtD,CAAAA,EAC/C+K,KAAK,GAAG,CAACyH,GAAKlP,EAAAA,QAAkB,EAAE,KAAI,CAAC,KAAK,CAAGkP,CAAAA,CACvD,CACJ,E,mVC5CO,IAAM8K,IAAN,MAAMA,IAEA,QAAc,AAKd,UAAe,AAExB,aAAYf,CAAa,CAAEgB,CAAc,CAAE,CACvC,IAAI,CAAC,QAAQ,CAAGhB,EAChB,IAAM1b,EAAI0c,EAAU,SAAS,GAC7B,GAAI1c,AAAMsB,KAAAA,IAANtB,GAAmBA,EAAE,SAAS,CAACO,IAAI,IAAI,EACvC,MAAM,AAAIzB,MAAM,4BAEpB,KAAI,CAAC,SAAS,CAAGkB,CACrB,CAEA,UAAU8S,CAAU,CAAmB,CACnC,GAAI,IAAI,CAAC,SAAS,CAAC,YAAY,CAACA,EAAM,SAAS,EAAG,OAClD,IAAMlT,EAAS,IAAI,CAAC,SAAS,CAACkT,GAE9B,OAAOY,AADK9T,EAAO,GAAG,CAACkT,EAAM,QAAQ,EAC1B,YAAY,CAACA,EAAM,SAAS,EAAIlT,EAAS0B,KAAAA,CACxD,CAEA,UAAUwR,CAAU,CAAO,CACvB,IAAM9S,EAAI8S,EAAM,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,GACzD,GAAI9S,AAAMsB,KAAAA,IAANtB,EAAiB,OAAO,IAAI,CAAC,cAAc,CAAC8S,EAAM,QAAQ,EAC9D,IAAMU,EAASxT,EAAE,KAAK,CAAC8S,EAAM,SAAS,EAAE,SAAS,GAEjD,OAAO8G,AADO,IAAI2B,MAAMzI,EAAM,QAAQ,CAAEU,EAAQxT,GACnC,SAAS,CAAC,IAAI,CAC/B,CAEA,eAAe2Q,CAAU,CAAO,CAE5B,IAAM4C,EAAMG,AADA/C,EAAM,GAAG,CAAC,IAAI,CAAC,QAAQ,EACnB,GAAG,CAAC,IAAI,CAAC,SAAS,EAClC,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC4C,GACrD,CACJ,E,6WArCwB,G,6DAKA,G,kEAPJ,CAAC,CAAC,WAAY,Y,QCG3B,IAAMlT,GAAN,MAAMA,GACT,OAAgB,KAAO,IAAIA,GAAG,EAAG,EAAG,AACpC,QAAgB,MAAQ,IAAIA,GAAG,EAAG,EAAG,AACrC,QAAgB,MAAQ,IAAIA,GAAG,EAAG,EAAG,AAG5B,EAAU,AAEV,EAAU,AAEnB,aAAYlB,CAAS,CAAEwS,CAAS,CAAE,CAC9B,IAAI,CAAC,CAAC,CAAGxS,EACT,IAAI,CAAC,CAAC,CAAGwS,CACb,CAEA,MAAMmB,CAAS,CAAU,CACrB,OAAO,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,AAC9C,CAEA,IAAIA,CAAS,CAAU,CACnB,OAAO,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CAAG,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,AAC9C,CAEA,QAAQC,CAAc,CAAkB,CACpC,OAAO7I,KAAK,GAAG,CAAC6I,GAAUtQ,EAAAA,KAAe,CAAGnB,KAAAA,EAAY,IAAIjB,GAAG,IAAI,CAAC,CAAC,CAAG0S,EAAQ,IAAI,CAAC,CAAC,CAAGA,EAC7F,CAEA,SAAc,CACV,OAAO,IAAI1S,GAAG,CAAC,IAAI,CAAC,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC,CAClC,CAEA,SAAS0S,CAAc,CAAM,CACzB,OAAO,IAAI1S,GAAG,IAAI,CAAC,CAAC,CAAG0S,EAAQ,IAAI,CAAC,CAAC,CAAGA,EAC5C,CAEA,IAAID,CAAS,CAAM,CACf,OAAO,IAAIzS,GAAG,IAAI,CAAC,CAAC,CAAGyS,EAAM,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CACpD,CAEA,IAAIA,CAAS,CAAM,CACf,OAAO,IAAIzS,GAAG,IAAI,CAAC,CAAC,CAAGyS,EAAM,CAAC,CAAE,IAAI,CAAC,CAAC,CAAGA,EAAM,CAAC,CACpD,CAEA,WAA4B,CACxB,IAAME,EAAI,IAAI,CAAC,MAAM,GACrB,OAAOA,EAAIvQ,EAAAA,KAAe,CAAGnB,KAAAA,EAAY,IAAIjB,GAAG,IAAI,CAAC,CAAC,CAAG2S,EAAG,IAAI,CAAC,CAAC,CAAGA,EACzE,CAEA,WAAWF,CAAS,CAAU,CAC1B,IAAMG,EAAK,IAAI,CAAC,CAAC,CAAGH,EAAM,CAAC,CACrBI,EAAK,IAAI,CAAC,CAAC,CAAGJ,EAAM,CAAC,CAC3B,OAAO5I,KAAK,IAAI,CAAC+I,EAAKA,EAAKC,EAAKA,EACpC,CAEA,OAAO,OAAOE,CAAM,CAAEC,CAAM,CAAM,CAC9B,OAAO,IAAIhT,GAAI+S,AAAAA,CAAAA,EAAG,CAAC,CAAGC,EAAG,CAAC,AAAD,EAAK,EAAID,AAAAA,CAAAA,EAAG,CAAC,CAAGC,EAAG,CAAC,AAAD,EAAK,EACrD,CAEA,UAAmB,CACf,OAAO,IAAI,CAAC,CAAC,EAAI,EAAI,IAAI,CAAC,CAAC,EAAI,CACnC,CAEA,QAAiB,CACb,OAAOnJ,KAAK,IAAI,CAAC,IAAI,CAAC,QAAQ,GAClC,CAOA,QAAQ4I,CAAS,CAAsB,CACnC,IAAI,KAAI,CAAC,SAAS,CAACzS,GAAG,IAAI,GAAKyS,EAAM,SAAS,CAACzS,GAAG,IAAI,GAEtD,OAAO6J,KAAK,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC4I,GAAQ,IAAI,CAAC,GAAG,CAACA,GAClD,CAEA,UAAUA,CAAS,CAAEH,EAAoB,IAAI,CAAE,CAC3C,OACIJ,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,CAAEO,EAAM,CAAC,CAAEH,IACvCJ,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,CAAEO,EAAM,CAAC,CAAEH,EAE/C,CAEA,aAAaG,CAAS,CAAEH,EAAoB,IAAI,CAAuB,CACnE,IAAMc,EAAQ,IAAI,CAAC,OAAO,CAACX,GAC3B,OAAOW,AAAUnS,KAAAA,IAAVmS,EAAsBnS,KAAAA,EAAYmS,GAASd,GAAazI,KAAK,EAAE,CAAGuJ,GAASd,CACtF,CAEA,aAAaG,CAAS,CAAEH,EAAoB,IAAI,CAAuB,CACnE,IAAMc,EAAQ,IAAI,CAAC,OAAO,CAACX,GAC3B,OAAOW,AAAUnS,KAAAA,IAAVmS,EAAsBnS,KAAAA,EAAY4I,KAAK,EAAE,CAAGuJ,GAASd,CAChE,CACJ,E,kXAxFwB,G,oDAEA,G,uDARJ,CAAC,CAAC,IAAK,I,OCCpB,IAAMgK,QAAN,MAAMA,gBAAgBvW,kBACzB,IAEI,OAAgB,CAChB,OAAO,IAAI,CAAC,eAAe,CAAC,QAAS,GACzC,CACA,IAAI,MAAMlK,CAAa,CAAE,CACrB,IAAI,CAAC,WAAW,CAAC,QAASA,EAC9B,CAEA,IACI,OAAgB,CAChB,OAAO,IAAI,CAAC,eAAe,CAAC,QAAS,IACzC,CACA,IAAI,MAAMA,CAAa,CAAE,CACrB,IAAI,CAAC,WAAW,CAAC,QAASA,EAC9B,CAEA,IACI,OAAgB,CAChB,OAAO,IAAI,CAAC,eAAe,CAAC,QAAS,IACzC,CACA,IAAI,MAAMA,CAAa,CAAE,CACrB,IAAI,CAAC,WAAW,CAAC,QAASA,EAC9B,CAEA,IAEI,UAAmB,CACnB,OAAO,IAAI,CAAC,eAAe,CAAC,WAAY,EAC5C,CACA,IAAI,SAASA,CAAa,CAAE,CACxB,IAAI,CAAC,WAAW,CAAC,WAAYA,EACjC,CAEA,IAEI,QAAa,CACb,OAAO,IAAI,CAAC,eAAe,CAAC,SAAU,IAAImE,GAAG,EAAG,GACpD,CACA,IAAI,OAAOnE,CAAS,CAAE,CAClB,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CAEA,IAEI,QAAa,CACb,OAAO,IAAI,CAAC,eAAe,CAAC,SAAU,IAAImE,GAAG,EAAG,GACpD,CACA,IAAI,OAAOnE,CAAS,CAAE,CAClB,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CAGA,OAAa,IAAImE,GAAG,GAAK,GAAK,AAClC,E,gCAtDwB,G,QACJ,CAAC,0B,iEAQG,G,iEAQA,G,iEAQA,G,QACJ,CAAC,6B,oEAQG,G,QACJ,CAAC,2B,kEAQG,G,QACJ,CAAC,2B,kEAQG,G,4EAtDJ,CAAC,CAAC,W,YA2Df,IAAMuc,SAAN,MAAMA,iBAAiBxW,kBAE1B,aAAe,EAAM,AAGrB,aAAc,EAAK,AAGV,GAAW,AAEpB,KAEI,MAAe,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CACA,IAAI,KAAKlK,CAAa,CAAE,CACpB,IAAI,CAAC,WAAW,CAAC,OAAQA,EAC7B,CAEA,IAEI,OAAyB,CACzB,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CACA,IAAI,MAAMA,CAAsB,CAAE,CAC9B,IAAI,CAAC,WAAW,CAAC,QAASA,EAC9B,CAEA,IAEI,SAAkB,CAClB,OAAO,IAAI,CAAC,eAAe,CAAC,UAAW,EAC3C,CACA,IAAI,QAAQA,CAAa,CAAE,CACvB,IAAI,CAAC,WAAW,CAAC,UAAWA,EAChC,CAEA,IAEI,KAAe,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,MAAO,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EAChE,CACA,IAAI,IAAIzgB,CAAc,CAAE,CACpB,IAAI,CAAC,WAAW,CAAC,MAAOA,EAC5B,CAEA,YAAYO,CAAmB,CAAEuI,CAAY,CAAE4L,CAAsB,CAAE5G,EAAaF,GAAG,QAAQ,EAAE,CAAE,CAC/F,KAAK,CAACrN,GACN,IAAI,CAAC,EAAE,CAAGuN,EACV,IAAI,CAAC,eAAe,CAAC,OAAQhF,GAAM,OAAS,EAAIA,EAAO,WACvD,IAAI,CAAC,eAAe,CAAC,QAAS4L,EAClC,CAEA,OAAkB,CACd,IAAIiM,EAAW,IAAID,SAAS,IAAI,CAAC,QAAQ,CAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAE,IAAI,CAAC,KAAK,EAG3E,OAFAC,EAAS,eAAe,CAAC,MAAO,IAAI,CAAC,GAAG,EAEjCA,CACX,CACJ,E,gCA1DwB,G,2EAGA,G,0EAGA,G,iEAGA,G,QACJ,CAAC,e,iEAQG,G,QACJ,CAAC,eAAgB,CAAE,KAAM,O,qEAQrB,G,QACJ,CAAC,kB,oEAQG,G,QACJ,CAAC,gB,yEAvCD,CAAC,CAAC,WAAY,OAAQ,QAAS,K,aA+D5C,IAAMC,cAAN,MAAMA,sBAAsBF,SAC/B,IAEI,UAA4B,CAC5B,OAAO,IAAI,CAAC,eAAe,CAAC,WAAY,QAC5C,CACA,IAAI,SAAS1gB,CAAsB,CAAE,CACjC,IAAI,CAAC,WAAW,CAAC,WAAYA,EACjC,CAEA,IAEI,WAAoB,CACpB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAa,GAC7C,CACA,IAAI,UAAUA,CAAa,CAAE,CACzB,IAAI,CAAC,WAAW,CAAC,YAAaA,EAClC,CAEA,IAEI,UAA4B,CAC5B,OAAO,IAAI,CAAC,eAAe,CAAC,WAAY,EAC5C,CACA,IAAI,SAASA,CAAsB,CAAE,CACjC,IAAI,CAAC,WAAW,CAAC,WAAYA,EACjC,CAEA,IAEI,aAAuB,CACvB,OAAO,IAAI,CAAC,eAAe,CAAC,cAAe,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACxE,CACA,IAAI,YAAYzgB,CAAc,CAAE,CAC5B,IAAI,CAAC,WAAW,CAAC,cAAeA,EACpC,CAEA,IAEI,SAAmB,CACnB,OAAO,IAAI,CAAC,eAAe,CAAC,UAAW,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACpE,CACA,IAAI,QAAQzgB,CAAc,CAAE,CACxB,IAAI,CAAC,WAAW,CAAC,UAAWA,EAChC,CAEA,IAEI,WAAqB,CACrB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAa,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACtE,CACA,IAAI,UAAUzgB,CAAc,CAAE,CAC1B,IAAI,CAAC,WAAW,CAAC,YAAaA,EAClC,CAEA,IAEI,aAAuB,CACvB,OAAO,IAAI,CAAC,eAAe,CAAC,cAAe,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACxE,CACA,IAAI,YAAYzgB,CAAc,CAAE,CAC5B,IAAI,CAAC,WAAW,CAAC,cAAeA,EACpC,CACJ,E,gCA9DwB,G,QACJ,CAAC,oBAAqB,CAAE,KAAM,O,6EAQ1B,G,QACJ,CAAC,sB,2EAQG,G,QACJ,CAAC,oBAAqB,CAAE,KAAM,O,6EAQ1B,G,QACJ,CAAC,wB,6EAQG,G,QACJ,CAAC,oB,yEAQG,G,QACJ,CAAC,sB,2EAQG,G,QACJ,CAAC,wB,2FAzDD,CAAC,CAAC,WAAY,OAAQ,QAAS,K,kBAmE5C,IAAM6gB,iBAAN,MAAMA,yBAAyBH,SAClC,IAEI,WAAoB,CACpB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAa,EAC7C,CACA,IAAI,UAAU1gB,CAAa,CAAE,CACzB,IAAI,CAAC,WAAW,CAAC,YAAaA,EAClC,CAEA,IAEI,cAAwB,CACxB,OAAO,IAAI,CAAC,eAAe,CAAC,eAAgB,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACzE,CACA,IAAI,aAAazgB,CAAc,CAAE,CAC7B,IAAI,CAAC,WAAW,CAAC,eAAgBA,EACrC,CAEA,IAEI,WAAoB,CACpB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAa,EAC7C,CACA,IAAI,UAAUA,CAAa,CAAE,CACzB,IAAI,CAAC,WAAW,CAAC,YAAaA,EAClC,CAEA,IAEI,cAAwB,CACxB,OAAO,IAAI,CAAC,eAAe,CAAC,eAAgB,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACzE,CACA,IAAI,aAAazgB,CAAc,CAAE,CAC7B,IAAI,CAAC,WAAW,CAAC,eAAgBA,EACrC,CAEA,IAEI,UAA4B,CAC5B,OAAO,IAAI,CAAC,eAAe,CAAC,WAAY,EAC5C,CACA,IAAI,SAASA,CAAsB,CAAE,CACjC,IAAI,CAAC,WAAW,CAAC,WAAYA,EACjC,CAEA,IAEI,SAAmB,CACnB,OAAO,IAAI,CAAC,eAAe,CAAC,UAAW,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACpE,CACA,IAAI,QAAQzgB,CAAc,CAAE,CACxB,IAAI,CAAC,WAAW,CAAC,UAAWA,EAChC,CAEA,IAEI,WAAqB,CACrB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAa,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACtE,CACA,IAAI,UAAUzgB,CAAc,CAAE,CAC1B,IAAI,CAAC,WAAW,CAAC,YAAaA,EAClC,CAEA,IAEI,aAAuB,CACvB,OAAO,IAAI,CAAC,eAAe,CAAC,cAAe,IAAIygB,QAAQ,IAAI,CAAC,QAAQ,EACxE,CACA,IAAI,YAAYzgB,CAAc,CAAE,CAC5B,IAAI,CAAC,WAAW,CAAC,cAAeA,EACpC,CACJ,E,gCAvEwB,G,QACJ,CAAC,sB,8EAQG,G,QACJ,CAAC,yB,iFAQG,G,QACJ,CAAC,sB,8EAQG,G,QACJ,CAAC,yB,iFAQG,G,QACJ,CAAC,oBAAqB,CAAE,KAAM,O,gFAQ1B,G,QACJ,CAAC,oB,4EAQG,G,QACJ,CAAC,sB,8EAQG,G,QACJ,CAAC,wB,iGAlED,CAAC,CAAC,WAAY,OAAQ,QAAS,K,wXCpKlC8gB,CAAAA,GAAAA,CAAAA,EAAKA,CAAAA,EAAAA,EACFC,gBAAgB,CAAzB,SAA0Brc,CAAW,EACxC,OAAQA,AAAiCU,KAAAA,IAAjCV,EAAyB,GAAG,AACxC,EAGG,IAAelE,KAAf,MAAeA,aAAa0J,kBAC/B,MAAoC,AACpC,gBAAmC,AACnC,YAA+B,AAGtB,GAAW,AAEpB,aAAY3J,CAAmB,CAAEuI,CAAY,CAAEgF,CAAU,CAAE,CACvD,KAAK,CAACvN,GACN,IAAI,CAAC,EAAE,CAAGuN,EACV,IAAI,CAAC,eAAe,CAAC,OAAQhF,GAAQ,WACzC,CAEA,IAEI,MAAO,CACP,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CACA,IAAI,KAAK9I,CAAa,CAAE,CACpB,IAAI,CAAC,WAAW,CAAC,OAAQA,EAC7B,CAEA,IACI,SAAmB,CACnB,OAAO,IAAI,CAAC,eAAe,CAAC,UAAW,GAC3C,CACA,IAAI,QAAQA,CAAc,CAAE,CACxB,IAAI,CAAC,WAAW,CAAC,UAAWA,EAAO,IAAM,IAAI,CAAC,gBAAgB,GAClE,CAIA,IAAI,eAAgB,CAChB,OAAO,IAAI,CAAC,eAAe,CAAC,gBAAiB,GACjD,CACA,IAAI,cAAcA,CAAc,CAAE,CAC9B,IAAI,CAAC,WAAW,CAAC,gBAAiBA,EAAO,IAAM,IAAI,CAAC,sBAAsB,GAC9E,CAES,iBAAwB,CAC7B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,EAC9C,KAAK,CAAC,iBACV,CAEA,OAAc,CACV,IAAIghB,EAAa3a,EAAAA,eAA0B,CAAC,IAAI,CAChD2a,CAAAA,EAAW,UAAU,CAAC,EAAK,CAAGpT,GAAG,QAAQ,GACzCoT,EAAW,UAAU,CAAC,IAAO,CAAG,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CACnD,IAAIC,EAAe5a,EAAAA,iBAA4B,CAAC,IAAI,CAAC,QAAQ,CAAE2a,GAE/D,OADA,IAAI,CAAC,MAAM,EAAE,IAAIC,GACVA,CACX,CAGJ,E,4BAlDwB,G,yDASA,G,QACJ,CAAC,e,yDAQG,G,yCAkCPH,CAAK,EAmBlB,SAASI,iBAAiBvc,CAAc,CAAEwc,CAAc,CAAEC,CAAc,CAAEC,CAAmB,EACzFC,4BAA4B3c,EAAOwc,CAAK,CAAC,EAAE,EAC3CI,mBAAmB5c,EAAOwc,EAAOE,GACjCG,mBAAmB7c,EAAOwc,EAAOC,EAAOC,EAC5C,CAEA,SAASE,mBAAmB5c,CAAc,CAAEwc,CAAc,CAAEE,CAAmB,EAC3E,IAAK,IAAI9d,EAAI,EAAGA,EAAI4d,EAAM,MAAM,CAAGE,EAAa9d,IAAK,CACjD,IAAIke,EAAON,CAAK,CAAC5d,EAAE,CAAC,WAAW,CAC/B,KAAOke,AAASrc,KAAAA,IAATqc,GACHX,EAAM,2BAA2B,CAACnc,EAAO8c,GACzCA,EAAOA,EAAK,WAAW,AAE/B,CACJ,CAEA,SAASD,mBAAmB7c,CAAc,CAAEwc,CAAc,CAAEC,CAAc,CAAEC,CAAmB,EAC3F,IAAIK,EAAaP,EAAM,EAAE,CAAC,CAACE,IAAc,YACzC,KAAOK,GAAY,CACf,GAAIA,IAAeN,CAAK,CAAC,EAAE,CAAE,YACzBzc,EAAM,IAAI,CAACyc,CAAK,CAAC,EAAE,EAGvB,GAAIN,EAAM,gBAAgB,CAACY,GACvB,IAAIC,0BAA0Bhd,EAAO+c,EAAYN,CAAK,CAAC,EAAE,EACrD,MACJ,MAEAzc,EAAM,IAAI,CAAC+c,GAEfA,EAAaA,EAAW,WAAW,AACvC,CACJ,CAEO,SAASJ,4BAA4B3c,CAAc,CAAED,CAAW,EAC/Doc,EAAM,gBAAgB,CAACpc,GACvBid,0BAA0Bhd,EAAOD,GAEjCC,EAAM,IAAI,CAACD,EAEnB,CAYO,SAASkd,mBAAmBjd,CAAiB,CAAED,CAAW,SAC7D,AAAoBU,KAAAA,IAAhBV,EAAK,MAAM,KACXC,EAAM,GAAG,CAACD,EAAK,MAAM,GAClBkd,mBAAmBjd,EAAOD,EAAK,MAAM,EAChD,CAEA,SAASid,0BAA0Bhd,CAAc,CAAEkd,CAAuB,CAAE1R,CAAa,EACrFxL,EAAM,IAAI,CAACkd,GACX,IAAInd,EAAOmd,EAAO,UAAU,CAC5B,KAAOnd,AAASU,KAAAA,IAATV,GAAoB,CACvB,GAAIyL,IAAUzL,EAEV,OADAC,EAAM,IAAI,CAACD,GACJ,GAGX,GAAIoc,EAAM,gBAAgB,CAACpc,GACvB,IAAIid,0BAA0Bhd,EAAOD,EAAMyL,GAAQ,MAAO,EAAI,MAE9DxL,EAAM,IAAI,CAACD,GAEfA,EAAOA,EAAK,WAAW,AAC3B,CACA,MAAO,EACX,CAEA,SAASod,cAAcC,CAAc,CAAEC,CAAc,EACjD,KAAOD,AAAwB3c,KAAAA,IAAxB2c,EAAQ,WAAW,EAAgB,CACtC,GAAIA,EAAQ,WAAW,GAAKC,EAAS,MAAO,GAC5CD,EAAUA,EAAQ,WAAW,AACjC,CACA,MAAO,EACX,CAEA,SAASE,qBAAqBC,CAAgB,CAAEC,CAAgB,EAC5D,IAAI7e,EAAQ,EACZ,KAAYA,GAAS0K,KAAK,GAAG,CAACkU,EAAQ,MAAM,CAAEC,EAAQ,MAAM,GACpDD,EAAQ,EAAE,CAAC,CAAC5e,KAAW6e,EAAQ,EAAE,CAAC,CAAC7e,GADoBA,KAG/D,GAAI4e,EAAQ,EAAE,CAAC,EAAI5e,KAAW6e,EAAQ,EAAE,CAAC,EAAI7e,GAAQ,MAAM,AAAIV,MAAM,gCACrE,OAAOU,CACX,CAEA,SAAS8e,cAAc1d,CAAW,EAC9B,IAAIgB,EAAgB,EAAE,CAClBmc,EAA4Bnd,EAChC,KAAOmd,AAAWzc,KAAAA,IAAXyc,GACHnc,EAAK,IAAI,CAACmc,GACVA,EAASA,EAAO,MAAM,CAE1B,OAAOnc,CACX,C,EAxHgB2c,eAAe,CAAxB,SAAyBC,CAAY,CAAEC,CAAY,EACtD,GAAID,IAAUC,EAAO,MAAO,CAACD,EAAM,CACnC,IAAI3d,EAAiB,EAAE,CACnBud,EAAUE,cAAcE,GACxBH,EAAUC,cAAcG,GACxBjf,EAAQ2e,qBAAqBC,EAASC,GACtCN,EAASK,EAAQ,EAAE,CAAC,EAAI5e,GAC5B,GAAIue,IAAWM,CAAO,CAAC,EAAE,EAAIN,IAAWK,CAAO,CAAC,EAAE,CAAE,CAChD,IAAIpgB,EAAQ+f,IAAWM,CAAO,CAAC,EAAE,CAAGD,CAAO,CAAC,EAAE,CAAGC,CAAO,CAAC,EAAE,CAC3DR,0BAA0Bhd,EAAOkd,EAAQ/f,EAC7C,MAAWggB,cAAcI,EAAQ,EAAE,CAAC,CAAC5e,GAAS6e,EAAQ,EAAE,CAAC,CAAC7e,IACtD4d,iBAAiBvc,EAAOud,EAASC,EAAS7e,GAE1C4d,iBAAiBvc,EAAOwd,EAASD,EAAS5e,GAE9C,OAAOqB,CACX,E,EAoCgB2c,2BAA2B,CAA3BA,4B,EAQAkB,iBAAiB,CAA1B,SAA2B7d,CAAiB,EAC/C,IAAIjB,EAAkB,EAAE,CACxB,IAAK,IAAMgB,KAAQC,EACX,AAACid,mBAAmBjd,EAAOD,IAC3BhB,EAAO,IAAI,CAACgB,GAGpB,OAAOhB,CACX,E,EAEgBke,kBAAkB,CAAlBA,kBAmDpB,EA1HiBd,GAAAA,CAAAA,EAAKA,CAAAA,QA4HL2B,GAAAA,GAAAA,CAAAA,EAAcA,CAAAA,GAO3B,SAASC,qBAAqB/d,CAAmB,CAAED,CAAW,CAAEie,CAA4B,EACxF,IAAI3B,EAAkB3a,EAAAA,eAA0B,CAAC3B,GAUjD,OATIie,GAAU3B,CAAAA,EAAW,QAAW,CAAG2B,CAAO,EAC9Che,EAAM,IAAI,CAACqc,GAEPF,EAAM,gBAAgB,CAACpc,IAASA,EAAK,UAAU,EAC/Cge,qBAAqB/d,EAAOD,EAAK,UAAU,CAAEA,EAAK,EAAE,EAEpDA,EAAK,WAAW,EAChBge,qBAAqB/d,EAAOD,EAAK,WAAW,CAAEie,GAE3Che,CACX,C,6VAlBgByG,SAAS,CAAlB,SAAmB1G,CAAW,EACjC,IAAIC,EAAsB,EAAE,CAE5B,OADA+d,qBAAqB/d,EAAOD,EAAMU,KAAAA,GAC3BT,CACX,E,GAgBsBwG,WAAW,CAA1B,eAA2B5K,CAAmB,CAAEoE,CAAmB,EACtE,IAAIie,EAAwC,IAAIngB,IAchD,OAbAkC,EAAM,OAAO,CAAC,AAACb,IACX,IAAIY,EAAO2B,EAAAA,iBAA4B,CAAC9F,EAAUuD,EAC9Cgd,CAAAA,EAAM,gBAAgB,CAACpc,IACvBke,EAAQ,GAAG,CAAC9e,EAAE,UAAU,CAAC,EAAK,CAAEY,GAEpC,IAAIie,EAAY7e,EAAU,QAAW,CAChC6e,IACDC,EAAQ,GAAG,CAACD,GACZC,EAAQ,GAAG,CAACD,GAAW,GAAG,CAACje,GAE3BwE,QAAQ,IAAI,CAAC,qBAAuByZ,GAE5C,GACOvT,QAAQ,OAAO,CAACwT,EAAQ,GAAG,CAACje,CAAK,CAAC,EAAE,CAAC,UAAU,CAAC,EAAK,EAChE,ECvPG,IAAeke,WAAf,MAAeA,mBAAmBriB,KAGrC,IACI,WAAqB,CACrB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAawZ,QAAQ,QAAQ,GAC7D,CACA,IAAI,UAAUha,CAAc,CAAE,CAC1B,IAAI,CAAC,WAAW,CAAC,YAAaA,EAAOoF,KAAAA,EAAW,CAC5C,OAAQ,CAACzE,EAAMiW,IAAUjW,EAAK,MAAM,CAACiW,EACzC,EACJ,CAEA,gBAA0B,CACtB,IAAMkM,EAAS,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,SAC1D,AAAIA,EACOA,EAAO,cAAc,GAEzB,IAAI,CAAC,SAAS,AACzB,CAEU,kBAAyB,CAC/B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAE,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,aAAa,CACpF,CAEU,wBAA+B,CACrC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAE,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,aAAa,CACpF,CAGJ,E,0XA3BwB,G,wCCEjB,IAAMC,SAAN,MAAMA,iBAAiBF,WACjB,SAAoB,CACzB,MAAO,eACX,CAEA,IAEI,YAAgC,CAChC,OAAO,IAAI,CAAC,eAAe,CAAC,aAChC,CACA,IAAI,WAAW7iB,CAAwB,CAAE,CACrC,IAAI,CAAC,WAAW,CAAC,aAAcA,EACnC,CAEU,KAAY,AACtB,KACI,MAAa,CACb,OAAO,IAAI,CAAC,KAAK,AACrB,CACA,IAAI,KAAKA,CAAW,CAAE,CAClB,IAAI,CAAC,WAAW,CAAC,OAAQA,EAC7B,CAEA,YACIO,CAAmB,CACnBuT,CAAU,CACVhL,CAAY,CACZka,CAA8B,CAC9BlV,EAAaF,GAAG,QAAQ,EAAE,CAC5B,CACE,KAAK,CAACrN,EAAUuI,EAAMgF,GACtB,IAAI,CAAC,KAAK,CAAGgG,EACb,IAAI,CAAC,eAAe,CAAC,aAAckP,GAAcziB,EAAS,SAAS,CAAC,EAAE,CAAC,IAAI,IAAM,GACrF,CAES,aAAuC,CAC5C,IAAIwX,EAAS,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EACvD,OAAOL,YAAY,WAAW,CAACK,EACnC,CACJ,E,4XAlCwB,G,QACJ,CAAC,kBAAmB,CAAE,KAAM,Y,0EASxB,G,0EAhBJ,CAAC,CAAC,WAAY,OAAQ,OAAQ,K,aCC3C,IAAMkL,iBAAN,MAAMA,iBAET,SAAkB,AAGlB,cAAsB,AACtB,aAAYC,CAAiB,CAAExP,CAAqB,CAAE,CAClD,IAAI,CAAC,SAAS,CAAGwP,EACjB,IAAI,CAAC,aAAa,CAAGxP,CACzB,CACJ,E,oCATwB,G,oFAGA,G,yGALJ,CAAC,CAAC,YAAa,gB,qBAa5B,IAAeyP,aAAf,MAAeA,qBAAqBN,WACvC,IAEI,YAAgC,CAChC,OAAO,IAAI,CAAC,eAAe,CAAC,aAChC,CACA,IAAI,WAAW7iB,CAAwB,CAAE,CACrC,IAAI,CAAC,WAAW,CAAC,aAAcA,EACnC,CAEU,eAA+B,AAEzC,KACI,kBAAuC,CACvC,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAoB,EAAE,CACtD,CACA,IAAI,iBAAiBA,CAAyB,CAAE,CAC5C,IAAMojB,EAAcrgB,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,EAAI,IAAI,IAAI,CAAC,UAAU,CAAC,CAAG,IAAI,CAAC,UAAU,CACrFsgB,EAAO,IAAI,IAAI,CAAC,gBAAgB,CAAC,CACvC,IAAI,CAAC,WAAW,CAAC,mBAAoBrjB,EAAO,IAAM,IAAI,CAAC,YAAY,CAACojB,EAAaC,GACrF,CAEA,YACI9iB,CAAmB,CACnBuI,CAAY,CACZka,CAA8B,CAC9BlV,EAAaF,GAAG,QAAQ,EAAE,CAC5B,CACE,KAAK,CAACrN,EAAUuI,EAAMgF,GACtB,IAAI,CAAC,eAAe,CAAC,aAAckV,GAAcziB,EAAS,SAAS,CAAC,EAAE,CAAC,IAAI,IAAM,GACrF,CAEU,KAAkC,AAC5C,KAAI,MAAuB,CAEvB,OADA,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,UAAU,GACvB,IAAI,CAAC,KAAK,AACrB,CAES,aAAuC,CAC5C,IAAIwX,EAAS,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,SAK9B,GAJI,AAACA,GAAUA,AAAkB,IAAlBA,EAAO,MAAM,EACxBA,CAAAA,EAAS,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,QAAO,EAGjC,AAACA,GAAUA,AAAkB,IAAlBA,EAAO,MAAM,CAG5B,OAAOL,YAAY,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAACK,GAC3D,CAES,iBAAwB,CAC7B,KAAK,CAAC,kBACN,IAAI,CAAC,KAAK,CAAG3S,KAAAA,CACjB,CAEQ,cAAe,CACnB,IAAMke,EAAcvgB,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,EAAI,IAAI,IAAI,CAAC,UAAU,CAAC,CAAG,IAAI,CAAC,UAAU,CAE3F,MAAO,CACHwgB,YAFgB,IAAI,IAAI,CAAC,gBAAgB,CAAC,CAG1CD,YAAAA,CACJ,CACJ,CAEA,gBAAgBE,CAAkD,CAAE,CAChE,GAAM,CAAED,YAAAA,CAAW,CAAED,YAAAA,CAAW,CAAE,CAAG,IAAI,CAAC,YAAY,GACtDE,EAAM,OAAO,CAAC,CAAC,CAAEN,UAAAA,CAAS,CAAEF,WAAAA,CAAU,CAAE,IACpC,GAAI,IAAI,CAAC,UAAU,GAAKA,EACpB,OAGJ,GAAI,IAAI,CAAC,KAAK,EAAE,OAAO,MAAM,SAAW,EAAG,YACvC,IAAI,CAAC,eAAe,CAAC,aAAcA,EAInC,AAA2B,WAA3B,OAAO,IAAI,CAAC,UAAU,EACtB,IAAI,CAAC,eAAe,CAAC,aAAc,CAAC,IAAI,CAAC,UAAU,CAAEA,EAAW,EAGpE,IAAM1f,EAAQ,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC0f,EAClC1f,AAAU,MAAVA,GACC,IAAI,CAAC,UAAU,CAAc,IAAI,CAAC0f,GACnC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAIC,iBAAiBC,EAAW,IAAI,CAAC,UAAU,CAAC,MAAM,CAAG,KAEpF,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAID,iBAAiBC,EAAW5f,GAEnE,GACA,IAAI,CAAC,YAAY,CAACggB,EAAaC,EACnC,CAEA,mBAAmBE,CAAoB,CAAE,CACrC,GAAM,CAAEF,YAAAA,CAAW,CAAED,YAAAA,CAAW,CAAE,CAAG,IAAI,CAAC,YAAY,GAChDI,EAAW,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,AAACzgB,GAAMwgB,EAAW,QAAQ,CAACxgB,EAAE,SAAS,GACpF,IAAI,CAAC,eAAe,CAChB,mBACA,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,AAACA,GAAM,CAACwgB,EAAW,QAAQ,CAACxgB,EAAE,SAAS,IAExEygB,EAAS,OAAO,CAAC,AAACC,KACU,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAC9C,AAAC1gB,GAAMA,EAAE,aAAa,GAAK0gB,EAAK,aAAa,GAEzB5gB,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,IAGrD,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC4gB,EAAK,aAAa,CAAE,GACvC,AAA2B,IAA3B,IAAI,CAAC,UAAU,CAAC,MAAM,CACtB,IAAI,CAAC,eAAe,CAAC,aAAc,IAAI,CAAC,UAAU,CAAC,EAAE,EAC9C,IAAI,CAAC,UAAU,CAAC,MAAM,CAAG,GAChC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,AAAC1gB,IACvBA,EAAE,aAAa,CAAG0gB,EAAK,aAAa,EACpC1gB,EAAE,aAAa,EAEvB,GAER,GAEA,IAAI,CAAC,YAAY,CAACqgB,EAAaC,EACnC,CAEA,mBAAoB,CAChB,GAAM,CAAEA,YAAAA,CAAW,CAAED,YAAAA,CAAW,CAAE,CAAG,IAAI,CAAC,YAAY,EAElDvgB,CAAAA,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,GAC7B,IAAI,CAAC,eAAe,CAAC,aAAc,IAAI,CAAC,UAAU,CAAC,EAAE,EAEzD,IAAI,CAAC,eAAe,CAAC,mBAAoB,EAAE,EAE3C,IAAI,CAAC,YAAY,CAACugB,EAAaC,EACnC,CAEiB,aAAe,CAACH,EAAgCG,KAC7D,GAAI,CAAC,IAAI,CAAC,eAAe,CAAE,MACvB,AAAiC,KAAjC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAC5B,IAAI,CAAC,KAAK,CAAE,KAAK,CAAG,IAAI,CAAC,eAAe,EAExC,IAAI,CAAC,KAAK,CAAE,KAAK,CAAGK,GAAAA,CAAAA,CAAAA,aAAuB,CACvC,IAAI,CAAC,eAAe,CACpB,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,AAAC3gB,GAAM,CAACA,EAAE,SAAS,CAAEA,EAAE,aAAa,CAAC,GAE/D,AAAoC,IAApC,IAAI,CAAC,KAAK,CAAE,KAAK,CAAC,MAAM,CAAC,MAAM,EAC/B,IAAI,CAAC,eAAe,CAAC,aAAc,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,aAAa,CAAC,GAIlG,IAAI,CAAC,mBAAmB,CAAC,aAAcmgB,GACvC,IAAI,CAAC,mBAAmB,CAAC,mBAAoBG,GAC7C,IAAMM,EAAc9gB,MAAM,OAAO,CAAC,IAAI,CAAC,UAAU,EAAI,IAAI,IAAI,CAAC,UAAU,CAAC,CAAG,IAAI,CAAC,UAAU,CAC3FoG,YAAY,GAAG,CACX,IAAI,CAAC,QAAQ,CACb,IAAIZ,sBAAsB,IAAI,CAAE,aAAc6a,EAAaS,IAE/D1a,YAAY,GAAG,CACX,IAAI,CAAC,QAAQ,CACb,IAAIZ,sBAAsB,IAAI,CAAE,mBAAoBgb,EAAa,IAAI,IAAI,CAAC,gBAAgB,CAAC,GAG/F,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAClD,CAAE,AAGN,E,6XAhKwB,G,QACJ,CAAC,kBAAmB,CAAE,KAAM,Y,kFAUxB,G,iDCxBjB,IAAeO,UAAf,MAAeA,kBAAkBX,aAC1B,OAAyBljB,OAAO,GAAG,CAAC8jB,GAAiB,AAC/D,KAAI,OAAwB,CACxB,OAAO,IAAI,CAAC,MAAM,AACtB,CAEU,SAASvO,CAAqB,CAAE,CACtC,GAAI,IAAI,CAAC,MAAM,CAAC,IAAI,EAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAACA,EAAM,KAAK,EACzD,OAGJ,GAAI,CAACA,EAAM,IAAI,CAAE,YACbvH,OAAAA,OAAAA,CAAAA,GAAkB,CAAC,eAAgBuH,EAAM,KAAK,EAIlD,IAAIwO,EAAW,IAAI,CAAC,MAAM,AAC1B,KAAI,CAAC,MAAM,CAAGxO,EACd,IAAI,CAAC,KAAK,CAAGpQ,KAAAA,EAEb,IAAI,CAAC,mBAAmB,CAAC,QAAS4e,GAElCA,EAAS,SAAS,IAAI,SAC1B,CAEmB,YAA6B,CAC5C,GAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAChB,MAAM,AAAIphB,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,EAEpC,IAAMkR,EAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAOlC,OANA,IAAI,CAAC,eAAe,CAAGA,EAAK,KAAK,CAC7BA,EAAK,KAAK,EACVA,CAAAA,EAAK,KAAK,CAAG8P,GAAAA,CAAAA,CAAAA,aAAuB,CAChC9P,EAAK,KAAK,CACV,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,AAAC7Q,GAAM,CAACA,EAAE,SAAS,CAAEA,EAAE,aAAa,CAAC,EAAC,EAEjE6Q,CACX,CAES,iBAAwB,CAC7B,KAAK,CAAC,kBACN,IAAI,CAAC,MAAM,CAAC,SAAS,IAAI,UACzB,IAAI,CAAC,MAAM,CAAG,IAClB,CACJ,EAEO,IAAMmQ,eAAN,MAAMA,eACQ,MAAqB,AACrB,OAAqB,AAEtC,KAAI,OAAQ,CACR,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAG,EAAI,IAAI,CAAC,MAAM,CAAG7e,KAAAA,CAC3D,CAEA,IAAI,OAAQ,CACR,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAG,EAAI,IAAI,CAAC,MAAM,CAAGA,KAAAA,CAC3D,CAEA,aAAc,CACV,IAAI,CAAC,MAAM,CAAG,CACV,SAAU0B,GAAAA,KAAc,CACxB,SAAU,IAAI+D,aACd,MAAO,EAAE,CACT,MAAO4G,GAAa,gBAAgB,AACxC,EAEA,IAAI,CAAC,MAAM,CAAG,CACV,MAAO,IAAI3G,YACX,OAAQ,IAAID,aACZ,SAAU,IAAIA,aACd,GAAI,IAAIA,aACR,MAAO,EAAE,CACT,OAAQ,EAAE,CACV,MAAO4G,GAAa,gBAAgB,AACxC,CACJ,CAEO,SAAS+D,CAAa,CAAEoC,CAAe,CAAE,CAC5C,IAAM9D,EAAO0B,EAAM,IAAI,CACjB0O,EAAc1O,EAAM,MAAM,CAAC,QAAQ,CAACoC,EACtC9D,CAAAA,EAAK,KAAK,EACV8P,GAAAA,CAAAA,CAAAA,mBAA6B,CAAC,IAAI,CAAC,MAAM,CAAE9P,EAAK,KAAK,CAAEoQ,GAEvDpQ,EAAK,KAAK,EACV8P,GAAAA,CAAAA,CAAAA,mBAA6B,CAAC,IAAI,CAAC,MAAM,CAAE9P,EAAK,KAAK,CAAEoQ,EAE/D,CACJ,EAGO,IAAMC,eAAN,MAAMA,uBAAuBhB,aACf,OAAkB,AACnC,KACI,QAAgC,CAChC,OAAO,IAAI,CAAC,OAAO,AACvB,CAEA,YACI5iB,CAAmB,CACnBuI,CAAY,CACZsb,CAAgB,CAChBpB,CAAmB,CACnBlV,EAAaF,GAAG,QAAQ,EAAE,CAC5B,CACE,KAAK,CAACrN,EAAUuI,EAAMka,EAAYlV,GAClC,IAAI,CAAC,OAAO,CAAGsW,CACnB,CAEmB,YAA6B,CAC5C,IAAMC,EAAS,IAAIJ,eAMnB,OAJA,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,AAACzO,IAClB6O,EAAO,QAAQ,CAAC7O,EAAOwE,QAAQ,QAAQ,GAC3C,GAEOqK,CACX,CAES,SAAoB,CACzB,MAAO,iBACX,CACJ,E,iCA7BwB,G,yFAHJ,CAAC,CAAC,WAAY,OAAQ,SAAU,aAAc,K,mBAkClE,IAAMN,GAAkB,wBACjB,IAAeO,mBAAf,MAAeA,2BAA2BR,UAC7C,IAAa,OAAwB,CAIjC,OAHI,AAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAI,IAAI,CAAC,MAAM,CAAC,KAAK,GAAKC,IAC3C,KAAI,CAAC,MAAM,CAAG,IAAI,CAAC,aAAa,EAAC,EAE9B,IAAI,CAAC,MAAM,AACtB,CAEU,4BACNne,CAAW,CACX8C,CAAiB,CACjBoB,CAA4D,CAC5DC,CAA+C,CACxC,OACP,EAAI,IAAI,CAAC,WAAW,CAACnE,EAAU8C,EAAUoB,EAAmBC,KACxD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,IACzB,GAIf,CAEA,YAAYxJ,CAAmB,CAAEyiB,CAAmB,CAAElV,CAAW,CAAE,CAC/D,KAAK,CAACvN,EAAU6E,KAAAA,EAAkB4d,EAAYlV,GAC9C,IAAI,CAAC,eAAe,CAAC,OAAQkE,EAAAA,SAAc,CAAC,IAAI,CAAC,OAAO,IAC5D,CAGJ,EAGO,IAAMuS,kBAAN,MAAMA,0BAA0BT,UAC1B,SAAoB,CACzB,MAAO,oBACX,CAEA,IACa,OAAQ,CACjB,OAAO,IAAI,CAAC,MAAM,AACtB,CAEA,IAAa,MAAMtO,CAAqB,CAAE,CACtC,IAAI,CAAC,QAAQ,CAACA,EAClB,CAEA,YACIjV,CAAmB,CACnBuI,CAAY,CACZ0M,CAA8B,CAC9BwN,CAA8B,CAC9BlV,CAAW,CACb,CACE,KAAK,CAACvN,EAAUuI,EAAMka,EAAYlV,GAClC,IAAI,CAAC,MAAM,CAAG0H,aAAiBvV,OAASuV,EAAQvV,OAAO,EAAE,CAACuV,EAC9D,CACJ,E,yVCvKO,SAASgP,oBAAoB3W,CAAmB,EACnD,MAAO,CACH,cAAe,EAAE,CACjB,KAAM,CACF,SAAU/G,GAAAA,KAAc,CACxB,SAAU,IAAI+D,aAAagD,AAAY,EAAZA,EAAK,IAAI,EACpC,MAAO,EAAE,AACb,EACA,KAAM,CACF,MAAO,IAAI/C,YAAY+C,EAAK,SAAS,EACrC,OAAQ,IAAIhD,aAAagD,AAAoB,EAApBA,EAAK,YAAY,EAC1C,SAAU,IAAIhD,aAAagD,AAAoB,EAApBA,EAAK,YAAY,EAC5C,GAAI,IAAIhD,aAAagD,AAAoB,EAApBA,EAAK,YAAY,EACtC,MAAO,EAAE,CACT,OAAQ,EAAE,AACd,EACA,aAAc8F,KAAK,kBAAkB,CAAC9F,EAAK,WAAW,EACtD,iBAAkB,EAAE,CACpB,QAAS8F,KAAK,aAAa,CAAC9F,EAAK,YAAY,CAAEA,EAAK,SAAS,CAAG,EAAIA,EAAK,SAAS,CAAGA,AAAoB,EAApBA,EAAK,YAAY,CAC1G,CACJ,CAWO,SAAS4W,sBACZ,MAAO,CACH,aAAc,EACd,UAAW,EACX,KAAM,EACN,YAAa,EACb,UAAW,EACX,aAAc,CAClB,CACJ,C,iCD4GwB,G,8FANJ,CAAC,CAAC,WAAY,OAAQ,QAAS,aAAc,K,sBCnG1D,IAAMC,UAAN,MAAMA,UACQ,MAAkC,AACnD,KACI,OAAmC,CACnC,OAAO,IAAI,CAAC,MAAM,AACtB,CAEiB,KAAc,AAC/B,KACI,MAAe,CACf,OAAO,IAAI,CAAC,KAAK,AACrB,CAGS,EAAW,AAEZ,QAAa,AACrB,KACI,QAAc,CACd,OAAO,IAAI,CAAC,OAAO,AACvB,CACA,IAAI,OAAO1kB,CAAU,CAAE,CACnB,IAAI,CAAC,OAAO,CAAGA,CACnB,CAEQ,YAA2B,AACnC,KAAI,aAAuC,CAEvC,OADA,IAAI,CAAC,YAAY,GAAK,IAAI,CAAC,kBAAkB,GACtC,IAAI,CAAC,YAAY,AAC5B,CAEQ,KAAsB,AAC9B,KAAI,MAAsB,CAEtB,OADA,IAAI,CAAC,KAAK,GAAK,IAAI,CAAC,SAAS,GACtB,IAAI,CAAC,KAAK,AACrB,CAEO,UAA6B,EAAE,AAAC,AAEvC,aAAY8I,CAAY,CAAEnE,CAAgC,CAAE2a,CAAY,CAAExR,EAAKF,GAAG,QAAQ,EAAE,CAAE,CAC1F,IAAI,CAAC,KAAK,CAAG9E,EACb,IAAI,CAAC,MAAM,CAAGnE,EACd,IAAI,CAAC,EAAE,CAAGmJ,EACV,IAAI,CAAC,OAAO,CAAGwR,GAAU5H,YAAY,MAAM,CAAC,IAAI,CAAC,WAAW,CAChE,CAEA,UAAmB,CACf,OAAO,IAAI,CAAC,IAAI,AACpB,CAEQ,WAAY,CAChB,IAAM7J,EAAsB4W,sBAC5B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAE5W,GAC1B,IAAMiG,EAAO0Q,oBAAoB3W,GAE3BuG,EAAwBqQ,sBACxBE,EAAuC,EAAE,CAI/C,OAHA,IAAI,CAAC,cAAc,CAAC7Q,EAAM6Q,EAAkB,IAAI,CAAC,MAAM,CAAE3K,QAAQ,QAAQ,GAAI5F,GAC7EN,EAAK,IAAI,CAAG8P,GAAAA,CAAAA,CAAAA,aAAuB,CAAC9P,EAAK,IAAI,CAAE6Q,GAExC7Q,CACX,CAEQ,QAAQnP,CAAsB,CAAEkJ,CAAmB,CAAE,CACzD,IAAK,IAAMnJ,KAAQC,EACf,GAAID,aAAgBof,WAAapf,EAAK,KAAK,CAAC,IAAI,CAAE,CAC9C,IAAMoP,EAAOpP,EAAK,KAAK,CAAC,KAAK,CAAC,IAAI,AAC9BoP,CAAAA,EAAK,KAAK,GACVjG,EAAK,YAAY,EAAIiG,EAAK,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAG,EAClDjG,EAAK,SAAS,EAAIiG,EAAK,KAAK,CAAC,KAAK,CAAC,MAAM,EAEzCA,EAAK,KAAK,EAAEjG,CAAAA,EAAK,IAAI,EAAIiG,EAAK,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAG,EAC9D,MAAWpP,aAAgBqe,UACvBlV,EAAK,YAAY,EAAInJ,EAAK,IAAI,CAAC,QAAQ,CAAE,MAAM,CAAG,EAC9CA,AAAuB,YAAvBA,EAAK,IAAI,CAAC,QAAQ,EAClBmJ,CAAAA,EAAK,SAAS,EAAInJ,EAAK,IAAI,CAAC,KAAK,EAAE,QAAU,IAE1CA,aAAgBkgB,eACvB,IAAI,CAAC,OAAO,CAAClgB,EAAK,SAAS,CAAC,KAAK,CAAEmJ,EAG/C,CAEiB,eAAiB,CAC9BiV,EACA6B,EACAhgB,EACAkgB,EACAzQ,KAEA,IAAK,IAAM1P,KAAQC,EAAO,CACtB,IAAMmgB,EAAiBpgB,EAAK,SAAS,CAAC,QAAQ,CAACmgB,EAC3CngB,CAAAA,aAAgBof,WAAapf,EAAK,KAAK,CAAC,IAAI,CAC5C,IAAI,CAAC,cAAc,CAACoe,EAAQ6B,EAAkBjgB,EAAMogB,EAAgB1Q,GAC7D1P,aAAgBkgB,cACvB,IAAI,CAAC,cAAc,CAAC9B,EAAQ6B,EAAkBjgB,EAAK,SAAS,CAAC,KAAK,CAAEogB,EAAgB1Q,GAC7E1P,aAAgBqe,SACvB,IAAI,CAAC,aAAa,CAACD,EAAQpe,EAAMogB,EAAgB1Q,GAEjDlL,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE8C,OAAO,SAAS,CAAC,QAAQ,CAAC,IAAI,CAACtH,GAAM,CAAC,CAEjG,CACJ,CAAE,AAEM,gBACJoe,CAAqB,CACrB6B,CAAoC,CACpCjgB,CAAe,CACfmgB,CAAkB,CAClBzQ,CAAqB,CACvB,CACE,IAAMN,EAAOpP,EAAK,KAAK,CAAC,KAAK,CAAC,IAAI,AAC9BoP,CAAAA,EAAK,KAAK,GACV8P,GAAAA,CAAAA,CAAAA,eAAyB,CAACd,EAAO,IAAI,CAAEhP,EAAK,KAAK,CAAE+Q,EAAWzQ,EAAO,IAAI,EACzEA,EAAO,IAAI,EAAIN,EAAK,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAG,GAE5CA,EAAK,KAAK,GACV,IAAI,CAAC,iBAAiB,CAACpP,EAAMoe,EAAQ6B,GACrCf,GAAAA,CAAAA,CAAAA,eAAyB,CAACd,EAAO,IAAI,CAAEhP,EAAK,KAAK,CAAE+Q,EAAWzQ,GAC9DA,EAAO,YAAY,EAAIN,EAAK,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAG,EACpDM,EAAO,SAAS,EAAIN,EAAK,KAAK,CAAC,KAAK,CAAC,MAAM,CAEnD,CAEQ,kBAAkBpP,CAAe,CAAEoe,CAAqB,CAAE6B,CAAoC,CAAE,CACpG,IAAMI,EAAmB,IAAI,CAAC,sBAAsB,CAACrgB,EAAK,UAAU,CAAEoe,EAAO,aAAa,EAEpFvW,EAAM,IAAI9J,IACZiC,EAAK,gBAAgB,CAAC,GAAG,CAAC,AAACif,GAAS,CAACA,EAAK,SAAS,CAAEA,EAAK,aAAa,CAAC,EAE5Ejf,CAAAA,EAAK,IAAI,CAAC,KAAK,EAAE,MAAM,QAAQ,CAACsQ,EAAOzR,KAC/B,AAACgJ,EAAI,GAAG,CAAChJ,IACTohB,EAAiB,IAAI,CAAC,CAACphB,EAAIuf,EAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAEiC,EAAiB,GAAG,CAAC,GAAI,CAEtF,GACArgB,EAAK,gBAAgB,CAAC,OAAO,CAAC,AAACif,IAC3BgB,EAAiB,IAAI,CAAC,CAClBhB,EAAK,SAAS,CAAGb,EAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CACzCiC,EAAiB,GAAG,CAACpB,EAAK,aAAa,EAC1C,CACL,EACJ,CAEQ,cACJb,CAAqB,CACrBpe,CAAc,CACdmgB,CAAkB,CAClBzQ,CAAqB,CACvB,CACE,GAAI1P,AAAuB,YAAvBA,EAAK,IAAI,CAAC,QAAQ,CAAgB,CAClC,IAAMsgB,EAAgB,IAAI,CAAC,sBAAsB,CAACtgB,EAAK,UAAU,CAAEoe,EAAO,gBAAgB,EAC1Fc,GAAAA,CAAAA,CAAAA,kBAA4B,CAACd,EAAO,OAAO,CAAEpe,EAAK,IAAI,CAAEmgB,EAAWzQ,EAAQ4Q,GAC3E5Q,EAAO,YAAY,EAAI1P,EAAK,IAAI,CAAC,QAAQ,CAAE,MAAM,CAAG,EAChDA,EAAK,IAAI,CAAC,KAAK,EAAE,QACjB0P,CAAAA,EAAO,SAAS,EAAI1P,EAAK,IAAI,CAAC,KAAK,CAAC,MAAM,AAAD,CAEjD,KAAkC,iBAAvBA,EAAK,IAAI,CAAC,QAAQ,GACzBoe,EAAO,YAAY,CAAC,QAAQ,EAAE,IAAI+B,EAAU,QAAQ,CAACngB,EAAK,IAAI,CAAC,QAAQ,EAAI0P,AAAqB,EAArBA,EAAO,WAAW,EAC7FA,EAAO,WAAW,EAAI1P,EAAK,IAAI,CAAC,QAAQ,CAAE,MAAM,CAAG,EAE3D,CAEQ,uBAAuBse,CAA6B,CAAEiC,CAAqB,CAAE,CACjF,IAAMF,EAAmB,IAAItiB,IACvByiB,EAAYniB,MAAM,OAAO,CAACigB,GAAcA,EAAa,CAACA,EAAW,CACvE,IAAK,IAAIzf,EAAI,EAAGA,EAAI2hB,EAAU,MAAM,CAAE3hB,IAAK,CACvC,IAAMD,EAAQ2hB,EAAY,OAAO,CAACC,CAAS,CAAC3hB,EAAE,CAC1CD,AAAU,MAAVA,GACA2hB,EAAY,IAAI,CAACC,CAAS,CAAC3hB,EAAE,EAC7BwhB,EAAiB,GAAG,CAACxhB,EAAG0hB,EAAY,MAAM,CAAG,IAE7CF,EAAiB,GAAG,CAACxhB,EAAGD,EAEhC,CAEA,OAAOyhB,CACX,CAEQ,oBAAqB,CACzB,GAAI,AAAuB,IAAvB,IAAI,CAAC,MAAM,CAAC,MAAM,CAClB,OAGJ,IAAIpN,EAAM,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,WAAW,GACpC,IAAK,IAAIpU,EAAI,EAAGA,EAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAEA,IACpCoU,EAAMD,YAAY,OAAO,CAACC,EAAK,IAAI,CAAC,MAAM,CAACpU,EAAE,CAAC,WAAW,IAE7D,OAAOoU,CACX,CACJ,E,iCA3LwB,G,oEAMA,G,mEAKA,G,mEAIA,G,+EAlBJ,CAAC,CAAC,OAAQ,QAAS,SAAU,K,cAiM1C,IAAMiN,cAAN,MAAMA,sBAAsB/B,WACtB,SAAoB,CACzB,MAAO,YACX,CAES,aAAuC,CAC5C,GAAK,IAAI,CAAC,SAAS,CAAC,WAAW,CAI/B,OAAOnL,YAAY,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAE,IAAI,CAAC,SAAS,CAC7E,CAEQ,UAAuB,AAC/B,KACI,WAAY,CACZ,GAAI,CAAC,IAAI,CAAC,UAAU,CAAE,CAElB,GADA,IAAI,CAAC,UAAU,CAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,AAAChX,GAAMA,EAAE,EAAE,GAAK,IAAI,CAAC,WAAW,EAC5E,CAAC,IAAI,CAAC,UAAU,CAChB,MAAM,AAAIkC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,EAE7D,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CACvC,CACA,OAAO,IAAI,CAAC,UAAU,AAC1B,CAGS,WAAoB,AAGpB,OAAY,AAErB,aACIrC,CAAmB,CACnBuI,CAAY,CACZqc,CAAmB,CACnBC,CAAW,CACXtX,EAAaF,GAAG,QAAQ,EAAE,CAC5B,CACE,KAAK,CAACrN,EAAUuI,EAAMgF,GACtB,IAAI,CAAC,WAAW,CAAGqX,EACnB,IAAI,CAAC,MAAM,CAAGC,CAClB,CACJ,E,2XA7BoB,CAAC,c,4EAYG,G,gFAGA,G,yFA9BJ,CAAC,CAAC,WAAY,OAAQ,cAAe,SAAU,K,kBC5P5D,IAAeC,aAAf,MAAeA,qBAAqBf,mBACvC,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAAU,GAC1C,CACA,IAAI,OAAOtkB,CAAc,CAAE,CACvB,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CACJ,E,8XARwB,G,QACJ,CAAC,yB,uCCAd,IAAMslB,WAAN,MAAMA,mBAAmB9kB,KACpB,OAAiB,CAAE,AACnB,YAA+B,AAC/B,WAA8B,AAEtC,KAAI,YAAa,CACb,OAAO,IAAI,CAAC,WAAW,AAC3B,CACA,IAAI,WAAY,CACZ,OAAO,IAAI,CAAC,UAAU,AAC1B,CACA,IAAI,OAAQ,CACR,OAAO,IAAI,CAAC,MAAM,AACtB,CACA,MAAe,CACX,OAAO,IAAI,CAAC,MAAM,AACtB,CAEA,YAAYD,CAAmB,CAAEuI,CAAY,CAAEgF,EAAaF,GAAG,QAAQ,EAAE,CAAE,CACvE,KAAK,CAACrN,EAAUuI,EAAMgF,EAC1B,CAEA,IAAI,GAAGhL,CAAc,CAAQ,CACzB,IAAM8F,EAAU9F,EAAM,GAAG,CAAC,AAACD,GAAU,EACjC,OAAQsD,EAAAA,GAAc,CACtB,KAAMtD,EACN,UAAWuC,KAAAA,EACX,YAAaA,KAAAA,EACb,UAAW,IAAI,CACf,YAAa,IAAI,CAAC,UAAU,AAChC,IAEAtC,EAAM,OAAO,CAAC,AAACD,IACP,IAAI,CAAC,QAAQ,CAACA,IACd,IAAI,CAAC,SAAS,CAACA,GAEnB,IAAI,CAAC,MAAM,EACf,GAEA,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC+F,EACpC,CAEQ,SAASlE,CAAW,CAAW,QAGnC,AAFAA,EAAK,MAAM,CAAG,IAAI,CAClBA,EAAK,aAAa,CAAG,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,aAAa,EACnD,CAAC,IAAI,CAAC,WAAW,GACjB,IAAI,CAAC,WAAW,CAAG,IAAI,CAAC,UAAU,CAAGA,EACrCA,EAAK,eAAe,CAAGA,EAAK,WAAW,CAAGU,KAAAA,EACnC,GAGf,CAEQ,UAAUvC,CAAW,CAAE,CAC3B,IAAI,CAAC,UAAU,CAAE,WAAW,CAAGA,EAC/BA,EAAK,eAAe,CAAG,IAAI,CAAC,UAAU,CACtCA,EAAK,WAAW,CAAGuC,KAAAA,EACnB,IAAI,CAAC,UAAU,CAAGvC,CACtB,CAEA,UAAoB,CAChB,IAAMa,EAAkB,EAAE,CACtBgB,EAAO,IAAI,CAAC,WAAW,CAC3B,KAAOA,GACHhB,EAAO,IAAI,CAACgB,GACZA,EAAOA,EAAK,WAAW,CAE3B,OAAOhB,CACX,CAEA,OAAO,GAAGZ,CAAc,CAAQ,CAC5B,IAAM8F,EAAU9F,EACX,MAAM,CAAC,AAACD,GAAS,IAAI,CAAC,aAAa,CAACA,IACpC,GAAG,CAAC,AAACA,GAAU,EACZ,OAAQsD,EAAAA,MAAiB,CACzB,KAAMtD,EACN,UAAWuC,KAAAA,EACX,YAAaA,KAAAA,EACb,UAAW,IAAI,CACf,YAAavC,EAAK,eAAe,AACrC,IAEJ+F,EAAQ,OAAO,CAAC,AAACT,GAAW,IAAI,CAAC,UAAU,CAACA,EAAO,IAAI,CAAE,KACzD,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAACS,EACpC,CAEA,SAAS,GAAG9F,CAAc,CAAQ,CAC9B,IAAM8F,EAAU9F,EACX,MAAM,CAAC,AAACD,GAAS,IAAI,CAAC,aAAa,CAACA,IACpC,GAAG,CAAC,AAACA,GAAU,EACZ,OAAQsD,EAAAA,QAAmB,CAC3B,KAAMtD,EACN,UAAWuC,KAAAA,EACX,YAAaA,KAAAA,EACb,UAAW,IAAI,CACf,YAAavC,EAAK,eAAe,AACrC,IAEJ+F,EAAQ,OAAO,CAAC,AAACT,GAAW,IAAI,CAAC,UAAU,CAACA,EAAO,IAAI,CAAE,KACzD,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAACS,EACpC,CAEQ,cAAc/F,CAAW,CAAW,QACxC,AAAIA,EAAK,MAAM,GAAK,IAAI,GACpBmG,OAAO,IAAI,CAAC,CAAC,EAAEnG,EAAK,IAAI,CAAC,4BAA4B,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAChE,GAGf,CAEQ,WAAW6B,CAAW,CAAE6gB,CAAsB,CAAE,CAChDA,IACA7gB,EAAK,MAAM,CAAGU,KAAAA,EACdV,EAAK,aAAa,CAAG,IAGrBA,IAAS,IAAI,CAAC,WAAW,CACzB,IAAI,CAAC,eAAe,CAACA,GACdA,IAAS,IAAI,CAAC,UAAU,CAC/B,IAAI,CAAC,cAAc,CAACA,GAEpB,IAAI,CAAC,gBAAgB,CAACA,GAE1B,IAAI,CAAC,MAAM,EACf,CAEQ,gBAAgBA,CAAW,CAAE,CAC7BA,IAAS,IAAI,CAAC,UAAU,CACxB,IAAI,CAAC,WAAW,CAAG,IAAI,CAAC,UAAU,CAAGU,KAAAA,GAErC,IAAI,CAAC,WAAW,CAAGV,EAAK,WAAW,CACnC,IAAI,CAAC,WAAW,CAAE,eAAe,CAAGU,KAAAA,EACpCV,EAAK,WAAW,CAAGU,KAAAA,EAE3B,CAEQ,eAAeV,CAAW,CAAE,CAChC,IAAI,CAAC,UAAU,CAAGA,EAAK,eAAe,CACtC,IAAI,CAAC,UAAU,CAAE,WAAW,CAAGU,KAAAA,EAC/BV,EAAK,eAAe,CAAGU,KAAAA,CAC3B,CAEQ,iBAAiBV,CAAW,CAAE,CAClCA,EAAK,eAAe,CAAE,WAAW,CAAGA,EAAK,WAAW,CACpDA,EAAK,WAAW,CAAE,eAAe,CAAGA,EAAK,eAAe,CACxDA,EAAK,eAAe,CAAGA,EAAK,WAAW,CAAGU,KAAAA,CAC9C,CAEA,aAAaN,CAAyB,CAAEJ,CAAW,CAAQ,CACvD,GAAII,GAAU,CAAC,IAAI,CAAC,aAAa,CAACA,GAAS,OAE3C,IAAMqD,EAAS,CACX,OAAQhC,EAAAA,YAAuB,CAC/BzB,KAAAA,EACA,UAAWU,KAAAA,EACX,YAAaA,KAAAA,EACb,UAAW,IAAI,CACf,YAAaN,GAAQ,eACzB,EAEI,IAAI,CAAC,QAAQ,CAACJ,KACV,AAACI,GAAUA,IAAW,IAAI,CAAC,WAAW,CAGtC,IAAI,CAAC,kBAAkB,CAACA,EAAO,eAAe,CAAGJ,EAAMI,GAFvD,IAAI,CAAC,aAAa,CAACJ,IAK3B,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAACyD,EAAO,CAC5C,CAEQ,cAAczD,CAAW,CAAE,CAC/B,IAAI,CAAC,WAAW,CAAE,eAAe,CAAGA,EACpCA,EAAK,WAAW,CAAG,IAAI,CAAC,WAAW,CACnC,IAAI,CAAC,WAAW,CAAGA,CACvB,CAEQ,mBAAmB8gB,CAAW,CAAE9gB,CAAW,CAAE+c,CAAW,CAAE,CAC9D+D,EAAK,WAAW,CAAG9gB,EACnBA,EAAK,eAAe,CAAG8gB,EACvB9gB,EAAK,WAAW,CAAG+c,EACnBA,EAAK,eAAe,CAAG/c,CAC3B,CAEA,YAAYI,CAAyB,CAAEJ,CAAW,CAAQ,CACtD,GAAII,GAAU,CAAC,IAAI,CAAC,aAAa,CAACA,GAAS,OAE3C,IAAMqD,EAAS,CACX,OAAQhC,EAAAA,WAAsB,CAC9B,UAAWf,KAAAA,EACX,YAAaA,KAAAA,EACb,UAAW,IAAI,CACf,YAAaN,EACbJ,KAAAA,CACJ,EAEI,IAAI,CAAC,QAAQ,CAACA,KACTI,EAEMA,IAAW,IAAI,CAAC,UAAU,CACjC,IAAI,CAAC,SAAS,CAACJ,GAEf,IAAI,CAAC,kBAAkB,CAACI,EAAQJ,EAAMI,EAAO,WAAW,EAJxD,IAAI,CAAC,aAAa,CAACJ,IAO3B,IAAI,CAAC,MAAM,GACX,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAACyD,EAAO,CAC5C,CAEA,KAAKrG,CAAY,CAAE2jB,CAAqB,CAAEC,CAAuB,CAAQ,CACrE,GAAIA,GAAmBA,EAAgB,MAAM,GAAKD,EAAW,YACzDzc,OAAO,IAAI,CAAC,CAAC,EAAE0c,EAAgB,IAAI,CAAC,4BAA4B,EAAED,EAAU,IAAI,CAAC,KAAK,CAAC,EAI3F,IAAMtd,EAAS,CACX,OAAQhC,EAAAA,IAAe,CACvB,UAAWrE,EAAM,MAAM,CACvB,YAAaA,EAAM,eAAe,CAClC,UAAW2jB,EACX,YAAaC,EACb,KAAM5jB,CACV,EAEA,IAAI,CAAC,UAAU,CAACA,EAAO,IAEnB2jB,EAAU,QAAQ,CAAC3jB,KACd4jB,EAEMA,IAAoBD,EAAU,UAAU,CAC/CA,EAAU,SAAS,CAAC3jB,GAEpB2jB,EAAU,kBAAkB,CAACC,EAAiB5jB,EAAO4jB,EAAgB,WAAW,EAJhFD,EAAU,aAAa,CAAC3jB,IAOhC2jB,EAAU,MAAM,GAEhB,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAACtd,EAAO,CAC5C,CAES,iBAAwB,CAC7B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,EAClC,KAAK,CAAC,iBACV,CAEiB,aAAe,AAACzD,IACzBA,aAAgB4gB,YAChB,IAAI,CAAC,YAAY,CAAC5gB,EAAK,UAAU,EAGrC,IAAI+c,EAAO/c,GAAM,YAIjB,IAHIA,GACAA,CAAAA,EAAK,WAAW,CAAG,IAAG,EAEnB+c,GAAM,CACT,IAAIkE,EAAQlE,EAAK,WAAW,AAC5BA,CAAAA,EAAK,eAAe,CAAG,KACvBA,EAAK,WAAW,CAAG,KACnBA,EAAK,OAAO,GACZA,EAAOkE,CACX,CACAjhB,GAAM,SACV,CAAE,AAEQ,mBAAmB,CACzB,IAAI,CAAC,wBAAwB,EACjC,CAEU,wBAAyB,CAC/B,IAAI,CAAC,wBAAwB,EACjC,CAEQ,0BAA2B,CAC/B,IAAI5C,EAAQ,IAAI,CAAC,WAAW,CAC5B,KAAOA,AAAUsD,KAAAA,IAAVtD,GACHA,EAAM,aAAa,CAAG,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,aAAa,CACxDA,EAAQA,EAAM,WAAW,AAEjC,CACJ,E,sYAxRoB,CAAC,CAAC,WAAY,OAAQ,K,eCAnC,IAAM8jB,UAAN,MAAMA,kBAAkBN,WAC3B,IACI,WAAqB,CACrB,OAAO,IAAI,CAAC,eAAe,CAAC,YAAatL,QAAQ,QAAQ,GAC7D,CACA,IAAI,UAAUha,CAAc,CAAE,CAC1B,IAAI,CAAC,WAAW,CAAC,YAAaA,EAAOoF,KAAAA,EAAW,CAC5C,OAAQ,CAACzE,EAAMiW,IAAUjW,EAAK,MAAM,CAACiW,EACzC,EACJ,CACJ,E,iCATwB,G,kFAFJ,CAAC,CAAC,WAAY,OAAQ,K,cCOnC,IAAMiP,gBAAN,MAAMA,gB,WACT,aAAqBC,CAA0B,CAAE,C,KAA5BA,WAAW,CAAXA,CAA6B,CAElD,MAAMphB,CAAW,CAAW,QACxB,AAAIA,aAAgBof,WAChB,EAAI,IAAI,CAAC,WAAW,GAAIpf,EAAK,KAAK,CAAC,IAAI,EAC5B,IAAI,CAAC,WAAW,CAAC,KAAK,CAACA,EAAK,KAAK,CAAC,KAAK,CAClD,CAKR,CACJ,E3CtBO,IAAK2C,I,CAAAA,E,4CAAAA,G4CAL,IAAM0e,SAAN,MAAMA,iBAAoBrc,W,SAC7B,aAAqB/D,CAAyB,CAAE,CAC5C,KAAK,QADYA,SAAS,CAATA,EAAAA,IAAAA,CAmBZ,KAAK,CAAG,IAAI3C,oBAjBrB,CAEA,IAAI,eAAwB,CACxB,OAAO,IAAI,CAAC,eAAe,CAAC,gBAAiB,EACjD,CACA,IAAI,cAAchD,CAAa,CAAE,CACzBA,EAAQ,GAAKA,GAAS,IAAI,CAAC,KAAK,CAAC,MAAM,EAI3C,IAAI,CAAC,WAAW,CAAC,gBAAiBA,EACtC,CAEA,IAAI,cAA8B,CAC9B,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,aAAa,CAC3C,CAES,KAAsC,AACnD,E3CvBO,IAAKsH,I,CAAAA,E,wCAAAA,G,mV4CGL,IAAM0e,IAAN,MAAMA,YAAYtc,WACrB,IACW,MAAO,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CACA,IAAW,KAAK1J,CAAa,CAAE,CAC3B,IAAI,CAAC,WAAW,CAAC,OAAQA,EAC7B,CAEA,IACW,gBAAiB,CACxB,OAAO,IAAI,CAAC,eAAe,CAAC,iBAChC,CACA,IAAW,eAAeA,CAAU,CAAE,CAClC,IAAI,CAAC,WAAW,CAAC,iBAAkBA,EACvC,CAEA,IACW,cAAe,CACtB,OAAO,IAAI,CAAC,eAAe,CAAC,eAChC,CACA,IAAW,aAAaA,CAAU,CAAE,CAChC,IAAI,CAAC,WAAW,CAAC,eAAgBA,EACrC,CAEA,IACW,UAAW,CAClB,OAAO,IAAI,CAAC,eAAe,CAAC,WAChC,CACA,IAAW,SAASA,CAAU,CAAE,CAC5B,IAAI,CAAC,WAAW,CAAC,WAAYA,EACjC,CAEA,OAAO,SAASimB,CAAW,CAAEnd,CAAY,CAAE,CACvC,OAAO,IAAIkd,IACPld,EACAmd,EAAK,gBAAgB,CAAC,cAAc,CACpCA,EAAK,gBAAgB,CAAC,YAAY,CAClCA,EAAK,gBAAgB,CAAC,QAAQ,CAEtC,CAEA,YAAYnd,CAAY,CAAEod,CAAmB,CAAEC,CAAiB,CAAEC,CAAa,CAAE,CAC7E,KAAK,GACL,IAAI,CAAC,eAAe,CAAC,OAAQtd,GAC7B,IAAI,CAAC,eAAe,CAAC,iBAAkBod,GACvC,IAAI,CAAC,eAAe,CAAC,eAAgBC,GACrC,IAAI,CAAC,eAAe,CAAC,WAAYC,EACrC,CACJ,E,2BAhDwB,G,uDAQA,G,iEAQA,G,+DAQA,G,+DA1BJ,CAAC,CAAC,OAAQ,iBAAkB,eAAgB,W,Q3COzD,IAAK7e,I,CAAAA,E,iGAAAA,E,CAoDK8e,CAAAA,GAAAA,CAAAA,EAAKA,CAAAA,EAAAA,EACFC,cAAc,CAAvB,SAAwBL,CAAW,CAAEM,CAAU,CAAEC,CAAU,CAAE/R,CAAU,EAC1E,IAAIoK,EAAKoH,EAAK,aAAa,CAACxR,GACxBsC,EAAK8H,EAAG,CAAC,CAAG0H,EACZvP,EAAK6H,EAAG,CAAC,CAAG2H,EAChB,OAAOxY,KAAK,IAAI,CAAC+I,EAAKA,EAAKC,EAAKA,EACpC,E,A4ClDayP,CAAAA,GAAAA,CAAAA,EAAaA,CAAAA,EAAAA,EACVC,UAAU,CAAnB,SAAoBjd,CAAkB,EACzC,OAAQA,AAAyCrE,KAAAA,IAAzCqE,EAAwB,YAAY,AAChD,E3CpBG,IAAKjC,I,CAAAA,E,0IAAAA,E,EAOKA,EAAAA,IAAAA,CAAAA,GAAWA,CAAAA,IACRmf,QAAQ,CAAjB,SAAkBrH,CAAmB,CAAE/N,CAAgB,EAC1D,OAAO+N,EAAS/N,CACpB,E,EAEgBqV,WAAW,CAApB,SAAqBtH,CAAmB,CAAE9N,CAAmB,EAChE,OAAQ8N,EAAS9N,EAAU8N,CAC/B,E,EAEgBuH,QAAQ,CAAjB,SAAkBvH,CAAmB,CAAEwH,CAAsB,EAChE,MAAQxH,AAAAA,CAAAA,EAASwH,CAAQ,IAAOA,CACpC,C,6E4ChBG,IAAMlD,UAAN,MAAMA,UACT,OAAO,gBACHtY,CAAkB,CAClBwJ,CAA+B,CAC/B8C,CAAe,CACfxD,CAAmD,CACrD,CACOU,IAILxJ,EAAK,KAAK,CAAGA,EAAK,KAAK,CAAC,MAAM,CAC1BwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAACO,GACN,EACH,MAAOA,EAAE,KAAK,CAAGjB,EAAO,SAAS,CACjC,MAAOiB,EAAE,KAAK,CACd,MAAOA,EAAE,KAAK,CACd,UAAWuC,CACf,KAGRtM,EAAK,KAAK,CAAC,GAAG,CACVwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAAC7R,GAAMA,EAAImR,EAAO,YAAY,EAC9CA,EAAO,SAAS,EAEpB9I,EAAK,QAAQ,CAAC,GAAG,CAACsM,EAAO,QAAQ,CAAC9C,EAAM,QAAQ,EAAGV,AAAsB,EAAtBA,EAAO,YAAY,EACtE9I,EAAK,MAAM,CAAC,GAAG,CAACsM,EAAO,SAAS,CAAC9C,EAAM,MAAM,EAAGV,AAAsB,EAAtBA,EAAO,YAAY,EACnE9I,EAAK,EAAE,CAAC,GAAG,CAACwJ,EAAM,EAAE,CAAEV,AAAsB,EAAtBA,EAAO,YAAY,EAC7C,CAEA,OAAO,mBACH9I,CAAU,CACVwJ,CAAW,CACX8C,CAAe,CACfxD,CAAmD,CACnD2S,CAAgC,CAClC,CACEjS,EAAM,MAAM,CAAC,OAAO,CAAC,AAACO,IAClB/J,EAAK,MAAM,CAAC,IAAI,CAAC,CACb,MAAO+J,EAAE,KAAK,CAAGjB,EAAO,SAAS,CACjC,MAAOiB,EAAE,KAAK,CACd,cAAe0R,EAAY,GAAG,CAAC1R,EAAE,aAAa,CAClD,EACJ,GACI/J,EAAK,KAAK,EAAIwJ,EAAM,KAAK,EACzBxJ,EAAK,KAAK,CAAC,GAAG,CAACwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAAC7R,GAAMA,EAAImR,EAAO,YAAY,EAAGA,EAAO,SAAS,EAEhF9I,EAAK,QAAQ,EAAIwJ,EAAM,QAAQ,EAC/BxJ,EAAK,QAAQ,CAAC,GAAG,CAACsM,EAAO,QAAQ,CAAC9C,EAAM,QAAQ,EAAGV,AAAsB,EAAtBA,EAAO,YAAY,EAEtE9I,EAAK,MAAM,EAAIwJ,EAAM,MAAM,EAC3BxJ,EAAK,MAAM,CAAC,GAAG,CAACsM,EAAO,SAAS,CAAC9C,EAAM,MAAM,EAAGV,AAAsB,EAAtBA,EAAO,YAAY,EAEnE9I,EAAK,EAAE,EAAIwJ,EAAM,EAAE,EACnBxJ,EAAK,EAAE,CAAC,GAAG,CAACwJ,EAAM,EAAE,CAAEV,AAAsB,EAAtBA,EAAO,YAAY,CAEjD,CAEA,OAAO,oBAAoB9I,CAAkB,CAAEwJ,CAA+B,CAAE8C,CAAe,CAAE,CACxF9C,IAILxJ,EAAK,KAAK,CAAGA,EAAK,KAAK,CAAC,MAAM,CAC1BwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAACO,GACN,EACH,MAAOA,EAAE,KAAK,CAAG/J,EAAK,KAAK,CAAC,MAAM,CAClC,MAAO+J,EAAE,KAAK,CACd,MAAOA,EAAE,KAAK,CACd,UAAWuC,CACf,KAGRtM,EAAK,KAAK,CAAGyI,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAkB,CAACzI,EAAK,KAAK,CAAEwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAAC7R,GAAMA,EAAIqI,EAAK,QAAQ,CAAC,MAAM,CAAG,GAAG,EACjGA,EAAK,QAAQ,CAAG,IAAI,CAAC,kBAAkB,CAACA,EAAK,QAAQ,CAAEsM,EAAO,QAAQ,CAAC9C,EAAM,QAAQ,GACrFxJ,EAAK,MAAM,CAAG,IAAI,CAAC,kBAAkB,CAACA,EAAK,MAAM,CAAEsM,EAAO,SAAS,CAAC9C,EAAM,MAAM,GAChFxJ,EAAK,EAAE,CAAG,IAAI,CAAC,kBAAkB,CAACA,EAAK,EAAE,CAAEwJ,EAAM,EAAE,EACvD,CAEA,OAAO,mBAAmBkS,CAAuB,CAAEC,CAAuB,CAAE,CACxE,IAAI9S,EAAM,IAAItJ,aAAamc,EAAK,MAAM,CAAGC,EAAK,MAAM,EAGpD,OAFA9S,EAAI,GAAG,CAAC6S,GACR7S,EAAI,GAAG,CAAC8S,EAAMD,EAAK,MAAM,EAClB7S,CACX,CAEA,OAAO,gBACH7I,CAAkB,CAClBwJ,CAA+B,CAC/B8C,CAAe,CACfxD,CAAc,CAChB,CACOU,IAILxJ,EAAK,QAAQ,CAAC,GAAG,CAACsM,EAAO,QAAQ,CAAC9C,EAAM,QAAQ,EAAGV,AAAS,EAATA,GACnD9I,EAAK,KAAK,CAAGA,EAAK,KAAK,CAAC,MAAM,CAC1BwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAACO,GACN,EACH,UAAWuC,EACX,MAAOvC,EAAE,KAAK,CAAGjB,EACjB,MAAOiB,EAAE,KAAK,CACd,MAAOA,EAAE,KAAK,AAClB,KAGZ,CAEA,OAAO,oBAAoB/J,CAAkB,CAAEwJ,CAA+B,CAAE8C,CAAe,CAAE,CAC7F,GAAI,CAAC9C,EACD,OAGJ,IAAItB,EAAQlI,EAAK,QAAQ,CAAC,MAAM,CAAG,CACnCA,CAAAA,EAAK,QAAQ,CAAG,IAAI,CAAC,kBAAkB,CAACA,EAAK,QAAQ,CAAEsM,EAAO,QAAQ,CAAC9C,EAAM,QAAQ,GACrFxJ,EAAK,KAAK,CAAGA,EAAK,KAAK,CAAC,MAAM,CAC1BwJ,EAAM,KAAK,CAAC,GAAG,CAAC,AAACO,GACN,EACH,MAAOA,EAAE,KAAK,CAAG7B,EACjB,MAAO6B,EAAE,KAAK,CACd,MAAOA,EAAE,KAAK,CACd,UAAWuC,CACf,IAGZ,CAEA,OAAO,cAAc9D,CAAkB,CAAEiT,CAA+B,CAAgB,CACpF,GAAIA,AAAuB,IAAvBA,EAAY,MAAM,CAClB,OAAOjT,EAGX,IAAMiR,EAAmB,IAAItiB,IAAoBskB,GACjD,IAAK,IAAIxjB,EAAI,EAAGA,EAAIuQ,EAAK,KAAK,CAAC,MAAM,CAAEvQ,IAC/B,AAACwhB,EAAiB,GAAG,CAACxhB,IACtBwhB,EAAiB,GAAG,CAACxhB,EAAG,GAIhC,OAAO,IAAI,CAAC,oBAAoB,CAACuQ,EAAMiR,EAC3C,CAEA,OAAe,qBAAqBjR,CAAkB,CAAEiT,CAAgC,CAAgB,CACpG,IAAMrjB,EAAuB,CACzB,SAAU,IAAImH,aAAaiJ,EAAK,QAAQ,CAAC,MAAM,EAC/C,OAAQ,IAAIjJ,aAAaiJ,EAAK,MAAM,CAAC,MAAM,EAC3C,GAAI,IAAIjJ,aAAaiJ,EAAK,EAAE,CAAC,MAAM,EACnC,MAAO,IAAIhJ,YAAYgJ,EAAK,KAAK,CAAC,MAAM,EACxC,MAAO,EAAE,CACT,MAAOA,EAAK,KAAK,CACjB,OAAQ,EAAE,AACd,EAEIM,EAAS,CAAE,aAAc,EAAG,UAAW,CAAE,EACvC8S,EAAUlb,OAAO,OAAO,CAAC+a,EAAa,AAAC9jB,GAAMA,CAAC,CAAC,EAAE,EAEvD,IAAK,IAAMpC,KAAOmL,OAAO,IAAI,CAACkb,GAAU,CACpC,IAAM3jB,EAAII,SAAS9C,GACbsmB,EAAa/S,EAAO,SAAS,CACnCwP,UAAU,cAAc,CAACsD,CAAO,CAAC3jB,EAAE,CAAGuQ,EAAMpQ,EAAQ0Q,GACpD1Q,EAAO,MAAM,CAAC,IAAI,CAAC,CACf,MAAOyjB,EACP,MAAO/S,EAAO,SAAS,CAAG+S,EAC1B,cAAe5jB,CACnB,EACJ,CACA,OAAOG,CACX,CAEA,OAAe,eACXyR,CAAyB,CACzBrB,CAAkB,CAClBpQ,CAAoB,CACpB0Q,CAAmD,CACrD,CACE,IAAK,IAAM9Q,KAAS6R,EAAO,CACvB,GAAM,CAAE3B,MAAAA,CAAK,CAAEC,MAAAA,CAAK,CAAE+B,MAAAA,CAAK,CAAE,UAAW4R,CAAc,CAAE,CAAGtT,EAAK,KAAK,CAACxQ,CAAK,CAAC,EAAE,CAAC,CAEzE+jB,EAAWvT,EAAK,KAAK,CAAC,KAAK,CAACN,EAAOA,EAAQC,GAC3C,CAAEiD,IAAAA,CAAG,CAAEC,IAAAA,CAAG,CAAE,CAAGN,EAAAA,EAAAA,CAAAA,MAAgB,CAACgR,GACtC3jB,EAAO,QAAQ,CAAC,GAAG,CAACoQ,EAAK,QAAQ,CAAC,KAAK,CAAC4C,AAAM,EAANA,EAAUC,AAAAA,CAAAA,EAAM,GAAK,GAAIvC,AAAsB,EAAtBA,EAAO,YAAY,EACpF1Q,EAAO,MAAM,CAAC,GAAG,CAACoQ,EAAK,MAAM,CAAC,KAAK,CAAC4C,AAAM,EAANA,EAAUC,AAAAA,CAAAA,EAAM,GAAK,GAAIvC,AAAsB,EAAtBA,EAAO,YAAY,EAChF1Q,EAAO,EAAE,CAAC,GAAG,CAACoQ,EAAK,EAAE,CAAC,KAAK,CAAC4C,AAAM,EAANA,EAAUC,AAAAA,CAAAA,EAAM,GAAK,GAAIvC,AAAsB,EAAtBA,EAAO,YAAY,EACxE1Q,EAAO,KAAK,CAAC,GAAG,CACZ2jB,EAAS,GAAG,CAAC,AAACpkB,GAAMA,EAAIyT,EAAMtC,EAAO,YAAY,EACjDA,EAAO,SAAS,EAEpB1Q,EAAO,KAAK,CAAC,IAAI,CAAC,CACd,MAAO0Q,EAAO,SAAS,CACvBX,MAAAA,EACA+B,MAAAA,EACA,UAAW4R,CACf,GACAhT,EAAO,YAAY,EAAIuC,EAAMD,EAAM,EACnCtC,EAAO,SAAS,EAAIiT,EAAS,MAAM,AACvC,CACJ,CAEA,OAAO,QAAQvT,CAAkB,CAAExQ,CAAa,CAA4B,CACxE,IAAM6R,EAAQrB,GAAM,KAAK,CAACxQ,EAAM,CAChC,GAAI,CAAC6R,EAAO,OAEZ,IAAMmS,EAAUxT,EAAK,KAAK,CAAC,KAAK,CAACqB,EAAM,KAAK,CAAEA,EAAM,KAAK,CAAGA,EAAM,KAAK,EACjE,CAAEuB,IAAAA,CAAG,CAAEC,IAAAA,CAAG,CAAE,CAAGN,EAAAA,EAAAA,CAAAA,MAAgB,CAACiR,GAChC,CAACC,EAAaC,EAAU,CAAG,CAAC9Q,EAAKC,EAAM,EAAE,CAE/C,MAAO,CACH,SAAU7C,EAAK,QAAQ,CAAC,KAAK,CAACyT,AAAc,EAAdA,EAAiBC,AAAY,EAAZA,GAC/C,OAAQ1T,EAAK,MAAM,CAAC,KAAK,CAACyT,AAAc,EAAdA,EAAiBC,AAAY,EAAZA,GAC3C,MAAOF,EAAQ,GAAG,CAAC,AAAC/jB,GAAMA,EAAIgkB,GAC9B,GAAIzT,EAAK,EAAE,CAAC,KAAK,CAACyT,AAAc,EAAdA,EAAiBC,AAAY,EAAZA,GACnC,MAAO,EAAE,CACT,MAAO1T,EAAK,KAAK,CACjB,OAAQ,EAAE,AACd,CACJ,CAEA,OAAO,gBAAgB2T,CAAkB,CAAEnkB,CAAa,CAAE,CACtD,IAAMwQ,EAAO,IAAI,CAAC,OAAO,CAAC2T,EAAMnkB,GAChC,GAAKwQ,EAEL,OAAO,IAAI,CAAC,WAAW,CAACA,EAC5B,CAEA,OAAO,QACH4T,CAA2D,CAC3DD,CAAgC,CAChClkB,CAAS,CACT0Z,CAAS,CACX,CACE,IAAMpc,EAAM0C,EAAI0Z,EAAI,CAAC,EAAE1Z,EAAE,CAAC,EAAE0Z,EAAE,CAAC,CAAG,CAAC,EAAEA,EAAE,CAAC,EAAE1Z,EAAE,CAAC,CACvCokB,EAAQD,EAAU,GAAG,CAAC7mB,GAC5B,GAAI8mB,EACAA,EAAM,KAAK,OACR,CACH,IAAM5P,EAAS,IACR0P,EAAK,QAAQ,CAAC,KAAK,CAAClkB,AAAI,EAAJA,EAAOA,AAAI,EAAJA,EAAQ,MACnCkkB,EAAK,QAAQ,CAAC,KAAK,CAACxK,AAAI,EAAJA,EAAOA,AAAI,EAAJA,EAAQ,GACzC,CACDyK,EAAU,GAAG,CAAC7mB,EAAK,CAAE,MAAO,EAAGkX,OAAAA,CAAO,EAC1C,CACJ,CAEA,OAAO,YAAY0P,CAAoD,CAAE,CACrE,IAAMC,EAAY,IAAIjlB,IAEtB,IAAK,IAAIc,EAAI,EAAGA,EAAIkkB,EAAK,KAAK,CAAC,MAAM,CAAElkB,GAAK,EACxC,IAAI,CAAC,OAAO,CAACmkB,EAAWD,EAAMA,EAAK,KAAK,CAAClkB,EAAE,CAAEkkB,EAAK,KAAK,CAAClkB,EAAI,EAAE,EAC9D,IAAI,CAAC,OAAO,CAACmkB,EAAWD,EAAMA,EAAK,KAAK,CAAClkB,EAAI,EAAE,CAAEkkB,EAAK,KAAK,CAAClkB,EAAI,EAAE,EAClE,IAAI,CAAC,OAAO,CAACmkB,EAAWD,EAAMA,EAAK,KAAK,CAAClkB,EAAI,EAAE,CAAEkkB,EAAK,KAAK,CAAClkB,EAAE,EAGlE,OAAO,IAAIsH,aACP9H,MAAM,IAAI,CAAC2kB,EAAU,MAAM,IACtB,MAAM,CAAC,AAAC5b,GAAMA,AAAY,IAAZA,EAAE,KAAK,EACrB,OAAO,CAAC,AAAC6b,GAAUA,EAAM,MAAM,EAE5C,CAEA,OAAO,QAAQ7T,CAAkB,CAAExQ,CAAa,CAAE,CAC9C,IAAM6R,EAAQrB,GAAM,KAAK,CAACxQ,EAAM,CAChC,GAAK6R,EAEL,OAAOrB,EAAK,QAAQ,CAAC,KAAK,CAACqB,AAAc,EAAdA,EAAM,KAAK,CAAOA,AAAAA,CAAAA,EAAM,KAAK,CAAGA,EAAM,KAAI,EAAK,EAC9E,CACJ,EC1QO,IAAMyS,SAAN,MAAMA,SACT,OAAO,aAAaC,CAAW,CAAEpT,CAAU,CAA+B,CACtE,IACIqT,EADAC,EAAcnkB,OAAO,SAAS,CAGlC,IAAK,IAAMokB,KAAQH,EAAK,aAAa,CAAC1gB,EAAAA,EAAAA,CAAAA,IAAc,EAAc,CAC9D,IAAM8gB,EAAYD,EAAK,KAAK,CAAC,gBAAgB,CAACvT,EAC1CwT,CAAAA,EAAU,QAAQ,CAAGF,IACrBD,EAAU,CAAEE,KAAAA,EAAM,MAAOC,EAAU,KAAK,AAAC,EACzCF,EAAcE,EAAU,QAAQ,CAExC,CACA,OAAOH,CACX,CAEA,OAAO,YAAY5U,CAAa,CAAE,CAK9B,GAJItM,EAAAA,EAAAA,CAAAA,SAAgB,CAACsM,IACjBA,CAAAA,EAAQA,EAAM,UAAU,AAAD,EAGvBtM,EAAAA,EAAAA,CAAAA,OAAc,CAACsM,GACf,OAAOA,EAAM,IAAI,CAErB,IAAIsE,EAAMtE,EAAM,EAAE,CAAC,EAAG,UACtB,AAAIsE,EAAI,YAAY,CAACnT,EAAAA,EAAAA,CAAAA,KAAS,EAAUA,EAAAA,EAAAA,CAAAA,KAAS,CAC1CmT,EAAI,KAAK,CAACnT,EAAAA,EAAAA,CAAAA,KAAS,EAAE,SAAS,EACzC,CAEA,OAAe,WAAWwjB,CAAW,CAAO,CACxC,IAGIK,EAHET,EAAOI,EAAK,MAAM,GACxB,GAAIJ,EAAK,IAAI,CAAE,OAAOA,EAAK,KAAK,CAAC,MAAM,CAAC,EAAG,EAAE,CAAC,EAAE,CAGhD,IAAK,IAAMO,KAAQH,EAAK,aAAa,CAAC1gB,EAAAA,EAAAA,CAAAA,IAAc,EAAG,CACnD+gB,EAAYF,EACZ,KACJ,CACA,OAAO,IAAI,CAAC,WAAW,CAACE,EAAW,KAAK,CAC5C,CAEA,OAAO,aAAaL,CAAW,CAAEG,CAAW,CAAiB,CACzD,IAAM9U,EAAQ8U,EAAK,KAAK,CAClBvT,EAAQvB,EAAM,KAAK,CAACA,EAAM,aAAa,IAE7C,IAAK,IAAM5S,KAAKunB,EAAK,aAAa,CAAC1gB,EAAAA,EAAAA,CAAAA,IAAc,EAAG,CAChD,GAAI7G,EAAE,OAAO,CAAC0nB,GAAO,SACrB,IAAMG,EAAa7nB,EAAY,KAAK,CACpC,GACImU,EAAM,UAAU,CAAC0T,EAAU,KAAK,CAACA,EAAU,cAAc,KAAO5hB,EAAAA,EAAAA,CAAAA,QAAkB,EAClFkO,EAAM,UAAU,CAAC0T,EAAU,KAAK,CAACA,EAAU,aAAa,KAAO5hB,EAAAA,EAAAA,CAAAA,QAAkB,CAEjF,OAAOtG,EAAAA,EAAAA,CAAAA,EAAS,CAACK,EAEzB,CACA,OAAOL,EAAAA,EAAAA,CAAAA,GAAU,CAAC,wBACtB,CAEA,OAAO,OAAOuV,CAA4B,CAAO,CAC7C,GAAIA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAClC,OAAQqO,EAAgB,MAAM,CAAC,EAAG,EAAE,CAAC,EAAE,CAG3C,GAAIA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAAE,CACpC,IAAI+L,EAASsC,EAAgB,KAAK,CAClC,OAAO,IAAI,CAAC,WAAW,CAACtC,EAC5B,CAEA,OAAO,IAAI,CAAC,UAAU,CAACsC,EAC3B,CAEA,OAAO,WAAWwS,CAAW,CAAEI,CAAmB,CAAuC,CACrF,IAAI1kB,EAA8C,EAAE,CAOpD,OANA0kB,EAAW,OAAO,CAAC,AAAC9nB,IAChB,IAAI+nB,EAAYL,EAAK,SAAS,CAAC1nB,EAC3B+nB,CAAAA,EAAU,MAAM,CAAG,GACnB3kB,EAAO,IAAI,IAAI2kB,EAEvB,GACO3kB,CACX,CACJ,C,sJC9EA,IAAM4kB,EAAqB;;;;;;;;;;AAU3B,CAAC,CAQM,IAAeC,iBAAf,MAAeA,iB,6BACR,KAAqB,AACrB,SAAgB,AAChB,MAAsC,AAC7B,gBAAuD,AAE1E,aACaC,CAAmB,CACnBC,CAAkB,CAClBC,CAA4B,CACvC,C,KAHWF,QAAQ,CAARA,E,KACAC,SAAS,CAATA,E,KACAC,UAAU,CAAVA,E,KAPH,QAAQ,CAAG,G,KACX,KAAK,CAAG,CAAE,OAAQ,GAAO,EAAG,EAAG,EAAG,CAAE,E,KAC3B,eAAe,CAA8B,IAAIjmB,I,KAapE,EAAS,CAAG,G,KACH,OAAO,CAAG,KACV,IAAI,CAAC,EAAS,GACf,IAAI,CAAC,EAAS,CAAG,GAEjB,IAAI,CAAC,eAAe,GAE5B,EAbIimB,GAAY,YAAY,AAAClL,IACrB,IAAI,CAAC,aAAa,CAACgL,GACnB,IAAI,CAAC,eAAe,EACxB,EACJ,CAEA,EAAS,AAAS,AACT,QAMP,AAEQ,kBAAkB,CACxB,IAAI,CAAC,eAAe,CAAC,KAAK,EAC9B,CAEA,YAAYvC,CAAW,CAAE9X,CAAmB,CAAQ,CAlDnC,IAmDTA,EAAM,OAAO,GACb,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAEA,GAE1C,IAAI,CAAC,YAAY,CAAC8X,EAAM9X,GAC5B,CAYA,YAAY8X,CAAW,CAAE9X,CAAmB,CAAQ,CAChDA,EAAM,cAAc,GACC,IAAjBA,EAAM,MAAM,EAAUA,EAAM,SAAS,GACrC,IAAI,CAAC,KAAK,CAAG,CAAE,OAAQ,GAAM,EAAGA,EAAM,OAAO,CAAE,EAAGA,EAAM,OAAO,AAAC,EAC5D,IAAI,CAAC,SAAS,EAAI,IAAI,CAAC,QAAQ,EAC/B,KAAI,CAAC,IAAI,CAAG,IAAI,CAAC,QAAQ,CAACA,EAAK,GAGvC,IAAI,CAAC,eAAe,CAAC,GAAG,CAACA,EAAM,SAAS,CAAEA,EAC9C,CAEQ,SAASA,CAAmB,CAAiB,CACjD,IAAMwa,EAAOpoB,SAAS,aAAa,CAAC,OAGpC,OAFAooB,EAAK,KAAK,CAAC,OAAO,CAAGL,EACrB/nB,SAAS,IAAI,CAAC,WAAW,CAACooB,GACnB,CAAE,QAASA,EAAM,QAASxa,EAAM,OAAO,CAAE,QAASA,EAAM,OAAO,AAAC,CAC3E,CAEU,WAAWwa,CAAmB,CAAExa,CAAmB,CAAE,CAC3D,GAAI,AAA8B,IAA9B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAQ,MACrCwa,CAAAA,EAAK,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,QAC7B,GAAM,CAACtQ,EAAIC,EAAG,CAAG,CAACtK,KAAK,GAAG,CAAC2a,EAAK,OAAO,CAAExa,EAAM,OAAO,EAAGH,KAAK,GAAG,CAAC2a,EAAK,OAAO,CAAExa,EAAM,OAAO,EAAE,CACzF,CAACsK,EAAIC,EAAG,CAAG,CAAC1K,KAAK,GAAG,CAAC2a,EAAK,OAAO,CAAExa,EAAM,OAAO,EAAGH,KAAK,GAAG,CAAC2a,EAAK,OAAO,CAAExa,EAAM,OAAO,EAAE,CAC/FnC,OAAO,MAAM,CAAC2c,EAAK,OAAO,CAAC,KAAK,CAAE,CAC9B,KAAM,CAAC,EAAEtQ,EAAG,EAAE,CAAC,CACf,IAAK,CAAC,EAAEC,EAAG,EAAE,CAAC,CACd,MAAO,CAAC,EAAEG,EAAKJ,EAAG,EAAE,CAAC,CACrB,OAAQ,CAAC,EAAEK,EAAKJ,EAAG,EAAE,CAAC,AAC1B,EACJ,CAEA,WAAW2N,CAAW,CAAE9X,CAAmB,CAAQ,CAC3CA,EAAM,SAAS,GACf,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,GACpB,IAAI,CAAC,UAAU,CAAC8X,GAChB,IAAI,CAAC,eAAe,IAExB,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC9X,EAAM,SAAS,CAC/C,CAEA,UAAU8X,CAAW,CAAE9X,CAAmB,CAAQ,CAE9C,GADAA,EAAM,cAAc,GAChB,IAAI,CAAC,KAAK,CAAC,MAAM,EAAIA,AAAiB,IAAjBA,EAAM,MAAM,EAAUA,EAAM,SAAS,CAAE,CAC5D,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,GACpB,IAAI,CAAC,UAAU,CAAC8X,GAChB,IAAMxS,EAAQ,IAAI,CAAC,MAAM,CAACwS,EAAM9X,GAChC,IAAI,CAAC,eAAe,GACpB8X,EAAK,MAAM,GACPxS,EAAQ,GAAK,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,EAAE,SACvD,CACA,IAAI,CAAC,eAAe,CAAC,MAAM,CAACtF,EAAM,SAAS,CAC/C,CAEQ,WAAW8X,CAAW,CAAE,CAC5B,IAAI,CAAC,IAAI,EAAE,QAAQ,SACnB,IAAI,CAAC,IAAI,CAAG7gB,KAAAA,CAChB,CAEA,QAAQ6gB,CAAW,CAAE9X,CAAoB,CAAQ,CACzCA,AAAc,WAAdA,EAAM,GAAG,EACT,IAAI,CAAC,UAAU,CAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAK,IAAI,CAAC,aAAa,CAAC8X,EAAK,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAC7F,IAAI,CAAC,eAAe,IACb9X,AAAc,UAAdA,EAAM,GAAG,EAChB,IAAI,CAAC,eAAe,GACpB,IAAI,CAAC,UAAU,EAAE,WACI,QAAdA,EAAM,GAAG,GAChBA,EAAM,cAAc,GACpB,IAAI,CAAC,aAAa,CAAC8X,GAE3B,CACJ,EC9HO,IAAM2C,qBAAN,MAAMA,6BAA6BL,iB,MAC9B,YAAyC,AACzC,eAA4C,AAC5C,cAAyC,AAEjD,QAAsB,CAClB,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,gBAAgB,EACnD,CAEA,YACIhoB,CAAmB,CACnBkoB,CAAkB,CAClBC,CAA4B,CACnBG,CAAoB,CAC/B,CACE,KAAK,CAACtoB,EAAUkoB,EAAWC,GAAAA,IAAAA,CAFlBG,MAAM,CAANA,CAGb,CAEmB,OAAO5C,CAAW,CAAE9X,CAAmB,CAAU,CAChE,GAAI,CAAC,IAAI,CAAC,WAAW,EAAE,OAEnB,OADA,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,EACzB,EAEX,IAAM2a,EAAS,IAAI,CAAC,WAAW,CAC1B,GAAG,CAAC,AAAC7lB,GAAMgjB,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAChjB,IAChD,MAAM,CAAC,AAACA,GAAkBA,AAAMmC,KAAAA,IAANnC,GAE/B,OADA,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC6lB,EAAQ3a,EAAM,QAAQ,EACpD2a,EAAO,MAAM,AACxB,CAEA,aAAa7C,CAAW,CAAE9X,CAAmB,CAAE,CAC3C,GACI,IAAI,CAAC,IAAI,EACTH,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAGG,EAAM,OAAO,EAAI,GACzCH,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAGG,EAAM,OAAO,EAAI,EAEzC,OAAO8X,EAAK,gBAAgB,CACxB,IAAI,CAAC,KAAK,CAAC,CAAC,CACZ,IAAI,CAAC,KAAK,CAAC,CAAC,CACZ9X,EAAM,OAAO,CACbA,EAAM,OAAO,CACb,IAAI,CAAC,MAAM,CAGnB,KAAI,CAAC,cAAc,CAAG8X,EAAK,YAAY,CAAC9X,EAAM,OAAO,CAAEA,EAAM,OAAO,CAAE,IAAI,CAAC,MAAM,EACjF,IAAM4a,EAAW,IAAI,CAAC,YAAY,GAClC,OAAOA,EAAW,CAACA,EAAS,CAAG,EAAE,AACrC,CAEQ,cAAe,CACnB,GAAI,CAAC,IAAI,CAAC,cAAc,CAAE,OAC1B,IAAMzlB,EAAQ,IAAI,CAAC,aAAa,CAAG,IAAI,CAAC,kBAAkB,GAAK,EAC/D,OAAO,IAAI,CAAC,cAAc,CAACA,EAAM,EAAI8B,KAAAA,CACzC,CAEQ,oBAAqB,CACzB,GAAI,CAAC,IAAI,CAAC,cAAc,CAAE,OAAO,GACjC,IAAK,IAAI7B,EAAI,EAAGA,EAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAEA,IAC5C,GAAI,IAAI,CAAC,aAAa,GAAK,IAAI,CAAC,cAAc,CAACA,EAAE,CAC7C,OAAOA,EAGf,OAAO,EACX,CAEmB,aAAa0iB,CAAW,CAAE9X,CAAmB,CAAE,CAC9D,IAAI6a,EAAY,IAAI,CAAC,YAAY,CAAC/C,EAAM9X,GACxC,IAAI,CAAC,kBAAkB,CAAC8X,EAAM+C,EAClC,CAEQ,mBAAmB/C,CAAW,CAAE+C,CAA0B,CAAE,CAChE,IAAI,CAAC,eAAe,GACpBA,EAAU,OAAO,CAAC,AAAC/lB,IACfgjB,EAAK,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAChjB,EAAGuE,EAAAA,EAAAA,CAAAA,aAAyB,CAAEL,EAAAA,EAAAA,CAAAA,KAAe,CAC3F,GACA,IAAI,CAAC,WAAW,CAAG6hB,EACnB/C,EAAK,MAAM,EACf,CAEmB,iBAAwB,CACvC,IAAI,CAAC,WAAW,EAAE,QAAQ,AAAChjB,IACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,WAAW,CAACA,EAAGuE,EAAAA,EAAAA,CAAAA,aAAyB,CAAEL,EAAAA,EAAAA,CAAAA,KAAe,CAC9F,GACA,IAAI,CAAC,WAAW,CAAG/B,KAAAA,CACvB,CAEmB,cAAc6gB,CAAW,CAAQ,CAChD,GAAI,IAAI,CAAC,cAAc,EAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAG,EAAG,CACvD,IAAM3iB,EAAQ,IAAI,CAAC,aAAa,CACzB,KAAI,CAAC,kBAAkB,GAAK,GAAK,IAAI,CAAC,cAAc,CAAC,MAAM,CAC5D,CACN,KAAI,CAAC,aAAa,CAAG,IAAI,CAAC,cAAc,CAACA,EAAM,CAC/C,IAAMylB,EAAW,IAAI,CAAC,YAAY,EAC9BA,CAAAA,GAAU,IAAI,CAAC,kBAAkB,CAAC9C,EAAM,CAAC8C,EAAS,CAC1D,CACJ,CAES,cAAcxoB,CAAmB,CAAQ,CAC9CA,EAAS,SAAS,CAAC,cAAc,EACrC,CACJ,ECrGO,IAAe0oB,sBAAf,MAAeA,8BAA8BV,iB,gBACtC,YAA2C,AAC7C,eAA8C,AAC9C,cAAkC,AAE1C,aACIhoB,CAAmB,CACV2oB,CAAoB,CAC7BT,CAAkB,CAClBC,CAA4B,CACnBG,CAAqB,CAChC,CACE,KAAK,CAACtoB,EAAUkoB,EAAWC,GAAAA,IAAAA,CALlBQ,SAAS,CAATA,EAAAA,IAAAA,CAGAL,MAAM,CAANA,CAGb,CAEQ,aAAa5C,CAAW,CAAE9X,CAAmB,CAAE,CACnD,GACI,IAAI,CAAC,IAAI,EACTH,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAGG,EAAM,OAAO,EAAI,GACzCH,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAGG,EAAM,OAAO,EAAI,EAEzC,OAAO8X,EAAK,gBAAgB,CACxB,IAAI,CAAC,SAAS,CACd,IAAI,CAAC,KAAK,CAAC,CAAC,CACZ,IAAI,CAAC,KAAK,CAAC,CAAC,CACZ9X,EAAM,OAAO,CACbA,EAAM,OAAO,CACb,IAAI,CAAC,MAAM,CAGnB,KAAI,CAAC,cAAc,CAAG8X,EAAK,YAAY,CAAC,IAAI,CAAC,SAAS,CAAE9X,EAAM,OAAO,CAAEA,EAAM,OAAO,CAAE,IAAI,CAAC,MAAM,EACjG,IAAM4a,EAAW,IAAI,CAAC,YAAY,GAClC,OAAOA,EAAW,CAACA,EAAS,CAAG,EAAE,AACrC,CAEmB,aAAa9C,CAAW,CAAE9X,CAAmB,CAAE,CAC9D,IAAI6a,EAAY,IAAI,CAAC,YAAY,CAAC/C,EAAM9X,GACxC,IAAI,CAAC,kBAAkB,CAAC8X,EAAM+C,EAClC,CAEU,mBAAmB/C,CAAW,CAAE+C,CAA4B,CAAE,CACpE,IAAI,CAAC,eAAe,GACpBA,EAAU,OAAO,CAAC,AAAC/lB,IACfgjB,EAAK,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CACrChjB,EAAE,KAAK,CACPuE,EAAAA,EAAAA,CAAAA,aAAyB,CACzB,IAAI,CAAC,SAAS,IACXvE,EAAE,OAAO,CAEpB,GACA,IAAI,CAAC,WAAW,CAAG+lB,EACnB/C,EAAK,MAAM,EACf,CAEU,iBAAkB,CACxB,IAAI,CAAC,WAAW,EAAE,QAAQ,AAAChjB,IACvBA,EAAE,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,WAAW,CAChDA,EAAE,KAAK,CACPuE,EAAAA,EAAAA,CAAAA,aAAyB,CACzB,IAAI,CAAC,SAAS,IACXvE,EAAE,OAAO,CAEpB,GACA,IAAI,CAAC,WAAW,CAAGmC,KAAAA,CACvB,CAEU,cAAc6gB,CAAW,CAAE,CACjC,GAAI,IAAI,CAAC,cAAc,EAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAG,EAAG,CACvD,IAAI3iB,EAAQ,IAAI,CAAC,aAAa,CACvB,KAAI,CAAC,kBAAkB,GAAK,GAAK,IAAI,CAAC,cAAc,CAAC,MAAM,CAC5D,CACN,KAAI,CAAC,aAAa,CAAG,IAAI,CAAC,cAAc,CAACA,EAAM,CAAC,KAAK,CACrD,IAAMylB,EAAW,IAAI,CAAC,YAAY,EAC9BA,CAAAA,GAAU,IAAI,CAAC,kBAAkB,CAAC9C,EAAM,CAAC8C,EAAS,CAC1D,CACJ,CAEQ,cAAe,CACnB,GAAI,IAAI,CAAC,cAAc,CAAE,CACrB,IAAMzlB,EAAQ,IAAI,CAAC,aAAa,CAAG,IAAI,CAAC,kBAAkB,GAAK,EAC/D,OAAO,IAAI,CAAC,cAAc,CAACA,EAAM,AACrC,CAEJ,CAEQ,oBAAqB,CACzB,OAAO,IAAI,CAAC,cAAc,EAAE,UAAU,AAACL,GAAM,IAAI,CAAC,aAAa,GAAKA,EAAE,KAAK,GAAK,EACpF,CACJ,EAEO,IAAMkmB,yBAAN,MAAMA,iCAAiCF,sBACzB,QAAwC,IAAIxmB,GAAM,AACnE,eAA6B+E,EAAAA,EAAAA,CAAAA,YAAwB,AAAC,AAEtD,aACIjH,CAAmB,CACnB2oB,CAAoB,CACpBT,CAAkB,CAClBC,CAA4B,CAC5BG,CAAqB,CACvB,CACE,KAAK,CAACtoB,EAAU2oB,EAAWT,EAAWC,EAAYG,GAClD,IAAI,CAAC,QAAQ,CAAG,EACpB,CAEA,QAA4B,CACxB,MAAO,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,AACrC,CAES,cAActoB,CAAmB,CAAQ,CAC9C,IAAK,IAAMiV,KAAS,IAAI,CAAC,OAAO,CAAC,MAAM,GACnC,IAAI,CAAC,cAAc,CAACA,GAExB,IAAI,CAAC,OAAO,CAAC,KAAK,EACtB,CAEmB,OAAOyQ,CAAW,CAAE9X,CAAmB,CAAU,CAChE,IAAM5N,EAAW0lB,EAAK,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAS9C,OARI,IAAI,CAAC,SAAS,CACd,IAAI,CAAC,WAAW,EAAE,QAAQ,AAAChjB,GACvB,IAAI,CAAC,OAAO,CAAC,GAAG,CAACA,EAAE,KAAK,EAAI,IAAI,CAAC,cAAc,CAACA,GAAK,IAAI,CAAC,WAAW,CAACA,KAG1E,IAAI,CAAC,aAAa,CAAC1C,GACnB,IAAI,CAAC,WAAW,EAAE,QAAQ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,IAEjD,IAAI,CAAC,OAAO,CAAC,IAAI,AAC5B,CAEQ,eAAeiV,CAAsB,CAAE,CAC3C,IAAI,CAAC,OAAO,CAAC,MAAM,CAACA,EAAM,KAAK,EAC/BA,EAAM,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,WAAW,CACpDA,EAAM,KAAK,CACX,IAAI,CAAC,aAAa,CAClBA,EAAM,KAAK,CAAC,SAAS,IAClBA,EAAM,OAAO,CAExB,CAEQ,YAAYA,CAAsB,CAAE,CACxCA,EAAM,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CACjDA,EAAM,KAAK,CACX,IAAI,CAAC,aAAa,CAClB,IAAI,CAAC,SAAS,IACXA,EAAM,OAAO,EAEpB,IAAI,CAAC,OAAO,CAAC,GAAG,CAACA,EAAM,KAAK,CAAEA,EAClC,CACJ,EC9JO,IAAM4T,UAAN,MAAMA,UACT,OAAO,WAAWnD,CAAW,CAAExR,CAAU,CAAE,CACvC,IAAMyR,EAAiBD,EAAK,gBAAgB,CAAC,cAAc,CACrDnI,EAASrJ,EAAM,GAAG,CAACyR,GACzB,GAAID,AAAqC,iBAArCA,EAAK,gBAAgB,CAAC,UAAU,CAMhC,OAAO,IAAI1F,EAAAA,EAAGA,CAAC2F,EAAgBpI,EANsB,EACrD,IAAM0C,EAAYyF,EAAK,SAAS,GAC1B5O,EAAMyG,EAAO,GAAG,CAAC0C,GACjBhB,EAAW/K,EAAM,GAAG,CAAC+L,EAAU,QAAQ,CAACnJ,IAC9C,OAAO,IAAIkJ,EAAAA,EAAGA,CAACf,EAAUgB,EAC7B,CAGJ,CAEA,OAAO,YAAYyF,CAAW,CAAExR,CAAU,CAAE,CACxC,GAAIwR,AAAqC,iBAArCA,EAAK,gBAAgB,CAAC,UAAU,CAChC,OAAOA,EAAK,SAAS,EAClB,EACH,IAAMC,EAAiBD,EAAK,gBAAgB,CAAC,cAAc,CAC3D,OAAOxR,EAAM,GAAG,CAACyR,EACrB,CACJ,CAEA,OAAO,YAAYD,CAAW,CAAEvI,CAAY,CAAE,CAC1C,IAAM8C,EAAYyF,EAAK,SAAS,GAChC,GAAIjY,KAAK,GAAG,CAACwS,EAAU,GAAG,CAAC9C,EAAM,MAAM,GAAKnX,EAAAA,EAAAA,CAAAA,KAAe,CAAE,CACzD,IAAM5F,EAAO6f,EAAU,KAAK,CAACyF,EAAK,EAAE,IACpC,OAAO,IAAI5G,EAAAA,EAAKA,CAAC3B,EAAM,MAAM,CAAE8C,EAAW7f,EAC9C,CACA,OAAO+c,CACX,CAEA,OAAO,oBAAoBuI,CAAW,CAAEzS,CAAU,CAAEmB,CAAQ,CAAS,CACjE,IAAM6L,EAAYyF,EAAK,SAAS,GAChC,GAAIjY,KAAK,GAAG,CAACwS,EAAU,GAAG,CAACyF,EAAK,SAAS,CAAC,MAAM,GAAK1f,EAAAA,EAAAA,CAAAA,KAAe,CAAE,CAClE,IAAM5F,EAAO6f,EAAU,KAAK,CAACyF,EAAK,EAAE,IACpC,OAAO,IAAI5G,EAAAA,EAAKA,CAAC7L,EAAOgN,EAAW7f,EACvC,CAEA,IAAM8e,EAAM2J,UAAU,UAAU,CAACnD,EAAMtR,GACjC0U,EAAS,CACX,IAAIhK,EAAAA,EAAKA,CAAC7L,EAAOnP,EAAAA,EAAAA,CAAAA,KAAS,CAAEA,EAAAA,EAAAA,CAAAA,KAAS,EACrC,IAAIgb,EAAAA,EAAKA,CAAC7L,EAAOnP,EAAAA,EAAAA,CAAAA,KAAS,CAAEA,EAAAA,EAAAA,CAAAA,KAAS,EACrC,IAAIgb,EAAAA,EAAKA,CAAC7L,EAAOnP,EAAAA,EAAAA,CAAAA,KAAS,CAAEA,EAAAA,EAAAA,CAAAA,KAAS,EACxC,CAEKilB,EAAYD,EAAO,GAAG,CAAC,AAACE,GAAMA,EAAE,SAAS,CAAC9J,IAAM,WAAWjM,IAC7D9P,EAAsC,CAAC2lB,CAAM,CAAC,EAAE,CAAEC,CAAS,CAAC,EAAE,CAAC,CACnE,IAAK,IAAI/lB,EAAI,EAAGA,EAAI+lB,EAAU,MAAM,CAAE/lB,IACb6B,KAAAA,IAAjBkkB,CAAS,CAAC/lB,EAAE,EAEZG,CAAAA,AAAc0B,KAAAA,IAAd1B,CAAM,CAAC,EAAE,EAAkBsK,KAAK,GAAG,CAACsb,CAAS,CAAC/lB,EAAE,EAAKyK,KAAK,GAAG,CAACtK,CAAM,CAAC,EAAE,IACvEA,CAAAA,EAAS,CAAC2lB,CAAM,CAAC9lB,EAAE,CAAE+lB,CAAS,CAAC/lB,EAAE,CAAC,A,EAI1C,OAAOG,CAAM,CAAC,EAAE,AACpB,CACJ,C,2BCtCI8lB,E,iKCtBQC,EAUKA,E,qBCUV,IAAMC,UAAN,MAAMA,U,QACD,eAA6B,AAC7B,iBAA+B,AAEvC,UAAuC,AACvC,YAA2B,AAC3B,WAAyB,AAEzB,aAAqBnpB,CAAmB,CAAE,C,KAArBA,QAAQ,CAARA,E,KAPb,cAAc,CAAY,EAAE,C,KAC5B,gBAAgB,CAAY,EAAE,C,KAEtC,SAAS,CAAc4G,EAAAA,EAAAA,CAAAA,KAAe,C,KA8ErB,eAAe,CAAG,AAAClE,IAChC,GAAIA,aAAa6gB,EAAAA,EAASA,CAAE,CACxB,IAAItO,EAAQvS,EAAE,KAAK,CAAC,KAAK,OACzB,CAAKuS,IAAU,IAAI,CAAC,WAAW,EACxB,IAAI,CAAC,WAAW,CAAC,KAAK,CAACA,EAClC,OAEA,CAAI,IAAI,CAAC,UAAU,EACR,IAAI,CAAC,UAAU,CAAC,KAAK,CAACvS,EAIrC,CAtF2C,CAE3C,MAAM,UACF0mB,CAAgB,CAChBjB,CAA2B,CAC3BD,CAAkB,CAClBmB,EAA6BpiB,EAAAA,EAAAA,CAAAA,YAAwB,CACvD,CACE,IAAMyC,EAAU,IAAIkf,EAAAA,EAAwBA,CACxC,IAAI,CAAC,QAAQ,CACb,IAAI,CAAC,SAAS,CACdV,EACAC,EACA,IAAI,CAAC,WAAW,EAIpB,OAFAze,EAAQ,aAAa,CAAG2f,EACxB,MAAM,IAAI,CAAC,SAAS,CAAC3f,EAAS0f,EAAQjB,EAAYD,GAC3Cxe,EAAQ,MAAM,EACzB,CAEA,MAAM,SAAS0f,CAAgB,CAAEjB,CAA2B,CAAED,CAAkB,CAAE,CAC9E,IAAMxe,EAAU,IAAI2e,EAAAA,CAAoBA,CAAC,IAAI,CAAC,QAAQ,CAAEH,EAAWC,EAAY,IAAI,CAAC,UAAU,EAE9F,OADA,MAAM,IAAI,CAAC,SAAS,CAACze,EAAS0f,EAAQjB,EAAYD,GAC3Cxe,EAAQ,KAAK,EACxB,CAEA,MAAM,UACFA,CAAsB,CACtB0f,CAAgB,CAChBjB,CAA2B,CAC3BmB,CAAoB,CACpBC,EAAqB,gBAAgB,CACvC,CACE,IAAMC,EAAa,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,AACpD,KAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAG9f,EACpCgE,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,aAAc6b,GACjC7b,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,eAAgB0b,GAC/BE,GAAa5b,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,uBAAwBya,GAE5D,GAAI,CACA,MAAM,IAAItZ,QAAQ,CAACC,EAAS2a,KACxBtB,EAAW,WAAW,CAACrZ,GACvBqZ,EAAW,WAAW,CAACsB,EAC3B,EACJ,CAAE,MAAO1pB,EAAG,CACR0I,EAAAA,EAAAA,CAAAA,KAAY,CAAC,gBAAiB1I,EAClC,QAAU,CACFupB,GAAa5b,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,yBACpCA,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,qBACnB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAG8b,EACpC9b,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,aAAc,UACrC,CACJ,CAEA,SAAgB,CACZ,IAAI,CAAC,cAAc,CAAC,MAAM,CAAG,EAC7B,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAG,CACnC,CAEA,kBAA4B,CACxB,OAAO,IAAI,CAAC,cAAc,AAC9B,CAEA,aAAatJ,CAAc,CAAEslB,CAAe,CAAE,CAQ1C,OAPAtlB,EAAQA,EAAM,MAAM,CAAC,IAAI,CAAC,eAAe,EACrCslB,EACA,IAAI,CAAC,mBAAmB,CAACtlB,EAAO,KAEhC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,cAAc,CAAE,IAChD,IAAI,CAAC,gBAAgB,CAACA,EAAO,KAE1B,IAAI,CAAC,cAAc,CAAC,MAAM,AACrC,CAEiB,eAYf,AAEF,UAASA,CAAc,CAAE,CACrB,IAAI,CAAC,qBAAqB,CAACA,EAAO,GACtC,CAEA,gBAAiB,CACb,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,cAAc,CAAE,GACpD,CAEQ,iBAAkB,CACtB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,GAC3BsJ,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,mBAAoB,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,cAAc,CAAE,IAAI,CAAC,gBAAgB,CACpG,CAEQ,oBAAoBtJ,CAAc,CAAEulB,CAAgB,CAAE,CAC1D,IAAMC,EAAWxlB,EAAM,MAAM,CAAC,AAACqZ,GAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAACA,IAC5DoM,EAAazlB,EAAM,MAAM,CAAC,AAACqZ,GAAM,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAACA,IACrE,IAAI,CAAC,qBAAqB,CAACmM,EAAU,IACrC,IAAI,CAAC,gBAAgB,CAACC,EAAYF,EACtC,CAEQ,iBAAiBvlB,CAAc,CAAEulB,CAAgB,CAAE,CACvDvlB,EAAM,OAAO,CAAC,AAACqZ,IACX,GAAIA,aAAa6E,EAAAA,EAAUA,CAAE,CACzB,IAAMC,EAAS,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC9E,EAClD8E,CAAAA,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CACrCA,EACAtb,EAAAA,EAAAA,CAAAA,YAAwB,CACxBL,EAAAA,EAAAA,CAAAA,KAAe,CAE3B,CACJ,GACA,IAAI,CAAC,cAAc,CAAC,IAAI,IAAIxC,GACxBulB,GAAS,IAAI,CAAC,eAAe,EACrC,CAEQ,sBAAsBvlB,CAAc,CAAEulB,CAAgB,CAAE,CAC5D,IAAK,IAAMxlB,KAAQC,EACf,GAAID,aAAgBme,EAAAA,EAAUA,CAAE,CAC5B,IAAIC,EAAS,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAACpe,EAChDoe,CAAAA,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,WAAW,CACxCA,EACAtb,EAAAA,EAAAA,CAAAA,YAAwB,CACxBL,EAAAA,EAAAA,CAAAA,KAAe,CAE3B,CAEJ,IAAI,CAAC,cAAc,CAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,AAAC6W,GAAM,CAACrZ,EAAM,QAAQ,CAACqZ,IACxE,IAAI,CAAC,gBAAgB,CAAGrZ,EACpBulB,GAAS,IAAI,CAAC,eAAe,EACrC,CACJ,E,gVCzIO,IAAMG,SAAN,MAAMA,iBAAiB3gB,EAAAA,EAAUA,C,cAC3B,WAA6B,AAC7B,OAAgB,AAChB,QAAiB,AACjB,UAAsB,AACtB,KAAuC,AACvC,UAAuE,AAE/D,sBAAwD,AAEzE,QAAgB,QAAU4gB,KAAqB,AAE/C,KAAI,MAAe,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CACA,IAAI,KAAKxhB,CAAY,CAAE,CACf,IAAI,CAAC,IAAI,GAAKA,IAClB,IAAI,CAAC,WAAW,CAAC,OAAQA,GACrB,IAAI,CAAC,SAAS,EAAE,KAAI,CAAC,SAAS,CAAC,IAAI,CAAGA,CAAG,EACjD,CAEQ,SAAuC,AAC/C,KACI,UAA4B,CAI5B,OAHI,AAAmB1D,KAAAA,IAAnB,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,IAE/B,IAAI,CAAC,SAAS,AACzB,CACA,IAAI,SAASpF,CAAsB,CAAE,CACjC,IAAI,CAAC,WAAW,CAACA,EACrB,CAEQ,YAAYA,CAAuB,CAAE,CACrC,IAAI,CAAC,SAAS,GAAKA,IACvB,IAAI,CAAC,SAAS,EAAE,sBAAsB,IAAI,CAAC,yBAAyB,EACpE,IAAI,CAAC,SAAS,CAAGA,GAAS,IAAIslB,EAAAA,EAAUA,CAAC,IAAI,CAAE,IAAI,CAAC,IAAI,EACxD,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,yBAAyB,EACnE,CAEQ,YAA+B,AACvC,KAAI,aAA2C,CAC3C,OAAO,IAAI,CAAC,YAAY,AAC5B,CACA,IAAI,YAAYtlB,CAAkC,CAAE,CAChD,IAAI,CAAC,WAAW,CAAC,cAAeA,EACpC,CAEA,YACa8Q,CAAyB,CAClChI,CAAY,CACHgF,EAAaF,EAAAA,EAAAA,CAAAA,QAAW,EAAE,CACrC,CACE,KAAK,QAJIkD,WAAW,CAAXA,EAAAA,IAAAA,CAEAhD,EAAE,CAAFA,EAAAA,IAAAA,CAlDJ,UAAU,CAAgB,EAAE,MAI5B,IAAI,CAAG,IAAI9K,EAAAA,EAAoBA,CAAAA,IAAAA,CAC/B,SAAS,CAAmC,IAAIA,EAAAA,EAAoBA,CAAAA,IAAAA,CAE5D,qBAAqB,CAAG,IAAI+B,IAAAA,IAAAA,CAwD5B,yBAAyB,CAAG,AAACnE,IACtCA,AAAS,SAATA,GACA,KAAI,CAAC,IAAI,CAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,AAAD,CAErC,OAiHiB,qBAAqB,CAAG,AAAC8B,IAClCA,EAAK,MAAM,GAAKC,EAAAA,EAAAA,CAAAA,GAAoB,CACpCwG,EAAAA,EAAAA,CAAAA,GAAe,CAAC,IAAI,CAAE,CAClB,KAAM,kBACN,UAAW,EACX,KAAM,IAAM,IAAI,CAAC,SAAS,CAAC,MAAM,IAAIzG,EAAK,KAAK,EAC/C,KAAM,IAAM,IAAI,CAAC,SAAS,CAAC,IAAI,IAAIA,EAAK,KAAK,CACjD,GACOA,EAAK,MAAM,GAAKC,EAAAA,EAAAA,CAAAA,MAAuB,EAC9CwG,EAAAA,EAAAA,CAAAA,GAAe,CAAC,IAAI,CAAE,CAClB,KAAM,kBACN,UAAW,EACX,KAAM,IAAM,IAAI,CAAC,SAAS,CAAC,IAAI,IAAIzG,EAAK,KAAK,EAC7C,KAAM,IAAM,IAAI,CAAC,SAAS,CAAC,MAAM,IAAIA,EAAK,KAAK,CACnD,EAER,EA/II,IAAI,CAAC,eAAe,CAAC,OAAQoG,GAC7B,IAAI,CAAC,OAAO,CAAG,IAAIZ,EAAAA,EAAOA,CAC1B,IAAI,CAAC,MAAM,CAAG4I,EAAY,aAAa,CAAC,MAAM,CAAC,IAAI,EACnD,IAAI,CAAC,SAAS,CAAG,IAAI4Y,UAAU,IAAI,EACnC,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,IAAI,CAAC,qBAAqB,EAC7D5Y,EAAY,SAAS,CAAC,GAAG,CAAC,IAAI,EAE9B9H,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,cAAc,EAAEF,EAAK,CAAC,CACvC,CAEiB,yBAIf,AAEF,eAAe,CACX,OAAO,IAAIwc,EAAAA,EAAUA,CAAC,IAAI,CAAE,IAAI,CAAC,IAAI,CACzC,CAEA,WAAwB,CAapB,MAZiB,CACb,SAAU,WACV,QAASgF,MACT,WAAY,CACR,GAAI,IAAI,CAAC,EAAE,CACX,KAAM,IAAI,CAAC,IAAI,CACf,WAAY,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,AAACrnB,GAAMoD,EAAAA,EAAAA,CAAAA,eAA0B,CAACpD,IAClE,MAAOwf,EAAAA,EAAAA,CAAAA,SAAwB,CAAC,IAAI,CAAC,QAAQ,EAC7C,UAAW,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,AAACxf,GAAMoD,EAAAA,EAAAA,CAAAA,eAA0B,CAACpD,IAChE,KAAM,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,AAACA,GAAMoD,EAAAA,EAAAA,CAAAA,eAA0B,CAACpD,GAC1D,CACJ,CAEJ,CAES,iBAAwB,CAC7B,KAAK,CAAC,kBACN,IAAI,CAAC,qBAAqB,CAAC,KAAK,GAChC,IAAI,CAAC,SAAS,EAAE,sBAAsB,IAAI,CAAC,yBAAyB,EACpE,IAAI,CAAC,SAAS,EAAE,UAChB,IAAI,CAAC,MAAM,CAAC,OAAO,GACnB,IAAI,CAAC,OAAO,CAAC,OAAO,GACpB,IAAI,CAAC,SAAS,CAAC,OAAO,GACtB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,AAACA,GAAMA,EAAE,OAAO,IACvC,IAAI,CAAC,SAAS,CAAC,KAAK,GACpB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,AAACA,GAAMA,EAAE,OAAO,IAClC,IAAI,CAAC,IAAI,CAAC,KAAK,GAEf,IAAI,CAAC,SAAS,CAAGmC,KAAAA,EACjB,IAAI,CAAC,YAAY,CAAGA,KAAAA,CACxB,CAEA,MAAM,MAAO,CACT,IAAMkG,EAAO,IAAI,CAAC,SAAS,EAC3B,OAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAACsG,EAAAA,EAAAA,CAAAA,MAAgB,CAAEA,EAAAA,EAAAA,CAAAA,aAAuB,CAAE,IAAI,CAAC,EAAE,CAAEtG,GACvF,IAAMif,EAAQ,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,SAC3C,OAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC3Y,EAAAA,EAAAA,CAAAA,MAAgB,CAAEA,EAAAA,EAAAA,CAAAA,WAAqB,CAAE,IAAI,CAAC,EAAE,CAAE,CACjF,GAAI,IAAI,CAAC,EAAE,CACX,KAAM,IAAI,CAAC,IAAI,CACf,KAAM4Y,KAAK,GAAG,GACdD,MAAAA,CACJ,EACJ,CAEA,MAAM,OAAQ,CACN9b,OAAO,OAAO,CAACuD,EAAAA,EAAAA,CAAAA,SAAc,CAAC,yBAA0B,IAAI,CAAC,IAAI,IACjE,MAAM,IAAI,CAAC,IAAI,GAGnB,IAAIyY,EAAQ,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,CAAC,AAACxnB,GAAMA,EAAE,QAAQ,GAAK,IAAI,EACpE,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,IAAIwnB,GACjC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,EAAE,CAAC,GACxD,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,EACtC,IAAI,CAAC,SAAS,CAAC,uBAAuB,CAAC,IAAI,CAAC,qBAAqB,EACjExc,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,iBAAkB,IAAI,EAEzCjF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAC3C,IAAI,CAAC,OAAO,EAChB,CAEA,aAAa,KAAK8H,CAAyB,CAAEhD,CAAU,CAAE,CACrD,IAAIxC,EAAQ,MAAMwF,EAAY,OAAO,CAAC,GAAG,CACrCc,EAAAA,EAAAA,CAAAA,MAAgB,CAChBA,EAAAA,EAAAA,CAAAA,aAAuB,CACvB9D,GAEJ,GAAIxC,AAASlG,KAAAA,IAATkG,EAAoB,YACpBtC,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,UAAU,EAAE8E,EAAG,SAAS,CAAC,EAG1C,IAAIvN,EAAW,MAAM,IAAI,CAAC,IAAI,CAACuQ,EAAaxF,GAI5C,OAHI/K,AAAa6E,KAAAA,IAAb7E,GACAyI,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,UAAU,EAAEzI,EAAS,IAAI,CAAC,OAAO,CAAC,EAE5CA,CACX,CAEA,aAAa,KAAKipB,CAAiB,CAAEle,CAAgB,CAAkC,CACnF,GAAKA,AAAyBgf,QAAzBhf,EAAa,OAAO,CAA2B,YAChDof,MACI,oGAIR,IAAInqB,EAAW,IAAI8pB,SAASb,EAAKle,EAAK,UAAU,CAAC,IAAO,CAAEA,EAAK,UAAU,CAAC,EAAK,CAC/E/K,CAAAA,EAAS,OAAO,CAAC,QAAQ,CAAG,GAC5BA,EAAS,SAAS,CAAC,IAAI,IAChB+K,EAAK,UAAU,CAAC,SAAY,CAAC,GAAG,CAAC,AAACrI,GACjCoD,EAAAA,EAAAA,CAAAA,iBAA4B,CAAC9F,EAAU0C,KAG/C1C,EAAS,IAAI,CAAC,IAAI,IACX+K,EAAK,UAAU,CAAC,IAAO,CAAC,GAAG,CAAC,AAACrI,GAAkBoD,EAAAA,EAAAA,CAAAA,iBAA4B,CAAC9F,EAAU0C,KAE7F1C,EAAS,UAAU,CAAC,IAAI,IACjB+K,EAAK,UAAU,CAAC,UAAa,CAAC,GAAG,CAAC,AAACrI,GAClCoD,EAAAA,EAAAA,CAAAA,iBAA4B,CAAC9F,EAAU0C,KAI/C,IAAM0nB,EAAW,MAAMlI,EAAAA,EAAAA,CAAAA,WAA0B,CAACliB,EAAU+K,EAAK,UAAU,CAAC,KAAQ,EAGpF,OAFA/K,EAAS,WAAW,CAACoqB,GACrBpqB,EAAS,OAAO,CAAC,QAAQ,CAAG,GACrBA,CACX,CAEiB,qBAgBf,AAEF,iBAAgBqqB,CAA8B,CAAE,CAC5C,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAACA,EACnC,CAEA,mBAAmBA,CAA8B,CAAE,CAC/C,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAACA,EACtC,CAEA,kBAAkBhiB,CAAqB,CAAE,CACrCO,EAAAA,EAAAA,CAAAA,GAAe,CAAC,IAAI,CAAE,IAAIR,EAAAA,EAA2BA,CAACC,IACtD,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,AAAC3F,GAAMA,EAAE,iBAAiB,CAAC2F,GAClE,CAEA,QAAQ,GAAGjE,CAAc,CAAQ,CAC5B,KAAI,CAAC,WAAW,EAAI,IAAI,CAAC,QAAO,EAAG,GAAG,IAAIA,EAC/C,CACJ,ECpPO,eAAekmB,YAAY/Z,CAAyB,CAAEnB,CAAwB,EACjF,IAAIpP,EAAWuQ,EAAY,UAAU,EAAE,UAAa,MAAMA,EAAY,WAAW,CAAC,YAClF7C,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CACd,gBACA,UACI,MAAM9E,EAAAA,EAAAA,CAAAA,YAAwB,CAAC5I,EAAU,eAAgB,UACrD,MAAMA,EAAS,WAAW,CAAC,YAAY,CAAC,MAAM,CAACA,EAAUoP,EAC7D,GACApP,EAAS,WAAW,CAAC,UAAU,EAAE,iBAAiB,YACtD,EACA,oBACAyR,EAAAA,EAAAA,CAAAA,SAAc,CAAC,uBAEvB,C,2BDsCwB,G,qCHpBjB,IAAM8Y,YAAN,MAAMA,YACA,YAA4B,AAC5B,cAA8B,AAC9B,aAA4B,AAC5B,SAAqB,AACrB,QAAkB,AAClB,WAAqB,AAErB,OAAQ,IAAI9nB,EAAAA,EAAoBA,AAAU,AAC1C,WAA4B,IAAI+B,GAAiB,AAE1D,iBAAuC,AAE/B,YAA+B,AACvC,KAAI,YAAgC,CAChC,OAAO,IAAI,CAAC,WAAW,AAC3B,CACA,IAAI,WAAW/E,CAAwB,CAAE,CACjC,IAAI,CAAC,WAAW,GAAKA,IACzB,IAAI,CAAC,WAAW,CAAGA,EACnBiO,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,oBAAqBjO,GAC5C,CAEA,YAAYsB,CAA0B,CAAE,CACpC,GAAIkoB,AAAQpkB,KAAAA,IAARokB,EACA,MAAM,AAAI5mB,MAAM,uCAEpB4mB,EAAM,IAAI,CACV,IAAI,CAAC,aAAa,CAAGloB,EAAO,aAAa,CACzC,IAAI,CAAC,YAAY,CAAGA,EAAO,YAAY,CACvC,IAAI,CAAC,QAAQ,CAAGA,EAAO,QAAQ,CAC/B,IAAI,CAAC,OAAO,CAAGA,EAAO,OAAO,CAC7B,IAAI,CAAC,YAAY,CAAGA,EAAO,YAAY,CACvC,IAAI,CAAC,UAAU,CAAGA,EAAO,UAAU,CAEnC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,AAAC2B,GAAMA,EAAE,QAAQ,CAAC,IAAI,GAC5C,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,AAACA,GAAMA,EAAE,KAAK,IAEpC,IAAI,CAAC,gBAAgB,EACzB,CAEQ,kBAAmB,CACvBwL,OAAO,cAAc,CAAG,IAAI,CAAC,kBAAkB,CAC/CA,OAAO,gBAAgB,CACnB,YACA,AAACsc,IACGA,EAAG,cAAc,EACrB,EACA,IAEJtc,OAAO,gBAAgB,CACnB,WACA,AAACsc,IACGA,EAAG,eAAe,GAClBA,EAAG,cAAc,GACjBA,EAAG,YAAY,CAAE,UAAU,CAAG,MAClC,EACA,IAEJtc,OAAO,gBAAgB,CACnB,OACA,AAACsc,IACGA,EAAG,eAAe,GAClBA,EAAG,cAAc,GACjB,IAAI,CAAC,WAAW,CAACA,EAAG,YAAY,EAAE,MACtC,EACA,GAER,CAEiB,mBAAqB,AAAC5c,IAC/B,IAAI,CAAC,UAAU,GAEfA,EAAM,cAAc,GAEpBA,EAAM,WAAW,CAAG,GAE5B,CAAE,AAEF,OAAM,YAAYwB,CAA2B,CAAE,CAC3C,GAAI,CAACA,GAASA,AAAiB,IAAjBA,EAAM,MAAM,CACtB,OAEJ,GAAM,CAAEqb,MAAAA,CAAK,CAAEC,QAAAA,CAAO,CAAE,CAAG,IAAI,CAAC,UAAU,CAACtb,GAC3C,IAAI,CAAC,wBAAwB,CAACqb,GAC9BH,YAAY,IAAI,CAAEI,EACtB,CAEQ,yBAAyBD,CAAa,CAAE,CAC5C/c,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CACd,gBACA,UACI,IAAK,IAAM4B,KAAQmb,EAAO,CACtB,IAAIE,EAAmBC,KAAK,KAAK,CAAC,MAAMtb,EAAK,IAAI,GACjD,OAAM,IAAI,CAAC,YAAY,CAACqb,GACxB,IAAI,CAAC,UAAU,EAAE,iBAAiB,YACtC,CACJ,EACA,oBACAlZ,EAAAA,EAAAA,CAAAA,SAAc,CAAC,oBAEvB,CAEQ,WAAWrC,CAAe,CAAE,CAChC,IAAMqb,EAAgB,EAAE,CAClBC,EAAkB,EAAE,CAC1B,IAAK,IAAMplB,KAAW8J,EACd9J,EAAQ,IAAI,CAAC,QAAQ,CAACgM,EAAAA,EAAuBA,EAC7CmZ,EAAM,IAAI,CAACnlB,GAEXolB,EAAQ,IAAI,CAACplB,GAGrB,MAAO,CAAEmlB,MAAAA,EAAOC,QAAAA,CAAQ,CAC5B,CAEA,MAAM,aAAand,CAAU,CAAkC,CAC3D,IAAMvN,EAAW,MAAM8pB,SAAS,IAAI,CAAC,IAAI,CAAEvc,GAE3C,OADA,MAAM,IAAI,CAAC,gBAAgB,CAACvN,GACrBA,CACX,CAEA,MAAM,YAAYuI,CAAY,CAAsB,CAChD,IAAMvI,EAAW,IAAI8pB,SAAS,IAAI,CAAEvhB,GAC9BsiB,EAAY,IAAI1K,EAAAA,EAAQA,CAACngB,EAAU,YAAa,UAChD8qB,EAAW,IAAI3K,EAAAA,EAAQA,CAACngB,EAAU,WAAY,SAGpD,OAFAA,EAAS,SAAS,CAAC,IAAI,CAAC6qB,EAAWC,GACnC,MAAM,IAAI,CAAC,gBAAgB,CAAC9qB,GACrBA,CACX,CAEA,MAAM,aAAa+K,CAAgB,CAAkC,CACjE,IAAM/K,EAAW,MAAM8pB,SAAS,IAAI,CAAC,IAAI,CAAE/e,GAE3C,OADA,MAAM,IAAI,CAAC,gBAAgB,CAAC/K,GACrBA,CACX,CAEA,MAAgB,iBAAiBA,CAA+B,CAAE,CAC9D,GAAIA,AAAa6E,KAAAA,IAAb7E,EAAwB,OAC5B,IAAM0lB,EAAO1lB,EAAS,MAAM,CAAC,UAAU,CAAC,KAAM8e,EAAAA,EAAAA,CAAAA,EAAQ,CACtD,KAAI,CAAC,UAAU,CAAG4G,CACtB,CACJ,E,mVKnKO,IAAMqF,QAAN,MAAMA,gBAAgBhH,EAAAA,EAAkBA,CAClC,SAAoB,CACzB,MAAO,UACX,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGvN,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IACI,OAAe,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CAEA,YAAY1W,CAAmB,CAAEmd,CAAY,CAAE3G,CAAU,CAAEC,CAAU,CAAEC,CAAU,CAAE,CAC/E,KAAK,CAAC1W,GACN,IAAI,CAAC,eAAe,CAAC,QAASmd,GAC9B,IAAI,CAAC,eAAe,CAAC,KAAM3G,GAC3B,IAAI,CAAC,eAAe,CAAC,KAAMC,GAC3B,IAAI,CAAC,eAAe,CAAC,KAAMC,EAC/B,CAEA,eAAgC,CAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,EAAE,CAAE,IAAI,CAAC,EAAE,CAAE,IAAI,CAAC,EAAE,CAC3F,CACJ,E,oXA3CwB,G,WACJ,CAAC,U,4DAQG,G,WACJ,CAAC,U,4DAQG,G,WACJ,CAAC,U,4DAQG,G,uEAjCJ,CAAC,CAAC,WAAY,QAAS,KAAM,KAAM,K,YCRhD,IAAMsU,WAAN,MAAMA,mBAAmBlG,EAAAA,EAAYA,CAC/B,SAAoB,CACzB,MAAO,aACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOmG,CAAW,CAAE,CACpB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOC,CAAc,CAAE,CACvB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IACI,QAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CAEA,YAAYlrB,CAAmB,CAAE+W,CAAW,CAAEkU,CAAW,CAAEC,CAAc,CAAE,CACvE,KAAK,CAAClrB,GACN,IAAI,CAAC,eAAe,CAAC,SAAU+W,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUkU,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUC,EACnC,CAEA,eAAwC,CACpC,IAAIrY,EAAS,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,MAAM,EAChG,GAAI,CAACA,EAAO,IAAI,EAAI,CAAC,IAAI,CAAC,MAAM,CAAE,OAAOA,EACzC,IAAIyU,EAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAACzU,EAAO,KAAK,CAAC,EACrE,OAAOyU,EAAK,IAAI,CAAGA,EAAK,KAAK,CAAC,MAAM,GAAKzU,CAC7C,CACJ,E,qXApCwB,G,WACJ,CAAC,iB,sEAQG,G,WACJ,CAAC,iB,sEAQG,G,iFAxBJ,CAAC,CAAC,WAAY,SAAU,SAAU,S,eCU/C,IAAMsY,SAAN,MAAMA,iBAAiBpH,EAAAA,EAAkBA,CACnC,SAAoB,CACzB,MAAO,WACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOkH,CAAW,CAAE,CACpB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOxU,CAAU,CAAE,CACnB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IACI,QAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CAEA,YAAY1W,CAAmB,CAAE+W,CAAW,CAAEkU,CAAW,CAAEC,CAAc,CAAExU,CAAU,CAAE,CACnF,KAAK,CAAC1W,GACN,IAAI,CAAC,eAAe,CAAC,SAAU+W,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUkU,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUC,GAC/B,IAAI,CAAC,eAAe,CAAC,KAAMxU,EAC/B,CAEA,eAAgC,CAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAC9C,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,MAAM,CACX,EACA,IAAI,CAAC,EAAE,CAEf,CACJ,E,uXAjDwB,G,WACJ,CAAC,iB,kEAQG,G,WACJ,CAAC,iB,kEAQG,G,WACJ,CAAC,U,8DAQG,G,2EAjCJ,CAAC,CAAC,WAAY,SAAU,SAAU,SAAU,K,aCCzD,IAAM0U,aAAN,MAAMA,qBAAqBrH,EAAAA,EAAkBA,CACvC,SAAoB,CACzB,MAAO,eACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOkH,CAAW,CAAE,CACpB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOxU,CAAU,CAAE,CACnB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IACI,QAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CAEA,YAAY1W,CAAmB,CAAE+W,CAAW,CAAEkU,CAAW,CAAEC,CAAc,CAAExU,CAAU,CAAE,CACnF,KAAK,CAAC1W,GACN,IAAI,CAAC,eAAe,CAAC,SAAU+W,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUkU,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUC,GAC/B,IAAI,CAAC,eAAe,CAAC,KAAMxU,EAC/B,CAEA,eAAgC,CAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,QAAQ,CAClD,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,EAAE,CAEf,CACJ,E,0XAhDwB,G,WACJ,CAAC,iB,0EAQG,G,WACJ,CAAC,iB,0EAQG,G,WACJ,CAAC,U,sEAQG,G,uFAjCJ,CAAC,CAAC,WAAY,SAAU,SAAU,SAAU,K,iBCRzD,IAAM2U,YAAN,MAAMA,oBAAoBvG,EAAAA,EAAYA,CAChC,SAAoB,CACzB,MAAO,cACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOmG,CAAW,CAAE,CACpB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,aAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,cAChC,CACA,IAAI,YAAYC,CAAc,CAAE,CAC5B,IAAI,CAAC,2BAA2B,CAAC,cAAeA,EACpD,CACA,IAEI,aAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,cAChC,CACA,IAAI,YAAYA,CAAc,CAAE,CAC5B,IAAI,CAAC,2BAA2B,CAAC,cAAeA,EACpD,CAEA,IACI,QAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CAEA,IACI,MAAY,CACZ,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CAEA,YACIlrB,CAAmB,CACnB+W,CAAW,CACXkU,CAAW,CACXjM,CAAS,CACTsM,CAAmB,CACnBC,CAAmB,CACrB,CACE,KAAK,CAACvrB,GACN,IAAI,CAAC,eAAe,CAAC,SAAU+W,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUkU,GAC/B,IAAI,CAAC,eAAe,CAAC,OAAQjM,GAC7B,IAAI,CAAC,eAAe,CAAC,cAAesM,GACpC,IAAI,CAAC,eAAe,CAAC,cAAeC,EACxC,CAEA,eAAwC,CACpC,IAAI1Y,EAAS,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO,CACvD,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,IAAI,CACT,IAAI,CAAC,WAAW,CAChB,IAAI,CAAC,WAAW,EAEpB,GAAI,CAACA,EAAO,IAAI,EAAI,CAAC,IAAI,CAAC,MAAM,CAAE,OAAOA,EACzC,IAAIyU,EAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAACzU,EAAO,KAAK,CAAC,EACrE,OAAOyU,EAAK,IAAI,CAAGA,EAAK,KAAK,CAAC,MAAM,GAAKzU,CAC7C,CACJ,E,sXAhEwB,G,WACJ,CAAC,iB,wEAQG,G,WACJ,CAAC,uB,6EAOG,G,WACJ,CAAC,uB,6EAQG,G,wEAKA,G,kFArCJ,CAAC,CAAC,WAAY,SAAU,SAAU,OAAQ,cAAe,c,gBCUtE,IAAM2Y,SAAN,MAAMA,iBAAiBzH,EAAAA,EAAkBA,CACnC,SAAoB,CACzB,MAAO,WACX,CAEA,IAEI,OAAQ,CACR,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CACA,IAAI,MAAM0H,CAAQ,CAAE,CAChB,IAAI,CAAC,2BAA2B,CAAC,QAASA,EAC9C,CAEA,IAEI,KAAM,CACN,OAAO,IAAI,CAAC,eAAe,CAAC,MAChC,CACA,IAAI,IAAIA,CAAQ,CAAE,CACd,IAAI,CAAC,2BAA2B,CAAC,MAAOA,EAC5C,CAEA,YAAYzrB,CAAmB,CAAEiT,CAAU,CAAEmB,CAAQ,CAAE,CACnD,KAAK,CAACpU,GACN,IAAI,CAAC,eAAe,CAAC,QAASiT,GAC9B,IAAI,CAAC,eAAe,CAAC,MAAOmB,EAChC,CAEA,eAAwC,CACpC,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,GAAG,CAC3E,CACJ,E,sXA3BwB,G,WACJ,CAAC,c,iEAQG,G,WACJ,CAAC,Y,wEAhBD,CAAC,CAAC,WAAY,QAAS,M,aCRpC,IAAMsX,YAAN,MAAMA,oBAAoB5G,EAAAA,EAAYA,CAChC,SAAoB,CACzB,MAAO,cACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOrlB,CAAY,CAAE,CACrB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,YAAYO,CAAmB,CAAEwX,CAAa,CAAE,CAC5C,KAAK,CAACxX,GACN,IAAI,CAAC,eAAe,CAAC,SAAUwX,EACnC,CAEA,eAAwC,CACpC,IAAI8P,EAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,SACrE,AAAI,AAACA,EAAK,IAAI,EAAK,IAAI,CAAC,MAAM,CACvBA,EAAK,KAAK,CAAC,MAAM,GADeA,CAE3C,CACJ,E,kCAnBwB,G,WACJ,CAAC,kB,oFAPD,CAAC,CAAC,WAAY,S,mXCE3B,IAAMqE,UAAN,MAAMA,kBAAkB5H,EAAAA,EAAkBA,CACpC,SAAoB,CACzB,MAAO,YACX,CAEA,IACI,SAAkB,CAClB,OAAO,IAAI,CAAC,eAAe,CAAC,UAChC,CACA,IAAI,QAAQtkB,CAAa,CAAE,CACvB,IAAI,CAAC,2BAA2B,CAAC,UAAWA,EAChD,CAEA,IAEI,QAAiB,CACjB,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOA,CAAa,CAAE,CACtB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,YAAYO,CAAmB,CAAEknB,CAAY,CAAE0E,CAAc,CAAE,CAC3D,KAAK,CAAC5rB,GACN,IAAI,CAAC,eAAe,CAAC,UAAWknB,GAChC,IAAI,CAAC,eAAe,CAAC,SAAU0E,EACnC,CAES,eAAgC,CAErC,IAAI3U,EAAMF,AADGsQ,EAAAA,CAAAA,CAAAA,MAAe,CAAC,IAAI,CAAC,OAAO,EACxB,QAAQ,CAAC,IAAI,CAAC,MAAM,EACrC,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAEpQ,EACtE,CACJ,E,uXA5BwB,G,qEAQA,G,WACJ,CAAC,iB,8EAfD,CAAC,CAAC,WAAY,UAAW,S,cCStC,IAAM4U,YAAN,MAAMA,oBAAoB9H,EAAAA,EAAkBA,CACtC,SAAoB,CACzB,MAAO,cACX,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGvN,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IACI,OAAe,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CAEA,YAAY1W,CAAmB,CAAEmd,CAAY,CAAE3G,CAAU,CAAEC,CAAU,CAAEC,CAAU,CAAE,CAC/E,KAAK,CAAC1W,GACN,IAAI,CAAC,eAAe,CAAC,QAASmd,GAC9B,IAAI,CAAC,eAAe,CAAC,KAAM3G,GAC3B,IAAI,CAAC,eAAe,CAAC,KAAMC,GAC3B,IAAI,CAAC,eAAe,CAAC,KAAMC,EAC/B,CAEA,eAAgC,CAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,EAAE,CAAE,IAAI,CAAC,EAAE,CAAE,IAAI,CAAC,EAAE,CAC/F,CACJ,E,sXA3CwB,G,WACJ,CAAC,U,oEAQG,G,WACJ,CAAC,U,oEAQG,G,WACJ,CAAC,U,oEAQG,G,mFAjCJ,CAAC,CAAC,WAAY,QAAS,KAAM,KAAM,K,gBCEhD,IAAMoV,SAAN,MAAMA,iBAAiBhH,EAAAA,EAAYA,CAC7B,SAAoB,CACzB,MAAO,WACX,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGtO,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IAEI,IAAK,CACL,OAAO,IAAI,CAAC,eAAe,CAAC,KAChC,CACA,IAAI,GAAGC,CAAU,CAAE,CACf,IAAI,CAAC,2BAA2B,CAAC,KAAMA,EAC3C,CAEA,IACI,OAAe,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CAEA,YAAYzW,CAAmB,CAAEmd,CAAY,CAAE3G,CAAU,CAAEC,CAAU,CAAE,CACnE,KAAK,CAACzW,GACN,IAAI,CAAC,eAAe,CAAC,QAASmd,GAC9B,IAAI,CAAC,eAAe,CAAC,KAAM3G,GAC3B,IAAI,CAAC,eAAe,CAAC,KAAMC,EAC/B,CAEA,eAAwC,CACpC,IAAIe,EAASsU,SAAS,MAAM,CAAC,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,EAAE,CAAE,IAAI,CAAC,EAAE,EACrDxE,EAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC9P,UAC1D,AAAI,AAAC8P,EAAK,IAAI,EAAK,IAAI,CAAC,MAAM,CACvBA,EAAK,KAAK,CAAC,MAAM,GADeA,CAE3C,CAEA,OAAO,OAAOnK,CAAY,CAAE3G,CAAU,CAAEC,CAAU,CAAS,CACvD,IAAIxD,EAAQkK,EAAM,MAAM,CACxB,MAAO,CACHlK,EACAA,EAAM,GAAG,CAACkK,EAAM,IAAI,CAAC,QAAQ,CAAC3G,IAC9BvD,EAAM,GAAG,CAACkK,EAAM,IAAI,CAAC,QAAQ,CAAC3G,IAAK,GAAG,CAAC2G,EAAM,IAAI,CAAC,QAAQ,CAAC1G,IAC3DxD,EAAM,GAAG,CAACkK,EAAM,IAAI,CAAC,QAAQ,CAAC1G,IAC9BxD,EACH,AACL,CACJ,E,sXA/CwB,G,WACJ,CAAC,W,8DAQG,G,WACJ,CAAC,W,8DAQG,G,0EAxBJ,CAAC,CAAC,WAAY,QAAS,KAAM,K,aCT1C,IAAM8Y,aAAN,MAAMA,qBAAqBhI,EAAAA,EAAkBA,CACvC,SAAoB,CACzB,MAAO,YACX,CAEA,IACI,SAAU,CACV,OAAO,IAAI,CAAC,eAAe,CAAC,UAChC,CACA,IAAI,QAAQtkB,CAAa,CAAE,CACvB,IAAI,CAAC,2BAA2B,CAAC,UAAWA,EAChD,CAEA,IACI,MAAO,CACP,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CACA,IAAI,KAAKA,CAAU,CAAE,CACjB,IAAI,CAAC,2BAA2B,CAAC,OAAQA,EAC7C,CAEA,IACI,OAAQ,CACR,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CACA,IAAI,MAAMA,CAAa,CAAE,CACrB,IAAI,CAAC,2BAA2B,CAAC,QAASA,EAC9C,CAEA,YAAYO,CAAmB,CAAEgsB,CAAe,CAAEC,CAAS,CAAEjV,CAAa,CAAE,CACxE,KAAK,CAAChX,GACN,IAAI,CAAC,eAAe,CAAC,UAAWgsB,GAChC,IAAI,CAAC,eAAe,CAAC,OAAQC,GAC7B,IAAI,CAAC,eAAe,CAAC,QAASjV,EAClC,CAES,eAAgC,CACrC,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAE,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,KAAK,CAC7F,CACJ,E,wXAlCwB,G,0EAQA,G,uEAQA,G,qFAtBJ,CAAC,CAAC,WAAY,UAAW,OAAQ,Q,iBCU9C,IAAMkV,WAAN,MAAMA,mBAAmBnI,EAAAA,EAAkBA,CACrC,SAAoB,CACzB,MAAO,aACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOkH,CAAW,CAAE,CACpB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOxrB,CAAa,CAAE,CACtB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,YAAYO,CAAmB,CAAEirB,CAAW,CAAEC,CAAc,CAAE,CAC1D,KAAK,CAAClrB,GACN,IAAI,CAAC,eAAe,CAAC,SAAUirB,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUC,EACnC,CAEA,eAAgC,CAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,MAAM,CACjF,CACJ,E,sXA3BwB,G,WACJ,CAAC,iB,sEAQG,G,WACJ,CAAC,iB,iFAhBD,CAAC,CAAC,WAAY,SAAU,S,eCErC,IAAMiB,YAAN,MAAMA,oBAAoBpI,EAAAA,EAAkBA,CACtC,SAAoB,CACzB,MAAO,YACX,CAEA,IACI,SAAU,CACV,OAAO,IAAI,CAAC,eAAe,CAAC,UAChC,CACA,IAAI,QAAQtkB,CAAa,CAAE,CACvB,IAAI,CAAC,2BAA2B,CAAC,UAAWA,EAChD,CAEA,IACI,MAAO,CACP,OAAO,IAAI,CAAC,eAAe,CAAC,OAChC,CACA,IAAI,KAAKA,CAAY,CAAE,CACnB,IAAI,CAAC,2BAA2B,CAAC,OAAQA,EAC7C,CAEA,YAAYO,CAAmB,CAAEgsB,CAAe,CAAE7mB,CAAmB,CAAE,CACnE,KAAK,CAACnF,GACN,IAAI,CAAC,eAAe,CAAC,UAAWgsB,GAChC,IAAI,CAAC,eAAe,CAAC,OAAQ,IAAI,CAAC,UAAU,CAAC7mB,GACjD,CAEQ,WAAWA,CAAmB,CAAE,CACpC,IAAImiB,EAAOniB,EAIX,OAHIA,EAAK,SAAS,GAAKyB,EAAAA,EAAAA,CAAAA,IAAc,EACjC0gB,CAAAA,EAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,CAACniB,EAAyB,EAAE,KAAK,AAAD,EAEhFmiB,CACX,CAES,eAAgC,CACrC,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAE,IAAI,CAAC,IAAI,CAC/E,CACJ,E,2XAjCwB,G,uEAQA,G,gFAdJ,CAAC,CAAC,WAAY,UAAW,O,gBCV7C,IAAIpU,EAAQ,EAML,IAAMkZ,YAAN,MAAMA,YACT,MAAM,QAAQnD,CAAiB,CAAiB,CAC5C,MAAMA,EAAI,WAAW,CAAC,CAAC,UAAU,EAAE/V,IAAQ,CAAC,CAChD,CACJ,E,2YAPI,IAAK,UACL,KAAM,U,iBCAH,IAAMmZ,aAAN,MAAMA,aACT,MAAM,QAAQpD,CAAiB,CAAiB,CAC5Cvb,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CACd,gBACA,UACI,IAAI0B,EAAQ,MAAMJ,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAc,MAAO,IACvC,GAAII,EAAM,IAAI,CAAE,CACZ,IAAIub,EAAmBC,KAAK,KAAK,CAACxb,EAAM,KAAK,CAAC,EAAE,CAAC,IAAI,EACjDpP,EAAW,MAAMipB,EAAI,YAAY,CAAC0B,GACtC3qB,GAAU,YAAY,YAAY,iBAAiB,YACvD,CACJ,EACA,oBACAyR,EAAAA,EAAAA,CAAAA,SAAc,CAAC,oBAEvB,CACJ,E,gZAnBI,IAAK,WACL,KAAM,W,kBCOH,IAAe6a,uBAAf,MAAeA,uBACR,KAAO,EAAG,AACV,KAAM,CAAE,AACR,SAAU,EAAG,AAEvB,OAAM,QAAQrD,CAAiB,CAAiB,CAC5C,IAAIjpB,EAAW,MAAMipB,EAAI,WAAW,CAAC,uBAE/BhW,EAAQsZ,YAAY,GAAG,GACvBC,EAAW,IAAI,CAAC,GAAG,CAAG,IAAI,CAAC,IAAI,CACrC,IAAK,IAAI9pB,EAAI,EAAGA,EAAI,IAAI,CAAC,OAAO,CAAEA,IAC9B,IAAK,IAAIwS,EAAI,EAAGA,EAAI,IAAI,CAAC,OAAO,CAAEA,IAC9B,IAAK,IAAIC,EAAI,EAAGA,EAAI,IAAI,CAAC,OAAO,CAAEA,IAAK,CACnC,IAAI4H,EAAWjZ,EAAAA,EAAAA,CAAAA,IAAAA,CAAAA,GACP,CAACA,EAAAA,EAAAA,CAAAA,KAAAA,CAAAA,QAAkB,CAACpB,EAAI8pB,IAC3B,GAAG,CAAC1oB,EAAAA,EAAAA,CAAAA,KAAAA,CAAAA,QAAkB,CAACoR,EAAIsX,IAC3B,GAAG,CAAC1oB,EAAAA,EAAAA,CAAAA,KAAAA,CAAAA,QAAkB,CAACqR,EAAIqX,IAChC,IAAI,CAAC,WAAW,CAACxsB,EAAUA,EAAS,SAAS,CAAC,EAAE,CAAC,GAAK+c,EAC1D,CAGR/c,EAAS,MAAM,CAAC,MAAM,GACtBmqB,MACI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,OAAO,CAAC,eAAe,EAAEoC,YAAY,GAAG,GAAKtZ,EAAM,GAAG,CAAC,CAE5G,CAGJ,EAMO,IAAMwZ,0BAAN,MAAMA,kCAAkCH,uBACnC,MAAQ,CAAE,AAClB,QAAgB,EAAE,AAAC,AAEA,aAAYtsB,CAAmB,CAAEogB,CAAkB,CAAErD,CAAa,CAAQ,CACzF,IAAII,EAAQ2B,EAAAA,EAAAA,CAAAA,EAAAA,CAAAA,WAAoB,CAAC/B,GAC7B3F,EAAMpX,EAAS,WAAW,CAAC,YAAY,CAAC,GAAG,CAC3Cmd,EACA,IAAI,CAAC,IAAI,CAAG1P,KAAK,MAAM,GACvB,IAAI,CAAC,IAAI,CAAGA,KAAK,MAAM,GACvB,IAAI,CAAC,IAAI,CAAGA,KAAK,MAAM,IACzB,KAAK,CACHtJ,EAAO,IAAI6f,EAAAA,EAAiBA,CAAChkB,EAAU,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC,CAAEoX,EAAKgJ,EAAS,EAAE,EAClFpgB,EAAS,OAAO,CAACmE,EACrB,CACJ,E,6ZAlBI,IAAK,kBACL,KAAM,E,+BCrCH,IAAMuoB,aAAN,MAAMA,aACT,MAAM,QAAQzD,CAAiB,CAAiB,CACvCA,EAAI,UAAU,EAAE,UACrBvb,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CACd,gBACA,UACI,MAAMub,EAAI,UAAU,EAAE,SAAU,OAChCvb,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,uBACpC,EACA,oBACA+D,EAAAA,EAAAA,CAAAA,SAAc,CAAC,oBAEvB,CACJ,E,uYAhBI,IAAK,WACL,KAAM,W,kBCUH,IAAMkb,mBAAN,MAAMA,mBACT,MAAM,QAAQ1D,CAAiB,CAAiB,CACvCA,EAAI,UAAU,EAAE,UACrBvb,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CACd,gBACA,UACI,MAAM,IAAImB,QAAQ,CAACrG,EAAGkU,KAClBpM,WAAW9H,EAAG,IAClB,GACA,IAAIyU,EAAIgM,EAAI,UAAU,EAAE,SAAU,YAClCvb,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,qBAChCS,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAS,CAACyc,KAAK,SAAS,CAAC3N,GAAG,CAAE,CAAC,EAAEgM,EAAI,UAAU,EAAE,SAAU,KAAK,EAAE3X,EAAAA,EAAuBA,CAAC,CAAC,CAC/F,EACA,oBACAG,EAAAA,EAAAA,CAAAA,SAAc,CAAC,0BAEvB,CACJ,E,uZApBI,IAAK,iBACL,KAAM,e,wBCLH,IAAMmb,8BAAN,MAAMA,8BACT,MAAM,QAAQ3D,CAAiB,CAAiB,CAC5C9X,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,gBAAgC,CAAG,CAACA,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,gBAAgC,AACxE,CACJ,E,4EARI,IAAK,6BACL,OAAQ,IAAIzL,EAAAA,EAAOA,CAACyL,EAAAA,EAAAA,CAAAA,QAAe,CAAE,oBACrC,KAAM,mB,4YCEH,IAAM0b,YAAN,MAAMA,YACT,MAAM,QAAQ5D,CAAiB,CAAiB,CAC5Cvb,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,aAAc,uBAAwB,IAAI,CAAC,EAAE,GACpE,CAEQ,IAAK,CACT,MAAOjN,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACHI,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAM,CACF,YAAa,aACb,MAAO,CACH,SAAU,OACV,QAAS,QACT,UAAW,SACX,aAAc,MAClB,CACJ,GACAO,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAI,CACA,MAAO,IACP,IAAK,0BACL,MAAO,CACH,aAAc,MAClB,CACJ,GAER,CACJ,E,sYA5BI,IAAK,eACL,KAAM,a,iBCFH,IAAM0rB,YAAN,MAAMA,oBAAoB/I,EAAAA,EAAkBA,CACtC,SAAoB,CACzB,MAAO,aACX,CAEA,IACI,cAAuB,CACvB,OAAO,IAAI,CAAC,eAAe,CAAC,eAChC,CAEA,YAAY/jB,CAAmB,CAAEiV,CAAa,CAAE,CAC5C,KAAK,CAACjV,GACN,IAAI,CAAC,eAAe,CAAC,eAAgBiV,EACzC,CAES,eAAgC,CACrC,OAAOvV,EAAAA,EAAAA,CAAAA,EAAS,CAAC,IAAI,CAAC,YAAY,CACtC,CACJ,E,kCAbwB,G,0FANJ,CAAC,CAAC,WAAY,e,gBxBF3B,IAAKwpB,G,CAAAA,E,4GAAAA,E,EAUKA,EAAAA,GAAAA,CAAAA,EAASA,CAAAA,IACN6D,QAAQ,CAAjB,SAAkBC,CAAa,CAAEC,CAAa,SACjD,AAAW,IAAPA,GACID,AAAAA,CAAAA,EAAKC,CAAC,IAAOA,CACzB,EAMC,EACetqB,IAAI,CAAb,SAAclD,CAAa,EAM9B,MAAOytB,AALuC,EAC1C,EAAG,EACH,EAAG,EACH,EAAG,CACP,EACc,CAACztB,EAAM,EAAI,CAC7B,EyBzBG,IAAM0tB,SAAN,MAAMA,S,eACD,WAA6B,AAErC,aACajZ,CAAU,CACV+L,CAAc,CACzB,C,KAFW/L,KAAK,CAALA,E,KACA+L,SAAS,CAATA,CACV,CAEH,KAAKlV,CAAsB,CAA0B,CACjD,IAAMsL,EAAQtL,EAAK,IAAI,CAAC,EAAE,GAAG,KAAK,CAACA,EAAK,IAAI,CAAC,SAAS,IAAI,SAAS,GAC7DgM,EAASV,GAAO,MAAM,IAAI,CAAC,SAAS,EAAE,YAC5C,GAAI,CAACU,EAAQ,OAEb,IAAMoG,EAAQ,IAAI2B,EAAAA,EAAKA,CAAC,IAAI,CAAC,KAAK,CAAE/H,EAAQV,GACtC6I,EAAMnU,EAAK,IAAI,CAAC,KAAK,CAACA,EAAK,EAAE,CAAEA,EAAK,EAAE,EACtC+c,EAAY3K,EAAM,SAAS,CAAC+B,EAAK,IACvC,GAAI,CAAC4I,EAAW,OAGhB,IAAMhR,EAAMyG,AADGuK,EAAU,GAAG,CAAC,IAAI,CAAC,KAAK,EACpB,GAAG,CAAC,IAAI,CAAC,SAAS,EAC/B5T,EAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC4C,IAGrD,OAFA,IAAI,CAAC,YAAY,CAAC/L,EAAK,IAAI,CAAE+L,GAEtB,CACH,KAAM/L,EAAK,IAAI,CACfmJ,MAAAA,EACA,SAAU4C,EACV,OAAQ,EAAE,AACd,CACJ,CAEQ,aAAa4O,CAAW,CAAE5O,CAAW,CAAE,CAC3C,IAAMsW,EAAO3f,AAAgB,KAAhBA,KAAK,GAAG,CAACqJ,GAAkB,KAAO,KAAOA,EAChDuW,EAAW5mB,EAAAA,EAAAA,CAAAA,IAAiB,CAC9B,IAAI,CAAC,KAAK,CACV,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC2mB,IACvClc,EAAAA,EAAAA,CAAAA,kBAA+B,CAC/B3K,EAAAA,EAAAA,CAAAA,IAAa,EAEXgH,EAAKmY,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC2H,EACpD,KAAI,CAAC,UAAU,CAAG,CAAC3H,EAAMnY,EAAG,AAChC,CAEA,qBAA4B,CACxB,IAAI,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,SAAS,OAAO,QAAQ,WAAW,IAAI,CAAC,UAAU,CAAC,EAAE,CAC9E,CAEA,OAAc,CACV,IAAI,CAAC,mBAAmB,EAC5B,CACJ,EClDO,IAAe+f,SAAf,MAAeA,S,cACR,aAA+C,AAC/C,mBAA2C,AAErD,aAAqBC,CAA0B,CAAE,C,KAA5BA,cAAc,CAAdA,E,KAHX,YAAY,CAAyB,IAAIrrB,I,KACzC,kBAAkB,CAAsB,EAAE,AAEF,CAIlD,qBAA4B,CACxB,IAAI,CAAC,eAAe,GACpB,IAAI,CAAC,WAAW,EACpB,CAEA,OAAc,CACV,IAAI,CAAC,mBAAmB,EAC5B,CAEU,iBAAwB,CAC9B,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAACsrB,EAAK9H,KAC5B8H,EAAI,OAAO,CAAC,AAACjgB,GAAOmY,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAACnY,GAChE,GACA,IAAI,CAAC,YAAY,CAAC,KAAK,EAC3B,CAEU,YAAYmY,CAAW,CAAE+H,CAAc,CAAQ,CACrD,IAAID,EAAM,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC9H,GAC3B8H,IACDA,EAAM,EAAE,CACR,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC9H,EAAM8H,IAEhCA,EAAI,IAAI,CAACC,EACb,CAEU,UAAU5J,CAAyB,CAAQ,CACjDA,EAAO,OAAO,CAAC,AAAC5O,IAEZyY,AADoBzY,EAAM,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CACpD,QAAQ,CAChBA,EAAM,KAAK,CACXhO,EAAAA,EAAAA,CAAAA,aAAyB,CACzBgO,EAAM,KAAK,CAAC,SAAS,IAClBA,EAAM,OAAO,CAExB,GACA,IAAI,CAAC,kBAAkB,CAAC,IAAI,IAAI4O,EACpC,CAEU,aAAoB,CAC1B,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,AAAC5O,IAE7ByY,AADoBzY,EAAM,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CACpD,WAAW,CACnBA,EAAM,KAAK,CACXhO,EAAAA,EAAAA,CAAAA,aAAyB,CACzBgO,EAAM,KAAK,CAAC,SAAS,IAClBA,EAAM,OAAO,CAExB,GACA,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAG,CACrC,CAEU,kBAAkBf,CAAU,CAAsB,CACxD,OAAO,IAAI,CAAC,cAAc,CAAG,IAAI,CAAC,cAAc,GAAG,UAAU,CAACA,GAASrP,KAAAA,CAC3E,CACJ,EC9DO,IAAM8oB,qBAAN,MAAMA,qB,SACQ,cAA8D,AAE/E,aAAoBC,CAAyB,CAAE,C,KAA3BA,SAAS,CAATA,E,KAFH,aAAa,CAAuC,IAAI1rB,GAEzB,CAEhD,iBAAiBwjB,CAAW,CAAEzQ,CAAsB,CAAgB,CAChE,GAAI,IAAI,CAAC,aAAa,CAAC,GAAG,CAACA,GACvB,OAAO,IAAI,CAAC,aAAa,CAAC,GAAG,CAACA,GAGlC,IAAM4Y,EAAsB,EAAE,CAK9B,OAJI5Y,EAAM,KAAK,CAAC,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,EACxC,IAAI,CAAC,oBAAoB,CAAC8e,EAAMzQ,EAAO4Y,GAE3C,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC5Y,EAAO4Y,GACvBA,CACX,CAEQ,qBAAqBnI,CAAW,CAAEzQ,CAAsB,CAAE4Y,CAAmB,CAAE,CACnF,IAAMlb,EAASsC,EAAM,KAAK,CAAW,KAAK,CACpChC,EAAQN,EAAM,KAAK,CAACA,EAAM,cAAc,IACxCyB,EAAMzB,EAAM,KAAK,CAACA,EAAM,aAAa,IAErCmb,SAAW,CAAC5Z,EAAY6Z,IAC1BF,EAAM,IAAI,CAAC,CACPnI,KAAAA,EACA,MAAOzQ,EAAM,SAAS,CAAC,OAAO,CAACf,GAC/B6Z,KAAAA,EACA,OAAQ,CAAC9Y,EAAM,AACnB,GAEA/O,EAAAA,EAAAA,CAAAA,GAAkB,CAAC,IAAI,CAAC,SAAS,CAAEA,EAAAA,EAAAA,CAAAA,QAAuB,IAC1D4nB,SAAS7a,EAAOxB,EAAAA,EAAAA,CAAAA,SAAc,CAAC,aAC/Bqc,SAAS1Z,EAAK3C,EAAAA,EAAAA,CAAAA,SAAc,CAAC,cAE7BvL,EAAAA,EAAAA,CAAAA,GAAkB,CAAC,IAAI,CAAC,SAAS,CAAEA,EAAAA,EAAAA,CAAAA,QAAuB,GAE1D4nB,SADYnb,EAAM,KAAK,CAAEA,AAAAA,CAAAA,EAAM,cAAc,GAAKA,EAAM,aAAa,EAAC,EAAK,IAC7DlB,EAAAA,EAAAA,CAAAA,SAAc,CAAC,YAErC,CAEA,OAAc,CACV,IAAI,CAAC,aAAa,CAAC,KAAK,EAC5B,CAEA,eAAeL,CAAwB,CAAQ,CAC3C,IAAI,CAAC,SAAS,CAAGA,EACjB,IAAI,CAAC,KAAK,EACd,CACJ,EC1BO,IAAM4c,WAAN,MAAMA,mBAAmBV,S,SACX,iBAAuC,AACvC,mBAA8C,AAC9C,gBAAyD,AAClE,cAAoC,AACpC,YAAuC,AAE/C,aACYM,CAAyB,CACjCL,CAA0B,CAC5B,CACE,KAAK,CAACA,GAAAA,IAAAA,CAHEK,SAAS,CAATA,EAAAA,IAAAA,CAoBH,YAAY,CAAG,CAAC5tB,EAAqBiuB,KACtCA,GAAQ,OAAO,SAAW,GAAK,IAAI,CAAC,aAAa,GACjD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAE,IAAI,CAAC,aAAa,CAAC,EAAE,EAC7D,IAAI,CAAC,aAAa,CAAGppB,KAAAA,EAE7B,OAEiB,iBAAiB,CAAG,AAACQ,IAC9BA,CAAAA,AAAa,aAAbA,GAA2BA,AAAa,eAAbA,CAAwB,IACnD,IAAI,CAAC,SAAS,CAAG8L,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,QAAwB,CACzC,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,EACnD,IAAI,CAAC,kBAAkB,CAAC,KAAK,GAErC,EA7BI,IAAI,CAAC,gBAAgB,CAAG,IAAIwc,qBAAqBC,GACjD,IAAI,CAAC,kBAAkB,CAAG,IAAI1rB,IAC9B,IAAI,CAAC,eAAe,CAAG,IAAIA,IAC3BiP,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,iBAAiC,CAAC,IAAI,CAAC,iBAAiB,CAC5D,CAES,OAAQ,CACb,KAAK,CAAC,QACN,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,AAAC4c,IAC1BA,EAAK,QAAQ,CAAC,OAAO,CAAC,AAACrrB,GAAMqrB,EAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAACrrB,GAC9E,GACA,IAAI,CAAC,UAAU,GACf,IAAI,CAAC,gBAAgB,CAAC,KAAK,GAC3ByO,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,qBAAqC,CAAC,IAAI,CAAC,iBAAiB,CAChE,CAES,YAKP,AAEe,kBAMf,AAEO,sBAA4B,CACjC,KAAK,CAAC,sBACN,IAAI,CAAC,UAAU,EACnB,CAEQ,YAAa,CACQtM,KAAAA,IAArB,IAAI,CAAC,WAAW,GAChB,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,EAClD,IAAI,CAAC,WAAW,CAAGA,KAAAA,EAE3B,CAEA,KAAKkG,CAAsB,CAA0B,KAG7CmjB,EAFJ,GAAK/c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,UAA0B,CAY/B,OATIpG,EAAK,MAAM,CAAC,MAAM,CAAG,GACrB,IAAI,CAAC,kBAAkB,CAACA,EAAK,IAAI,CAAEA,EAAK,MAAM,CAAC,EAAE,EACjDmjB,EAAO,IAAI,CAAC,WAAW,CAACnjB,EAAK,IAAI,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,CAAEA,EAAK,MAAM,GAEhEmjB,EAAO,IAAI,CAAC,cAAc,CAACnjB,EAAK,IAAI,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,EAEtD,IAAI,CAAC,cAAc,EAAImjB,GAAM,OAC7BA,CAAAA,EAAK,QAAQ,CAAG,IAAI,CAAC,cAAc,GAAG,UAAU,CAACA,EAAK,KAAK,GAExDA,CACX,CAEQ,YAAYxI,CAAW,CAAEhjB,CAAS,CAAEwS,CAAS,CAAE2O,CAAyB,CAAE,CAC9E,IAAMsK,EAAgB,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAACzI,EAAM7B,CAAM,CAAC,EAAE,EAGtEuK,EAAU,IAAID,KAFG,IAAI,CAAC,iBAAiB,CAACzI,EAAM7B,CAAM,CAAC,EAAE,KACvC,IAAI,CAAC,gBAAgB,CAAC6B,EAAM7B,CAAM,CAAC,EAAE,CAAEA,GACU,CAAC,IAAI,CAAC,CAAC7iB,EAAG+T,IAC7E,IAAI,CAAC,SAAS,CAAC2Q,EAAMhjB,EAAGwS,EAAGlU,EAAG+T,IAGlC,GAAIqZ,AAAmB,IAAnBA,EAAQ,MAAM,EAGlB,GAAIhB,AADStH,EAAAA,EAAAA,CAAAA,cAAoB,CAACJ,EAAMhjB,EAAGwS,EAAGkZ,CAAO,CAAC,EAAE,CAAC,KAAK,EACnDjd,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,YAA4B,CAEnC,OADA,IAAI,CAAC,SAAS,CAACuU,EAAM0I,CAAO,CAAC,EAAE,CAAC,MAAM,EAC/BA,CAAO,CAAC,EAAE,AAEjB,KAAI,CAAC,aAAa,CAAG,CAAC1I,EAAM0I,CAAO,CAAC,EAAE,CAAC,CAG/C,CAEQ,YAAY1I,CAAW,CAAEzQ,CAAiB,CAAE,CAChD,IAAI,CAAC,SAAS,CAACyQ,EAAMzQ,EAAM,MAAM,EACjC,IAAIlK,EAAOkJ,EAAAA,EAAAA,CAAAA,IAAmB,CAC1BgB,EAAM,KAAK,CACX/D,EAAAA,EAAAA,CAAAA,cAA2B,CAC3BA,EAAAA,EAAAA,CAAAA,eAA4B,CAEhC,KAAI,CAAC,WAAW,CAAG,CAACwU,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAEA,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC3a,GAAM,AACrG,CAEQ,eAAe2a,CAAW,CAAEhjB,CAAS,CAAEwS,CAAS,CAA0B,CAC9E,GAAM,CAAEsS,YAAAA,CAAW,CAAE0G,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,uBAAuB,CAACxI,EAAMhjB,EAAGwS,GACpE,GAAIsS,EAAcrW,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,YAA4B,CAE1C,OADA,IAAI,CAAC,SAAS,CAACuU,EAAMwI,EAAM,MAAM,EAC1BA,CAGf,CAEQ,wBACJxI,CAAW,CACXhjB,CAAS,CACTwS,CAAS,CACiC,CAE1C,IADIgZ,EACA1G,EAAcnkB,OAAO,SAAS,CAWlC,OATA,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,AAAC0qB,IAC1BA,EAAK,KAAK,CAAC,OAAO,CAAC,AAAC9Q,IAChB,IAAMmQ,EAAOtH,EAAAA,EAAAA,CAAAA,cAAoB,CAACJ,EAAMhjB,EAAGwS,EAAG+H,EAAE,KAAK,EACjDmQ,EAAO5F,IACPA,EAAc4F,EACdc,EAAOjR,EAEf,EACJ,GACO,CAAEuK,YAAAA,EAAa0G,KAAAA,CAAK,CAC/B,CAEQ,mBAAmBxI,CAAW,CAAEzQ,CAAsB,CAAE,CAC5D,GAAIA,EAAM,KAAK,CAAC,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAAE,CAC1C,GAAI,IAAI,CAAC,eAAe,CAAC,GAAG,CAACqO,GAAQ,OAErC,IAAIoZ,EAAa1b,AADJsC,EAAM,KAAK,CAAW,KAAK,CACjB,UAAU,AAC7B5O,CAAAA,EAAAA,EAAAA,CAAAA,QAAe,CAACgoB,IAChB,IAAI,CAAC,gBAAgB,CAACA,EAAY3I,EAAMzQ,EAEhD,CACJ,CAEQ,iBAAiBtC,CAAc,CAAE+S,CAAW,CAAEzQ,CAAsB,CAAE,CAC1E,IAAMgW,EAAShW,EAAM,SAAS,CAAC,OAAO,CAACtC,EAAM,MAAM,EAC/C2b,EAAYra,EAAAA,EAAAA,CAAAA,IAAmB,CAC/BgX,EACA/Z,EAAAA,EAAAA,CAAAA,cAA2B,CAC3BA,EAAAA,EAAAA,CAAAA,eAA4B,EAE5B3D,EAAKmY,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC4I,GAClD,IAAI,CAAC,eAAe,CAAC,GAAG,CAACrZ,EAAO,CAC5ByQ,KAAAA,EACA,MAAO,CACH,CACIA,KAAAA,EACA,MAAOuF,EACP,KAAMxZ,EAAAA,EAAAA,CAAAA,SAAc,CAAC,eACrB,OAAQ,CAACwD,EAAM,AACnB,EACH,CACD,SAAU,CAAC1H,EAAG,AAClB,EACJ,CAEQ,UAAUmY,CAAW,CAAE7B,CAAyB,CAAE,CACtD,IAAI,CAAC,SAAS,CAACA,EACnB,CAEQ,UAAU6B,CAAW,CAAEhjB,CAAS,CAAEwS,CAAS,CAAElU,CAAa,CAAE+T,CAAa,CAAU,CACvF,OAAO+Q,EAAAA,EAAAA,CAAAA,cAAoB,CAACJ,EAAMhjB,EAAGwS,EAAGlU,EAAE,KAAK,EAAK8kB,EAAAA,EAAAA,CAAAA,cAAoB,CAACJ,EAAMhjB,EAAGwS,EAAGH,EAAE,KAAK,CAChG,CAEQ,kBAAkB2Q,CAAW,CAAEzQ,CAAsB,CAAgB,CACzE,IAAI9R,EAAuB,EAAE,CAC7B,GACI,CAAC+C,EAAAA,EAAAA,CAAAA,GAAkB,CAAC,IAAI,CAAC,SAAS,CAAEA,EAAAA,EAAAA,CAAAA,aAA4B,GAChE,AAAwBrB,KAAAA,IAAxB,IAAI,CAAC,cAAc,CAEnB,OAAO1B,EAGX,IAAIwP,EAASsC,EAAM,KAAK,CAAW,KAAK,CAClCqP,EAAYrP,EAAM,SAAS,CAC7Bf,EAAQvB,EAAM,OAAO,CAAC2R,EAAU,MAAM,GAAI,OAAO,CAAC,IAAI,CAAC,cAAc,KAAK,EAAE,CAAC,UACnEzf,KAAAA,IAAVqP,GACJ/Q,EAAO,IAAI,CAAC,CACRuiB,KAAAA,EACA,MAAOpB,EAAU,OAAO,CAACpQ,GACzB,KAAMzC,EAAAA,EAAAA,CAAAA,SAAc,CAAC,sBACrB,OAAQ,CAACwD,EAAM,AACnB,GANgC9R,CASpC,CAEQ,iBAAiBuiB,CAAW,CAAE6I,CAAwB,CAAE1K,CAAyB,CAAE,CACvF,IAAI1gB,EAAS,EAAIX,OAEb,CAAC0D,EAAAA,EAAAA,CAAAA,GAAkB,CAAC,IAAI,CAAC,SAAS,CAAEA,EAAAA,EAAAA,CAAAA,YAA2B,GAC/DqoB,EAAQ,KAAK,CAAC,SAAS,GAAK3nB,EAAAA,EAAAA,CAAAA,IAAc,AAAdA,GAIhCid,EAAO,OAAO,CAAC,AAACnhB,IACZ,GAAIA,IAAM6rB,GAAW7rB,EAAE,KAAK,CAAC,SAAS,GAAKkE,EAAAA,EAAAA,CAAAA,IAAc,CAAE,OAC3D,IAAItG,EAAM,IAAI,CAAC,kBAAkB,CAACiuB,EAAS7rB,GACvCkR,EAAM,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAACtT,EAC1BuE,MAAAA,IAAR+O,IACAA,EAAM,IAAI,CAAC,iBAAiB,CAAC8R,EAAM6I,EAAS7rB,GAC5C,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAACpC,EAAKsT,IAErCzQ,EAAO,IAAI,IAAIyQ,EACnB,GAXWzQ,CAaf,CAEQ,mBAAmBqrB,CAAmB,CAAEC,CAAmB,CAAE,CACjE,OAAOD,EAAG,KAAK,CAAC,EAAE,CAAGC,EAAG,KAAK,CAAC,EAAE,CAAG,CAAC,EAAED,EAAG,KAAK,CAAC,EAAE,CAAC,CAAC,EAAEC,EAAG,KAAK,CAAC,EAAE,CAAC,CAAC,CAAG,CAAC,EAAEA,EAAG,KAAK,CAAC,EAAE,CAAC,CAAC,EAAED,EAAG,KAAK,CAAC,EAAE,CAAC,CAAC,AACxG,CAEQ,kBAAkB9I,CAAW,CAAE8I,CAAmB,CAAEC,CAAmB,CAAgB,CAC3F,IAAMC,EAAKF,EAAG,KAAK,CAAC,cAAc,CAACA,EAAG,SAAS,EACzCG,EAAKF,EAAG,KAAK,CAAC,cAAc,CAACA,EAAG,SAAS,EAC3CG,EAAgBF,EAAG,SAAS,CAACC,GAGjC,OAFAD,EAAG,OAAO,GACVC,EAAG,OAAO,GACHC,EAAc,GAAG,CAAC,AAAC1a,GACf,EACHwR,KAAAA,EACA,MAAOxR,EAAM,KAAK,CAClB,KAAMzC,EAAAA,EAAAA,CAAAA,SAAc,CAAC,qBACrB,OAAQ,CAAC+c,EAAIC,EAAG,AACpB,GAER,CACJ,EChQO,IAAeI,cAAf,MAAeA,c,QAClB,sBAA4B,CAAC,CAC7B,OAAc,CAAC,CAGf,YAAqBC,CAAoB,CAAE,C,KAAtBA,QAAQ,CAARA,CAAuB,CAElC,YAAY3R,CAAY,CAAEpS,CAAsB,CAA0B,CAChFoS,EAAQ0L,EAAAA,EAAAA,CAAAA,WAAqB,CAAC9d,EAAK,IAAI,CAAEoS,GACzC,IAAM+B,EAAMnU,EAAK,IAAI,CAAC,KAAK,CAACA,EAAK,EAAE,CAAEA,EAAK,EAAE,EACtCmJ,EAAQiJ,EAAM,SAAS,CAAC+B,GAC9B,GAAI,CAAChL,EAAO,OAEZ,IAAMsY,EAAW,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,QAAQ,GAAG,UAAU,CAACtY,GAASrP,KAAAA,EAErE,MAAO,CACH,KAAMkG,EAAK,IAAI,CACfmJ,MAAAA,EACAsY,SAAAA,EACA,OAAQ,EAAE,AACd,CACJ,CACJ,EAEO,IAAMuC,cAAN,MAAMA,sBAAsBF,cAC/B,KAAK9jB,CAAsB,CAA0B,CACjD,OAAO,IAAI,CAAC,WAAW,CAACA,EAAK,IAAI,CAAC,SAAS,CAAEA,EACjD,CACJ,EAEO,IAAMikB,UAAN,MAAMA,kBAAkBH,c,KAC3B,aACa1R,CAA4B,CACrC2R,CAAoB,CACtB,CACE,KAAK,CAACA,GAAAA,IAAAA,CAHG3R,KAAK,CAALA,CAIb,CAEA,KAAKpS,CAAsB,CAA0B,CACjD,IAAImJ,EAAQnJ,EAAK,IAAI,CAAC,aAAa,CAACA,EAAK,EAAE,CAAEA,EAAK,EAAE,EAC9CoS,EAAQ,IAAI,CAAC,KAAK,CAACjJ,GACnB/Q,EAAS,IAAI,CAAC,WAAW,CAACga,EAAOpS,GAIvC,OAHI5H,GACAA,CAAAA,EAAO,KAAK,CAAGga,CAAI,EAEhBha,CACX,CACJ,EC/CO,IAAM8rB,iBAAN,MAAMA,iB,SACT,aAAqBC,CAA+B,CAAE,C,KAAjCA,SAAS,CAATA,CAAkC,CAEvD,KAAKnkB,CAAsB,CAA0B,CACjD,IAAMmU,EAAMnU,EAAK,IAAI,CAAC,KAAK,CAACA,EAAK,EAAE,CAAEA,EAAK,EAAE,EAEtCwc,EAAU5U,AADF,IAAI,CAAC,SAAS,CAAC,KAAK,CACZ,cAAc,CAACuM,GACrC,GAAKqI,EACL,MAAO,CACH,KAAMxc,EAAK,IAAI,CACf,MAAOwc,EAAQ,EAAE,CACjB,OAAQ,EAAE,AACd,CACJ,CAEA,qBAA4B,CAAC,CAC7B,OAAc,CAAC,CACnB,ECnBO,IAAM4H,KAAN,MAAMA,aAAanP,EAAAA,EAAGA,C,IACzB,aACIf,CAAa,CACbgB,CAAc,CACL1X,CAAY,CACvB,CACE,KAAK,CAAC0W,EAAUgB,GAAAA,IAAAA,CAFP1X,IAAI,CAAJA,CAGb,CAEA,OAAO,gBAAgB0W,CAAa,CAAE9B,CAAY,CAAEiS,CAAkB,CAAE,CACpE,IAAMC,WAAa,CAACpP,EAAgB1X,IAChC,IAAI4mB,KAAKlQ,EAAUgB,EAAWxO,EAAAA,EAAAA,CAAAA,SAAc,CAAClJ,IAE3C+mB,EAAQ,CACVD,WAAWlS,EAAM,IAAI,CAAE,UACvBkS,WAAWlS,EAAM,IAAI,CAAC,OAAO,GAAI,UACjCkS,WAAWlS,EAAM,IAAI,CAAE,UACvBkS,WAAWlS,EAAM,IAAI,CAAC,OAAO,GAAI,UACpC,CAMD,OAJIiS,GACAE,EAAM,IAAI,CAACD,WAAWlS,EAAM,MAAM,CAAE,UAAWkS,WAAWlS,EAAM,MAAM,CAAC,OAAO,GAAI,WAG/EmS,CACX,CACJ,ECzBO,IAAeC,aAAf,MAAeA,a,SACC,WAAiD,AAC1D,UAA2B,AAErC,aAAqBC,CAAkB,CAAE,C,KAApBA,SAAS,CAATA,E,KAHF,UAAU,CAA6B,IAAIttB,I,KACpD,SAAS,CAAY,EAEW,CAE1C,OAAc,CACV,IAAI,CAAC,eAAe,GACpB,IAAI,CAAC,SAAS,CAAG,EACrB,CAEU,iBAAwB,CAC9B,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAACsrB,EAAKxtB,KAC1BwtB,EAAI,OAAO,CAAC,AAACjgB,GAAOvN,EAAS,MAAM,CAAC,OAAO,CAAC,UAAU,CAACuN,GAC3D,GACA,IAAI,CAAC,UAAU,CAAC,KAAK,EACzB,CAEU,YAAYvN,CAAmB,CAAEytB,CAAc,CAAQ,CAC7D,IAAID,EAAM,IAAI,CAAC,UAAU,CAAC,GAAG,CAACxtB,GACzBwtB,IACDA,EAAM,EAAE,CACR,IAAI,CAAC,UAAU,CAAC,GAAG,CAACxtB,EAAUwtB,IAElCA,EAAI,IAAI,CAACC,EACb,CAEU,aAAaztB,CAAmB,CAAEkU,CAAiB,CAAE5G,CAAY,CAAE6G,CAAa,CAAU,CAChG,IAAMpJ,EAAOkJ,EAAAA,EAAAA,CAAAA,IAAmB,CAACC,EAAM,KAAK,CAAG5G,EAAM6G,GAC/C5G,EAAKvN,EAAS,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC+K,GAE/C,OADA,IAAI,CAAC,WAAW,CAAC/K,EAAUuN,GACpBA,CACX,CACJ,EChCO,IAAMkiB,aAAN,MAAMA,qBAAqBF,aACb,MAA4B,IAAIrtB,GAAM,AAEvD,aAAYstB,CAAkB,CAAE,CAC5B,KAAK,CAACA,EACV,CAEA,QAAQ9J,CAAW,CAAE6H,CAAmB,CAAEvW,CAAqC,CAAE,CAI7E,OAHI,AAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC0O,IAChB,IAAI,CAAC,KAAK,CAAC,GAAG,CAACA,EAAM,IAAI,CAAC,QAAQ,CAACA,EAAK,SAAS,CAAE6H,EAAgBvW,IAEhE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC0O,EAC1B,CAEQ,SAASvI,CAAY,CAAEoQ,CAAmB,CAAEvW,CAAyB,CAAU,CACnF,GAAIA,AAAUnS,KAAAA,IAAVmS,EACA,OAAOmY,KAAK,eAAe,CAAC5B,EAAgBpQ,EAAO,IAAI,CAAC,SAAS,EAGrE,IAAMha,EAAiB,EAAE,CACrBusB,EAAY,EAChB,KAAOA,EAAY,KAAK,CACpB,IAAIzP,EAAY9C,EAAM,IAAI,CAAC,MAAM,CAACA,EAAM,MAAM,CAAGuS,EAAY,IAAOjiB,KAAK,EAAE,EAC3EtK,EAAO,IAAI,CAAC,IAAIgsB,KAAK5B,EAAgBtN,EAAW,CAAC,EAAEyP,EAAU,KAAE,CAAC,GAChEA,GAAa1Y,CACjB,CAMA,OALI,IAAI,CAAC,SAAS,GACd7T,EAAO,IAAI,CAAC,IAAIgsB,KAAK5B,EAAgBpQ,EAAM,MAAM,CAAE1L,EAAAA,EAAAA,CAAAA,SAAc,CAAC,YAClEtO,EAAO,IAAI,CAAC,IAAIgsB,KAAK5B,EAAgBpQ,EAAM,MAAM,CAAC,OAAO,GAAI1L,EAAAA,EAAAA,CAAAA,SAAc,CAAC,aAGzEtO,CACX,CAES,OAAc,CACnB,KAAK,CAAC,QACN,IAAI,CAAC,KAAK,CAAC,KAAK,EACpB,CACJ,EC1BO,IAAMwsB,eAAN,MAAMA,uBAAuBJ,aACxB,KAAe,AACf,SAAsB,AACb,WAAyC,IAAIrtB,GAAM,AAEpE,aAAYstB,CAAkB,CAAE,CAC5B,KAAK,CAACA,EACV,CAES,OAAc,CACnB,IAAI,CAAC,UAAU,GACf,KAAK,CAAC,QACN,IAAI,CAAC,SAAS,CAAC,KAAK,EACxB,CAEA,gBAAgB9J,CAAW,CAAE,CACzB,IAAMviB,EAA+B,EAAE,CAMvC,OALA,IAAI,CAAC,SAAS,CAAC,GAAG,CAACuiB,EAAK,QAAQ,GAAG,IAAI,AAAChjB,IACpC,IAAIya,EAAQ0L,EAAAA,EAAAA,CAAAA,WAAqB,CAACnD,EAAMA,EAAK,SAAS,EAClDkK,EAAOT,KAAK,eAAe,CAACzsB,EAAE,IAAI,CAAC,KAAK,CAAGya,EAAO,IAAI,CAAC,SAAS,EACpEha,EAAO,IAAI,CAAC,CAAEysB,KAAAA,EAAM,WAAYltB,EAAE,IAAI,CAAC,IAAI,AAAC,EAChD,GACOS,CACX,CAEA,sBAAsBnD,CAAmB,CAAEkuB,CAAiB,CAAE,CACtDA,CAAAA,AAASrpB,KAAAA,IAATqpB,GAAsB,IAAI,CAAC,QAAQ,GAAKA,CAAG,IAC/C,IAAI,CAAC,QAAQ,CAAGA,EAChB,IAAI,CAAC,UAAU,GACVA,GACL,KAAI,CAAC,KAAK,CAAGhgB,OAAO,UAAU,CAAC,IAAM,IAAI,CAAC,mBAAmB,CAAClO,EAAUkuB,GAAO,IAAG,EACtF,CAEQ,YAAa,CACErpB,KAAAA,IAAf,IAAI,CAAC,KAAK,GACVoJ,aAAa,IAAI,CAAC,KAAK,EACvB,IAAI,CAAC,KAAK,CAAGpJ,KAAAA,EAErB,CAEQ,oBAAoB7E,CAAmB,CAAEkuB,CAAgB,CAAE,CAC/D,GAAI,IAAI,CAAC,SAAS,EAAIA,AAAuB,IAAvBA,EAAK,MAAM,CAAC,MAAM,CAAQ,MAC5C,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAACluB,IACpB,IAAI,CAAC,SAAS,CAAC,GAAG,CAACA,EAAU,EAAE,EAEnC,IAAM6vB,EAAmB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC7vB,GACtC8vB,EAAmBD,EAAiB,IAAI,CAAC,AAACntB,GAAMA,EAAE,IAAI,CAAC,KAAK,CAAE,SAAS,CAACwrB,EAAK,KAAK,EACxF4B,CAAAA,EACM,IAAI,CAAC,mBAAmB,CAAC9vB,EAAU8vB,EAAkBD,GACrD,IAAI,CAAC,gBAAgB,CAAC3B,EAAMluB,EAAU6vB,GAC5C7vB,EAAS,MAAM,CAAC,MAAM,EAC1B,CAEQ,oBAAoBA,CAAmB,CAAEid,CAAY,CAAE8S,CAAkB,CAAE,CAC/E/vB,EAAS,MAAM,CAAC,OAAO,CAAC,UAAU,CAACid,EAAE,OAAO,EAC5C,IAAI,CAAC,SAAS,CAAC,GAAG,CACdjd,EACA+vB,EAAM,MAAM,CAAC,AAACrtB,GAAMA,IAAMua,GAElC,CAEQ,iBAAiBiR,CAAgB,CAAEluB,CAAmB,CAAE+vB,CAAkB,CAAE,CAChF,IAAMC,EAAU,IAAI,CAAC,YAAY,CAC7BhwB,EACAkuB,EACAhd,EAAAA,EAAAA,CAAAA,kBAA+B,CAC/BA,EAAAA,EAAAA,CAAAA,mBAAgC,EAEpC6e,EAAM,IAAI,CAAC,CAAE,QAASC,EAAS9B,KAAAA,CAAK,EACxC,CACJ,EC1DO,IAAM+B,aAAN,MAAMA,a,cACQ,cAA4B,AAC5B,gBAAgC,AAChC,WAA6C,AAE9D,aACa1C,CAAuC,CAChD2C,CAAsB,CACxB,C,KAFW3C,cAAc,CAAdA,E,KAHI,UAAU,CAAyB,IAAIrrB,I,KAW/C,YAAY,CAAG,CAAClC,EAAqBiuB,KACtC9c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,kBAAkC,EAClC,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAACnR,EAAUiuB,EAE7D,E,KAyIiB,iBAAiB,CAAG,AAAC5oB,IAC9BA,CAAAA,AAAa,aAAbA,GAA2BA,AAAa,uBAAbA,GAAqCA,AAAa,eAAbA,CAAwB,IACxF,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,eAAe,CAAC,KAAK,GAC1B,IAAI,CAAC,aAAa,CAAC,KAAK,GAEhC,EAxJI,IAAI,CAAC,aAAa,CAAG,IAAIoqB,aAAaS,GACtC,IAAI,CAAC,eAAe,CAAG,IAAIP,eAAeO,GAC1C/e,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,iBAAiC,CAAC,IAAI,CAAC,iBAAiB,CAC5D,CAES,YAIP,AAEF,MAAKpG,CAAsB,CAA0B,CACjD,GAAI,CAACoG,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,kBAAkC,CAAE,OAEzC,IAAMgf,EAAgB,IAAI,CAAC,cAAc,CAACplB,EAAK,IAAI,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,EACrE,GAAIolB,AAAyB,IAAzBA,EAAc,MAAM,CAAQ,OAChCA,EAAc,IAAI,CAAC,AAACztB,GAAMA,EAAE,QAAQ,EACpC,IAAIurB,EAAS,IAAI,CAAC,sBAAsB,CAACljB,EAAMolB,UAC/C,AAAIlC,AAAWppB,KAAAA,IAAXopB,EAA6BA,EAC7BkC,AAAyB,IAAzBA,EAAc,MAAM,CACb,IAAI,CAAC,wBAAwB,CAACplB,EAAK,IAAI,CAAEolB,CAAa,CAAC,EAAE,CAAC,KAAK,CAAE,CAACA,CAAa,CAAC,EAAE,CAAC,EAG1F,IAAI,CAAC,yBAAyB,CAACplB,EAAK,IAAI,CAAEolB,IAC1C,IAAI,CAAC,wBAAwB,CAACplB,EAAK,IAAI,CAAEolB,CAAa,CAAC,EAAE,CAAC,KAAK,CAAE,CAACA,CAAa,CAAC,EAAE,CAAC,CAE3F,CAEQ,0BAA0BzK,CAAW,CAAEyK,CAA6B,CAAE,CAC1E,IAAMjc,EAAQic,CAAa,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAACA,CAAa,CAAC,EAAE,CAAC,IAAI,EACnE,OAAOjc,EACD,IAAI,CAAC,wBAAwB,CAACwR,EAAMxR,EAAO,CAACic,CAAa,CAAC,EAAE,CAAEA,CAAa,CAAC,EAAE,CAAC,EAC/EtrB,KAAAA,CACV,CAEQ,yBAAyB6gB,CAAW,CAAExR,CAAU,CAAEic,CAA6B,CAAc,CACjG,IAKIpC,EACAvB,EANE4D,EAAkBD,EACnB,GAAG,CAAC,AAACztB,GAAM,IAAI,CAAC,YAAY,CAACgjB,EAAMhjB,EAAE,IAAI,CAAC,QAAQ,CAAEwR,IACpD,MAAM,CAAC,AAAC3G,GAAOA,AAAO1I,KAAAA,IAAP0I,GAYpB,OAXA,IAAI,CAAC,UAAU,CAAC,GAAG,CAACmY,EAAM0K,GAItBD,AAAyB,IAAzBA,EAAc,MAAM,EACpB3D,EAAWtY,EAAM,UAAU,CAACic,CAAa,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,EAC1DpC,EAAOoC,CAAa,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,EAC1BA,AAAyB,IAAzBA,EAAc,MAAM,EAC3BpC,CAAAA,EAAOtc,EAAAA,EAAAA,CAAAA,SAAc,CAAC,oBAAmB,EAGtC,CAAEiU,KAAAA,EAAMxR,MAAAA,EAAO6Z,KAAAA,EAAM,OAAQ,EAAE,CAAEe,SADvBqB,CAAa,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,CACG3D,SAAAA,CAAS,CAC/D,CAEQ,aAAa9G,CAAW,CAAEzS,CAAU,CAAEmB,CAAQ,CAAsB,CACxE,IAAMmJ,EAASnJ,EAAI,GAAG,CAACnB,GACjB8D,EAASwG,EAAO,SAAS,GAC/B,GAAI,CAACxG,EAAQ,OACb,IAAMyV,EAAW/e,KAAK,GAAG,CAAC8P,AAAkB,KAAlBA,EAAO,MAAM,GAAW,MAC5C8S,EAASpd,EAAM,GAAG,CAAC8D,EAAO,QAAQ,CAACyV,IACnCa,EAAW5mB,EAAAA,EAAAA,CAAAA,IAAiB,CAACwM,EAAOod,EAAQnf,EAAAA,EAAAA,CAAAA,kBAA+B,CAAE3K,EAAAA,EAAAA,CAAAA,IAAa,EAChG,OAAOmf,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC2H,EACpD,CAEQ,uBACJtiB,CAAsB,CACtBolB,CAA6B,CACP,CACtB,GAAIplB,AAAuB,IAAvBA,EAAK,MAAM,CAAC,MAAM,EAAUA,EAAK,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAKnE,EAAAA,EAAAA,CAAAA,IAAc,CAAE,OACnF,IAAMsN,EAAQ,IAAI,CAAC,gBAAgB,CAACnJ,EAAMolB,GAC1C,GAAI,CAACjc,EAAO,OACZ,IAAM3G,EAAK,IAAI,CAAC,YAAY,CAACxC,EAAK,IAAI,CAAEmJ,EAAM,QAAQ,CAAEA,EAAM,SAAS,EACvE,GAAI3G,AAAO1I,KAAAA,IAAP0I,EAEJ,OADA,IAAI,CAAC,UAAU,CAAC,GAAG,CAACxC,EAAK,IAAI,CAAE,CAACwC,EAAG,EAC5B,CACH,KAAMxC,EAAK,IAAI,CACf,MAAOmJ,EAAM,SAAS,CACtB,KAAMzC,EAAAA,EAAAA,CAAAA,SAAc,CAAC,qBACrB,OAAQ,CAAC1G,EAAK,MAAM,CAAC,EAAE,CAAC,AAC5B,CACJ,CAEQ,iBAAiBA,CAAsB,CAAEolB,CAA6B,CAAE,CAC5E,IAAM1I,EAAO1c,EAAK,MAAM,CAAC,EAAE,CAAC,KAAK,CAC3ByM,EAA8C,EAAE,CAOtD,OANA2Y,EAAc,OAAO,CAAC,AAACztB,IACnB+kB,EAAK,SAAS,CAAC/kB,EAAE,IAAI,EAAE,OAAO,CAAC,AAACsmB,IAC5BxR,EAAO,IAAI,CAAC,CAAE,UAAWwR,EAAE,KAAK,CAAE,SAAUtmB,EAAE,IAAI,CAAC,QAAQ,AAAC,EAChE,EACJ,GACA8U,EAAO,IAAI,CAAC,AAACwR,GAAMlD,EAAAA,EAAAA,CAAAA,cAAoB,CAAC/a,EAAK,IAAI,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,CAAEie,EAAE,SAAS,GACzExR,EAAO,EAAE,CAAC,EACrB,CAEQ,eAAekO,CAAW,CAAEhjB,CAAS,CAAEwS,CAAS,CAAE,CACtD,IAAMnK,EAAuB,EAAE,CAC/B,GAAI,IAAI,CAAC,cAAc,CAAE,CACrB,IAAMukB,EAAQ,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC5J,EAAM,IAAI,CAAC,cAAc,IAClE3a,EAAK,IAAI,IAAI,IAAI,CAAC,iBAAiB,CAACukB,EAAO5J,EAAMhjB,EAAGwS,GACxD,CAKA,OAHAob,AAD2B,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC5K,GAC7C,OAAO,CAAC,AAAC1kB,IACxB+J,EAAK,IAAI,IAAI,IAAI,CAAC,iBAAiB,CAAC/J,EAAE,IAAI,CAAE0kB,EAAMhjB,EAAGwS,EAAGlU,EAAE,UAAU,EACxE,GACO+J,CACX,CAEQ,kBAAkB6kB,CAAY,CAAElK,CAAW,CAAEhjB,CAAS,CAAEwS,CAAS,CAAEqb,CAAmB,CAAE,CAC5F,IAAIptB,EAAyB,EAAE,CAC/B,IAAK,IAAM8oB,KAAQ2D,EAAM,CACrB,IAAIpD,EAAW,IAAI,CAAC,mBAAmB,CAAC9G,EAAMhjB,EAAGwS,EAAG+W,GACpD,GAAIO,EAAWrb,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,YAA4B,CAAE,CACzC,IAAI+N,EAAMwG,EAAK,KAAK,CAAChjB,EAAGwS,GACpBhB,EAAQ+X,EAAK,SAAS,CAAC/M,GAC3B,GAAIhL,AAA+C,EAA/CA,EAAM,GAAG,CAAC+X,EAAK,QAAQ,EAAE,GAAG,CAACA,EAAK,SAAS,EAAO,SACtD9oB,EAAO,IAAI,CAAC,CACR8oB,KAAAA,EACAO,SAAAA,EACAtY,MAAAA,EACA,KAAMqc,GAActE,EAAK,IAAI,CAC7B,iBAAkBsE,AAAe1rB,KAAAA,IAAf0rB,CACtB,EACJ,CACJ,CACA,OAAOptB,CACX,CAEQ,oBAAoBuiB,CAAW,CAAEhjB,CAAS,CAAEwS,CAAS,CAAE+W,CAAS,CAAU,CAC9E,IAAMhZ,EAAQyS,EAAK,aAAa,CAACuG,EAAK,QAAQ,EACxC1O,EAAS,IAAI3Z,EAAAA,EAAEA,CAAClB,EAAIuQ,EAAM,CAAC,CAAEiC,EAAIjC,EAAM,CAAC,EAC9C,GAAIsK,EAAO,SAAS,CAAC3Z,EAAAA,EAAAA,CAAAA,IAAO,EAAG,OAAO,EACtC,IAAMwQ,EAAMsR,EAAK,aAAa,CAACuG,EAAK,QAAQ,CAAC,GAAG,CAACA,EAAK,SAAS,CAAC,QAAQ,CAAC,OACzE,GAAIhZ,EAAM,UAAU,CAACmB,GAAOpO,EAAAA,EAAAA,CAAAA,KAAe,CAAE,OAAOuX,EAAO,MAAM,GACjE,IAAMiT,EAAMpc,EAAI,GAAG,CAACnB,GAAO,SAAS,GAC9B6D,EAAMyG,EAAO,GAAG,CAACiT,GACvB,OAAO/iB,KAAK,IAAI,CAAC8P,EAAO,QAAQ,GAAKzG,EAAMA,EAC/C,CAEA,qBAA4B,CACxB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAACvL,EAAGW,KACxBX,EAAE,OAAO,CAAC,AAACgC,IACPrB,EAAE,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAACqB,EACzC,EACJ,GACA,IAAI,CAAC,UAAU,CAAC,KAAK,EACzB,CAEiB,iBAMf,AAEF,QAAc,CACV,IAAI,CAAC,mBAAmB,GACxB,IAAI,CAAC,aAAa,CAAC,KAAK,GACxB,IAAI,CAAC,eAAe,CAAC,KAAK,GAC1B4D,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,qBAAqC,CAAC,IAAI,CAAC,iBAAiB,CAChE,CACJ,EC7KO,IAAesf,iBAAf,MAAeA,iB,8BACV,WAAoB,AACpB,YAAuB,AACrB,QAAqB,AACvB,OAAmC,AAE3C,aACazwB,CAAmB,CACnBmoB,CAA2B,CAC3B4H,CAAc,CACdhlB,CAAO,CAClB,C,KAJW/K,QAAQ,CAARA,E,KACAmoB,UAAU,CAAVA,E,KACA4H,KAAK,CAALA,E,KACAhlB,IAAI,CAAJA,E,KANL,MAAM,CAAN,EAQJ,IAAI,CAAC,aAAa,CAAClG,KAAAA,GACnBsjB,EAAW,WAAW,CAAC,IAAM,IAAI,CAAC,YAAY,GAClD,CAEA,IAAI,QAAS,CACT,OAAO,IAAI,CAAC,OAAO,AACvB,CACA,IAAI,OAAQ,CACR,OAAO,IAAI,CAAC,MAAM,AACtB,CAEA,SAAU,CACN,IAAI,CAAC,OAAO,CAAGtjB,KAAAA,EACf,IAAI,CAAC,MAAM,CAAG,CAClB,CAEQ,eAAgB,CACpB,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,UAAU,CAAC,OAAO,GACvB,IAAI,CAAC,gBAAgB,EACzB,CAEQ,cAAe,CACC,IAAhB,IAAI,CAAC,MAAM,GACf,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,UAAU,CAAC,MAAM,GACtB,IAAI,CAAC,gBAAgB,GACzB,CAEQ,kBAAmB,CACvB,IAAI,CAAC,YAAY,GACjB,IAAI,CAAC,UAAU,GACf,IAAI,CAAC,iBAAiB,GACtB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,AAACqpB,GAASA,EAAK,KAAK,GAC3C,CAEQ,YAAa,CACjBxgB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,aACvB,CAEA,YAAYgY,CAAW,CAAE9X,CAAmB,CAAQ,CAChD,IAAI,CAAC,MAAM,CAAG,EACd,IAAI,CAAC,iBAAiB,GACtB,IAAI,CAAC,eAAe,CAAC8X,EAAM9X,GAC3B,IAAI,CAAC,oBAAoB,CAAC8X,EAC9B,CAEQ,gBAAgBA,CAAW,CAAE9X,CAAmB,CAAE,CACtD,IAAI,CAAC,SAAS,CAAC8X,EAAM9X,GACjB,IAAI,CAAC,OAAO,CACZ,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,GAElD,IAAI,CAAC,YAAY,EAEzB,CAEQ,qBAAqB8X,CAAW,CAAE,CACtC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,EAAE,OACjCA,EAAK,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CAEQ,aAAauI,CAAkB,CAAE,CACrC,IAAI7E,EAAS,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG6E,GAChC,GAAI,CAAC7E,EAAQ,CACT,IAAIoD,EAAWyB,EAAO,QAAQ,EAAIA,EAAO,QAAQ,EAAE,WAAWA,EAAO,KAAK,CACtEzB,CAAAA,GACApD,CAAAA,EAAS,CAAC,EAAEoD,EAAS,OAAO,CAAC,GAAG,CAAC,AAAD,CAExC,CAEA,MAAO,CAACyB,EAAO,IAAI,CAAE7E,EAAO,CAAC,MAAM,CAAC,AAAC1mB,GAAMA,AAAMmC,KAAAA,IAANnC,GAAiB,IAAI,CAAC,OACrE,CAEU,UAAUgjB,CAAW,CAAE9X,CAAmB,CAAE,CAC9C,IAAI,CAAC,qBAAqB,CAAC8X,EAAM9X,KAErC,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,aAAa,CAAChH,EAAAA,EAAAA,CAAAA,IAAc,CAAE8e,EAAM9X,GACxD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,AAACsgB,GAASA,EAAK,YAAY,GAAGxI,EAAK,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAE,IAAI,CAAC,OAAO,GAChG,CAEQ,sBAAsBA,CAAW,CAAE9X,CAAmB,CAAE,CAC5D,IAAM8iB,EAAe,IAAI,CAAC,uBAAuB,CAAChL,EAAM9X,SACxD,CAAI,CAAC8iB,IAEL,IAAI,CAAC,OAAO,CAAG,CACXhL,KAAAA,EACA,MAAOgL,EAAa,KAAK,CACzB,KAAMA,EAAa,MAAM,CACzB,OAAQ,EAAE,AACd,EACO,GACX,CAEQ,wBAAwBhL,CAAW,CAAE9X,CAAmB,CAAE,CAC9D,IACI2Z,EADAoJ,EAAUttB,OAAO,SAAS,CAG9B,IAAK,IAAM6Q,KAAS,IAAI,CAAC,IAAI,CAAC,aAAa,EAAI,EAAE,CAAE,CAC/C,GAAIA,EAAM,IAAI,EAAI,CAACA,EAAM,IAAI,GAAI,SAEjC,IAAMkZ,EAAOtH,EAAAA,EAAAA,CAAAA,cAAoB,CAACJ,EAAM9X,EAAM,OAAO,CAAEA,EAAM,OAAO,CAAEsG,EAAM,KAAK,EAC7EkZ,EAAOuD,IACPA,EAAUvD,EACV7F,EAAUrT,EAElB,CAEA,OAAOyc,EAAUxf,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,YAA4B,CAAGoW,EAAU1iB,KAAAA,CAC9D,CAEQ,cAAc8jB,CAAoB,CAAEjD,CAAW,CAAE9X,CAAiB,CAAE,CACxE,IAAM4a,EAAW,IAAI,CAAC,YAAY,CAACG,EAAWjD,EAAM9X,GACpD,IAAK,IAAMsgB,KAAQ,IAAI,CAAC,KAAK,CAAE,CAC3B,IAAMD,EAASC,EAAK,IAAI,CAAC1F,GACzB,GAAIyF,GAAU,IAAI,CAAC,iBAAiB,CAACA,GAAS,OAAOA,CACzD,CAEJ,CAEQ,kBAAkBA,CAAkB,CAAE,CAC1C,MAAO,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAACA,EAAO,KAAK,CACnE,CAEQ,aAAatF,CAAoB,CAAEjD,CAAW,CAAE9X,CAAiB,CAAoB,CAEzF,MAAO,CAAEiW,OADM6B,EAAK,YAAY,CAACiD,EAAW/a,EAAM,OAAO,CAAEA,EAAM,OAAO,CAAE,IAAI,CAAC,IAAI,CAAC,MAAM,EACzE8X,KAAAA,EAAM,GAAI9X,EAAM,OAAO,CAAE,GAAIA,EAAM,OAAO,AAAC,CAChE,CAEQ,cAAe,CACnBF,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,gBACvB,CAEQ,eAAekjB,CAAuB,CAAE,CAC5C,GAAI,CAACA,EAAK,YACN,IAAI,CAAC,YAAY,GAGrBljB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,eAAgB3H,EAAAA,EAAAA,CAAAA,IAAgB,CAAE6qB,EACzD,CAEQ,mBAAoB,CACxB,IAAI,CAAC,gBAAgB,GACrB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,AAAC1C,GAASA,EAAK,mBAAmB,GACzD,CAEQ,cAAcha,CAAsB,CAAE,CAC1C,GAAIA,EAAO,CACP,IAAMnJ,EAAOkJ,EAAAA,EAAAA,CAAAA,IAAmB,CAC5BC,EACAhD,EAAAA,EAAAA,CAAAA,mBAAgC,CAChCA,EAAAA,EAAAA,CAAAA,oBAAiC,CAErC,KAAI,CAAC,UAAU,CAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAACnG,EAC/D,CAEA,IAAI,CAAC,WAAW,CAAG,IAAI,CAAC,IAAI,CACvB,OAAO,GAAGmJ,IACT,IAAI,AAACe,GAAU,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAACA,GAClE,CAEQ,kBAAmB,CACnB,IAAI,CAAC,UAAU,GACf,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,EACvD,IAAI,CAAC,UAAU,CAAGpQ,KAAAA,GAEtB,IAAI,CAAC,WAAW,EAAE,QAAQ,AAAC0I,IACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAACA,EAC5C,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,GAC3B,IAAI,CAAC,WAAW,CAAG1I,KAAAA,CACvB,CAEA,YAAY6gB,CAAW,CAAE9X,CAAmB,CAAQ,CACtB,UAAtBA,EAAM,WAAW,EAAgBA,AAAiB,IAAjBA,EAAM,MAAM,GACzC,IAAI,CAAC,OAAO,CACZ,IAAI,CAAC,aAAa,GAElBF,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,iCAG5C,CAEA,UAAUgY,CAAW,CAAE9X,CAAmB,CAAQ,CAC1CA,AAAsB,UAAtBA,EAAM,WAAW,EAAgBA,EAAM,SAAS,EAAI,IAAI,CAAC,OAAO,EAChE,IAAI,CAAC,aAAa,EAE1B,CAEA,WAAW8X,CAAW,CAAE9X,CAAiB,CAAQ,CAC7C8X,EAAK,MAAM,EACf,CAEA,QAAQA,CAAW,CAAE9X,CAAoB,CAAQ,CAC7C,OAAQA,EAAM,GAAG,EACb,IAAK,SACD,IAAI,CAAC,OAAO,CAAG/I,KAAAA,EACf,IAAI,CAAC,YAAY,GACjB,KACJ,KAAK,QACD,IAAI,CAAC,OAAO,CAAGA,KAAAA,EACf,IAAI,CAAC,aAAa,GAClB,KACJ,SACI,IAAI,CAAC,kBAAkB,CAAC6gB,EAAM9X,EACtC,CACJ,CAEQ,mBAAmB8X,CAAW,CAAE9X,CAAoB,CAAE,CACrD,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAI,CAAC,QAAQ,CAACA,EAAM,GAAG,IAE/E,IAAI,CAAC,MAAM,CAAG,EACdF,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAaE,EAAM,GAAG,CAAE,AAAC1J,IACxC,IAAMkI,EAAQ,IAAI,CAAC,UAAU,CAAClI,UAC9B,AAAIkI,EAAc1M,EAAAA,EAAAA,CAAAA,GAAU,CAAC0M,IAE7B,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,iBAAiB,CAACsZ,EAAMxhB,GAC5C,IAAI,CAAC,aAAa,GACXxE,EAAAA,EAAAA,CAAAA,EAAS,CAACwE,GACrB,GACJ,CAIJ,EC5PO,IAAM2sB,sBAAN,MAAMA,8BAA8BJ,iB,MACtB,WAAuB,AACvB,MAAa,AAE9B,aACIzwB,CAAmB,CACnBmoB,CAA2B,CACV8C,CAAiB,CAClCtU,CAAO,CACPma,CAA4B,CAC9B,CACE,GAAI,CAACA,EAAc,KAAK,CAAE,MAAM,AAAIzuB,MAAM,mCAE1C,IAAM0uB,EAAa,IAAI/C,WAAW7c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,QAAwB,CAAE2f,EAAc,QAAQ,CAGlF,MAAK,CAAC9wB,EAAUmoB,EAAY,CAAC4I,EADR,IAAId,aAAahF,EAAQ,IADxB,IAAI+D,UAAU8B,EAAc,KAAK,CAAE7F,GAEY,CAAE6F,GAAAA,IAAAA,CATtD7F,MAAM,CAANA,EAAAA,IAAAA,CAiBJ,iBAAiB,CAAG,AAACgD,GAClC,AAAKA,GAAQ,OACb,IAAI,CAAC,UAAU,CAAC,SAAS,CAACA,EAAO,KAAK,EAC/B,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,KAAE,CAAC,EAFnB,GAP3B,IAAMjP,EAAOrI,EAAG,GAAG,CAACsU,KAAU,SAAS,EACvC,KAAI,CAAC,KAAK,CAAG,IAAInM,EAAAA,EAAKA,CAACmM,IAAU6F,EAAc,KAAK,GAAG,MAAM,CAAE9R,GAC/D,IAAI,CAAC,UAAU,CAAG,IAAIO,EAAAA,EAAUA,CAAC,IAAI,CAAC,KAAK,EAC3CuR,EAAc,MAAM,GAAK,IAAI,CAAC,iBAAiB,AACnD,CAEiB,iBAIf,AAEiB,YAAW5sB,CAAY,CAAE,CAExC,OAAO8sB,MADO3tB,OAAO,UAAU,CAACa,IACV,4BAA8BW,KAAAA,CACxD,CAEmB,kBAAkB6gB,CAAW,CAAExhB,CAAY,CAAc,CACxE,IAAM8S,EAAS3T,OAAO,UAAU,CAACa,GAAQuJ,KAAK,EAAE,CAAI,IAC9CwJ,EAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAED,GAEtD,MAAO,CAAE9C,MADK,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC+C,GAChByO,KAAAA,EAAM,OAAQ,EAAE,CAAE,MAAO,IAAI,CAAC,KAAK,AAAC,CACxD,CACJ,EChCO,IAAMuL,wBAAN,MAAMA,gCAAgCR,iBACzC,YAAYzwB,CAAmB,CAAEmoB,CAA2B,CAAE+I,CAAgC,CAAE,CAG5F,KAAK,CAAClxB,EAAUmoB,EAAY,CAFT,IAAI6F,WAAW7c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,QAAwB,CAAE,IAAM+f,EAAW,KAAK,EACjE,IAAI/D,SAAS+D,EAAW,KAAK,CAAEA,EAAW,SAAS,EAClB,CAAEA,EACxD,CAEU,kBAAkBxL,CAAW,CAAExhB,CAAY,CAAc,CAC/D,IAAMkpB,EAAO,IAAI,CAAC,iBAAiB,CAAC/pB,OAAOa,IAE3C,MAAO,CAAEwhB,KAAAA,EAAMxR,MADD,IAAI,CAAC,cAAc,CAACkZ,GACZ,SAAUA,EAAM,OAAQ,EAAE,AAAC,CACrD,CAEQ,kBAAkB+D,CAAkB,CAAU,CAClD,OAAO,IAAI,CAAC,aAAa,GAAK,CAACA,EAAaA,CAChD,CAEQ,eAAe3E,CAAgB,CAAO,CAC1C,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAACA,GAC5D,CAEQ,eAAgB,CACpB,OACI,IAAI,CAAC,OAAO,EAAE,OACd,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAI,CAACxmB,EAAAA,EAAAA,CAAAA,QAAkB,AAE9F,CAEU,WAAW9B,CAAY,CAAwB,CACrD,OAAOb,OAAO,KAAK,CAACA,OAAOa,IAAS,4BAA8BW,KAAAA,CACtE,CACJ,EAEO,IAAMusB,yBAAN,MAAMA,iCAAiCX,iB,UAClC,UAA6B,AAErC,aACIzwB,CAAmB,CACnBmoB,CAA2B,CAClB+I,CAAiC,CAC5C,CACE,IAAMH,EAAa,IAAI/C,WAAW7c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,QAAwB,CAAE+f,EAAW,KAAK,CAG5E,MAAK,CAAClxB,EAAUmoB,EAAY,CAAC4I,EAFR,IAAId,aAAaiB,EAAW,KAAK,CAAE,IACtC,IAAIlC,UAAUkC,EAAW,KAAK,CAAEA,EAAW,KAAK,EACD,CAAEA,GAAAA,IAAAA,CAL1DA,UAAU,CAAVA,CAMb,CAEmB,UAAUxL,CAAW,CAAE9X,CAAmB,CAAQ,CACjE,KAAK,CAAC,UAAU8X,EAAM9X,GACtB,IAAI,CAAC,eAAe,EACxB,CAEQ,iBAAkB,CAClB,IAAI,CAAC,OAAO,GACZ,IAAI,CAAC,SAAS,CAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,EACzD,IAAI,CAAC,OAAO,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAE3C,CAEU,kBAAkB8X,CAAW,CAAExhB,CAAY,CAAc,CAC/D,IAAMiZ,EAAQ,IAAI,CAAC,SAAS,EAAIuI,EAAK,SAAS,CAE9C,MAAO,CAAExR,MADK,IAAI,CAAC,cAAc,CAAChQ,EAAMiZ,GACxBuI,KAAAA,EAAM,OAAQ,EAAE,CAAEvI,MAAAA,CAAM,CAC5C,CAEQ,eAAejZ,CAAY,CAAEiZ,CAAY,CAAO,CACpD,IAAMkU,EAAUntB,EAAK,KAAK,CAAC,KAAK,GAAG,CAACb,QACpC,OAAOguB,AAAmB,IAAnBA,EAAQ,MAAM,CACf,IAAI,CAAC,0BAA0B,CAACA,CAAO,CAAC,EAAE,EAC1C,IAAI,CAAC,6BAA6B,CAACA,EAASlU,EACtD,CAEQ,2BAA2BqP,CAAgB,CAAO,CACtD,IAAMjP,EAAS,IAAI,CAAC,OAAO,EAAE,MAAO,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,YAC3D,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAACA,EAAQ,QAAQ,CAACiP,GAClD,CAEQ,8BAA8B8E,CAAgB,CAAEnU,CAAY,CAAO,CACvE,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAACA,EAAM,IAAI,CAAC,QAAQ,CAACmU,CAAM,CAAC,EAAE,GAAG,GAAG,CAACnU,EAAM,IAAI,CAAC,QAAQ,CAACmU,CAAM,CAAC,EAAE,EAClG,CAEU,WAAWptB,CAAY,CAAwB,CACrD,IAAMmtB,EAAUntB,EAAK,KAAK,CAAC,KAAK,GAAG,CAACb,QACpC,GAAIguB,EAAQ,IAAI,CAAChuB,OAAO,KAAK,GAAMguB,AAAmB,IAAnBA,EAAQ,MAAM,EAAUA,AAAmB,IAAnBA,EAAQ,MAAM,CACrE,MAAO,2BAGf,CACJ,EC7EO,IAAME,sBAAN,MAAMA,8BAA8Bd,iBACvC,YAAYzwB,CAAmB,CAAEmoB,CAA2B,CAAE+G,CAAwB,CAAE,CACpF,IAAM6B,EAAa,IAAI/C,WAAW7c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,QAAwB,CAAE+d,EAAU,QAAQ,EAK9E,KAAK,CAAClvB,EAAUmoB,EAAY,CAAC4I,EADR,IAAId,aAAaf,EAAU,QAAQ,CAAE,IAHpCA,EAAU,KAAK,CAC/B,IAAIF,UAAUE,EAAU,KAAK,CAAEA,EAAU,QAAQ,EACjD,IAAIH,cAAcG,EAAU,QAAQ,EAE2B,CAAEA,EAC3E,CAEU,kBAAkBxJ,CAAW,CAAExhB,CAAY,CAAc,CAC/D,IAAMstB,EAAO,IAAI,CAAC,oBAAoB,CAACttB,GACjC4qB,EAAW,IAAI,CAAC,WAAW,IAAMhrB,EAAAA,EAAAA,CAAAA,IAAQ,CACzCX,EAAS,CAAE,MAAO2rB,EAAUpJ,KAAAA,EAAM,OAAQ,EAAE,AAAC,EAQnD,OANI8L,AAAgB,IAAhBA,EAAK,MAAM,EAAU,IAAI,CAAC,OAAO,EAAE,MACnCruB,EAAO,KAAK,CAAG,IAAI,CAAC,0BAA0B,CAAC2rB,EAAU0C,CAAI,CAAC,EAAE,EACzDA,EAAK,MAAM,CAAG,GACrBruB,CAAAA,EAAO,KAAK,CAAG,IAAI,CAAC,6BAA6B,CAAC2rB,EAAU0C,EAAI,EAG7DruB,CACX,CAEQ,qBAAqBe,CAAY,CAAY,CACjD,OAAOA,EAAK,KAAK,CAAC,KAAK,GAAG,CAACb,OAC/B,CAEQ,2BAA2ByrB,CAAa,CAAEtC,CAAgB,CAAO,CACrE,IAAMjP,EAAS,IAAI,CAAC,OAAO,CAAE,KAAK,CAAE,GAAG,CAACuR,GAAU,SAAS,GAC3D,OAAOA,EAAS,GAAG,CAACvR,EAAO,QAAQ,CAACiP,GACxC,CAEQ,8BAA8BsC,CAAa,CAAE0C,CAAc,CAAO,CACtE,IAAMrU,EAAQ,IAAI,CAAC,IAAI,CAAC,KAAK,MAAQ,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,SAAS,CAC5DjJ,EAAQ4a,EAAS,GAAG,CAAC3R,EAAM,IAAI,CAAC,QAAQ,CAACqU,CAAI,CAAC,EAAE,GAAG,GAAG,CAACrU,EAAM,IAAI,CAAC,QAAQ,CAACqU,CAAI,CAAC,EAAE,GAItF,OAHIA,AAAgB,IAAhBA,EAAK,MAAM,EACXtd,CAAAA,EAAQA,EAAM,GAAG,CAACiJ,EAAM,MAAM,CAAC,QAAQ,CAACqU,CAAI,CAAC,EAAE,EAAC,EAE7Ctd,CACX,CAEU,WAAWhQ,CAAY,CAAwB,CACrD,IAAMstB,EAAO,IAAI,CAAC,oBAAoB,CAACttB,GACjCutB,EAAYvI,EAAAA,IAAc,CAACsI,EAAK,MAAM,SAE5C,AAAK,IAAI,CAAC,gBAAgB,CAACC,GACvB,IAAI,CAAC,iBAAiB,CAACD,GAAc,4BACrC,IAAI,CAAC,oBAAoB,CAACA,GAAc,oCACxC,IAAI,CAAC,qBAAqB,CAACA,GAAc,wCAHC,+BAMlD,CAEQ,iBAAiBC,CAAoB,CAAW,CACpD,OAAOvI,EAAAA,QAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAGuI,EACpD,CAEQ,kBAAkBD,CAAc,CAAW,CAC/C,OAAOA,EAAK,IAAI,CAACnuB,OAAO,KAAK,CACjC,CAEQ,qBAAqBmuB,CAAc,CAAW,CAElD,OAAO1C,AAAajqB,KAAAA,IADH,IAAI,CAAC,WAAW,IACA2sB,AAAgB,IAAhBA,EAAK,MAAM,AAChD,CAEQ,sBAAsBA,CAAc,CAAW,CACnD,IAAM1C,EAAW,IAAI,CAAC,WAAW,GACjC,OAAO0C,AAAgB,IAAhBA,EAAK,MAAM,EAAU1C,GAAc,EAAC,IAAI,CAAC,OAAO,EAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAE,SAAS,CAACA,EAAQ,CACrG,CAEQ,aAA+B,CACnC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,MAAQ,IAAI,CAAC,OAAO,EAAE,QACnD,CACJ,EAEO,IAAM4C,6BAAN,MAAMA,qCAAqCjB,iBAC9C,YAAYzwB,CAAmB,CAAEmoB,CAA2B,CAAE+G,CAA+B,CAAE,CAC3F,IAAM6B,EAAa,IAAI/C,WAAW7c,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,QAAwB,EAG1D,KAAK,CAACnR,EAAUmoB,EAAY,CAAC4I,EAFhB,IAAI9B,iBAAiBC,GACZ,IAAIH,cACmC,CAAEG,EACnE,CAEmB,kBAAkBxJ,CAAW,CAAExhB,CAAY,CAAc,CACxE,IAAM0nB,EAAS,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAC/B+F,EAAYtuB,OAAOa,GAAQ0nB,EACjC,MAAO,CAAE,MAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC+F,GAAYjM,KAAAA,EAAM,OAAQ,EAAE,AAAC,CACvE,CAEmB,WAAWxhB,CAAY,CAAE,CACxC,OAAOb,OAAO,KAAK,CAACA,OAAOa,IAAS,4BAA8BW,KAAAA,CACtE,CACJ,EClHO,IAAe+sB,SAAf,MAAeA,S,+BAClB,aACaC,CAAa,CACLC,CAAuB,CACvBC,EAAwB,EAAK,CAChD,C,KAHWF,GAAG,CAAHA,E,KACQC,cAAc,CAAdA,E,KACAC,YAAY,CAAZA,CAClB,CAEH,MAAM,QAAQ/xB,CAAmB,CAAEmoB,CAA2B,CAAmC,CACxF,IAAI,CAAC,YAAY,GAClBnoB,EAAS,SAAS,CAAC,cAAc,GACjCA,EAAS,MAAM,CAAC,WAAW,CAAC,KAAK,IAGrC,IAAM+K,EAAO,IAAI,CAAC,cAAc,GAChC,IAAI,CAAC,YAAY,CAACA,GAElB,IAAMinB,EAAkB,IAAI,CAAC,eAAe,CAAChyB,EAAUmoB,EAAYpd,GAGnE,OAFA,MAAM/K,EAAS,SAAS,CAAC,SAAS,CAACgyB,EAAiB,IAAI,CAAC,GAAG,CAAE7J,EAAY,GAAO,QAE1EA,EAAW,MAAM,EAAE,SAAW,UAAY6J,EAAgB,MAAM,CAAGntB,KAAAA,CAC9E,CAEQ,aAAakG,CAAO,CAAE,CAC1B,IAAMknB,EAAelnB,EAAK,SAAS,AACnCA,CAAAA,EAAK,SAAS,CAAG,AAACmJ,GACd,AAAI+d,EACOA,EAAa/d,IAAU,IAAI,CAAC,SAAS,CAACnJ,EAAMmJ,GAEhD,IAAI,CAAC,SAAS,CAACnJ,EAAMmJ,EAEpC,CASJ,ECzCA,SAASge,oBACL,MAAO,CACH,UAAWhJ,EAAAA,MAAgB,AAC/B,CACJ,CAEO,IAAMiJ,UAAN,MAAMA,kBAAkBP,S,qBAC3B,aACIC,CAAa,CACIO,CAAuB,CACvBC,CAAmB,CACpCC,EAAoCJ,iBAAiB,CACrDH,EAAe,EAAK,CACtB,CACE,KAAK,CAACF,EAAKS,EAAcP,GAAAA,IAAAA,CALRK,YAAY,CAAZA,EAAAA,IAAAA,CACAC,QAAQ,CAARA,CAKrB,CAEU,gBAAgBryB,CAAmB,CAAEmoB,CAA2B,CAAEpd,CAAmB,CAAE,CAC7F,OAAO,IAAI8lB,sBAAsB7wB,EAAUmoB,EAAY,IAAI,CAAC,YAAY,CAAE,IAAI,CAAC,QAAQ,GAAIpd,EAC/F,CAEU,UAAUA,CAAmB,CAAEmJ,CAAU,CAAW,CAC1D,OAAOnJ,AAAkBlG,KAAAA,IAAlBkG,EAAK,QAAQ,EAAkBA,EAAK,QAAQ,GAAG,UAAU,CAACmJ,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,AAChG,CACJ,ECpBO,IAAMusB,iBAAN,MAAMA,yBAAyBX,SACxB,gBAAgB5xB,CAAmB,CAAEmoB,CAA2B,CAAEpd,CAA0B,CAAE,CACpG,OAAO,IAAIkmB,wBAAwBjxB,EAAUmoB,EAAYpd,EAC7D,CAEU,UAAUA,CAA0B,CAAEmJ,CAAU,CAAW,CACjE,OAAOzG,KAAK,GAAG,CAACyG,EAAM,GAAG,CAACnJ,EAAK,KAAK,EAAE,GAAG,CAACA,EAAK,SAAS,GAAK/E,EAAAA,EAAAA,CAAAA,QAAkB,AACnF,CACJ,EAEO,IAAMwsB,kBAAN,MAAMA,0BAA0BZ,SACzB,gBACN5xB,CAAmB,CACnBmoB,CAA2B,CAC3Bpd,CAA2B,CAC7B,CACE,OAAO,IAAIqmB,yBAAyBpxB,EAAUmoB,EAAYpd,EAC9D,CAEU,UAAUA,CAA2B,CAAEmJ,CAAU,CAAW,CAElE,OAAOue,AADc1nB,EAAK,KAAK,CAACmJ,GAAO,OAAO,CAACA,GAC3B,UAAU,CAACnJ,EAAK,KAAK,IAAM/E,EAAAA,EAAAA,CAAAA,QAAkB,AACrE,CACJ,ECtBA,SAASksB,8BACL,MAAO,CAAE,UAAWhJ,EAAAA,EAAY,CAAGA,EAAAA,MAAgB,AAAC,CACxD,CAEO,IAAMwJ,UAAN,MAAMA,kBAAkBd,SAC3B,YAAYC,CAAa,CAAEc,EAAkCT,2BAAiB,CAAEH,EAAe,EAAK,CAAE,CAClG,KAAK,CAACF,EAAKc,EAAYZ,EAC3B,CAEU,gBAAgB/xB,CAAmB,CAAEmoB,CAA2B,CAAEpd,CAAmB,CAAE,CAC7F,OAAO,IAAIwmB,sBAAsBvxB,EAAUmoB,EAAYpd,EAC3D,CAEU,UAAUA,CAAmB,CAAEmJ,CAAU,CAAW,CAC1D,OAAOnJ,AAAkBlG,KAAAA,IAAlBkG,EAAK,QAAQ,EAAkBA,EAAK,QAAQ,GAAG,UAAU,CAACmJ,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,AAChG,CACJ,EAEO,IAAM4sB,iBAAN,MAAMA,yBAAyBhB,SAClC,YAAYC,CAAa,CAAEc,CAAsC,CAAEZ,EAAe,EAAK,CAAE,CACrF,KAAK,CAACF,EAAKc,EAAYZ,EAC3B,CAEmB,UAAUhnB,CAA0B,CAAEmJ,CAAU,CAAW,CAC1E,MAAO,EACX,CAEmB,gBACflU,CAAmB,CACnBmoB,CAA2B,CAC3Bpd,CAA0B,CAC5B,CACE,OAAO,IAAI2mB,6BAA6B1xB,EAAUmoB,EAAYpd,EAClE,CACJ,ECjBO,IAAe8nB,WAAf,MAAeA,W,wBAClB,aACaC,CAAoB,CACpB1J,CAAgB,CAChBrnB,CAA4B,CACvC,C,KAHW+wB,SAAS,CAATA,E,KACA1J,MAAM,CAANA,E,KACArnB,OAAO,CAAPA,CACV,CAEH,MAAM,QAAQ/B,CAAmB,CAAEmoB,CAA2B,CAAmC,CAC7F,GAAM,CAAEQ,UAAAA,CAAS,CAAEpD,YAAAA,CAAW,CAAE,CAAGvlB,EAAS,SAAS,AACrDA,CAAAA,EAAS,SAAS,CAAC,SAAS,CAAG,IAAI,CAAC,SAAS,CAC7CA,EAAS,SAAS,CAAC,WAAW,CAAG,IAAI,CAAC,OAAO,EAAE,YAC1C,IAAI,CAAC,OAAO,EAAE,gBACfA,EAAS,SAAS,CAAC,cAAc,GACjCA,EAAS,MAAM,CAAC,WAAW,CAAC,KAAK,IAErC,GAAI,CACA,OAAO,MAAM,IAAI,CAAC,MAAM,CAACA,EAAUmoB,EACvC,QAAU,CACNnoB,EAAS,SAAS,CAAC,SAAS,CAAG2oB,EAC/B3oB,EAAS,SAAS,CAAC,WAAW,CAAGulB,CACrC,CACJ,CAGJ,EAEO,IAAMwN,gBAAN,MAAMA,wBAAwBF,WACjC,MAAe,OACX7yB,CAAmB,CACnBmoB,CAA2B,CACI,CAC/B,IAAMtE,EAAS,MAAM7jB,EAAS,SAAS,CAAC,SAAS,CAC7C,IAAI,CAAC,MAAM,CACXmoB,EACA,IAAI,CAAC,OAAO,EAAE,WAAa,GAC3B,IAAI,CAAC,OAAO,EAAE,eAElB,GAAItE,AAAkB,IAAlBA,EAAO,MAAM,CACjB,MAAO,CACH,KAAM7jB,EAAS,WAAW,CAAC,UAAU,CACrC6jB,OAAAA,EACA,MAAOA,EAAO,GAAG,CAAC,AAACnhB,GAAMA,EAAE,KAAK,CAAC,IAAI,CACzC,CACJ,CACJ,EAEO,IAAMswB,eAAN,MAAMA,e,cACT,aACa5J,CAAgB,CAChBrnB,CAA2B,CACtC,C,KAFWqnB,MAAM,CAANA,E,KACArnB,OAAO,CAAPA,CACV,CAEH,MAAM,QAAQ/B,CAAmB,CAAEmoB,CAA2B,CAAmC,CAC7F,GAAM,CAAE8K,WAAAA,CAAU,CAAE,CAAGjzB,EAAS,SAAS,AACzCA,CAAAA,EAAS,SAAS,CAAC,UAAU,CAAG,IAAI,CAAC,OAAO,EAAE,OACzC,IAAI,CAAC,OAAO,EAAE,gBACfA,EAAS,SAAS,CAAC,cAAc,GACjCA,EAAS,MAAM,CAAC,WAAW,CAAC,KAAK,IAErC,GAAI,CACA,IAAMoE,EAAQ,MAAMpE,EAAS,SAAS,CAAC,QAAQ,CAC3C,IAAI,CAAC,MAAM,CACXmoB,EACA,IAAI,CAAC,OAAO,EAAE,WAAa,IAE/B,GAAI/jB,AAAiB,IAAjBA,EAAM,MAAM,CAAQ,OACxB,MAAO,CACH,KAAMpE,EAAS,WAAW,CAAC,UAAU,CACrC,OAAQ,EAAE,CACVoE,MAAAA,CACJ,CACJ,QAAU,CACNpE,EAAS,SAAS,CAAC,UAAU,CAAGizB,CACpC,CACJ,CACJ,EAEO,IAAMC,oBAAN,MAAMA,4BAA4BF,eAC5B,QAAQhzB,CAAmB,CAAEmoB,CAA2B,CAAmC,CAChG,IAAMyB,EAAW5pB,EAAS,SAAS,CAAC,gBAAgB,GAAG,MAAM,CAAC,AAAC0C,GAC3D,CAAI,IAAI,CAAC,OAAO,EAAE,QAAQ,OACf,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAACA,WAMzC,AAAIknB,EAAS,MAAM,CAAG,GAClBzB,EAAW,OAAO,GACXtZ,QAAQ,OAAO,CAAC,CACnB,KAAM7O,EAAS,WAAW,CAAC,UAAU,CACrC,OAAQ,EAAE,CACV,MAAO4pB,CACX,IAGG,KAAK,CAAC,QAAQ5pB,EAAUmoB,EACnC,CACJ,E,gWC1GO,IAAegL,kCAAf,MAAeA,0CAAyB9iB,EAAAA,EAAiBA,CAClD,UAA0B,EAAE,AAAC,AAEvC,KACI,iBAAkB,CAClB,OAAO,IAAI,CAAC,eAAe,CAAC,kBAAmB,GACnD,CAEA,IAAI,gBAAgB5Q,CAAc,CAAE,CAChC,IAAI,CAAC,WAAW,CAAC,kBAAmBA,EACxC,CAEU,WAA8B,CACpC,OAAOoP,QAAQ,OAAO,CAAC,GAC3B,CAEA,MAAgB,cAA8B,CACpC,MAAM,IAAI,CAAC,SAAS,IAAS,MAAM,IAAI,CAAC,YAAY,KAI1D,IAAI,CAAC,eAAe,GAEhB,IAAI,CAAC,eAAe,GACpB,IAAI,CAAC,UAAU,GACf,MAAM,IAAI,CAAC,YAAY,IAE/B,CAEA,MAAgB,cAAiC,CAC7C,IAAIukB,EAAQ,IAAI,CAAC,QAAQ,GACzB,GAAI,CACA,KAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAGA,EAAM,MAAM,EAAE,CACzC,IAAI,CAAC,UAAU,CAAG,IAAI3uB,EAAAA,EAAeA,CACrC,IAAIsG,EAAO,MAAMqoB,CAAK,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,UAAU,EACpF,GAAIroB,AAASlG,KAAAA,IAATkG,GAAsB,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,SAAW,UACzD,MAAO,GAEX,IAAI,CAAC,SAAS,CAAC,IAAI,CAACA,EACxB,CACA,MAAO,EACX,QAAU,CACN,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,GACtC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,KAAK,EAC1C,CACJ,CAEU,YAAa,CACnB,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,CAC5B,CAEU,UAAUmJ,CAAU,CAAE,CAC5B,OAAOD,EAAAA,EAAAA,CAAAA,IAAmB,CAACC,EAAOhD,EAAAA,EAAAA,CAAAA,cAA2B,CAAEA,EAAAA,EAAAA,CAAAA,eAA4B,CAC/F,CAEU,SAAS+B,CAAU,CAAEmB,CAAQ,CAAED,EAAQjD,EAAAA,EAAAA,CAAAA,gBAA6B,CAAEmiB,CAAiB,CAAE,CAC/F,IAAMtoB,EAAOtE,EAAAA,EAAAA,CAAAA,IAAiB,CAACwM,EAAOmB,EAAKD,EAAO5N,EAAAA,EAAAA,CAAAA,KAAc,EAIhE,OAHI8sB,AAAaxuB,KAAAA,IAAbwuB,GACAtoB,CAAAA,EAAK,SAAS,CAAGsoB,CAAO,EAErBtoB,CACX,CAEU,iBACNkE,CAAS,CACT,GAAG9M,CAA2F,CAChG,CACE,IAAM8S,EAAS,IAAI,CAAC,WAAW,CAAC,YAAoB,CAAChG,EAAO,IAAI9M,GAChE,OAAO,IAAI,CAAC,SAAS,CAAC8S,EAC1B,CAEU,UAAUA,CAA8B,CAAEqe,EAAe,EAAI,CAAE,CACrE,GAAIre,aAAiBvV,EAAAA,EAAMA,EAAI,CAACuV,EAAM,IAAI,CACtC,MAAMA,EAAM,KAAK,CAGrB,IAAMgI,EAAIhI,aAAiBvV,EAAAA,EAAMA,CAAGuV,EAAM,KAAK,CAAGA,EAC5Cse,EAAWtW,EAAE,iBAAiB,GAKpC,OAJIqW,GACArW,EAAE,OAAO,GAGNsW,CACX,CAEmB,UAAY,CAAC7N,EAAa3G,EAAa7K,IACtD,AAAIA,AAAUrP,KAAAA,IAAVqP,GAAwB/C,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,gBAAgC,CAIrD0X,EAAAA,EAAAA,CAAAA,mBAA6B,CAACnD,EAAM3G,EAAQ7K,GAHxCwR,EAAK,SAAS,CAAC,WAAW,CAAC3G,EAIxC,AAEQ,sBAAqByU,CAAgB,CAAEC,EAAgB,EAAI,CAAE,CACnE,IAAMxe,EAAQue,EAAK,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,cAAc,CAACA,EAAK,MAAM,CAAC,EAAE,CAAC,SAAS,EAE1E,OADIC,GAAe,IAAI,CAAC,YAAY,CAAC,GAAG,CAACxe,GAClCA,CACX,CAKJ,E,yYAnGoB,CAAC,yB,qECjBd,IAAeye,eAAf,MAAeA,uBAAuBP,kCACtB,iBAAkB,CACjCvqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,UAAW,KAC1C,IAAM+qB,EAAS,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EACpDC,EAAS,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EACpDC,EAAc,IAAI,CAAC,qBAAqB,GAExCC,EAAe,IAAI,CAAC,eAAe,CAACD,EAAaF,EAAQC,GAC/D,GAAI,CAACE,EAAa,IAAI,CAAE,YACpBpmB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,oBAAqB,kBAGzD,IAAMvJ,EAAO,IAAI2oB,YAAY,IAAI,CAAC,QAAQ,CAAEgH,EAAa,KAAK,EAC9D,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC3vB,GAC3B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,AAACzB,GAAMA,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,QAAQ,OAAOA,EAAE,KAAK,CAAC,EAAE,GACrE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEQ,gBACJqJ,CAA+B,CAC/B4nB,CAAc,CACdC,CAAc,CACA,CACd,OAAQ7nB,GACJ,IAAK,SACD,OAAO,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,aAAa,CAAC4nB,EAAQC,EAC/D,KAAK,MACD,OAAO,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,UAAU,CAACD,EAAQC,EAC5D,SACI,OAAO,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,WAAW,CAACD,EAAQC,EACjE,CACJ,CAImB,UAAoB,CACnC,MAAO,CACH,IAAIb,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,WAAY,CAAE,MAAO,AAACzC,GAASA,aAAgBof,EAAAA,EAASA,AAAC,CAC7D,GACA,IAAIwP,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,WAAY,CACR,MAAO,AAACzC,GACJ,AAAMA,aAAgBof,EAAAA,EAAQ,EAIvB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACzB,IAAI,AAAC7gB,GAAOA,EAAgB,KAAK,CAAC,KAAK,EACxC,SAASyB,EAAK,KAAK,CAAC,KAAK,CAEtC,EACA,cAAe,EACnB,GACH,AACL,CACJ,EAMO,IAAM4vB,cAAN,MAAMA,sBAAsBL,eACZ,uBAAmD,CAClE,MAAO,QACX,CACJ,E,sDAPI,IAAK,iBACL,KAAM,oB,mBAYH,IAAMM,WAAN,MAAMA,mBAAmBN,eACT,uBAAmD,CAClE,MAAO,KACX,CACJ,E,mDAPI,IAAK,cACL,KAAM,iB,gBAYH,IAAMO,YAAN,MAAMA,oBAAoBP,eACV,uBAAmD,CAClE,MAAO,MACX,CACJ,E,uYAPI,IAAK,eACL,KAAM,kB,iBC1EH,IAAMQ,QAAN,MAAMA,gBAAgBnQ,EAAAA,EAAkBA,CAClC,SAAoB,CACzB,MAAO,UACX,CAEA,IAEI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAOkH,CAAW,CAAE,CACpB,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,IAEI,OAAa,CACb,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CAEA,IACI,QAAc,CACd,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CAEA,IAEI,OAAQ,CACR,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CACA,IAAI,MAAMxrB,CAAa,CAAE,CACrB,IAAI,CAAC,2BAA2B,CAAC,QAASA,EAC9C,CAEA,YAAYO,CAAmB,CAAE+W,CAAW,CAAEkU,CAAW,CAAEhY,CAAU,CAAE+D,CAAa,CAAE,CAClF,KAAK,CAAChX,GACN,IAAI,CAAC,eAAe,CAAC,SAAU+W,GAC/B,IAAI,CAAC,eAAe,CAAC,SAAUkU,GAC/B,IAAI,CAAC,eAAe,CAAC,QAAShY,GAC9B,IAAI,CAAC,eAAe,CAAC,QAAS+D,EAClC,CAEA,eAAwC,CACpC,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,MAAM,CAAE,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,KAAK,CACtG,CACJ,E,2XAxCwB,G,WACJ,CAAC,iB,gEAQG,G,WACJ,CAAC,a,+DAKG,G,gEAKA,G,WACJ,CAAC,a,uEA3BD,CAAC,CAAC,WAAY,SAAU,SAAU,QAAS,Q,YCNxD,IAAemd,cAAf,MAAeA,sBAAsBhB,kCACrB,iBAAkB,CACjCvqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAItH,EAAO,IAAI,CAAC,YAAY,GAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,CAACA,GACtB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAGJ,EAaO,IAAeiwB,sBAAf,MAAeA,8BAA8BD,cACtC,QAAmB,EAAM,AACnC,KACW,QAAS,CAChB,OAAO,IAAI,CAAC,OAAO,AACvB,CACA,IAAW,OAAO10B,CAAc,CAAE,CAC9B,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CACJ,E,gYAPoB,CAAC,yB,gDCpBd,IAAM40B,IAAN,MAAMA,YAAYF,cACb,WAAoC,AAE5C,WAAoB,CAChB,MAAO,CACH,IAAIzB,UAAU,2BACd,IAAIF,kBAAkB,oBAAqB,IAAI,CAAC,aAAa,EAC7D,IAAIL,UACA,uBACA,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC7B,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC7B,IAAI,CAAC,YAAY,EAExB,AACL,CAEiB,cAAgB,KAC7B,GAAM,CAAEje,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACzC,MAAO,CACH,MAAO,IAAMxR,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,AAAC8U,GAAuB,IAAI,CAAC,SAAS,CAACtD,EAAMxR,EAAQ8U,GAC5D,UAAW,AAACA,GACR,CAAIA,CAAAA,EAAE,UAAU,CAAC9U,GAAUlO,EAAAA,EAAAA,CAAAA,QAAkB,AAAlBA,GACpBgjB,AAAwE,KAAxEA,EAAE,GAAG,CAAC9U,GAAQ,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAEjF,CACJ,CAAE,AAEe,cAAe,KAC5B,GAAM,CAAC+W,EAAQtU,EAAG,CAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,CACnEwG,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAE8N,EAAQtU,GAClFa,EAA0B,CAAC,IAAI,CAAC,SAAS,CAACyT,GAAS,IAAI,CAAC,SAAS,CAACtU,GAAI,CAE5E,OADA,IAAI,CAAC,WAAW,CAAG,IAAI4I,EAAAA,EAAUA,CAAC,IAAIT,EAAAA,EAAKA,CAACmM,EAAQ9N,EAAM,MAAM,CAAExG,EAAG,GAAG,CAACsU,KAClE,CACH,UAAW/B,EAAAA,IAAc,CACzB,QAAS,AAAChV,GAA2B,IAAI,CAAC,YAAY,CAACA,EAAO+W,EAAQtU,EAAIa,GAC1E,MAAO,IAAM2F,EACb,WAAY,CAAC,IAAI,CAAC,cAAc,CAAC8N,EAAQ9N,GAAO,AACpD,CACJ,CAAE,AAEM,cACJjJ,CAAsB,CACtB+W,CAAW,CACXtU,CAAO,CACPa,CAAuB,CACR,CACftD,EAAQA,GAASyC,EACjB,IAAI,CAAC,WAAW,CAAE,SAAS,CAACzC,GAC5B,IAAM/Q,EAAS,IAAIqU,EAAO,CAY1B,OAXI/J,KAAK,GAAG,CAAC,IAAI,CAAC,WAAW,CAAE,KAAK,EAAIzH,EAAAA,EAAAA,CAAAA,KAAe,EACnD7C,EAAO,IAAI,CACP,IAAI,CAAC,gBAAgB,CACjB,MACA,IAAI,CAAC,WAAW,CAAE,KAAK,CAAC,MAAM,CAC9B8nB,EACAtU,EACA,IAAI,CAAC,WAAW,CAAE,KAAK,GAI5BxT,CACX,CAEQ,eAAe8nB,CAAW,CAAE9N,CAAY,CAAE,CAC9C,OAAO,AAAC6L,GACJA,EAAE,UAAU,CAACiC,IAAWjlB,EAAAA,EAAAA,CAAAA,QAAkB,EAAI,CAACgjB,EAAE,GAAG,CAACiC,GAAQ,YAAY,CAAC9N,EAAM,MAAM,CAC9F,CAEmB,cAA6B,CAC5C,GAAM,CAACmX,EAAI3d,EAAG,CAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,CAC/DwG,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAEmX,EAAI3d,GAEpF,OADA,IAAI,CAAC,WAAW,EAAE,UAAU,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC5C,IAAIud,QAAQ,IAAI,CAAC,QAAQ,CAAE/W,EAAM,MAAM,CAAEmX,EAAI3d,EAAI,IAAI,CAAC,WAAW,CAAE,KAAK,CACnF,CAEiB,cAAgB,AAACvC,IAC9B,IAAMmgB,EAAe,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC3D,GAAI,CAACngB,EAAK,MAAO,CAACmgB,EAAa,CAC/B,GAAM,CAAErgB,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACnCvI,EAAQ,IAAI,CAAC,SAAS,CAACuI,EAAMxR,EAAQE,GAC3C,MAAO,CACHmgB,EACA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGngB,GACxC,IAAI,CAAC,gBAAgB,CAAC,SAAU+I,EAAM,MAAM,CAAEjJ,EAAQiJ,EAAM,eAAe,CAACjJ,EAAQE,IACvF,AACL,CAAE,AACN,E,4XA3FI,IAAK,aACL,KAAM,U,SCaH,IAAMogB,cAAN,MAAMA,sBAAsBL,cACZ,cAA6B,CAC5C,IAAIM,EAAS,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,AAAC/xB,GAAMA,EAAE,KAAK,GACnF,OAAO,IAAIshB,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEvS,EAAAA,EAAAA,CAAAA,SAAc,CAAC,yBAA0BgjB,EAAO,KAAK,CACrG,CAEA,MAAyB,cAAe,CACpC,IAAMrB,EAAQ,IAAI,CAAC,QAAQ,GACvBsB,EAAY,GAChB,OAAa,CACT,IAAMlB,EAAOkB,EAAYtB,CAAK,CAAC,EAAE,CAAGA,CAAK,CAAC,EAAE,AACxCsB,CAAAA,GAAWA,CAAAA,EAAY,EAAI,EAC/B,IAAI,CAAC,UAAU,CAAG,IAAIjwB,EAAAA,EAAeA,CACrC,IAAMsG,EAAO,MAAMyoB,EAAK,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,UAAU,EAC9D,GAAIzoB,AAASlG,KAAAA,IAATkG,EACA,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,SAAW,UAG9C,GADA,IAAI,CAAC,SAAS,CAAC,IAAI,CAACA,GAChB,IAAI,CAAC,OAAO,CAACA,GACb,MAAO,EAEf,CACJ,CAEQ,QAAQA,CAAgB,CAAE,CAE9B,OADApC,QAAQ,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACoC,EAAK,KAAK,GAEtD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,GACxB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACA,EAAK,KAAK,GAAM/E,EAAAA,EAAAA,CAAAA,QAAkB,AAE9E,CAEmB,UAAoB,CAGnC,MAAO,CAFS,IAAI0sB,UAAU,wBACb,IAAIA,UAAU,uBAAwB,IAAI,CAAC,WAAW,EACzC,AAClC,CAEiB,YAAc,IACpB,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,KAAK,CAC5C,UAAWxJ,EAAAA,MAAgB,CAC3B,UAAW,IAAI,CAAC,SAAS,CACzB,QAAS,IAAI,CAAC,OAAO,CACrB,cAAe,CACX,CACI,MAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,GAAI,KAAK,CAClC,OAAQzX,EAAAA,EAAAA,CAAAA,SAAc,CAAC,wBACvB,KAAM,IAAM,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,CACxC,EACH,AACL,EACF,AAEe,SAAU,AAACyC,IACxB,IAAIygB,EAAsB,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,AAAC5pB,GAAS,IAAI,CAAC,SAAS,CAACA,EAAK,KAAK,GAC5EyM,EAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,AAACzM,GAASA,EAAK,KAAK,EASpD,OARImJ,GACAsD,EAAO,IAAI,CAACtD,GAEZsD,EAAO,MAAM,CAAG,IAChBmd,EAAG,IAAI,IAAI,IAAI,CAAC,YAAY,CAACnd,IAC7Bmd,EAAG,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAUnd,KAGrCmd,CACX,CAAE,AAEe,cAAe,AAACnd,IAC7B,GAAIA,EAAO,MAAM,CAAG,EAChB,MAAO,EAAE,CAEb,IAAIod,EAAuB,EAAE,CAC7B,IAAK,IAAI5xB,EAAI,EAAGA,EAAIwU,EAAO,MAAM,CAAExU,IAC/B4xB,EAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAACpd,CAAM,CAACxU,EAAI,EAAE,CAAEwU,CAAM,CAACxU,EAAE,GAErD,OAAO4xB,CACX,CAAE,AAEQ,YAAW3hB,CAAU,CAAEmB,CAAQ,CAAE,CACvC,OAAO3N,EAAAA,EAAAA,CAAAA,IAAiB,CAACwM,EAAOmB,EAAKlD,EAAAA,EAAAA,CAAAA,kBAA+B,CAAE3K,EAAAA,EAAAA,CAAAA,IAAa,CACvF,CAEiB,UAAY,AAAC2N,IAC1B,IAAK,IAAMnJ,KAAQ,IAAI,CAAC,SAAS,CAC7B,GAAImJ,AAAgC,KAAhCA,EAAM,UAAU,CAACnJ,EAAK,KAAK,EAC3B,MAAO,GAGf,MAAO,EACX,CAAE,AACN,E,uYA9FI,IAAK,gBACL,KAAM,a,mBCJO8pB,CAAAA,GAAAA,CAAAA,EAAQA,CAAAA,EAAAA,EACLjkB,GAAG,CAAZ,SAAakkB,CAAc,CAAE7hB,CAAU,CAAEmB,CAAQ,EACpD,IAAI+I,EAAQ,IAAI2B,EAAAA,EAAKA,CAAC7L,EAAO6hB,EAAQ,MAAM,CAAEA,EAAQ,IAAI,EACrDvX,EAASnJ,EAAI,GAAG,CAACnB,GACjBuD,EAAK+G,EAAO,GAAG,CAACJ,EAAM,IAAI,EAC1B1G,EAAK8G,EAAO,GAAG,CAACJ,EAAM,IAAI,EAC9B,MAAO,CAAEA,MAAAA,EAAO3G,GAAAA,EAAIC,GAAAA,EAAI,GAAIxD,EAAO,GAAImB,CAAI,CAC/C,EAGG,IAAe2gB,gBAAf,MAAeA,wBAAwBZ,cAChC,UAAoB,CAC1B,MAAO,CACH,IAAIzB,UAAU,wBACd,IAAIF,kBAAkB,uBAAwB,IAAI,CAAC,YAAY,EAClE,AACL,CAEiB,aAAe,KAC5B,GAAM,CAAEte,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACzC,MAAO,CACH,MAAO,IAAMxR,EACb,QAAS,IAAI,CAAC,WAAW,CACzB,MAAO,AAAC8gB,GAAyB,IAAI,CAAC,SAAS,CAACtP,EAAMxR,EAAQ8gB,GAC9D,UAAW,IAAI,CAAC,WAAW,CAC3B,OAAQ,AAAC/G,IACL,IAAIljB,EAAO,IAAI,CAAC,gBAAgB,CAACkjB,EAAO,KAAK,EAC7C,MAAO,CAAC,EAAEljB,EAAK,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,EAAEA,EAAK,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,AACzD,CACJ,CACJ,CAAE,AAEe,aAAc,AAACqJ,IAC5B,IAAMrJ,EAAO,IAAI,CAAC,gBAAgB,CAACqJ,GACnC,OAAOrJ,AAASlG,KAAAA,IAATkG,GAAsB,CAAC+K,EAAAA,EAAAA,CAAAA,YAAsB,CAAC/K,EAAK,EAAE,CAAEA,EAAK,EAAE,CACzE,CAAE,AAEQ,aAAc,AAACqJ,IACrB,GAAIA,AAAQvP,KAAAA,IAARuP,EAAmB,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,CACxE,GAAM,CAAE+I,MAAAA,CAAK,CAAE3G,GAAAA,CAAE,CAAEC,GAAAA,CAAE,CAAE,CAAG,IAAI,CAAC,gBAAgB,CAACrC,GAEhD,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAACA,GACf,IAAI,CAAC,gBAAgB,CAAC,OAAQ+I,EAAO3G,EAAIC,GAC5C,AACL,CAAE,AAEQ,kBAAiBue,CAAQ,CAAY,CAC3C,GAAM,CAAEtP,KAAAA,CAAI,CAAExR,MAAAA,CAAK,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACnCiJ,EAAQhM,EAAAA,EAAAA,CAAAA,QAAAA,CAAAA,gBAAgC,CACxC0X,EAAAA,EAAAA,CAAAA,mBAA6B,CAACnD,EAAMxR,EAAQ8gB,GAC5C,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC9gB,GACnD,OAAO2gB,EAAS,GAAG,CAAC1X,EAAOjJ,EAAQ8gB,EACvC,CAEU,sBAAuB,CAC7B,IAAI5M,EAMJ,OALI,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAChByM,EAAS,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAEvF,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAG5D,CACJ,EAMO,IAAMI,KAAN,MAAMA,aAAaF,gBACtB,IACW,QAAS,CAChB,OAAO,IAAI,CAAC,eAAe,CAAC,SAAU,GAC1C,CACA,IAAW,OAAOt1B,CAAc,CAAE,CAC9B,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CAEmB,cAA6B,CAC5C,GAAM,CAAE0d,MAAAA,CAAK,CAAE3G,GAAAA,CAAE,CAAEC,GAAAA,CAAE,CAAE,CAAG,IAAI,CAAC,oBAAoB,GAC7CtS,EAAO,IAAI2nB,SAAS,IAAI,CAAC,QAAQ,CAAE3O,EAAO3G,EAAIC,GAEpD,OADAtS,EAAK,MAAM,CAAG,IAAI,CAAC,MAAM,CAClBA,CACX,CACJ,E,8XAdoB,CAAC,yB,uEAJjB,IAAK,cACL,KAAM,W,UC1EH,IAAM+wB,IAAN,MAAMA,YAAYH,gBACF,UAAoB,CAGnC,MAAO,IAFK,KAAK,CAAC,WACN,IAAIxC,iBAAiB,uBAAwB,IAAI,CAAC,iBAAiB,EACvD,AAC5B,CAEiB,kBAAoB,KACjC,IAAMpV,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACrC,GAAIA,AAAUtY,KAAAA,IAAVsY,EACA,MAAM,AAAI9a,MAAM,yCAEpB,MAAO,CACH,MAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC9B,UAAW8a,EAAM,MAAM,CACvB,QAAS,IAAI,CAAC,UAAU,AAC5B,CACJ,CAAE,AAEe,YAAa,AAAC/I,IAC3B,GAAI,CAACA,EACD,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAGnD,GAAM,CAAE+I,MAAAA,CAAK,CAAE3G,GAAAA,CAAE,CAAEC,GAAAA,CAAE,CAAE,CAAG,IAAI,CAAC,oBAAoB,GACnD,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,gBAAgB,CAAC,MAAO0G,EAAO3G,EAAIC,EAAI,IAAI,CAAC,SAAS,CAAC0G,EAAO/I,IACrE,AACL,CAAE,AAEiB,eAA6B,CAC5C,IAAMgU,EAAO,IAAI,CAAC,oBAAoB,GAChC1R,EAAK,IAAI,CAAC,SAAS,CAAC0R,EAAK,KAAK,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC7D,OAAO,IAAI2C,QAAQ,IAAI,CAAC,QAAQ,CAAE3C,EAAK,KAAK,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,CAAE1R,EACpE,CAEQ,UAAUyG,CAAY,CAAEjJ,CAAU,CAAU,CAChD,IAAMihB,EAAIjhB,EAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,GAAG,CAACiJ,EAAM,MAAM,SAC9D,AAAI1P,KAAK,GAAG,CAAC0nB,GAAKnvB,EAAAA,EAAAA,CAAAA,QAAkB,CACzBmvB,EAAI,EAAI,MAAW,KAEvBA,CACX,CACJ,E,mYAhDI,IAAK,aACL,KAAM,U,SCEH,IAAMC,OAAN,MAAMA,eAAehB,sBACxB,UAAoB,CAGhB,MAAO,CAFU,IAAI1B,UAAU,2BACd,IAAIF,kBAAkB,oBAAqB,IAAI,CAAC,aAAa,EAC/C,AACnC,CAEiB,cAAgB,KAC7B,GAAM,CAAEte,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACzC,MAAO,CACH,MAAO,IAAMxR,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,AAAC8gB,GAAyB,IAAI,CAAC,SAAS,CAACtP,EAAMxR,EAAQ8gB,GAC9D,UAAW,AAAChM,IACR,GAAIA,EAAE,UAAU,CAAC9U,GAAUlO,EAAAA,EAAAA,CAAAA,QAAkB,CAAE,MAAO,GACtD,IAAMmX,EAAQ,IAAI,CAAC,SAAS,CAACuI,EAAMxR,EAAQ8U,GAC3C,MAAOA,AAA6C,KAA7CA,EAAE,GAAG,CAAC9U,GAAQ,YAAY,CAACiJ,EAAM,MAAM,CAClD,CACJ,CACJ,CAAE,AAEiB,eAA6B,CAC5C,GAAM,CAACxG,EAAIC,EAAG,CAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,CAC/DuG,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAExG,EAAIC,GAC9Eye,EAAO,IAAIrK,WAAW,IAAI,CAAC,QAAQ,CAAE7N,EAAM,MAAM,CAAExG,EAAIwG,EAAM,eAAe,CAACxG,EAAIC,IAEvF,OADAye,EAAK,MAAM,CAAG,IAAI,CAAC,MAAM,CAClBA,CACX,CAEiB,cAAgB,AAACjhB,IAC9B,GAAI,CAACA,EAAK,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,CAE3D,GAAM,CAAEF,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACnCvI,EAAQ,IAAI,CAAC,SAAS,CAACuI,EAAMxR,EAAQE,GAC3C,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,QAAQ,CAACF,EAAQE,GACtB,IAAI,CAAC,gBAAgB,CAAC,SAAU+I,EAAM,MAAM,CAAEjJ,EAAQiJ,EAAM,eAAe,CAACjJ,EAAQE,IACvF,AACL,CAAE,AACN,E,uYA3CI,IAAK,gBACL,KAAM,a,YCWH,IAAMkhB,KAAN,MAAMA,aAAanB,cACH,UAAoB,CAInC,MAAO,CAHU,IAAIzB,UAAU,2BACd,IAAIF,kBAAkB,oBAAqB,IAAI,CAAC,aAAa,EAClE,IAAID,iBAAiB,uBAAwB,IAAI,CAAC,iBAAiB,EACzC,AAC1C,CAEiB,cAAgB,KAC7B,IAAMre,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACrC,MAAO,CACH,MAAO,IAAMA,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,AAAC8U,GAAuB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAE9U,EAAO8U,GAC7E,UAAW,AAACA,IACR,GAAIA,EAAE,UAAU,CAAC9U,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,CAAE,MAAO,GACrD,IAAMmX,EAAQ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAEjJ,EAAO8U,GAC5D,MAAOA,AAA4C,KAA5CA,EAAE,GAAG,CAAC9U,GAAO,YAAY,CAACiJ,EAAM,MAAM,CACjD,CACJ,CACJ,CAAE,AAEe,eAAgB,AAACjJ,IAC9B,GAAI,CAACA,EAAO,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,CAE7D,IAAMjB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/BkK,EAAQ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAElK,EAAOiB,GAC5D,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,QAAQ,CAACjB,EAAOiB,GACrB,IAAI,CAAC,gBAAgB,CAAC,SAAUiJ,EAAM,MAAM,CAAElK,EAAOkK,EAAM,eAAe,CAAClK,EAAOiB,IACrF,AACL,CAAE,AAEe,mBAAoB,IAC1B,EACH,MAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC9B,UAAW,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,MAAM,CAC1C,QAAS,IAAI,CAAC,WAAW,AAC7B,EACF,AAEe,aAAc,AAACE,IAC5B,GAAI,CAACA,EACD,OAAO,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAErD,IAAM6W,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAChCsK,EAAW,IAAI,CAAC,SAAS,CAACtK,GAC1B9N,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/B+N,EAAS/N,EAAM,eAAe,CAAC8N,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC9DuK,EAAKvK,EAAO,GAAG,CAAC9N,EAAM,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAACA,EAAO/I,KAClE,MAAO,CACHmhB,EACA,IAAI,CAAC,gBAAgB,CAAC,SAAUpY,EAAM,MAAM,CAAE8N,EAAQC,GACtD,IAAI,CAAC,QAAQ,CAACD,EAAO,GAAG,CAAC9N,EAAM,IAAI,CAAC,QAAQ,CAAC+N,IAAUsK,GACvD,IAAI,CAAC,QAAQ,CAACvK,EAAO,GAAG,CAAC9N,EAAM,IAAI,CAAC,QAAQ,CAAC,CAAC+N,IAAUsK,GACxD,IAAI,CAAC,QAAQ,CAACvK,EAAO,GAAG,CAAC9N,EAAM,IAAI,CAAC,QAAQ,CAAC+N,IAAUsK,GACvD,IAAI,CAAC,QAAQ,CAACvK,EAAO,GAAG,CAAC9N,EAAM,IAAI,CAAC,QAAQ,CAAC,CAAC+N,IAAUsK,GAC3D,AACL,CAAE,AAEiB,UAASviB,CAAU,CAAEmB,CAAQ,CAAE,CAC9C,OAAO3N,EAAAA,EAAAA,CAAAA,IAAiB,CAACwM,EAAOmB,EAAKlD,EAAAA,EAAAA,CAAAA,gBAA6B,CAAE3K,EAAAA,EAAAA,CAAAA,KAAc,CACtF,CAEmB,cAA6B,CAC5C,IAAM4W,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/B+N,EAAS/N,EAAM,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAChFsY,EAAS,IAAI,CAAC,SAAS,CAACtY,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC5D,OAAO,IAAIgO,SACP,IAAI,CAAC,QAAQ,CACbsK,EAAS,EAAItY,EAAM,MAAM,CAAC,OAAO,GAAKA,EAAM,MAAM,CAClD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB+N,EACAzd,KAAK,GAAG,CAACgoB,GAEjB,CAEQ,UAAUtY,CAAY,CAAEjJ,CAAU,CAAU,CAChD,OAAOA,EAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,GAAG,CAACiJ,EAAM,MAAM,CAC/D,CACJ,E,4XApFI,IAAK,cACL,KAAM,W,UCJH,IAAMuY,SAAN,MAAMA,iBAAiB3R,EAAAA,EAAkBA,CACnC,SAAoB,CACzB,MAAO,WACX,CAEA,IACI,QAA4B,CAC5B,OAAO,IAAI,CAAC,eAAe,CAAC,SAChC,CACA,IAAI,OAAO9N,CAAyB,CAAE,CAClC,IAAI,CAAC,2BAA2B,CAAC,SAAUA,EAC/C,CAEA,YAAYjW,CAAmB,CAAE6jB,CAAyB,CAAE,CACxD,KAAK,CAAC7jB,GACN,IAAI,CAAC,eAAe,CAAC,SAAU6jB,EACnC,CAEQ,aAAuB,CAC3B,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,AAAC5O,GAAUA,EAAM,QAAQ,IAAMA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAC9F,CAEQ,UAAoB,CACxB,IAAI+uB,EAAiB,EAAE,CACnB,IAAI,CAAC,WAAW,GAChB,IAAI,CAAC,cAAc,CAACA,EAAO,IAAI,CAAC,MAAM,EAEtC,IAAI,CAAC,gBAAgB,CAACA,EAAO,IAAI,CAAC,MAAM,EAG5C,IAAK,IAAI3yB,EAAI,EAAGA,EAAI2yB,EAAM,MAAM,CAAE3yB,IAC9B2yB,CAAK,CAAC3yB,EAAE,CAAC,OAAO,GAGpB,OAAO2yB,CACX,CAEQ,eAAeA,CAAc,CAAEC,CAAc,CAAQ,CACzD,IAAK,IAAM3gB,KAAS,IAAI,CAAC,MAAM,CACvBA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAClC+uB,EAAM,IAAI,CAAC1gB,GAEX,IAAI,CAAC,gBAAgB,CAAC0gB,EAAO,CAAC1gB,EAAe,CAGzD,CAEQ,iBAAiB0gB,CAAc,CAAEC,CAAc,CAAQ,CAC3D,IAAItO,EAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAACsO,GACvD,GAAI,CAACtO,EAAK,IAAI,CAAE,MAAM,AAAIjlB,MAAM,uCAChCszB,EAAM,IAAI,CAACrO,EAAK,KAAK,CACzB,CAES,eAAgC,CACrC,GAAI,AAAuB,IAAvB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAQ,OAAO5nB,EAAAA,EAAAA,CAAAA,GAAU,CAAC,4BAEhD,IAAIi2B,EAAQ,IAAI,CAAC,QAAQ,GACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAACA,EACvD,CACJ,E,mXAtDwB,G,2EANJ,CAAC,CAAC,WAAY,S,aCT3B,IAAME,SAAN,MAAMA,iBAAiB9R,EAAAA,EAAkBA,CACnC,SAAoB,CACzB,MAAO,WACX,CAEA,IACI,OAAiB,CACjB,OAAO,IAAI,CAAC,eAAe,CAAC,QAChC,CACA,IAAI,MAAM9N,CAAe,CAAE,CACvB,IAAI,CAAC,2BAA2B,CAAC,QAASA,EAC9C,CAEA,YAAYjW,CAAmB,CAAE41B,CAAc,CAAE,CAC7C,KAAK,CAAC51B,GACN,IAAI,CAAC,eAAe,CAAC,QAAS41B,EAClC,CAES,eAAgC,CACrC,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CACjE,CACJ,E,wXAhBwB,G,0EANJ,CAAC,CAAC,WAAY,Q,aCsBlC,IAAeE,eAAf,MAAeA,uBAAuBzlB,EAAAA,EAAiBA,CACnD,MAAM,cAA8B,CAChC,IAAMkY,EAAS,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,EACvD,GAAI,CAACA,EAAQ,YACT7a,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,2BAGpC9E,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAMtH,EAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAEokB,EACnCpkB,CAAAA,EAAK,IAAI,EAGV,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAACA,EAAK,KAAK,EACrC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,GAC3BuJ,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,kBAJhCA,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,yBAOpC6a,EAAO,OAAO,CAAC,AAAC7lB,GAAMA,EAAE,MAAM,EAAE,OAAOA,GAC3C,EACJ,CAGU,aAA4B,CAClC,MAAO,CACH,MAAO,AAACuS,GACJA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,EAAIqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,AAChF,CACJ,CAEA,MAAM,gBAAgB5G,CAAmB,CAAE,CACvC,IAAMsoB,EAAS,IAAI,CAAC,WAAW,GAC3BC,EAAS,IAAI,CAAC,kBAAkB,CAACvoB,EAAUsoB,GAE/C,GADAtoB,EAAS,SAAS,CAAC,cAAc,GAC7BuoB,EAAO,MAAM,CAAG,EAAG,OAAOA,EAE9B,IAAMiL,EAAO,IAAIR,eAAe,uBAAwB,CACpD,OAAQ,IAAI1N,EAAAA,EAAeA,CAACgD,GAC5B,SAAU,EACd,EACA,KAAI,CAAC,UAAU,CAAG,IAAI7jB,EAAAA,EAAeA,CACrC,IAAMsG,EAAO,MAAMyoB,EAAK,OAAO,CAACxzB,EAAU,IAAI,CAAC,UAAU,EAEzD,OADAA,EAAS,SAAS,CAAC,cAAc,GAC1B+K,GAAM,KACjB,CAEQ,mBAAmB/K,CAAmB,CAAEsoB,CAAqB,CAAE,CACnE,OAAOtoB,EAAS,SAAS,CACpB,gBAAgB,GAChB,GAAG,CAAC,AAAC0C,GAAMA,GACX,MAAM,CAAC,AAACA,IACL,GAAIA,AAAMmC,KAAAA,IAANnC,EAAiB,MAAO,GAC5B,IAAIuS,EAAQvS,EAAE,KAAK,CAAC,KAAK,QACXmC,KAAAA,IAAVoQ,GACAqT,CAAAA,AAAWzjB,KAAAA,IAAXyjB,IAAwB,CAACA,EAAO,KAAK,CAACrT,EAAK,CAEnD,EACR,CACJ,EAMO,IAAM8gB,cAAN,MAAMA,sBAAsBD,eACZ,OAAO91B,CAAmB,CAAEuoB,CAAmB,CAAwB,CACtF,IAAMqN,EAAQrN,EAAO,GAAG,CAAC,AAAC7lB,GAAMA,EAAE,KAAK,CAAC,KAAK,CAAC,cAAc,CAACA,EAAE,cAAc,KACvEszB,EAAW,IAAIH,SAAS71B,EAAU41B,GAClC3gB,EAAQ+gB,EAAS,aAAa,UACpC,AAAK/gB,EAAM,IAAI,CAERvV,EAAAA,EAAAA,CAAAA,EAAS,CAACs2B,GAFOt2B,EAAAA,EAAAA,CAAAA,GAAU,CAACuV,EAAM,KAAK,CAGlD,CACJ,E,+CAZI,IAAK,iBACL,KAAM,a,mBAiBH,IAAMghB,cAAN,MAAMA,sBAAsBH,eACZ,OAAO91B,CAAmB,CAAEuoB,CAAmB,CAAwB,CACtF,IAAMqN,EAAQrN,EAAO,GAAG,CAAC,AAAC7lB,GAAMA,EAAE,KAAK,CAAC,KAAK,CAAC,cAAc,CAACA,EAAE,cAAc,KACvEszB,EAAW,IAAIN,SAAS11B,EAAU41B,GAClC3gB,EAAQ+gB,EAAS,aAAa,UACpC,AAAK/gB,EAAM,IAAI,CAERvV,EAAAA,EAAAA,CAAAA,EAAS,CAACs2B,GAFOt2B,EAAAA,EAAAA,CAAAA,GAAU,CAACuV,EAAM,KAAK,CAGlD,CACJ,E,+CAZI,IAAK,iBACL,KAAM,a,mBAiBH,IAAMihB,eAAN,MAAMA,uBAAuBJ,eACb,aAA4B,CAC3C,MAAO,CACH,MAAO,AAAC7gB,GAAkBA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,AAChE,CACJ,CAEmB,OAAO5G,CAAmB,CAAEuoB,CAAmB,CAAwB,CACtF,IAAM4N,EAAQ5N,EAAO,GAAG,CAAC,AAAC7lB,GAAMA,EAAE,KAAK,CAAC,KAAK,CAAC,cAAc,CAACA,EAAE,cAAc,KACvEuS,EAAQ,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,CAACkhB,GAElD,GADAA,EAAM,OAAO,CAAC,AAACzzB,GAAMA,EAAE,OAAO,IAC1B,CAACuS,EAAM,IAAI,CAAE,OAAOvV,EAAAA,EAAAA,CAAAA,GAAU,CAACuV,EAAM,KAAK,EAE9C,IAAMmhB,EAAQ,IAAIpS,EAAAA,EAAiBA,CAAChkB,EAAU,QAASiV,GACvD,OAAOvV,EAAAA,EAAAA,CAAAA,EAAS,CAAC02B,EACrB,CACJ,E,gDAnBI,IAAK,kBACL,KAAM,c,oBAwBH,IAAMC,eAAN,MAAMA,uBAAuBP,eACb,aAA4B,CAC3C,MAAO,CACH,MAAO,AAAC7gB,GAAkBA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,KAAe,AACjE,CACJ,CAEmB,OAAO5G,CAAmB,CAAEuoB,CAAmB,CAAwB,CACtF,IAAM4N,EAAQ5N,EAAO,GAAG,CAAC,AAAC7lB,GAAMA,EAAE,KAAK,CAAC,KAAK,CAAC,cAAc,CAACA,EAAE,cAAc,KACvEuS,EAAQ,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,CAACkhB,GAElD,GADAA,EAAM,OAAO,CAAC,AAACzzB,GAAMA,EAAE,OAAO,IAC1B,CAACuS,EAAM,IAAI,CAAE,OAAOvV,EAAAA,EAAAA,CAAAA,GAAU,CAACuV,EAAM,KAAK,EAE9C,IAAMqhB,EAAQ,IAAItS,EAAAA,EAAiBA,CAAChkB,EAAU,QAASiV,GACvD,OAAOvV,EAAAA,EAAAA,CAAAA,EAAS,CAAC42B,EACrB,CACJ,E,4YAnBI,IAAK,kBACL,KAAM,c,oBCjIH,IAAMC,oBAAN,MAAMA,4BAA4BpD,kCAClB,iBAAkB,CACjCvqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,AAAC/I,IAC9B,IAAM8zB,EAAW9zB,EAAE,KAAK,CAAC,KAAK,GACxB+zB,EAAQ,IAAIzS,EAAAA,EAAiBA,CAC/B,IAAI,CAAC,QAAQ,CACbpd,EAAAA,EAAAA,CAAAA,WAAqB,CAAC4vB,EAAS,SAAS,EACxCA,GAGEryB,EAAOzB,EAAE,KAAK,CAAC,IAAI,AACzB+zB,CAAAA,EAAM,SAAS,CAAGtyB,EAAK,SAAS,CAChCA,EAAK,MAAM,CAAE,WAAW,CAACA,EAAMsyB,EACnC,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,GAC3B/oB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,gBACpC,EACJ,CAEmB,UAAW,CAC1B,MAAO,CACH,IAAIqlB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CAAE,SAAU,EAAK,GAChG,AACL,CACJ,E,uZA5BI,IAAK,mBACL,KAAM,e,yBCIH,IAAM8vB,SAAN,MAAMA,iBAAiBvC,cACP,UAAoB,CAInC,MAAO,CAHU,IAAIzB,UAAU,2BACd,IAAIF,kBAAkB,oBAAqB,IAAI,CAAC,aAAa,EAClE,IAAID,iBAAiB,uBAAwB,IAAI,CAAC,iBAAiB,EACzC,AAC1C,CAEiB,cAAgB,KAC7B,GAAM,CAAEre,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACzC,MAAO,CACH,MAAO,IAAMxR,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,AAAC8gB,GAAyB,IAAI,CAAC,SAAS,CAACtP,EAAMxR,EAAQ8gB,GAC9D,UAAW,AAAChM,IACR,GAAIA,EAAE,UAAU,CAAC9U,GAAUlO,EAAAA,EAAAA,CAAAA,QAAkB,CAAE,MAAO,GACtD,IAAMmX,EAAQ,IAAI,CAAC,SAAS,CAACuI,EAAMxR,EAAQ8U,GAC3C,MAAOA,AAA6C,KAA7CA,EAAE,GAAG,CAAC9U,GAAQ,YAAY,CAACiJ,EAAM,MAAM,CAClD,CACJ,CACJ,CAAE,AAEe,eAAgB,AAACjJ,IAC9B,GAAI,CAACA,EAAO,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,CAE7D,IAAMjB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/BkK,EAAQ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAElK,EAAOiB,GAC5D,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,QAAQ,CAACjB,EAAOiB,GACrB,IAAI,CAAC,gBAAgB,CAAC,SAAUiJ,EAAM,MAAM,CAAElK,EAAOkK,EAAM,eAAe,CAAClK,EAAOiB,IACrF,AACL,CAAE,AAEe,mBAAoB,IAC1B,EACH,MAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC9B,UAAW,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,MAAM,CAC1C,QAAS,IAAI,CAAC,eAAe,CAC7B,UAAW,AAAC8U,GACDvb,KAAK,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGub,IAAM,IAEvE,EACF,AAEe,iBAAkB,AAAC5U,IAChC,GAAI,CAACA,EACD,OAAO,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAGrD,IAAM+I,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/B+N,EAAS/N,EAAM,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAChFsY,EAAS,IAAI,CAAC,SAAS,CAACtY,EAAO/I,GAErC,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,gBAAgB,CACjB,WACAqhB,EAAS,EAAItY,EAAM,MAAM,CAAC,OAAO,GAAKA,EAAM,MAAM,CAClD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB+N,EACAzd,KAAK,GAAG,CAACgoB,IAEhB,AACL,CAAE,AAEiB,eAA6B,CAC5C,IAAMtY,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/B+N,EAAS/N,EAAM,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAChFzG,EAAK,IAAI,CAAC,SAAS,CAACyG,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACxD,OAAO,IAAIiO,aACP,IAAI,CAAC,QAAQ,CACb1U,EAAK,EAAIyG,EAAM,MAAM,CAAC,OAAO,GAAKA,EAAM,MAAM,CAC9C,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB+N,EACAzd,KAAK,GAAG,CAACiJ,GAEjB,CAEQ,UAAUyG,CAAY,CAAEjJ,CAAU,CAAU,CAChD,OAAOA,EAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,GAAG,CAACiJ,EAAM,MAAM,CAC/D,CACJ,E,8YArFI,IAAK,kBACL,KAAM,e,cCEH,IAAMwZ,QAAN,MAAMA,gBAAgBvC,sBACzB,UAAoB,CAIhB,MAAO,CAHU,IAAI1B,UAAU,2BACb,IAAIF,kBAAkB,oBAAqB,IAAI,CAAC,cAAc,EAC9D,IAAID,iBAAiB,oBAAqB,IAAI,CAAC,cAAc,EAClC,AACjD,CAEiB,eAAiB,KAC9B,IAAMre,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACrC,MAAO,CACH,MAAO,IAAMA,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,AAAC8gB,GAAyB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAE9gB,EAAO8gB,GAC/E,UAAW,IAAI,CAAC,aAAa,AACjC,CACJ,CAAE,AAEe,eAAgB,AAAC9gB,IAC9B,IAAM+W,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACtC,GAAI/W,EAAM,UAAU,CAAC+W,GAAUjlB,EAAAA,EAAAA,CAAAA,QAAkB,CAAE,MAAO,GAC1D,IAAMmX,EAAQ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAE8N,EAAQ/W,GAC7D,MAAOA,AAAiD,KAAjDA,EAAM,GAAG,CAAC+W,GAAQ,YAAY,CAAC9N,EAAM,MAAM,CACtD,CAAE,AAEQ,eAAgB,AAAC/I,IACvB,GAAIA,AAAQvP,KAAAA,IAARuP,EAAmB,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,CAExE,IAAM+I,EAAQ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG/I,GAC/E,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAACA,GACf,IAAI,CAAC,gBAAgB,CACjB,SACA+I,EAAM,MAAM,CACZ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB/I,EAAI,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,GAE7C,AACL,CAAE,AAEe,gBAAiB,KAC9B,IAAMF,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAE/B+L,EAAY9C,AADJ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACb,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAACjJ,IAAQ,SAAS,GACnF,MAAO,CACH,MAAOA,EACP,QAAS,IAAI,CAAC,cAAc,CAC5B+L,UAAAA,EACA,UAAW,IAAI,CAAC,aAAa,AACjC,CACJ,CAAE,AAEiB,eAA6B,CAC5C,GAAM,CAACqU,EAAI3d,EAAIC,EAAG,CAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,CAC7FuG,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC/B6P,EAAK7P,EAAM,eAAe,CAACmX,EAAI3d,GAC/BsW,EAAK9P,EAAM,eAAe,CAACmX,EAAI1d,GAErC,OADa,IAAIyU,YAAY,IAAI,CAAC,QAAQ,CAAElO,EAAM,MAAM,CAAEmX,EAAI3d,EAAG,GAAG,CAAC2d,GAAKtH,EAAIC,EAAKD,EAAKA,EAAKC,EAEjG,CAEiB,eAAiB,AAAC/Y,GAC/B,AAAKA,EAEE,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,aAAa,CAACA,GACtB,CANkB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAO/D,AAEM,eAAc0C,CAAO,CAAE,CAC3B,IAAM0d,EAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC5B3d,EAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC5BwG,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAE/B6P,EAAK7P,EAAM,eAAe,CAACmX,EAAI3d,GAC/BsW,EAAK9P,EAAM,eAAe,CAACmX,EAAI1d,GACrC,OAAO,IAAI,CAAC,gBAAgB,CAAC,UAAWuG,EAAM,MAAM,CAAEmX,EAAI3d,EAAG,GAAG,CAAC2d,GAAKtH,EAAIC,EAAKD,EAAKA,EAAKC,EAC7F,CACJ,E,kYApFI,IAAK,iBACL,KAAM,c,aCGH,IAAM2J,KAAN,MAAMA,aAAazC,cACH,cAA6B,CAC5C,IAAIlf,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CACzC,CAACf,EAAO6C,EAAO,CAAG9B,EAAM,MAAM,CAAC,EAAG,GAClCmY,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAAClZ,GAAO,GAAG,CAAC6C,GACnD,OAAO,IAAI4U,UAAU,IAAI,CAAC,QAAQ,CAAE1W,EAAOmY,EAC/C,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI2F,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBACpC,IAAI2rB,iBAAiB,uBAAwB,IAAI,CAAC,iBAAiB,EACtE,AACL,CAEQ,kBAAoB,KACxB,IAAItd,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CACzC,CAACf,EAAO6C,EAAO,CAAG9B,EAAM,MAAM,CAAC,EAAG,GACtC,MAAO,CACHf,MAAAA,EACA,UAAW6C,EACX,QAAS,AAACiS,IACN,GAAI,CAACA,EAAG,MAAO,EAAE,CACjB,IAAIoE,EAAOpE,EAAE,GAAG,CAAC9U,GAAO,GAAG,CAAC6C,GAC5B,GAAItJ,KAAK,GAAG,CAAC2f,GAAQpnB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,MAAO,EAAE,CAC/C,IAAIiR,EAAMF,EAAO,QAAQ,CAACqW,GAC1B,MAAO,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,CAACnY,EAAOgC,GAAK,KAAK,CAAC,IAAI,CAAC,KAAK,CAAE,AAC9E,CACJ,CACJ,CAAE,AACN,E,sXAjCI,IAAK,eACL,KAAM,a,UCYV,IAAM4f,gBAAN,MAAMA,wBAAwB1tB,EAAAA,EAAUA,CACpC,IAAI,MAAO,CACP,OAAO,IAAI,CAAC,eAAe,CAAC,OAAQ,UACxC,CACA,IAAI,KAAK1J,CAAa,CAAE,CACpB,IAAI,CAAC,WAAW,CAAC,OAAQA,EAC7B,CAEA,IAAI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAAUqE,EAAAA,EAAAA,CAAAA,IAAQ,CAClD,CACA,IAAI,OAAOrE,CAAU,CAAE,CACnB,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CAEA,IAAI,iBAAkB,CAClB,OAAO,IAAI,CAAC,eAAe,CAAC,kBAAmB,GACnD,CACA,IAAI,gBAAgBA,CAAc,CAAE,CAChC,IAAI,CAAC,WAAW,CAAC,kBAAmBA,EACxC,CACJ,EAMO,IAAMq3B,aAAN,MAAMA,qBAAqB3D,kCACX,UAAoB,CACnC,MAAO,CAAC,IAAID,oBAAoB,sBAAuB,CAAE,SAAU,EAAK,GAAG,AAC/E,CAEmB,iBAAwB,CACvC,IAAM9uB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,AAACD,GAASA,aAAgBme,EAAAA,EAAUA,EAClF,GAAI,CAACle,GAASA,AAAiB,IAAjBA,EAAM,MAAM,CAAQ,YAC9BsJ,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,2BAIpC,IAAIqpB,EAAa,IAAIF,gBAErBnpB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,aAAc,uBAAwB,IAAI,CAAC,MAAM,CAACqpB,GAAa,AAACvuB,IAC3EA,IAAMzB,EAAAA,EAAAA,CAAAA,EAAe,EAAE,IAAI,CAAC,WAAW,CAACgwB,EAAY3yB,EAC5D,EACJ,CAEQ,YAAY2yB,CAA2B,CAAE3yB,CAAmB,CAAE,CAClEwE,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,eAAgB,KAC/C,IAAK,IAAMzE,KAAQC,EAAO,CACtB,IAAMyiB,EAAiB1iB,EAAK,cAAc,EAC1CA,CAAAA,EAAK,MAAM,EAAE,SAASA,GACtBA,EAAK,SAAS,CAAG0iB,CACrB,CAEA,IAAMmQ,EAAY,IAAI7S,EAAAA,EAASA,CAAC4S,EAAW,IAAI,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGA,EAAW,MAAM,EAG5F,GAFA,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAACC,GAE1BD,EAAW,eAAe,CAAE,CAC5B,IAAMniB,EAAQ,IAAIyP,EAAAA,EAAaA,CAC3B,IAAI,CAAC,QAAQ,CACb0S,EAAW,IAAI,CACfC,EAAU,EAAE,CACZA,EAAU,MAAM,EAEpB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAACpiB,EAC/B,CACJ,EACJ,CAEiB,gBAAkB,MAAOmiB,EAA6Bh3B,KACnE,IAAMk3B,EAAS,IAAI,CAAC,UAAU,CAACl3B,EAAE,MAAM,EACvC,GAAI,CAACk3B,EAAQ,OACbA,EAAO,KAAK,GAEZ,IAAM7mB,EAAU,IAAI8mB,uBAAuB,IAAI,CAAC,QAAQ,CAAEH,GAC1D,GAAI,CACA,GAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,gBAAgB,CAC1C,MAAM,AAAI10B,MAAM,uBAEpB,KAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,gBAAgB,CAAG+N,EAC7C,MAAMA,EAAQ,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CACnD,QAAU,CACN6mB,EAAO,SAAS,GAChB,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,gBAAgB,CAAGpyB,KAAAA,CACjD,CACJ,CAAE,AAEe,YAAa,AAAC9E,GAC3B,AAAIA,aAAao3B,kBAA0Bp3B,EACtCA,EAAE,aAAa,CAEb,IAAI,CAAC,UAAU,CAACA,EAAE,aAAa,QACxC,AAEM,QAAOg3B,CAA2B,CAAE,CACxC,MAAOt2B,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACH,CACI,MAAO,CACH,QAAS,OACT,cAAe,SACf,IAAK,MACT,CACJ,EACAI,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACI,CACI,YAAa,IAAIN,EAAAA,EAAQA,CAAC,cAC9B,EACA,MAEJI,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAM,CACF,MAAO,IAAI+E,EAAAA,EAAOA,CAACqxB,EAAY,QAC/B,UAAW,AAACh3B,IACRA,EAAE,eAAe,EACrB,EACA,OAAQ,AAACA,IACLg3B,EAAW,IAAI,CAAIh3B,EAAE,MAAM,CAAsB,KAAK,AAC1D,CACJ,GACAc,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACI,CACI,YAAa,IAAIN,EAAAA,EAAQA,CAAC,6BAC9B,EACA,MAEJE,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACI,CACI,MAAO,CACH,QAAS,cACT,cAAe,MACf,QAAS,OACT,gBAAiB,OACjB,aAAc,MACd,IAAK,KACT,CACJ,EACAE,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAM,CACF,MAAO,IAAI+E,EAAAA,EAAOA,CAACqxB,EAAY,SAAU,IAAIlzB,EAAAA,EAAYA,EACzD,UAAW,AAAC9D,IACRA,EAAE,eAAe,EACrB,CACJ,GACAa,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAO,CACH,YAAa,IAAIL,EAAAA,EAAQA,CAAC,8BAC1B,QAAS,AAACR,GAAM,IAAI,CAAC,eAAe,CAACg3B,EAAYh3B,EACrD,IAEJU,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EACIE,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAM,CACF,KAAM,WACN,GAAI,aACJ,QAAS,IAAI+E,EAAAA,EAAOA,CAACqxB,EAAY,mBACjC,SAAU,AAACh3B,IACPg3B,EAAW,eAAe,CAAIh3B,EAAE,MAAM,CAAsB,OAAO,AACvE,CACJ,GACA,IACAc,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAM,CACF,YAAa,IAAIN,EAAAA,EAAQA,CAAC,oCAC1B,QAAS,YACb,IAGZ,CACJ,E,0CA3II,IAAK,eACL,KAAM,Y,kBA4IV,IAAM22B,uBAAN,MAAMA,uB,mBACF,aACal3B,CAAmB,CACnBo3B,CAA2B,CACtC,C,KAFWp3B,QAAQ,CAARA,E,KACAo3B,UAAU,CAAVA,CACV,CAEH,MAAM,QAAQ7mB,CAAyB,CAAiB,CACpD,IAAM8mB,EAAgB,IAAI3E,UAAU,8BAC9BvK,EAAa,IAAI1jB,EAAAA,EAAeA,CAChCtB,EAAS,MAAMk0B,EAAc,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAElP,EAEtDhlB,CAAAA,GAAQ,OACR,KAAI,CAAC,UAAU,CAAC,MAAM,CAAGA,EAAO,KAAK,AAAD,CAE5C,CACJ,E,2VC/LO,IAAMm0B,KAAN,MAAMA,aAAanD,cACtB,IAGI,YAAa,CACb,OAAO,IAAI,CAAC,eAAe,CAAC,aAAc,GAC9C,CACA,IAAI,WAAW10B,CAAc,CAAE,CAC3B,IAAI,CAAC,WAAW,CAAC,aAAcA,EACnC,CAEmB,cAA6B,CAC5C,OAAO,IAAI+rB,SAAS,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACxF,CAEA,UAAoB,CAGhB,MAAO,CAFS,IAAIkH,UAAU,wBACb,IAAIA,UAAU,uBAAwB,IAAI,CAAC,kBAAkB,EAChD,AAClC,CAEmB,YAAa,CACxB,IAAI,CAAC,UAAU,EACf,IAAI,CAAC,SAAS,CAAC,EAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACrC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,GAExB,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,CAEhC,CAEiB,mBAAqB,IAC3B,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvC,UAAWxJ,EAAAA,MAAgB,CAC3B,UAAW,AAAChV,GACD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACA,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,CAE1E,QAAS,IAAI,CAAC,WAAW,AAC7B,EACF,AAEe,aAAc,AAACkO,GAC5B,AAAKA,EAGE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGA,GAAO,CAFtF,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,AAGvD,AACN,E,0XA9CoB,CAAC,6BAA8B,CAC3C,aAAc,CAAC,CAAE,SAAU,kBAAmB,MAAO,EAAK,EAAE,A,8EALhE,IAAK,cACL,KAAM,W,UCaH,IAAMqjB,cAAN,MAAMA,sBAAsBpE,kCACZ,iBAAkB,CACjC,IAAMpc,EAAS,IAAI,CAAC,OAAO,GAAG,MAAM,CAC9B9B,EAAQ,IAAI,CAAC,iBAAiB,CAAC8B,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,EACjE5S,EAAO,IAAI6f,EAAAA,EAAiBA,CAC9B,IAAI,CAAC,QAAQ,CACbvS,EAAAA,EAAAA,CAAAA,SAAc,CAAC,yBACfwD,EAAM,KAAK,EAEf,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC9Q,GAC3B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI4uB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBACtE,IAAI2rB,iBAAiB,gBAAiB,KAClC,IAAIiF,EAAK,IAAI,CAAC,OAAO,GACrB,MAAO,CACH,MAAOA,EAAG,KAAK,CACf,UAAWA,EAAG,SAAS,CACvB,QAAS,AAACtjB,GAA2B,IAAI,CAAC,OAAO,CAACsjB,EAAItjB,EAC1D,CACJ,GACH,AACL,CAEQ,QACJsjB,CAA+C,CAC/CtjB,CAAsB,CACP,CACf,IAAI0gB,EAAuB,CAAC,IAAI,CAAC,SAAS,CAAC4C,EAAG,KAAK,EAAE,CACrD,GAAItjB,AAAUrP,KAAAA,IAAVqP,EAAqB,CACrB0gB,EAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC4C,EAAG,KAAK,CAAEtjB,IACjC,IAAIsY,EAAWtY,EAAM,GAAG,CAACsjB,EAAG,KAAK,EAAE,GAAG,CAACA,EAAG,SAAS,EAC/CviB,EAAQ,IAAI,CAAC,iBAAiB,CAACuiB,EAAG,MAAM,CAAEhL,EAC1CvX,CAAAA,EAAM,IAAI,EACV2f,EAAI,IAAI,CAAC3f,EAAM,KAAK,CAAC,iBAAiB,GAE9C,CACA,OAAO2f,CACX,CAEQ,SAAuD,CAC3D,IAAI3hB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CACzCgC,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,SACvD,AAAIA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAC3B,IAAI,CAAC,WAAW,CAACqO,EAAgBhC,GAGrC,IAAI,CAAC,iBAAiB,CAACgC,EAAOhC,EACzC,CAEQ,kBAAkBgC,CAAa,CAAEhC,CAAU,CAAE,CACjD,IAAIiU,EAAOjS,CACPA,CAAAA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,EAClCsgB,CAAAA,EAAQjS,EAAgB,MAAM,GAAG,KAAK,AAAD,EAEzC,IAAM8B,EAASmQ,EAAK,MAAM,CAAC,EAAG,EAAE,CAAC,EAAE,CAC7B,CAAEK,QAAAA,CAAO,CAAEtH,UAAAA,CAAS,CAAE,CAAG,IAAI,CAAC,0BAA0B,CAAChL,EAAOhC,EAAO8D,GAC7E,MAAO,CACH,MAAOwQ,EAAQ,KAAK,CACpBxQ,OAAAA,EACA,UAAWkJ,EAAU,KAAK,CAAClJ,GAAQ,SAAS,EAChD,CACJ,CAEQ,YAAY0Q,CAAW,CAAExU,CAAU,CAAE,CACzC,IAAMN,EAAQ8U,EAAK,KAAK,CAClBxH,EAAYtN,EAAM,EAAE,CAACA,EAAM,SAAS,CAACM,EAAO,MAAQ,GACpD8D,EAASsQ,EAAAA,CAAAA,CAAAA,MAAe,CAACI,GAC/B,MAAO,CACH,MAAOxU,EACP8D,OAAAA,EACA,UAAWkJ,EAAU,KAAK,CAAClJ,GAAQ,SAAS,EAChD,CACJ,CAEQ,2BAA2B9B,CAAa,CAAEhC,CAAU,CAAE8D,CAAW,CAAE,CACvE,IAAIuQ,EAAOrS,CACPA,CAAAA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,EAClC0gB,CAAAA,EAAQrS,EAAgB,SAAS,EAAC,EAEtC,IAAMsS,EAAUF,EAAAA,CAAAA,CAAAA,YAAqB,CAACC,EAAMrU,GACtCwkB,EAAWpQ,EAAAA,CAAAA,CAAAA,YAAqB,CAACC,EAAMC,EAAQ,IAAI,EAAE,KAAK,CAC5DtH,EAAYsH,EAAQ,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,EAAG,GACnCrJ,EAAQqJ,EAAQ,IAAI,CAAC,WAAW,KAAOkQ,EAAS,WAAW,GAAK,EAAI,GACpEC,EAAgBD,EAAS,KAAK,CAAC,EAAE,CAAC,EAAG,GAAG,QAAQ,CAACvZ,GAIvD,OAHI+B,EAAU,KAAK,CAACyX,GAAe,SAAS,IAAI,aAAa3gB,IACzDkJ,CAAAA,EAAYA,EAAU,QAAQ,CAAC,GAAE,EAE9B,CAAEsH,QAAAA,EAAStH,UAAAA,CAAU,CAChC,CAEQ,kBAAkBlJ,CAAW,CAAEyV,CAAgB,CAAE,CACrD,IAAIvX,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EACvD,GAAIA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAClC,OAAQqO,EAAgB,MAAM,CAACuX,EAAUzV,GAG7C,IAAIuQ,EAAOrS,EAIX,OAHIA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,EAClC0gB,CAAAA,EAAQrS,EAAgB,SAAS,EAAC,EAE/BqS,EAAK,MAAM,CAACkF,EAAU7lB,EAAAA,EAAAA,CAAAA,YAAqB,CACtD,CACJ,E,0YA7GI,IAAK,gBACL,KAAM,a,mBCAH,IAAMgxB,QAAN,MAAMA,gBAAgBvD,sBACN,cAA6B,CAC5C,IAAIjwB,EAAO,IAAIunB,YACX,IAAI,CAAC,QAAQ,CACb,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,AAAC8H,GAASA,EAAK,KAAK,GAG3C,OADArvB,EAAK,MAAM,CAAG,IAAI,CAAC,MAAM,CAClBA,CACX,CAEA,MAAyB,cAAiC,CACtD,IAAIivB,EAAQ,IAAI,CAAC,QAAQ,GACrBsB,EAAY,GAChB,OAAa,CACT,IAAIlB,EAAOkB,EAAYtB,CAAK,CAAC,EAAE,CAAGA,CAAK,CAAC,EAAE,AACtCsB,CAAAA,GAAWA,CAAAA,EAAY,EAAI,EAC/B,IAAI,CAAC,UAAU,CAAG,IAAIjwB,EAAAA,EAAeA,CACrC,IAAIsG,EAAO,MAAMyoB,EAAK,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,UAAU,EAC5D,GAAIzoB,AAASlG,KAAAA,IAATkG,EACA,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,SAAW,UAG9C,GADA,IAAI,CAAC,SAAS,CAAC,IAAI,CAACA,GAChB,IAAI,CAAC,OAAO,CAACA,GACb,MAAO,EAEf,CACJ,CAEQ,QAAQA,CAAgB,CAAE,CAC9B,OACI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,GACxB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACA,EAAK,KAAK,GAAM/E,EAAAA,EAAAA,CAAAA,QAAkB,AAE9E,CAEmB,UAAoB,CAGnC,MAAO,CAFS,IAAI0sB,UAAU,wBACb,IAAIA,UAAU,uBAAwB,IAAI,CAAC,WAAW,EACzC,AAClC,CAEiB,YAAc,IACpB,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,KAAK,CAC5C,UAAWxJ,EAAAA,MAAgB,CAC3B,UAAW,IAAI,CAAC,SAAS,CACzB,QAAS,IAAI,CAAC,OAAO,CACrB,cAAe,CACX,CACI,MAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,GAAI,KAAK,CAClC,OAAQzX,EAAAA,EAAAA,CAAAA,SAAc,CAAC,wBACvB,KAAM,IAAM,IAAI,CAAC,SAAS,CAAC,MAAM,CAAG,CACxC,EACH,AACL,EACF,AAEe,SAAU,AAACyC,IACxB,IAAIygB,EAAK,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,AAAC5pB,GAAS,IAAI,CAAC,SAAS,CAACA,EAAK,KAAK,GAC3D6qB,EAAQ,IAAI5gB,EAAAA,EAAmBA,CAKnC,OAJA,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,AAACjK,GAAS6qB,EAAM,WAAW,CAAC7qB,EAAK,KAAK,CAAE,CAAC,CAAEA,EAAK,KAAK,CAAE,CAAC,CAAEA,EAAK,KAAK,CAAE,CAAC,GAC1FmJ,GACA0hB,EAAM,WAAW,CAAC1hB,EAAM,CAAC,CAAEA,EAAM,CAAC,CAAEA,EAAM,CAAC,EAExC,IAAIygB,EAAIiB,EAAM,KAAK,GAAG,AACjC,CAAE,AAEe,WAAY,AAAC1hB,IAC1B,IAAK,IAAMnJ,KAAQ,IAAI,CAAC,SAAS,CAC7B,GAAImJ,AAAgC,KAAhCA,EAAM,UAAU,CAACnJ,EAAK,KAAK,EAC3B,MAAO,GAGf,MAAO,EACX,CAAE,AACN,E,0YA9EI,IAAK,iBACL,KAAM,c,aCLH,IAAM6sB,MAAN,MAAMA,cAAczD,cACJ,cAA6B,CAC5C,IAAMlf,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAE,IACrD,CAAEf,MAAAA,CAAK,CAAE6C,OAAAA,CAAM,CAAE,CAAG,IAAI,CAAC,OAAO,CAAC9B,GACjCmY,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAAClZ,GAAO,GAAG,CAAC6C,GACrD,OAAO,IAAI4U,UAAU,IAAI,CAAC,QAAQ,CAAE1W,EAAOmY,EAC/C,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI2F,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBACtE,IAAI2rB,iBAAiB,uBAAwB,IAAI,CAAC,iBAAiB,CAAE,IACxE,AACL,CAEiB,kBAAoB,KACjC,IAAMtd,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EACnD,CAAEf,MAAAA,CAAK,CAAE6C,OAAAA,CAAM,CAAE,CAAG,IAAI,CAAC,OAAO,CAAC9B,GACvC,MAAO,CACHf,MAAAA,EACA,UAAW6C,EACX,QAAS,AAACiS,IACN,GAAI,CAACA,EAAG,MAAO,EAAE,CACjB,IAAMoE,EAAOpE,EAAE,GAAG,CAAC9U,GAAO,GAAG,CAAC6C,GAC9B,GAAItJ,KAAK,GAAG,CAAC2f,GAAQpnB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,MAAO,EAAE,CAC/C,IAAMiR,EAAMF,EAAO,QAAQ,CAACqW,GAC5B,MAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAASnY,EAAOgC,GAAK,AACvD,CACJ,CACJ,CAAE,AAEM,SAAQhC,CAAa,CAAE,CAG3B,MAAO,CAAEf,MAFK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAE/B6C,OADDsQ,EAAAA,CAAAA,CAAAA,MAAe,CAACpS,EACR,CAC3B,CACJ,E,wYAvCI,IAAK,iBACL,KAAM,Y,WCAH,IAAM4iB,QAAN,MAAMA,gBAAgB9C,gBACN,UAAoB,CAGnC,MAAO,IAFK,KAAK,CAAC,WACN,IAAIxC,iBAAiB,uBAAwB,IAAI,CAAC,iBAAiB,EACvD,AAC5B,CAEiB,kBAAoB,KACjC,IAAMpV,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACrC,GAAIA,AAAUtY,KAAAA,IAAVsY,EACA,MAAM,AAAI9a,MAAM,yCAGpB,MAAO,CACH6R,MAFU,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,QAAQ,CAAC,IAG1E,UAAWiJ,EAAM,MAAM,CACvB,QAAS,IAAI,CAAC,cAAc,AAChC,CACJ,CAAE,AAEe,gBAAiB,AAAC/I,IAC/B,GAAI,CAACA,EACD,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAGnD,IAAMrJ,EAAO,IAAI,CAAC,oBAAoB,GACtC,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,gBAAgB,CAAC,UAAWA,EAAK,KAAK,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,CAAE,IAAI,CAAC,SAAS,CAACA,EAAK,KAAK,CAAEqJ,IAC7F,AACL,CAAE,AAEiB,eAA6B,CAC5C,IAAMgU,EAAO,IAAI,CAAC,oBAAoB,GAChC1R,EAAK,IAAI,CAAC,SAAS,CAAC0R,EAAK,KAAK,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC7D,OAAO,IAAIyD,YAAY,IAAI,CAAC,QAAQ,CAAEzD,EAAK,KAAK,CAAEA,EAAK,EAAE,CAAEA,EAAK,EAAE,CAAE1R,EACxE,CAEQ,UAAUyG,CAAY,CAAEjJ,CAAU,CAAU,CAChD,OAAOA,EAAM,GAAG,CAACiJ,EAAM,MAAM,EAAE,GAAG,CAACA,EAAM,MAAM,CACnD,CACJ,E,4YA7CI,IAAK,iBACL,KAAM,c,aCaH,IAAM2a,QAAN,MAAMA,gBAAgB3D,cACzB,IACW,OAAQ,CACf,OAAO,IAAI,CAAC,eAAe,CAAC,QAAS,IACzC,CACA,IAAW,MAAM10B,CAAa,CAAE,CAC5B,IAAI,CAAC,WAAW,CAAC,QAASA,EAC9B,CAEmB,cAA6B,CAC5C,IAAMwV,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAE,IACrDwS,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAW,KAAK,CAAC,UAAU,CACpEnD,EAAY,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,CACjD2H,EAAO,IAAIjM,EAAAA,EAAGA,CAACsE,EAAU,OAAO,CAACmD,EAAK,KAAK,CAAC,IAAKnD,EAAU,QAAQ,CAACmD,EAAK,SAAS,GACxF,OAAO,IAAIsE,aAAa,IAAI,CAAC,QAAQ,CAAE9W,EAAOgX,EAAM,IAAI,CAAC,KAAK,CAClE,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI8G,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBACtE,IAAImsB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACvD,YAAa,IAAImxB,WACjB,cAAe,EACnB,GACH,AACL,CACJ,E,uCAzBoB,CAAC,gB,+EAJjB,IAAK,gBACL,KAAM,c,aA8BV,IAAMA,WAAN,MAAMA,WACF,MAAM9iB,CAAa,CAAW,CAC1B,GAAIA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAAE,CAEpC,IAAI+L,EAAQ8U,AADDxS,EACM,KAAK,CAAC,UAAU,CACjC,OAAO5O,EAAAA,EAAAA,CAAAA,MAAa,CAACsM,EACzB,CACA,MAAO,EACX,CACJ,E,uVCjDO,IAAMqlB,QAAN,MAAMA,gBAAgB7E,kCACN,iBAAkB,CACjC,IAAIle,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EACnD9P,EAAO,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EAClD8yB,EAAUhjB,EAAM,OAAO,CAAC9P,GACtBhB,EAAO,IAAI6f,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEvS,EAAAA,EAAAA,CAAAA,SAAc,CAAC,0BAA2BwmB,GAC5F,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC9zB,GAC3B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI4uB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,cAAeK,EAAAA,EAAAA,CAAAA,eAA2B,AAC9C,GACA,IAAI8rB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CAAE,cAAe,EAAK,GACrF,AACL,CACJ,E,oYArBI,IAAK,iBACL,KAAM,c,aCGH,IAAMsxB,OAAN,MAAMA,eAAe/D,cACL,UAAoB,CAGnC,MAAO,CAFU,IAAIzB,UAAU,2BACd,IAAIF,kBAAkB,oBAAqB,IAAI,CAAC,aAAa,EAC/C,AACnC,CAEiB,cAAgB,KAC7B,IAAMte,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACrC,MAAO,CACH,MAAO,IAAMA,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAACA,GAC1D,UAAW,AAAC8U,GAAWA,EAAE,UAAU,CAAC9U,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,AACnE,CACJ,CAAE,AAEe,eAAgB,AAACoO,IAC9B,GAAI,CAACA,EACD,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,CAGrD,IAAM8W,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAE,WAAW9W,GACnD,MAAO,CACH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,gBAAgB,CAAC,SAAUtQ,EAAAA,EAAAA,CAAAA,KAAS,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGonB,GACrE,IAAI,CAAC,gBAAgB,CAAC,SAAUpnB,EAAAA,EAAAA,CAAAA,KAAS,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGonB,GACxE,AACL,CAAE,AAEiB,eAA6B,CAC5C,IAAMA,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC1E,OAAO,IAAIgB,WAAW,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGhB,EACnE,CACJ,E,wYArCI,IAAK,gBACL,KAAM,a,YCEH,IAAMiN,MAAN,MAAMA,cAAchE,cACJ,cAA6B,CAC5C,IAAMlf,EAAQ,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAE,IACrD9P,EAAO,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAE,IAC1D,OAAO,IAAIgnB,YAAY,IAAI,CAAC,QAAQ,CAAElX,EAAO9P,EACjD,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI4tB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBACtE,IAAImsB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACxE,cAAe,EACnB,GACH,AACL,CACJ,E,oYAlBI,IAAK,gBACL,KAAM,Y,WCAH,IAAMwxB,kBAAN,MAAMA,0BAA0BjF,kCACnC,IACI,WAAY,CACZ,OAAO,IAAI,CAAC,eAAe,CAAC,YAAa,GAC7C,CACA,IAAI,UAAU1zB,CAAa,CAAE,CACzB,IAAI,CAAC,WAAW,CAAC,YAAaA,EAClC,CAEmB,iBAAwB,CACvCmJ,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,AAAC/I,IAC9B,IAAM8zB,EAAW,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,sBAAsB,CACjE9zB,EAAE,KAAK,CACP,IAAI,CAAC,SAAS,EAElB,GAAI,CAAC8zB,EAAS,IAAI,CAAE,YAChB9oB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,yBAGpC,IAAM+oB,EAAQ,IAAIzS,EAAAA,EAAiBA,CAC/B,IAAI,CAAC,QAAQ,CACbvS,EAAAA,EAAAA,CAAAA,SAAc,CAAC,6BACf+kB,GAGEryB,EAAOzB,EAAE,KAAK,CAAC,IAAI,AACzB+zB,CAAAA,EAAM,SAAS,CAAGtyB,EAAK,SAAS,CAChCA,EAAK,MAAM,CAAE,WAAW,CAACA,EAAMsyB,EACnC,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,GAC3B/oB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,gBACpC,EACJ,CAEmB,UAAoB,CACnC,MAAO,CAAC,IAAIqlB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CAAE,SAAU,EAAK,GAAG,AAC3F,CACJ,E,mYArCoB,CAAC,4B,mGAJjB,IAAK,oBACL,KAAM,iB,uBCJV,IAAI7D,EAAQ,EAML,IAAMs1B,sBAAN,MAAMA,sBACT,MAAM,QAAQ9nB,CAAyB,CAAiB,CACpD,IAAMmV,EAAOnV,EAAY,UAAU,CAC9BmV,GAELA,EAAK,QAAQ,CAAC,IAAI,CAAC,IAAI,CACnB,IAAID,EAAAA,EAAGA,CACH,CAAC,EAAEhU,EAAAA,EAAAA,CAAAA,SAAc,CAAC,oBAAoB,CAAC,EAAE1O,IAAQ,CAAC,CAClD2iB,EAAK,gBAAgB,CAAC,cAAc,CACpCA,EAAK,gBAAgB,CAAC,YAAY,CAClCA,EAAK,gBAAgB,CAAC,QAAQ,EAG1C,CACJ,E,oZAjBI,IAAK,kBACL,KAAM,U,2BCEH,IAAM4S,OAAN,MAAMA,eAAenF,kCACL,iBAAwB,CACvC,IAAM/uB,EAA6B,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC1D,GAAI,CAACA,GAASA,AAAiB,IAAjBA,EAAM,MAAM,CAAQ,YAC9BsJ,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,0BAIhC,KAAI,CAAC,QAAQ,CAAC,WAAW,EAAItJ,EAAM,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,GACrE,KAAI,CAAC,QAAQ,CAAC,WAAW,CAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,AAAD,EAGrD,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,GACtCwE,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,SAAU,KACzCxE,EAAM,OAAO,CAAC,AAACqyB,GAAUA,EAAM,MAAM,EAAE,OAAOA,GAClD,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,GAC3B/oB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,yBAA0BtJ,EAAM,MAAM,CAC1E,CAEmB,UAAoB,CACnC,MAAO,CAAC,IAAI8uB,oBAAoB,uBAAwB,CAAE,SAAU,EAAK,GAAG,AAChF,CACJ,E,2XA1BI,IAAK,oBACL,KAAM,a,YCJV,IAAInwB,EAAQ,EAML,IAAMw1B,UAAN,MAAMA,UACT,MAAM,QAAQtP,CAAiB,CAAiB,CAC5C,IAAMjpB,EAAWipB,EAAI,UAAU,EAAE,SAC3BuP,EAAS,IAAIzT,EAAAA,EAAUA,CAAC/kB,EAAU,CAAC,MAAM,EAAE+C,IAAQ,CAAC,EAC1D/C,EAAS,OAAO,CAACw4B,EACrB,CACJ,E,oYATI,IAAK,gBACL,KAAM,kB,eCcH,IAAMC,OAAN,MAAMA,OACT,MAAM,QAAQloB,CAAyB,CAAiB,CACpD,IAAMmoB,EAAcnoB,EAAY,YAAY,CAAC,aAAa,GAAG,IAAI,CAAC,KAC5DnB,EAAQ,MAAMV,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAegqB,EAAa,IAChD,GAAI,CAACtpB,EAAM,IAAI,EAAIA,AAAuB,IAAvBA,EAAM,KAAK,CAAC,MAAM,CAAQ,YACzC+a,MAAM/a,EAAM,KAAK,EAGrBkb,YAAY/Z,EAAanB,EAAM,KAAK,CACxC,CACJ,E,2CAbI,IAAK,cACL,KAAM,a,YAkBH,IAAMupB,OAAN,MAAMA,eAAetoB,EAAAA,EAAiBA,CACzC,IACW,SAAU,CACjB,OAAO,IAAI,CAAC,eAAe,CAAC,UAAW,IAAI,CAAC,YAAY,GAC5D,CACA,IAAW,QAAQ5Q,CAAuB,CAAE,CACxC,IAAI,CAAC,WAAW,CAAC,UAAWA,EAChC,CAEQ,cAAe,CACnB,IAAM2X,EAAM,IAAIoO,EAAAA,EAAQA,CAExB,OADApO,EAAI,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,aAAa,IACtDA,CACX,CAEA,MAAgB,cAAe,CAC3B,IAAMhT,EAAQ,MAAM,IAAI,CAAC,gBAAgB,GACzC,GAAI,CAACA,GAASA,AAAiB,IAAjBA,EAAM,MAAM,CAAQ,YAC9BsJ,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,2BAIpCA,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CACd,gBACA,UACI,IAAMkrB,EAAS,IAAI,CAAC,OAAO,CAAC,YAAY,CACxC,GAAIA,AAAW/zB,KAAAA,IAAX+zB,EAAsB,OAE1B,IAAM7tB,EAAO,MAAM,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC6tB,EAAQx0B,GAC3D2G,IAEL2C,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,qBAChCS,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAASpD,EAAM,CAAC,EAAE3G,CAAK,CAAC,EAAE,CAAC,IAAI,CAAC,EAAEw0B,EAAO,CAAC,EAC9C,EACA,oBACAnnB,EAAAA,EAAAA,CAAAA,SAAc,CAAC,uBAEvB,CAEA,MAAc,kBAAmB,CAC7B,IAAI,CAAC,UAAU,CAAG,IAAIhN,EAAAA,EAAeA,CACrC,IAAM+uB,EAAO,IAAIR,eAAe,uBAAwB,CAAE,SAAU,GAAM,cAAe,EAAK,GACxFjoB,EAAO,MAAMyoB,EAAK,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,SAAW,IAAI,CAAC,UAAU,SACvF,AAAKzoB,GAAM,MAIJA,EAAK,KAAK,MAHb2C,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,gCAIxC,CACJ,E,0XAhDoB,CAAC,e,6EAJjB,IAAK,cACL,KAAM,a,YCvBH,IAAMmrB,aAAN,MAAMA,qBAAqB1F,kCACX,UAAoB,CACnC,IAAMuB,EAAY,IAAIhC,UAAU,wBAGhC,MAAO,CAACgC,EAFW,IAAIhC,UAAU,uBAAwB,IAAI,CAAC,kBAAkB,EAC9D,IAAIA,UAAU,uBAAwB,IAAI,CAAC,iBAAiB,EACrC,AAC7C,CAEiB,mBAAqB,IAC3B,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvC,UAAWxJ,EAAAA,MAAgB,CAC3B,UAAW,AAAChV,GACD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACA,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,CAE1E,QAAS,IAAI,CAAC,WAAW,AAC7B,EACF,AAEe,aAAc,AAACkO,GAC5B,AAAKA,EAGE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGA,GAAO,CAFtF,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,AAGvD,AAEe,mBAAoB,IAC1B,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvC,UAAWgV,EAAAA,MAAgB,CAC3B,OAAQ,AAAC/lB,GAAuB,IAAI,CAAC,WAAW,CAACA,EAAO,KAAK,EAC7D,UAAW,AAAC+Q,GAEJ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACA,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,EAC/D,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACkO,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,CAGvE,QAAS,IAAI,CAAC,UAAU,AAC5B,EACF,AAEe,aAAc,AAACkO,IAC5B,GAAM,CAAE4kB,IAAAA,CAAG,CAAE,CAAG,IAAI,CAAC,OAAO,CAAC5kB,GAC7B,MAAQ,AAAC4kB,CAAAA,AAAM,IAANA,EAAarrB,KAAK,EAAC,EAAG,OAAO,CAAC,GAAK,MAChD,CAAE,AAEe,YAAa,AAACyG,IAC3B,IAAM4P,EAA0B,CAC5B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,QAAQ,CACT,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB5S,EAAAA,EAAAA,CAAAA,kBAA+B,CAC/B,GAEP,CACD,GAAI,CAACgD,EAAO,OAAO4P,EAEnB,GAAM,CAAEiV,GAAAA,CAAE,CAAED,IAAAA,CAAG,CAAE/hB,OAAAA,CAAM,CAAE,CAAG,IAAI,CAAC,OAAO,CAAC7C,GACnC8C,EAAS8hB,AAAM,IAANA,EAAarrB,KAAK,EAAE,CACnC,GAAIuJ,EAAQhR,EAAAA,EAAAA,CAAAA,KAAe,CAAE,OAAO8d,EAEpC,IAAMkV,EAAQ,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAG9kB,EAAOhD,EAAAA,EAAAA,CAAAA,kBAA+B,CAAE,GACxF+nB,EAAM,IAAI,CAAC,WAAW,CAAC,YAAY,CACpC,GAAG,CACAliB,EACA,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAACgiB,EAAG,QAAQ,CAAC,AA1EpC,GA0EoC,IAAI,CAAC,UAAU,CAAC7kB,KACzD8C,GAEH,SAAS,IAAI,KAAK,MAGvB,OAFAiiB,EAAI,SAAS,CAAG,EAChBA,EAAI,KAAK,CAAG/nB,EAAAA,EAAAA,CAAAA,kBAA+B,CACpC,CAAC8nB,EAAOC,KAAQnV,EAAO,AAClC,CAAE,AAEM,YAAW5P,CAAsB,CAAE,CACvC,IAAM8Y,EAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,SACtE,AAAK9Y,EAIEzG,KAAK,GAAG,CAACuf,EADL,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAAC9Y,IAFpC8Y,CAIf,CAEQ,QAAQ9Y,CAAU,CAAE,CACxB,IAAM6kB,EAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,SAAS,GACrEG,EAAKhlB,EAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,SAAS,GAClD4kB,EAAMC,EAAG,OAAO,CAACG,GACjBniB,EAASgiB,EAAG,KAAK,CAACG,GAAI,SAAS,GACrC,MAAO,CACHH,GAAAA,EACAG,GAAAA,EACAJ,IAAAA,EACA/hB,OAAAA,CACJ,CACJ,CAEmB,iBAAwB,CACvC,GAAM,CAAEgiB,GAAAA,CAAE,CAAED,IAAAA,CAAG,CAAE/hB,OAAAA,CAAM,CAAE,CAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC1DoiB,EAASJ,EACV,MAAM,CAAChiB,EAAQ+hB,AAAM,GAANA,GACf,QAAQ,CAAC,AA7GD,GA6GC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,GAChD,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC1BM,EAAW,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CACrD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,KACnC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAE9C,KAAI,CAAC,WAAW,CAAC,UAAU,EAAE,SAAU,AAACN,CAAAA,AAAM,IAANA,EAAarrB,KAAK,EAAC,EAAG,OAAO,CAAC,GAAK,OAAK0rB,EAAQ,CACpF,UAAW,KACP,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAACC,EAC5C,CACJ,EACJ,CACJ,E,gYAtHI,IAAK,gBACL,KAAM,mB,kBCAH,IAAMC,cAAN,MAAMA,sBAAsBlG,kCACZ,UAAoB,CAGnC,MAAO,CAFS,IAAIT,UAAU,wBACb,IAAIA,UAAU,uBAAwB,IAAI,CAAC,kBAAkB,EAChD,AAClC,CAEiB,mBAAqB,IAC3B,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvC,UAAWxJ,EAAAA,MAAgB,CAC3B,UAAW,AAAChV,GACD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,UAAU,CAACA,GAASlO,EAAAA,EAAAA,CAAAA,QAAkB,CAE1E,QAAS,IAAI,CAAC,WAAW,AAC7B,EACF,AAEe,aAAc,AAACkO,GAC5B,AAAKA,EAGE,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGA,GAAO,CAFtF,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,AAGvD,AAEiB,kBAAwB,CACvC,IAAMolB,EAAa,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACpCC,EAAc,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACrC/M,EAAW8M,EAAW,UAAU,CAACC,GACjCH,EAAW,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CACrD,IAAI,CAAC,SAAS,CAACE,GACf,IAAI,CAAC,QAAQ,CAACA,EAAYC,EAAaroB,EAAAA,EAAAA,CAAAA,kBAA+B,CAAE,GACxE,IAAI,CAAC,SAAS,CAACqoB,GAEnB,KAAI,CAAC,WAAW,CAAC,UAAU,EAAE,SACzB/M,EAAS,OAAO,CAAC,GACjB8M,EAAW,GAAG,CAACC,GAAa,QAAQ,CAAC,IACrC,CACI,UAAW,KACP,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAACH,EAC5C,CACJ,EAER,CACJ,E,4CA/CI,IAAK,iBACL,KAAM,oB,sXCoBH,IAAMI,cAAN,MAAMA,sBAAsBnpB,EAAAA,EAAiBA,CAChD,EAAc,CAAG,EAAM,AACvB,GAAI,CAAG,CAAE,AACT,GAAM,AAKJ,AACO,GAAW,CAAqB,IAAI7L,GAAM,AAEnD,GAAS,AAAsB,AAC/B,KACW,UAA+B,CAItC,OAHI,AAAC,IAAI,CAAC,EAAS,EACf,KAAI,CAAC,EAAS,CAAG,IAAI,CAAC,YAAY,EAAC,EAEhC,IAAI,CAAC,EAAS,AACzB,CACA,IAAW,SAAS/E,CAAyB,CAAE,CAC3C,IAAI,CAAC,EAAS,EAAE,uBAChB,IAAI,CAAC,EAAS,CAAGA,EACjB,IAAI,CAAC,EAAS,CAAC,iBAAiB,CAAC,IAAI,CAAC,YAAY,CACtD,CAEQ,cAAe,CACnB,IAAM2X,EAAM,IAAIoO,EAAAA,EAAQA,CAGxB,OAFApO,EAAI,KAAK,CAAC,IAAI,CAAC,gBAAiB,cAAe,iBAC/CA,EAAI,iBAAiB,CAAC,IAAI,CAAC,YAAY,EAChCA,CACX,CAEiB,aAAe,KAC5B,IAAI,CAAC,EAAc,CAAG,GACtB,IAAI,CAAC,UAAU,EAAE,SACjB,IAAI,CAAC,EAAM,EAAE,UAAU,SACvB,IAAI,CAAC,EAAM,CAAGvS,KAAAA,EACd,IAAI,CAAC,EAAW,CAAC,OAAO,CAAC,AAAC0R,GAAMA,EAAE,OAAO,IACzC,IAAI,CAAC,EAAW,CAAC,KAAK,GACtB,IAAI,CAAC,EAAI,CAAG,CAChB,CAAE,AAEM,YAAY,CACZ,IAAI,CAAC,EAAM,EACX,IAAI,CAAC,EAAM,CAAC,SAAS,CAAC,MAAM,GAEhC,IAAI,CAAC,EAAM,CAAG,CACV,UAAW9V,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAI,CACX,UAAWuD,EAAAA,SAAe,AAC9B,GACA,OAAQ/C,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAG,CAAE,YAAa,IAAIV,EAAAA,EAAQA,CAAC,IAAI,CAAC,EAAS,CAAE,YAAY,CAAG,GACtE,KAAMY,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,IACN,MAAOT,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAK,CACR,YAAa,MACjB,EACJ,EACA,IAAI,CAAC,EAAM,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,EAAM,CAAC,MAAM,CAAE,IAAI,CAAC,EAAM,CAAC,IAAI,CAAEQ,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,EAAG,IAAI,CAAC,EAAM,CAAC,KAAK,GAEvF,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,KAAK,OAAO,IAAI,CAAC,EAAM,CAAC,SAAS,CAClE,CAEQ,WAAWoB,CAAY,CAAE,CAC7B,IAAI,CAAC,EAAI,EAAIA,EACT,AAAC,IAAI,CAAC,EAAM,EACZ,IAAI,CAAC,SAAS,GAGlB,IAAMm3B,EAAKz5B,SAAS,aAAa,CAAC,KAClCy5B,CAAAA,EAAG,WAAW,CAAGn3B,EAAK,OAAO,CAAC,GAC9B,IAAI,CAAC,EAAM,CAAE,IAAI,CAAC,MAAM,CAACm3B,GACzB,IAAI,CAAC,EAAM,CAAE,KAAK,CAAC,WAAW,CAAG,IAAI,CAAC,EAAI,CAAC,OAAO,CAAC,EACvD,CAEmB,cAAqB,CACpC,KAAK,CAAC,eACN,IAAI,CAAC,QAAQ,EAAE,uBACf,IAAI,CAAC,EAAW,CAAC,OAAO,CAAC,AAACljB,GAAMA,EAAE,OAAO,IACzC,IAAI,CAAC,EAAW,CAAC,KAAK,GACtB,IAAI,CAAC,EAAM,EAAE,UAAU,QAC3B,CAEA,MAAyB,cAA8B,CACnD,OAAa,CACT,IAAI,CAAC,UAAU,CAAG,IAAI9R,EAAAA,EAAeA,CACrC,IAAIsH,EAA8B,CAACnF,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAsB,AACrE,AAAgC,KAAhC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAC3BmF,EAAO,CAACnF,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAsB,CACvC,AAAgC,IAAhC,IAAI,CAAC,QAAQ,CAAC,aAAa,EAClCmF,CAAAA,EAAO,CAACnF,EAAAA,EAAAA,CAAAA,KAAe,CAAE,uBAAuB,A,EAGpD,IAAM4sB,EAAO,IAAIT,gBAAgBhnB,CAAI,CAAC,EAAE,CAAEA,CAAI,CAAC,EAAE,EAC3C5I,EAAS,MAAMqwB,EAAK,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,UAAU,EAChE,GAAI,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,SAAW,UACnC,IAAI,IAAI,CAAC,EAAc,CAInB,WAJqB,CACrB,IAAI,CAAC,EAAc,CAAG,GACtB,QACJ,CAIJ,IAAI,CAAC,aAAa,CAACrwB,GAAQ,MAAM,CAAC,EAAE,CACxC,CACJ,CAEiB,cAAgB,AAAC8R,IACzBA,IACDA,EAAM,KAAK,CAAC,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CACxC,IAAI,CAAC,WAAW,CAACqO,EAAM,KAAK,CAAWA,EAAM,SAAS,EAC/CA,EAAM,KAAK,CAAC,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,CAC/C,IAAI,CAAC,WAAW,CAACqO,EAAM,KAAK,CAAWA,EAAM,SAAS,EAC/CA,EAAM,KAAK,CAAC,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,KAAe,EAChD,IAAI,CAAC,YAAY,CACbqO,EAAM,KAAK,CACXA,EAAM,SAAS,CACfkC,EAAAA,EAAAA,CAAAA,MAAkB,CAAClC,EAAM,KAAK,CAAC,WAAW,KAGtD,CAAE,AAEM,aAAYwS,CAAW,CAAEnD,CAAkB,CAAE,CAEjD,IAAMrR,EAAQwU,AADdA,CAAAA,EAAOA,EAAK,cAAc,CAACnD,EAAS,EACjB,KAAK,CAAC,UAAU,GAC7BlQ,EAAMqT,EAAK,KAAK,CAAC,QAAQ,GACzBmE,EAASnE,EAAK,MAAM,GAC1B,IAAI,CAAC,UAAU,CAACmE,GAChB,IAAMrY,EAAOkU,EAAK,IAAI,CAAC,KAAK,CAC5BA,EAAK,OAAO,GACZlU,EAAK,SAAS,CAAG,EACjBA,EAAK,KAAK,CAAGrC,EAAAA,EAAAA,CAAAA,kBAA+B,CAE5C,IAAM3D,EAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAACgG,GACpD,IAAI,CAAC,EAAW,CAAC,GAAG,CAChB,IAAI,CAAC,WAAW,CAAC,UAAU,CAAE,QAAQ,CAACqY,EAAO,OAAO,CAAC,GAAI3Y,EAAM,GAAG,CAACmB,GAAK,QAAQ,CAAC,IAAM,CACnF,WAAY,GACZ,UAAW,KACP,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC7G,EAC5C,CACJ,GAER,CAEQ,YAAY2Z,CAAW,CAAE5C,CAAkB,CAAE,CACjD,IAAMgD,EAAOJ,EAAK,SAAS,GACrB3T,EAAO+T,EAAK,IAAI,CAAC,KAAK,CAC5BA,EAAK,OAAO,GACZ/T,EAAK,SAAS,CAAG,EACjBA,EAAK,KAAK,CAAGrC,EAAAA,EAAAA,CAAAA,kBAA+B,CAC5CqC,EAAK,QAAQ,CAAG,IAAIjJ,aAAaga,EAAU,QAAQ,CAAC/Q,EAAK,QAAQ,GAEjE,IAAMmmB,EAAOxS,EAAK,IAAI,GACtB,IAAI,CAAC,UAAU,CAACwS,GAChB,IAAMzO,EAAS,IAAI,CAAC,UAAU,CAAC1X,EAAK,QAAQ,EACtChG,EAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAACgG,GACpD,IAAI,CAAC,EAAW,CAAC,GAAG,CAChB,IAAI,CAAC,WAAW,CAAC,UAAU,CAAE,QAAQ,CAACmmB,EAAK,OAAO,CAAC,GAAIzO,EAAQ,CAC3D,WAAY,GACZ,UAAW,KACP,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC1d,EAC5C,CACJ,GAER,CAEQ,WAAWiK,CAAyB,CAAE,CAC1C,IAAMyT,EAAS,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAClC,IAAK,IAAIjoB,EAAI,EAAGA,EAAIwU,EAAO,MAAM,CAAExU,GAAK,EACpCioB,EAAO,CAAC,EAAIzT,CAAM,CAACxU,EAAE,CACrBioB,EAAO,CAAC,EAAIzT,CAAM,CAACxU,EAAI,EAAE,CACzBioB,EAAO,CAAC,EAAIzT,CAAM,CAACxU,EAAI,EAAE,CAG7B,IAAM4oB,EAASpU,EAAO,MAAM,CAAG,EAI/B,OAHAyT,EAAO,CAAC,EAAIW,EACZX,EAAO,CAAC,EAAIW,EACZX,EAAO,CAAC,EAAIW,EACLX,CACX,CAEQ,aAAaqL,CAAa,CAAEhS,CAAkB,CAAE2G,CAAW,CAAE,CACjE,IAAM1X,EAAO+iB,EAAM,IAAI,CAAC,KAAK,AAC7B/iB,CAAAA,EAAK,SAAS,CAAG,EACjBA,EAAK,KAAK,CAAGrC,EAAAA,EAAAA,CAAAA,kBAA+B,CAC5CqC,EAAK,QAAQ,CAAG,IAAIjJ,aAAaga,EAAU,QAAQ,CAAC/Q,EAAK,QAAQ,GAEjE,IAAMomB,EAASrD,EAAM,MAAM,GAC3B,IAAI,CAAC,UAAU,CAACqD,GAChB,IAAMpsB,EAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAACgG,GACpD,IAAI,CAAC,EAAW,CAAC,GAAG,CAChB,IAAI,CAAC,WAAW,CAAC,UAAU,CAAE,QAAQ,CAAComB,EAAO,OAAO,CAAC,GAAIrV,EAAU,OAAO,CAAC2G,GAAS,CAChF,WAAY,GACZ,UAAW,KACP,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC1d,EAC5C,CACJ,GAER,CACJ,E,oXAzLoB,CAAC,e,sFAfjB,IAAK,iBACL,KAAM,oB,mBCNH,IAAMqsB,MAAN,MAAMA,cAAczG,kCACJ,iBAAkB,CACjCvqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAMwJ,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CACzCtC,EAAQsC,EAAM,KAAK,CACnBf,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAC/C,cAAc,GACd,MAAM,GACN,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC9Byd,EAAYhf,EAAM,SAAS,CAACuB,EAAO,MACzC,GAAIyd,AAAc9sB,KAAAA,IAAd8sB,EAAyB,OAE7B,IAAMkI,EAASlnB,EAAM,IAAI,CAACgf,EAAWhf,EAAM,aAAa,IACxDA,EAAM,OAAO,CAACA,EAAM,cAAc,GAAIgf,GACtC1c,EAAM,MAAM,CAACtC,GAEb,IAAM8jB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAM,CAAC,EAAE,CACnCqD,EAAS,IAAI9V,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,EAAEyS,EAAM,IAAI,CAAC,EAAE,CAAC,CAAExhB,GACjE8kB,EAAS,IAAI/V,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,EAAEyS,EAAM,IAAI,CAAC,EAAE,CAAC,CAAEoD,EAAO,QAAQ,GACtFC,CAAAA,EAAO,SAAS,CAAGrD,EAAM,SAAS,CAClCsD,EAAO,SAAS,CAAGtD,EAAM,SAAS,CAClCA,EAAM,MAAM,EAAE,YAAYA,EAAOqD,GACjCrD,EAAM,MAAM,EAAE,YAAYqD,EAAQC,GAClCtD,EAAM,MAAM,EAAE,OAAOA,GAErB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI1D,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,YAAa,CAAE,MAAO,AAACqW,GAAMA,EAAE,SAAS,GAAKrW,EAAAA,EAAAA,CAAAA,IAAc,AAAC,CAChE,GACA,IAAIgsB,iBAAiB,uBAAwB,IAAI,CAAC,eAAe,CAAE,IACtE,AACL,CAEiB,gBAAkB,KAC/B,IAAMnL,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CACxC9U,EAAQ8U,EAAK,KAAK,CAAC,WAAW,CAChCA,EAAK,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,GAI9D,OAFA,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC9U,GAEf,CACHA,MAAAA,EACA,UAAWuW,EAAAA,EAAY,CACvB,QAAS,AAAChV,IACN,GAAI,CAACA,EAAO,MAAO,EAAE,CACrB,IAAI8lB,EAAUrnB,EAAM,OAAO,CAACuB,GAAO,EAAE,CAAC,GACtC,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC8lB,GAAW9lB,GAAO,AAC7C,CACJ,CACJ,CAAE,AACN,E,wXA1DI,IAAK,eACL,KAAM,Y,WCTH,IAAM+lB,gBAAN,MAAMA,wBAAwB9G,kCACjC,IACI,YAAqB,CACrB,OAAO,IAAI,CAAC,eAAe,CAAC,aAAc,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,GAC7E,CACA,IAAI,WAAW1zB,CAAa,CAAE,CAC1B,IAAI,CAAC,WAAW,CAAC,aAAcA,EACnC,CAEmB,UAAoB,CACnC,MAAO,CAAC,IAAIszB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CAAE,SAAU,EAAK,GAAG,AAC3F,CACmB,iBAAwB,CACvC,IAAMszB,EAAkB,IAAIh4B,IAE5B,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,AAACQ,IAC1BA,EAAE,KAAK,CAAC,IAAI,YAAYkgB,EAAAA,EAAYA,GAChC,AAACsX,EAAgB,GAAG,CAACx3B,EAAE,KAAK,CAAC,IAAI,GACjCw3B,EAAgB,GAAG,CAACx3B,EAAE,KAAK,CAAC,IAAI,CAAE,EAAE,EAExCw3B,EAAgB,GAAG,CAACx3B,EAAE,KAAK,CAAC,IAAI,EAAG,IAAI,CAAC,CACpC,UAAYA,EAAE,KAAK,CAAmB,KAAK,CAC3C,WAAY,IAAI,CAAC,UAAU,AAC/B,GAER,GAEAkG,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,oBAAqB,KACpDsxB,EAAgB,OAAO,CAAC,CAACz6B,EAAOa,KAC5BA,EAAI,eAAe,CAACb,EACxB,EACJ,GAEA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CACJ,E,8BAlCoB,CAAC,kBAAmB,CAAE,KAAM,Y,8FAJ5C,IAAK,kBACL,KAAM,e,qBA2CH,IAAM06B,mBAAN,MAAMA,2BAA2BhH,kCACjB,UAAoB,CACnC,MAAO,CAAC,IAAIJ,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CAAE,SAAU,EAAK,GAAG,AAC3F,CAEmB,iBAAwB,CACvC,IAAMszB,EAAkB,IAAIh4B,IAE5B,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,AAACQ,IAC1BA,EAAE,KAAK,CAAC,IAAI,YAAYkgB,EAAAA,EAAYA,GAChC,AAACsX,EAAgB,GAAG,CAACx3B,EAAE,KAAK,CAAC,IAAI,GACjCw3B,EAAgB,GAAG,CAACx3B,EAAE,KAAK,CAAC,IAAI,CAAE,EAAE,EAExCw3B,EAAgB,GAAG,CAACx3B,EAAE,KAAK,CAAC,IAAI,EAAG,IAAI,CAAEA,EAAE,KAAK,CAAmB,KAAK,EAEhF,GAEAkG,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,uBAAwB,KACvDsxB,EAAgB,OAAO,CAAC,CAACz6B,EAAOa,KAC5BA,EAAI,kBAAkB,CAACb,EAC3B,EACJ,GAEA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CACJ,E,gDA5BI,IAAK,qBACL,KAAM,kB,wBAiCH,IAAM26B,kBAAN,MAAMA,0BAA0BjH,kCAChB,UAAoB,CACnC,MAAO,CAAC,IAAIH,eAAe,sBAAuB,CAAE,SAAU,GAAM,cAAe,EAAK,GAAG,AAC/F,CAEmB,iBAAwB,CACvCpqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,sBAAuB,KACtD,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,AAAClG,IAC1BA,aAAakgB,EAAAA,EAAYA,EACzBlgB,EAAE,iBAAiB,EAE3B,EACJ,GAEA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CACJ,E,sYAnBI,IAAK,oBACL,KAAM,iB,uBC7DH,IAAM23B,eAAN,MAAMA,uBAAuBlH,kCAChC,IACI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAAU,GAC1C,CAEA,IAAI,OAAO1zB,CAAa,CAAE,CACtB,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CAEmB,iBAAkB,CACjCmJ,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAMtH,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAC7CyxB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,MAAM,CAAC,GAAG,CAAC,AAAClzB,GAAOA,EAAE,KAAK,CAAmB,KAAK,EACjF43B,EAAa,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,OAAO,CAC7Dn2B,EAAK,KAAK,CAAC,KAAK,CAChByxB,EACA,IAAI,CAAC,MAAM,EAGTa,EAAQ,IAAIzS,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAE7f,EAAK,IAAI,CAAEm2B,EAAYn2B,EAAK,UAAU,CACzFsyB,CAAAA,EAAM,SAAS,CAAGtyB,EAAK,SAAS,CAE/BA,AAAAA,CAAAA,EAAK,MAAM,EAAI,IAAI,CAAC,QAAQ,CAAC,QAAO,EAAG,GAAG,CAACsyB,GAC5CtyB,EAAK,MAAM,EAAE,OAAOA,GACpB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEmB,UAAW,CAC1B,MAAO,CACH,IAAI4uB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,YAAa,CACT,MAAO,AAACqO,GAEAA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,KAAe,EACnCqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,QAAkB,EACtCqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,aAAuB,AAGvD,EACA,cAAeK,EAAAA,EAAAA,CAAAA,eAA2B,AAC9C,GACA,IAAI8rB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACvD,SAAU,GACV,cAAe,EACnB,GACH,AACL,CACJ,E,uXAhDoB,CAAC,iB,uFAJjB,IAAK,iBACL,KAAM,c,oBCIH,IAAM2zB,QAAN,MAAMA,gBAAgBpH,kCACN,UAAoB,CACnC,MAAO,CAAC,IAAID,oBAAoB,sBAAuB,CAAE,SAAU,EAAK,GAAG,AAC/E,CAEmB,iBAAkB,CACjC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,GAEtCtqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,AAAC/I,IAC1BA,aAAa6gB,EAAAA,EAASA,CACtB,IAAI,CAAC,gBAAgB,CAAC7gB,GACfA,aAAa2hB,EAAAA,EAAaA,CACjC,IAAI,CAAC,oBAAoB,CAAC3hB,GACnBA,aAAakhB,EAAAA,EAAcA,EAClC,IAAI,CAAC,qBAAqB,CAAClhB,EAEnC,EACJ,GAEA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,CAEQ,iBAAiBA,CAAY,CAAE,CACnC,IAAI83B,EAAY93B,EAAE,KAAK,CAAC,KAAK,CAAC,SAAS,GACvC,GAAI83B,AAAqB,IAArBA,EAAU,MAAM,CAAQ,CACxB,IAAMC,EAAe,IAAIzW,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEthB,EAAE,IAAI,CAAE83B,CAAS,CAAC,EAAE,CAAE93B,EAAE,UAAU,CAC5F+3B,CAAAA,EAAa,SAAS,CAAG/3B,EAAE,SAAS,CACpCA,EAAE,MAAM,EAAE,YAAYA,EAAE,eAAe,CAAE+3B,EAC7C,MACI,IAAI,CAAC,WAAW,CAAC/3B,EAAG83B,EAGxB93B,CAAAA,EAAE,MAAM,EAAE,OAAOA,EACrB,CAEQ,YAAYyB,CAAe,CAAEq2B,CAAmB,CAAE,CACtD,IAAMhC,EAAS,IAAInT,EAAAA,EAASA,CAAC,IAAI,CAAC,QAAQ,CAAElhB,EAAK,IAAI,CACrDq0B,CAAAA,EAAO,SAAS,CAAGr0B,EAAK,SAAS,CACjCA,EAAK,MAAM,EAAE,YAAYA,EAAK,eAAe,CAAEq0B,GAE/C,IAAIx1B,EAAI,EACR,IAAK,IAAMwzB,KAAYgE,EAAW,CAC9B,IAAMjyB,EAAO,CAAC,EAAE3B,EAAAA,EAAAA,CAAAA,WAAqB,CAAC4vB,EAAS,SAAS,EAAE,CAAC,EAAExzB,IAAI,CAAC,CAC9Dy3B,EAAe,IAAIzW,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEzb,EAAMiuB,GAC9DgC,EAAO,GAAG,CAACiC,EACf,CACJ,CAEQ,qBAAqB/3B,CAAgB,CAAE,CAC3C,IAAK,IAAMyB,KAAQzB,EAAE,SAAS,CAAC,KAAK,CAAE,CAClC,IAAMg4B,EAAUv2B,EAAK,KAAK,EAC1Bu2B,CAAAA,EAAQ,SAAS,CAAGv2B,EAAK,SAAS,CAAC,QAAQ,CAACzB,EAAE,SAAS,EACvDA,EAAE,MAAM,EAAE,YAAYA,EAAE,eAAe,CAAEg4B,EAC7C,CAEAh4B,EAAE,MAAM,EAAE,OAAOA,EACrB,CAEQ,sBAAsBA,CAAiB,CAAE,CAC7C,IAAK,IAAMuS,KAASvS,EAAE,MAAM,CAAE,CAC1B,IAAMyB,EAAO,IAAI6f,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEthB,EAAE,IAAI,CAAEuS,EAAM,WAAW,CAACvS,EAAE,SAAS,EACvFA,CAAAA,EAAE,MAAM,EAAE,YAAYA,EAAE,eAAe,CAAEyB,EAC7C,CAEAzB,EAAE,MAAM,EAAE,OAAOA,GACjBA,EAAE,MAAM,CAAC,OAAO,CAAC,AAACA,GAAMA,EAAE,OAAO,GACrC,CACJ,E,6XAvEI,IAAK,iBACL,KAAM,c,aCAH,IAAMi4B,cAAN,MAAMA,sBAAsBxH,kCAC/B,IACI,QAAS,CACT,OAAO,IAAI,CAAC,eAAe,CAAC,SAAU,GAC1C,CAEA,IAAI,OAAO1zB,CAAa,CAAE,CACtB,IAAI,CAAC,WAAW,CAAC,SAAUA,EAC/B,CAEmB,iBAAkB,CACjCmJ,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAMtH,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAC7CyxB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,MAAM,CAAC,GAAG,CAAC,AAAClzB,GAAOA,EAAE,KAAK,CAAmB,KAAK,EACjF43B,EAAa,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAC5Dn2B,EAAK,KAAK,CAAC,KAAK,CAChByxB,EACA,IAAI,CAAC,MAAM,EAGTa,EAAQ,IAAIzS,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAE7f,EAAK,IAAI,CAAEm2B,EAAYn2B,EAAK,UAAU,CACzFsyB,CAAAA,EAAM,SAAS,CAAGtyB,EAAK,SAAS,CAC/BA,AAAAA,CAAAA,EAAK,MAAM,EAAI,IAAI,CAAC,QAAQ,CAAC,QAAO,EAAG,GAAG,CAACsyB,GAC5CtyB,EAAK,MAAM,EAAE,OAAOA,GACpB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEmB,UAAW,CAC1B,MAAO,CACH,IAAI4uB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,YAAa,CACT,MAAO,AAACqO,GAEAA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,KAAe,EACnCqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,QAAkB,EACtCqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,aAAuB,AAGvD,EACA,cAAeK,EAAAA,EAAAA,CAAAA,eAA2B,AAC9C,GACA,IAAI8rB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACvD,SAAU,GACV,cAAe,EACnB,GACH,AACL,CACJ,E,iYA/CoB,CAAC,iB,oFAJjB,IAAK,gBACL,KAAM,a,mBCGH,IAAeg0B,mBAAf,MAAeA,2BAA2BzH,kCACnC,MAAsB,AACtB,UAAqB,AAE/B,KACI,SAAU,CACV,OAAO,IAAI,CAAC,eAAe,CAAC,UAAW,GAC3C,CACA,IAAI,QAAQ1zB,CAAc,CAAE,CACxB,IAAI,CAAC,WAAW,CAAC,UAAWA,EAChC,CAIU,iBAAmB,AAACyU,GAGnB,EACH,SAAU,IAAI5J,aAFAga,AADA,IAAI,CAAC,SAAS,CAACpQ,GACL,QAAQ,CAAC,IAAI,CAAC,SAAS,GAG/C,SAAU3N,EAAAA,EAAAA,CAAAA,KAAc,CACxB,MAAO2K,EAAAA,EAAAA,CAAAA,gBAA6B,CACpC,MAAO,EAAE,AACb,EACF,AAEF,OAAc,sBAAuB,QAEjC,AADA,IAAI,CAAC,MAAM,CAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,gBAAgB,GAAG,MAAM,CAAC,AAACxO,GAAMA,aAAa4f,EAAAA,EAAUA,EAC1F,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,IAEzB,IAAI,CAAC,UAAU,CAAG,IAAI7d,EAAAA,EAAeA,CACrC,IAAI,CAAC,MAAM,CAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,uBAAwB,IAAI,CAAC,UAAU,CAAE,IAE1F,IAAI,CAAC,MAAM,CAAC,MAAM,CAAG,IACrB,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,SAAW,WACnCiJ,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,2BAE7B,IACX,CAEA,MAAyB,WAA8B,OACnD,CAAI,CAAE,MAAM,IAAI,CAAC,oBAAoB,KAErC,IAAI,CAAC,SAAS,CAAG,IAAI,CAAC,MAAM,CAAE,OAAO,CAAC,AAAC+oB,GACnC,AAAIA,aAAiBjU,EAAAA,EAAQA,CAClBiU,EAAM,IAAI,CAAC,QAAQ,CAAGA,EAAM,SAAS,CAAC,QAAQ,CAACA,EAAM,IAAI,CAAC,QAAQ,EAAI,EAAE,CACxEA,aAAiB7T,EAAAA,EAAYA,CAC7B6T,EAAM,IAAI,CAAC,KAAK,EAAE,SAAWA,EAAM,SAAS,CAAC,QAAQ,CAACA,EAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAI,EAAE,CACrFA,aAAiBpS,EAAAA,EAAaA,CAC9B7hB,MAAM,IAAI,CAAC2U,EAAAA,EAAAA,CAAAA,SAAqB,CAACsf,EAAM,WAAW,IAAK,QAAQ,EAEnE,EAAE,EAEN,GACX,CAEU,gBAAgBxjB,CAAU,CAAEmB,CAAQ,CAAE,CAC5C,OAAO3N,EAAAA,EAAAA,CAAAA,IAAiB,CAACwM,EAAOmB,EAAKlD,EAAAA,EAAAA,CAAAA,kBAA+B,CAAE3K,EAAAA,EAAAA,CAAAA,KAAc,CACxF,CAEU,iBAAwB,CAC9BqC,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAM8c,EAAS,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,MAAM,EAAE,IAAI,AAAC7lB,GAAMA,EAAE,KAAK,IAAM,IAAI,CAAC,MAAM,CACxE4hB,EAAY,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,KAAK,EAE7DiE,GAAQ,QAAQ,AAAC7lB,IACbA,EAAE,SAAS,CAAGA,EAAE,SAAS,CAAC,QAAQ,CAAC4hB,EACvC,GACA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CACJ,E,iYAlEoB,CAAC,gB,8CCbd,IAAMuW,OAAN,MAAMA,eAAeD,mBACL,UAAU1mB,CAAU,CAAW,CAC9C,IAAM+W,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAChCjM,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAE9CjI,EAAS+jB,AADF5mB,EAAM,GAAG,CAAC+W,GACH,KAAK,CAACjM,GACpB7B,EAAQ,IAAI2B,EAAAA,EAAKA,CAACmM,EAAQlU,EAAQiI,GACxC,OAAOvF,EAAAA,EAAAA,CAAAA,qBAA6B,CAAC0D,EACzC,CAEA,UAAoB,CAGhB,MAAO,CAFS,IAAIuV,UAAU,uBAAwB7tB,KAAAA,EAAW,IAChD,IAAI6tB,UAAU,uBAAwB,IAAI,CAAC,kBAAkB,CAAE,IAClD,AAClC,CAEiB,mBAAqB,IAC3B,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvC,UAAWxJ,EAAAA,IAAc,CACzB,QAAS,IAAI,CAAC,aAAa,CAC3B,UAAW,AAACF,IACR,IAAM/R,EAAM+R,EAAE,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACzC,OAAO/R,EAAI,MAAM,GAAK,MAAQ,CAACA,EAAI,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAC3F,CACJ,EACF,AAEe,eAAgB,AAAC/C,IAC9B,IAAMyC,EAAK,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACjD,GAAI,CAACzC,EAAO,MAAO,CAACyC,EAAG,CACvB,IAAM1B,EAAQ,IAAI,CAAC,gBAAgB,CAACf,GAC9BL,EAASK,EAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAG,SAAS,GAAI,QAAQ,CAAC,KAEzE,MAAO,CAACyC,EAAI1B,EADC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,GAAG,CAACpB,GAASK,EAAM,GAAG,CAACL,IAC1D,AAC5B,CAAE,AACN,E,yXAvCI,IAAK,gBACL,KAAM,a,YCEH,IAAMknB,KAAN,MAAMA,aAAaH,mBACtB,UAAoB,CAChB,MAAO,CACH,IAAIlI,UAAU,uBAAwB7tB,KAAAA,EAAW,IACjD,IAAI6tB,UAAU,uBAAwB,IAAI,CAAC,kBAAkB,CAAE,IAClE,AACL,CAEiB,mBAAqB,IAC3B,EACH,SAAU,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvC,UAAWxJ,EAAAA,MAAgB,CAC3B,QAAS,IAAI,CAAC,WAAW,AAC7B,EACF,AAEe,aAAc,AAAChV,IAC5B,IAAMyC,EAAK,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,SACjD,AAAKzC,EACE,CAACyC,EAAI,IAAI,CAAC,gBAAgB,CAACzC,GAAQ,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGA,GAAO,CAD7E,CAACyC,EAAG,AAE3B,CAAE,AAEiB,WAAUzC,CAAU,CAAW,CAC9C,GAAM,CAAExR,EAAAA,CAAC,CAAEwS,EAAAA,CAAC,CAAEC,EAAAA,CAAC,CAAE,CAAGjB,EAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACrD,OAAOuF,EAAAA,EAAAA,CAAAA,eAAuB,CAAC/W,EAAGwS,EAAGC,EACzC,CACJ,E,8XA7BI,IAAK,cACL,KAAM,W,UCSH,IAAM6lB,kBAAN,MAAMA,0BAA0B7H,kCAChB,iBAAkB,CACjCvqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAMtH,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAC7CgyB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,MAAM,CAAC,GAAG,CAAC,AAACzzB,GAAMA,EAAE,KAAK,EACxD43B,EAAa,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,aAAa,CAACn2B,EAAK,KAAK,CAAC,KAAK,CAAEgyB,GAEpFM,EAAQ,IAAIzS,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAE7f,EAAK,IAAI,CAAEm2B,EAAYn2B,EAAK,UAAU,CACzFsyB,CAAAA,EAAM,SAAS,CAAGtyB,EAAK,SAAS,CAEhC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAACsyB,GACtBtyB,EAAK,MAAM,EAAE,OAAOA,GACpB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEmB,UAAW,CAC1B,MAAO,CACH,IAAI4uB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,YAAa,CACT,MAAO,AAACqO,GAEAA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,KAAe,EACnCqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,QAAkB,EACtCqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,aAAuB,AAGvD,EACA,cAAeK,EAAAA,EAAAA,CAAAA,eAA2B,AAC9C,GACA,IAAI8rB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACvD,SAAU,GACV,cAAe,EACnB,GACH,AACL,CACJ,E,sZAvCI,IAAK,uBACL,KAAM,oB,uBCNH,IAAMq0B,uBAAN,MAAMA,+BAA+B9H,kCACrB,iBAAkB,CACjCvqB,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAMtH,EAAO,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAC7Cq2B,EAAY,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAK,MAAM,CAAC,GAAG,CAAC,AAAC93B,GAAMA,EAAE,KAAK,EAC5DuS,EAAQ,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,CAAC,cAAc,CAAC9Q,EAAK,KAAK,CAAC,KAAK,CAAEq2B,GAEhF/D,EAAQ,IAAIzS,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAE7f,EAAK,IAAI,CAAE8Q,EAAO9Q,EAAK,UAAU,CACpFsyB,CAAAA,EAAM,SAAS,CAAGtyB,EAAK,SAAS,CAEhCA,EAAK,MAAM,EAAE,YAAYA,EAAK,eAAe,CAAEsyB,GAC/CtyB,EAAK,MAAM,EAAE,OAAOA,GACpB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEmB,UAAW,CAC1B,MAAO,CACH,IAAI4uB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,YAAa,CACT,MAAO,AAACqO,GACGA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,MAAgB,EAAIqO,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,AAEzF,EACA,cAAeK,EAAAA,EAAAA,CAAAA,eAA2B,AAC9C,GACA,IAAI8rB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACxE,SAAU,GACV,cAAe,EACnB,GACH,AACL,CACJ,E,oZAnCI,IAAK,sBACL,KAAM,qB,4BCGH,IAAMs0B,OAAN,MAAMA,eAAeN,mBACL,UAAU1mB,CAAU,CAAW,CAC9C,IAAM6C,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,MAAM,CACxCkU,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAChCjU,EAAQ,IAAI,CAAC,QAAQ,CAAC9C,GAC5B,OAAOuF,EAAAA,EAAAA,CAAAA,WAAmB,CAACwR,EAAQlU,EAAQC,EAC/C,CAEA,UAAoB,CAUhB,MAAO,CATS,IAAI0b,UAAU,uBAAwB7tB,KAAAA,EAAW,IAChD,IAAI2tB,kBAAkB,uBAAwB,IAAI,CAAC,kBAAkB,CAAE,IACxE,IAAIL,UAChB,uBACA,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC7B,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAC7B,IAAI,CAAC,iBAAiB,CACtB,IAEqC,AAC7C,CAEiB,mBAAqB,KAClC,GAAM,CAAEje,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACzC,MAAO,CACH,MAAO,IAAMxR,EACb,QAAS,IAAI,CAAC,aAAa,CAC3B,MAAO,AAAC8U,GAAuB,IAAI,CAAC,SAAS,CAACtD,EAAMxR,EAAQ8U,GAC5D,UAAW,AAACA,GACR,CAAIA,CAAAA,EAAE,UAAU,CAAC9U,GAAUlO,EAAAA,EAAAA,CAAAA,QAAkB,AAAlBA,GACpBgjB,AAAwE,KAAxEA,EAAE,GAAG,CAAC9U,GAAQ,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAEjF,CACJ,CAAE,AAEe,eAAgB,AAACE,IAC9B,IAAMmgB,EAAe,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAC3D,GAAI,CAACngB,EAAK,MAAO,CAACmgB,EAAa,CAC/B,GAAM,CAAErgB,MAAAA,CAAK,CAAEwR,KAAAA,CAAI,CAAE,CAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CACnCvI,EAAQ,IAAI,CAAC,SAAS,CAACuI,EAAMxR,EAAQE,GAC3C,MAAO,CACHmgB,EACA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAGngB,GACxC,IAAI,CAAC,gBAAgB,CAAC,SAAU+I,EAAM,MAAM,CAAEjJ,EAAQiJ,EAAM,eAAe,CAACjJ,EAAQE,IACvF,AACL,CAAE,AAEe,mBAAoB,IAC1B,EACH,UAAW8U,EAAAA,IAAc,CACzB,QAAS,IAAI,CAAC,YAAY,CAC1B,MAAO,IAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACpC,UAAW,AAACF,GAEJA,EAAE,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAK,MACzCA,EAAE,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EAAK,IAGrD,EACF,AAEM,UAAS9U,CAAU,CAAE,CACzB,IAAM6C,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,MAAM,CACxCkU,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAEhC8N,EAAKpiB,AADA,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACpB,GAAG,CAACsU,GACZiO,EAAKhlB,EAAM,GAAG,CAAC+W,GACrB,OAAO8N,EAAG,cAAc,CAACG,EAAIniB,EACjC,CAEiB,aAAe,AAAC7C,IAC7BA,EAAQA,GAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACxC,IAAM/Q,EAAS,CACX,IAAI,CAAC,gBAAgB,CAAC+Q,GACtB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACtC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,EACvC,IAAI,CAAC,UAAU,CAACA,GACnB,CAEK8C,EAAQ,IAAI,CAAC,QAAQ,CAAC9C,GAY5B,OAXIzG,KAAK,GAAG,CAACuJ,GAAShR,EAAAA,EAAAA,CAAAA,KAAe,EACjC7C,EAAO,IAAI,CACP,IAAI,CAAC,gBAAgB,CACjB,MACA,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAAE,MAAM,CAC/B,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACvB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CACtB6T,AAAQ,IAARA,EAAevJ,KAAK,EAAE,GAI5BtK,CACX,CAAE,AAEM,YAAWiR,CAAQ,CAAE,CACzB,IAAI6W,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAChCkQ,EAASlQ,EAAO,GAAG,CAAC7W,EAAI,GAAG,CAAC6W,GAAQ,SAAS,GAAI,QAAQ,CAAC,MAC9D,OAAO,IAAI,CAAC,eAAe,CAACA,EAAQkQ,EACxC,CACJ,E,0XAtGI,IAAK,gBACL,KAAM,a,YCUH,IAAMC,MAAN,MAAMA,cAAcjI,kCACf,cAAe,CACnB,IAAMQ,EAAS,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAC1C0H,EAAkB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,CAAC,MAAM,GAC9DzF,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,AAAClzB,GACxCA,EAAE,KAAK,CAAC,cAAc,CAACA,EAAE,SAAS,CAAC,QAAQ,CAAC24B,KAE1Cl4B,EAASwwB,EAAO,KAAK,CAACiC,GAI5B,OAFAA,EAAM,OAAO,CAAC,AAAClzB,GAAMA,EAAE,OAAO,IAEvBS,CACX,CAEmB,iBAAkB,CACjCyF,EAAAA,EAAAA,CAAAA,OAAmB,CAAC,IAAI,CAAC,QAAQ,CAAE,CAAC,OAAO,EAAE6C,OAAO,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAE,KAClF,IAAM6vB,EAAM,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAM,CAAC,EAAE,CACjCrmB,EAAQ,IAAI,CAAC,YAAY,GAEzBwhB,EAAQ,IAAIzS,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEsX,EAAI,IAAI,CAAErmB,EAC7DwhB,CAAAA,EAAM,SAAS,CAAG6E,EAAI,SAAS,CAC/BA,EAAI,MAAM,EAAE,IAAI7E,GAEhB,IAAI,CAAC,YAAY,CACb,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,IAC9B,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,AAAC/zB,GAAMA,EAAE,KAAK,GAElD,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAC/B,EACJ,CAEQ,aAAa,GAAGmhB,CAAuB,CAAE,CAC7CA,EAAO,OAAO,CAAC,AAACnhB,IACZ,IAAM+zB,EAAQ,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC/zB,GACnD+zB,GAAO,QAAQ,OAAOA,EAC1B,EACJ,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAI1D,gBAAgBnsB,EAAAA,EAAAA,CAAAA,KAAe,CAAE,sBAAuB,CACxD,cAAeK,EAAAA,EAAAA,CAAAA,eAA2B,AAC9C,GACA,IAAI8rB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAGA,EAAAA,EAAAA,CAAAA,IAAc,CAAE,sBAAuB,CACxE,SAAU,GACV,cAAe,EACnB,GACH,AACL,CACJ,E,uXApDI,IAAK,eACL,KAAM,Y,WCeH,IAAM20B,KAAN,MAAMA,aAAalrB,EAAAA,EAAiBA,CACvC,MAAyB,cAAe,CACpC,IAAImrB,EAAc,IAAI5yB,EAAAA,EAAWA,CAAC,IAAI,CAAC,QAAQ,CAAE6I,EAAAA,EAAAA,CAAAA,SAAc,CAAC,wBAChE+pB,EAAY,KAAK,GACjB,GAAI,CACA,MAAM,IAAI,CAAC,SAAS,EACxB,CAAE,MAAOz7B,EAAG,CAER,MADAy7B,EAAY,QAAQ,GACdz7B,CACV,CACAy7B,EAAY,MAAM,EACtB,CAEA,MAAc,WAAY,CAItB,IAHA,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,KAAK,GACtC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,cAAc,GAE/B,CAAC,IAAI,CAAC,WAAW,EAAE,CACtB,IAAI,CAAC,UAAU,CAAG,IAAI/2B,EAAAA,EAAeA,CACrC,IAAIiF,EAAU,IAAI+xB,yBAAyB,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,UAAU,EAQzE,GAPA,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CACnC/xB,EACA,sBACA,IAAI,CAAC,UAAU,CACf,GACA,kBAEA,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,SAAW,WAAa,CAACA,EAAQ,QAAQ,CACjE,MAEJ,IAAI,CAAC,QAAQ,CAACA,EAAQ,QAAQ,EAC9BA,EAAQ,OAAO,EACnB,CACJ,CAEQ,SAASkgB,CAAkB,CAAE,CACjC,IAAI6M,EAAQ,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC7M,EAAS,IAAI,CAAC,KAAK,EAChEnH,EAAcgU,GAAwB,WAC1C7M,EAAS,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,AAAC8R,IACtC,IAAIC,EAAU/R,EAAS,KAAK,CAAC,IAAI,CAAC8R,EAAQ,KAAK,CAAEA,EAAQ,GAAG,EAAE,QAAQ,GACtEjF,GAAO,QAAQ,IAAI,IAAIzS,EAAAA,EAAiBA,CAAC,IAAI,CAAC,QAAQ,CAAEyS,EAAM,IAAI,CAAEkF,EAASlZ,GACjF,GACAgU,GAAO,QAAQ,OAAOA,EAC1B,CACJ,E,iCA/CI,IAAK,cACL,KAAM,W,UAgDH,IAAMmF,WAAN,MAAMA,WACT,MAAM3mB,CAAa,CAAW,CAC1B,OAAOA,EAAM,SAAS,GAAKrO,EAAAA,EAAAA,CAAAA,IAAc,AAC7C,CACJ,EAiBO,IAAM60B,yBAAN,MAAMA,iCAAiC/S,EAAAA,EAAqBA,CAC/D,EAAS,AAAuB,AACxB,gBAAoC,AACpC,UAAgC,AACvB,cAAe,IAAIlkB,GAAmB,AAEvD,KAAI,UAAW,CACX,OAAO,IAAI,CAAC,EAAS,AACzB,CAEA,YAAYxE,CAAmB,CAAEmoB,CAA2B,CAAE,CAC1D,KAAK,CAACnoB,EAAU4G,EAAAA,EAAAA,CAAAA,KAAe,CAAE,GAAOuhB,EAAY,IAAIyT,WAC5D,CAEmB,mBAAmBlW,CAAW,CAAE+C,CAA4B,CAAQ,CAEnF,GADA,IAAI,CAAC,eAAe,GAChBA,AAAqB,IAArBA,EAAU,MAAM,EAAUA,CAAS,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAK7hB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,OAE/E,IAAMwQ,EAAMD,EAAAA,EAAAA,CAAAA,WAAuB,CAACsR,CAAS,CAAC,EAAE,CAAC,KAAK,CAAC,WAAW,GAAKA,CAAS,CAAC,EAAE,CAAC,SAAS,EACvFmN,EAAQ,IAAI,CAAC,mBAAmB,CAACxe,EAAKsO,EAAM+C,CAAS,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,EACjEhB,EAAOgB,CAAS,CAAC,EAAE,CAAC,KAAK,CAAC,cAAc,CAACA,CAAS,CAAC,EAAE,CAAC,SAAS,EACrE,IAAI,CAAC,YAAY,CAAC,GAAG,CAAChB,GAEtB,IAAIoU,EAAWC,aAAarU,EAAK,KAAK,CAAEA,EAAMmO,EAAOnN,GACjDlV,EAAOkU,EAAK,IAAI,CAACoU,EAAS,aAAa,CAAC,KAAK,CAAEA,EAAS,aAAa,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,AACzFtoB,CAAAA,EAAK,KAAK,CAAGrC,EAAAA,EAAAA,CAAAA,kBAA+B,CAC5CqC,EAAK,SAAS,CAAG,EACjB,IAAI,CAAC,eAAe,CAAGmS,EAAK,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,aAAa,CAACnS,GACtE,IAAI,CAAC,SAAS,CAAG,CAAE,KAAMkV,CAAS,CAAC,EAAE,CAAEoT,SAAAA,EAAU,MAAOpU,EAAK,KAAK,AAAC,EACnE/B,EAAK,MAAM,EACf,CAEmB,iBAAwB,CACV7gB,KAAAA,IAAzB,IAAI,CAAC,eAAe,GACpB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,mBAAmB,CAAC,IAAI,CAAC,eAAe,EACzE,IAAI,CAAC,eAAe,CAAGA,KAAAA,EACvB,IAAI,CAAC,SAAS,CAAGA,KAAAA,EACjB,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,UAAU,EAAE,SAE9C,CAEmB,cAAc7E,CAAmB,CAAQ,CACxD,IAAI,CAAC,EAAS,CAAG6E,KAAAA,CACrB,CAEmB,OAAO6gB,CAAW,CAAE9X,CAAmB,CAAU,CAEhE,OADA,IAAI,CAAC,EAAS,CAAG,IAAI,CAAC,SAAS,CACxB,OAAI,CAAC,EAAS,AACzB,CAEQ,oBAAoBwJ,CAAgB,CAAEsO,CAAW,CAAEqW,CAAiB,CAAE,CAC1E,IAAIC,EAAc7kB,EAAAA,EAAAA,CAAAA,MAAkB,CAACC,EAAK,MAC1C,OAAOsO,EAAK,QAAQ,CAAC,MAAM,CAAC,OAAO,CAC9B,0BAA0B,CAACsW,EAAa,IAAIJ,YAC5C,GAAG,CAAC,AAACl5B,IACF,IAAMyB,EAAQzB,GAAuB,aAC/BuS,EAAS9Q,GAAoB,MAAM,MACzC,GAAI8Q,EAAM,EAAE,GAAK8mB,EAAW,OAC5B,IAAMtU,EAAOxS,EAAM,cAAc,CAAC9Q,EAAK,cAAc,IAErD,OADA,IAAI,CAAC,YAAY,CAAC,GAAG,CAACsjB,GACfA,CACX,GACC,MAAM,CAAC,AAAC/kB,GAAMA,AAAMmC,KAAAA,IAANnC,EACvB,CAES,iBAAwB,CAC7B,KAAK,CAAC,kBAEN,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,AAACA,GAAMA,EAAE,OAAO,IAC1C,IAAI,CAAC,YAAY,CAAC,KAAK,EAC3B,CACJ,EAEA,SAASo5B,aAAanpB,CAAoB,CAAE8U,CAAW,CAAEI,CAAmB,CAAEY,CAA4B,EACtG,IAAImG,EAAgBvH,EAAAA,CAAAA,CAAAA,UAAmB,CAACI,EAAMI,GAAY,GAAG,CAAC,AAACnlB,GAAMA,EAAE,SAAS,EAIhF,GAHAksB,EAAc,IAAI,CAACjc,EAAM,cAAc,GAAIA,EAAM,aAAa,IAG1Dic,AAAyB,IAAzBA,AAFJA,CAAAA,EAAgBpsB,MAAM,IAAI,CAAC,IAAIgC,IAAIoqB,IAAgB,IAAI,CAAC,CAAC5tB,EAAG+T,IAAM/T,EAAI+T,EAAC,EAErD,MAAM,CAAQ,OAAOknB,WAAWrN,GAElD,IAAI+C,EAAYhf,EAAM,SAAS,CAAC8V,CAAS,CAAC,EAAE,CAAC,KAAK,CAAG,GACrD,IAAK,IAAIzlB,EAAI,EAAGA,EAAI4rB,EAAc,MAAM,CAAE5rB,IACtC,GAAI2uB,EAAY/C,CAAa,CAAC5rB,EAAE,CAC5B,GAAIA,AAAM,IAANA,EACA,OAAOk5B,aAAatN,QACjB,GAAI5rB,IAAM4rB,EAAc,MAAM,CAAG,EACpC,OAAOuN,YAAYvN,QAEnB,OAAOwN,cAAcxN,EAAe5rB,GAKhD,OAAOi5B,WAAWrN,EACtB,CAEA,SAASqN,WAAWrN,CAAuB,EACvC,MAAO,CACH,cAAe,CACX,MAAOA,CAAa,CAAC,EAAE,CACvB,IAAKA,EAAc,EAAE,CAAC,GAC1B,EACA,eAAgB,EAAE,AACtB,CACJ,CAEA,SAASwN,cAAcxN,CAAuB,CAAE5rB,CAAS,EACrD,MAAO,CACH,cAAe,CACX,MAAO4rB,EAAc,EAAE,CAAC5rB,EAAI,GAC5B,IAAK4rB,EAAc,EAAE,CAAC5rB,EAC1B,EACA,eAAgB,CACZ,CACI,MAAO4rB,CAAa,CAAC,EAAE,CACvB,IAAKA,CAAa,CAAC5rB,EAAI,EAAE,AAC7B,EACA,CACI,MAAO4rB,CAAa,CAAC5rB,EAAE,CACvB,IAAK4rB,EAAc,EAAE,CAAC,GAC1B,EACH,AACL,CACJ,CAEA,SAASuN,YAAYvN,CAAuB,EACxC,MAAO,CACH,cAAe,CACX,MAAOA,EAAc,EAAE,CAAC,IACxB,IAAKA,EAAc,EAAE,CAAC,GAC1B,EACA,eAAgB,CACZ,CACI,MAAOA,CAAa,CAAC,EAAE,CACvB,IAAKA,EAAc,EAAE,CAAC,GAC1B,EACH,AACL,CACJ,CAEA,SAASsN,aAAatN,CAAuB,EACzC,MAAO,CACH,cAAe,CACX,MAAOA,CAAa,CAAC,EAAE,CACvB,IAAKA,CAAa,CAAC,EAAE,AACzB,EACA,eAAgB,CACZ,CACI,MAAOA,CAAa,CAAC,EAAE,CACvB,IAAKA,EAAc,EAAE,CAAC,GAC1B,EACH,AACL,CACJ,C,oVCpPO,IAAMyN,KAAN,MAAMA,KACT,MAAM,QAAQpT,CAAiB,CAAiB,CAC5C,IAAMjpB,EAAWipB,EAAI,UAAU,EAAE,SACjCjpB,GAAU,QAAQ,OAClBA,GAAU,OAAO,QACrB,CACJ,E,qXATI,IAAK,YACL,KAAM,W,UCEH,IAAMs8B,KAAN,MAAMA,KACT,MAAM,QAAQ/rB,CAAyB,CAAiB,CACpD,IAAMvQ,EAAWuQ,EAAY,UAAU,EAAE,SACzCvQ,GAAU,QAAQ,OAClBA,GAAU,OAAO,QACrB,CACJ,E,6XATI,IAAK,YACL,KAAM,W,UCoBH,IAAMu8B,sBAAN,MAAMA,8BAA8BpzB,EAAAA,EAAUA,CAEjD,OAAkC,IAAI5B,EAAAA,EAAeA,CAAC,CAAC,MAAO,MAAO,MAAM,CAAE5B,EAAAA,EAAAA,CAAAA,KAAgB,CAAE,CAAC,MAAM,CAAE,AAC5G,E,qCAFoB,CAAC,mC,kDAQd,IAAM62B,aAAN,MAAMA,aACT,MAAM,QAAQjsB,CAAyB,CAAiB,CACpD,IAAMmV,EAAOnV,EAAY,UAAU,CACnC,GAAI,CAACmV,EAAM,OAEX,IAAM+W,EAAK,IAAIF,sBACf7uB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,aAAc,kCAAmC,IAAI,CAAC,EAAE,CAAC+uB,GAAK,AAACt5B,IAC1EA,IAAW4D,EAAAA,EAAAA,CAAAA,EAAe,EAE1B2e,CAAAA,EAAK,SAAS,CAAGoD,AADF,CAAChK,EAAAA,EAAAA,CAAAA,EAAQ,CAAEA,EAAAA,EAAAA,CAAAA,EAAQ,CAAEA,EAAAA,EAAAA,CAAAA,EAAQ,CAAC,AACtB,CAAC2d,EAAG,MAAM,CAAC,eAAe,CAAC,EAAE,CAAC,AAAD,CAE5D,EACJ,CAEQ,GAAGA,CAAyB,CAAE,CAClC,MAAOh8B,AAAAA,GAAAA,EAAAA,EAAAA,AAAAA,KACAkP,EAAAA,EAAAA,CAAAA,aAAsB,CAAC8sB,GAAI,GAAG,CAAC,AAAC/5B,IAC/B,IAAMjD,EAASg9B,CAAU,CAAC/5B,EAAE,IAAI,CAAC,QACjC,AAAIjD,aAAiB8H,EAAAA,EAAeA,CACzB,IAAIlD,EAAAA,EAAUA,CAACoN,EAAAA,EAAAA,CAAAA,SAAc,CAAC/O,EAAE,OAAO,EAAGjD,GAE9C,EACX,GAER,CACJ,E,iDA5BI,IAAK,mBACL,KAAM,sB,kBAiCH,IAAMi9B,aAAN,MAAMA,aACT,MAAM,QAAQnsB,CAAyB,CAAiB,CACpD,IAAMmV,EAAOnV,EAAY,UAAU,CACnC,GAAI,CAACmV,EAAM,OACXA,EAAK,QAAQ,CAAC,SAAS,CAAC,cAAc,GACtC,IAAMyC,EAAa,IAAI1jB,EAAAA,EAAeA,CAChCsG,EAAO,MAAM,IAAIgoB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBAAuB,OAAO,CACjF8e,EAAK,QAAQ,CACbyC,GAGJ,GADAA,EAAW,OAAO,GACd,CAACpd,GAAQA,AAAuB,IAAvBA,EAAK,MAAM,CAAC,MAAM,CAAQ,OACvC2a,EAAK,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,KAAK,GACtC,IAAMwB,EAAOnc,EAAK,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,cAAc,CAACA,EAAK,MAAM,CAAC,EAAE,CAAC,SAAS,EACnE,CAACmJ,EAAO6C,EAAO,CAAGmQ,EAAK,MAAM,CAAC,EAAG,GACvCA,EAAK,OAAO,GACZ,IAAIlI,EAAOlb,EAAAA,EAAAA,CAAAA,KAAS,AAChB,CAACiT,EAAO,YAAY,CAACjT,EAAAA,EAAAA,CAAAA,KAAS,GAC9Bkb,CAAAA,EAAOlb,EAAAA,EAAAA,CAAAA,KAAAA,CAAAA,KAAe,CAACiT,GAAQ,SAAS,EAAC,EAE7C2O,EAAK,SAAS,CAAG,IAAI5G,EAAAA,EAAKA,CAAC5K,EAAO6C,EAAQiI,EAC9C,CACJ,E,iDAzBI,IAAK,4BACL,KAAM,wB,kBA8BH,IAAM2d,YAAN,MAAMA,oBAAoBxJ,kCACV,iBAAkB,CACjC,IAAMxgB,EAAQ,IAAI,CAAC,gBAAgB,GAC7BuB,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,KAAK,CAE/Byd,EAAYhf,EAAM,SAAS,CAACuB,EAAO,MACzC,GAAIyd,AAAc9sB,KAAAA,IAAd8sB,EAAyB,OAC7B,IAAM1R,EAAYtN,EAAM,EAAE,CAACgf,GAAW,GAAG,CAAC,SAAS,GAC/C3S,EAAY,IAAI,CAAC,QAAQ,CAACiB,GACxB9C,EAAQ,IAAI2B,EAAAA,EAAKA,CAAC5K,EAAO+L,EAAWjB,GACpC0G,EAAO,IAAI,CAAC,WAAW,CAAC,UAAU,CACnCA,GACLA,CAAAA,EAAK,SAAS,CAAGvI,CAAI,CACzB,CAEQ,SAAS8C,CAAc,CAAE,CAC7B,IAAIjB,EAQJ,OAPIiB,EAAU,SAAS,CAACnc,EAAAA,EAAAA,CAAAA,KAAS,EACtBA,EAAAA,EAAAA,CAAAA,KAAS,CACTmc,EAAU,SAAS,CAAC,IAAInc,EAAAA,EAAGA,CAAC,EAAG,EAAG,KAClCA,EAAAA,EAAAA,CAAAA,KAAS,CAETmc,EAAU,KAAK,CAACnc,EAAAA,EAAAA,CAAAA,KAAS,EAAE,SAAS,EAGnD,CAEmB,UAAoB,CACnC,MAAO,CACH,IAAIivB,gBAAgBnsB,EAAAA,EAAAA,CAAAA,IAAc,CAAE,uBACpC,IAAIgsB,iBAAiB,uBAAwB,IAAI,CAAC,eAAe,CAAE,IACtE,AACL,CAEQ,kBAAmB,CACvB,IAAM3d,EAAQ,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CACzCoC,EAASpC,EAAM,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,EACpEtC,EAAQsC,EAAM,KAAK,CAAC,WAAW,CAACoC,GAEtC,OADA,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC1E,GACfA,CACX,CAEiB,gBAAkB,KAC/B,IAAMA,EAAQ,IAAI,CAAC,gBAAgB,GACnC,MAAO,CACHA,MAAAA,EACA,UAAWuW,EAAAA,EAAY,CACvB,QAAS,AAAChV,IACN,GAAI,CAACA,EAAO,MAAO,EAAE,CACrB,IAAI8lB,EAAUrnB,EAAM,OAAO,CAACuB,GAAO,EAAE,CAAC,GACtC,MAAO,CAAC,IAAI,CAAC,SAAS,CAAC8lB,GAAW9lB,GAAO,AAC7C,CACJ,CACJ,CAAE,AACN,E,gDAzDI,IAAK,2BACL,KAAM,kB,iBCvFH,IAAM0oB,iBAAN,MAAMA,yBAAyBvU,EAAAA,CAAoBA,C,aACtD,aACIroB,CAAmB,CACV68B,CAAsB,CACjC,CACE,KAAK,CAAC78B,EAAU,SAFP68B,aAAa,CAAbA,EAGTnvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,iBAAkB1N,EAAU68B,EACnD,CAES,iBAAkB,CACvBnvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,iBAAkB,IAAI,CAAC,QAAQ,CAAE,EAAE,EACtD,KAAK,CAAC,iBACV,CACJ,ECdA,IAAMovB,EAAqC,CAAC,UAAW,WAAY,WAAW,CAEvE,IAAMC,eAAN,MAAMA,eACD,YAAsC,AACtC,WAAqB,EAAM,AAC3B,KAA+B,AAEvC,KAAY,KAAoB,CAC5B,GAAI,AAAcl4B,KAAAA,IAAd,IAAI,CAAC,IAAI,CACT,MAAM,AAAIxC,MAAM,+BAEpB,OAAO,IAAI,CAAC,IAAI,AACpB,CAEA,OAAc,CACVqL,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,iBAAkB,IAAI,CAAC,cAAc,EACxDA,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,oBAAqB,IAAI,CAAC,mBAAmB,EAChEjF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAEs0B,eAAe,IAAI,CAAC,QAAQ,CAAC,CAChD,CAEA,MAAa,CACTrvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,MAAqB,CAAC,iBAAkB,IAAI,CAAC,cAAc,EAC3DA,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,MAAqB,CAAC,oBAAqB,IAAI,CAAC,mBAAmB,EACnEjF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAEs0B,eAAe,IAAI,CAAC,OAAO,CAAC,CAC/C,CAEA,SAAS9T,CAAiB,CAAE,CACxB,IAAI,CAAC,IAAI,CAAGA,EACZxgB,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAEs0B,eAAe,IAAI,CAAC,SAAS,CAAC,CACjD,CAEiB,oBAAsB,MAAOrX,IACtC,IAAI,CAAC,GAAG,CAAC,gBAAgB,EAAIxV,EAAAA,EAAAA,CAAAA,mBAA4B,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAgB,GACnF,MAAM,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAC9C,CAAE,AAEe,gBAAiB,MAAO8sB,IACrC,IAAM5sB,EAAU4sB,AAAgB,iBAAhBA,EAAiC,IAAI,CAAC,YAAY,CAAGA,EAChE5sB,GAAa,MAAM,IAAI,CAAC,UAAU,CAACA,KACxC3H,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,kBAAkB,EAAE2H,EAAQ,CAAC,EAC1C,MAAM,IAAI,CAAC,YAAY,CAACA,GAC5B,CAAE,AAEF,OAAc,aAAa4sB,CAAwB,CAAE,CAEjD,IAAM5sB,EAAU,GADInK,CAAAA,EAAAA,EAAAA,CAAAA,GAAW,CAAC+2B,EAAW,CAE3C,KAAI,CAAC,GAAG,CAAC,gBAAgB,CAAG5sB,EAC5B1C,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,iBAAkB,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,SAAW,EAAE,EACvE,GAAI,CACA,MAAM0C,EAAQ,OAAO,CAAC,IAAI,CAAC,GAAG,CAClC,CAAE,MAAO6sB,EAAK,CACVvvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,eAAgBuvB,GACnCx0B,EAAAA,EAAAA,CAAAA,KAAY,CAACw0B,EACjB,QAAU,CACN,IAAI,CAAC,YAAY,CAAGD,EACpB,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAGn4B,KAAAA,CAChC,CACJ,CAEA,MAAc,WAAWm4B,CAAwB,CAAE,CAC/C,GAAI,IAAI,CAAC,SAAS,CAAE,MAAO,EAC3B,KAAI,CAAC,SAAS,CAAG,GACjB,IAAM75B,EAAS,MAAM,IAAI,CAAC,QAAQ,CAAC65B,GAEnC,OADA,IAAI,CAAC,SAAS,CAAG,GACV75B,CACX,CAEA,MAAc,SAAS65B,CAAwB,CAAE,QAC7C,AAAK/2B,EAAAA,EAAAA,CAAAA,GAAW,CAAC+2B,GAIb,AAACF,EAAoB,QAAQ,CAACE,IAAgB,AAAwBn4B,KAAAA,IAAxB,IAAI,CAAC,GAAG,CAAC,UAAU,EAIhE,IAAI,CAAC,GAAG,CAAC,gBAAgB,GAG1BoB,EAAAA,EAAAA,CAAAA,OAAe,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAgB,GAAG,MAAQ+2B,GACpDtvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,4BAA6BsvB,GACtD,MAEP9sB,EAAAA,EAAAA,CAAAA,mBAA4B,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAgB,IACtD,MAAM,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC,MAAM,GAC/B,MAZPzH,EAAAA,EAAAA,CAAAA,KAAY,CAAC,sBACN,KALPA,EAAAA,EAAAA,CAAAA,KAAY,CAAC,CAAC,aAAa,EAAEu0B,EAAY,QAAQ,CAAC,EAC3C,GAkBf,CACJ,ECzFO,IAAME,cAAN,MAAMA,c,OACD,YAA4B,AAEpC,aAAqBC,CAAkE,CAAE,C,KAApEA,OAAO,CAAPA,E,KAgBJ,sBAAsB,CAAG,CAACn9B,EAAqB4pB,KAC5D,IAAI,CAAC,WAAW,EAAE,UAClB,IAAI,CAAC,WAAW,CAAG/kB,KAAAA,EAEf7E,EAAS,WAAW,CAAC,gBAAgB,GAErC4pB,EAAS,MAAM,CAAG,GAClB,IAAI,CAAC,WAAW,CAAG,IAAI,CAAC,OAAO,CAAC5pB,EAAU4pB,GAC1C5pB,EAAS,MAAM,CAAC,YAAY,CAAG,IAAI,CAAC,WAAW,EAE/CA,EAAS,MAAM,CAAC,iBAAiB,GAEzC,CA5B0F,CAE1F,SAASo9B,CAAkB,CAAQ,CAC/B30B,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAEy0B,cAAc,IAAI,CAAC,SAAS,CAAC,CAChD,CAEA,OAAc,CACVxvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,mBAAoB,IAAI,CAAC,sBAAsB,EAClEjF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAEy0B,cAAc,IAAI,CAAC,QAAQ,CAAC,CAC/C,CAEA,MAAa,CACTxvB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,MAAqB,CAAC,mBAAoB,IAAI,CAAC,sBAAsB,EACrEjF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAEy0B,cAAc,IAAI,CAAC,QAAQ,CAAC,CAC/C,CAEiB,sBAYf,AACN,ECrBA,IAAMG,EAA2B,CAC7B,OAAQ,oBACR,UAAW,oBACX,IAAK,eACL,MAAO,eACP,SAAU,YACV,SAAU,WACd,EAEO,IAAMC,cAAN,MAAMA,cACD,GAAmB,AACV,SAAU,IAAIp7B,GAA2B,AAE1D,cAAc,CACV,IAAI,CAAC,MAAM,CAACm7B,EAChB,CAEA,SAASpU,CAAiB,CAAQ,CAC9B,IAAI,CAAC,GAAG,CAAGA,EACXxgB,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAE60B,cAAc,IAAI,CAAC,SAAS,CAAC,CAChD,CAEA,OAAc,CACVpvB,OAAO,gBAAgB,CAAC,UAAW,IAAI,CAAC,mBAAmB,EAC3DA,OAAO,gBAAgB,CAAC,UAAW,IAAI,CAAC,cAAc,EACtDzF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAE60B,cAAc,IAAI,CAAC,QAAQ,CAAC,CAC/C,CAEA,MAAa,CACTpvB,OAAO,mBAAmB,CAAC,UAAW,IAAI,CAAC,mBAAmB,EAC9DA,OAAO,mBAAmB,CAAC,UAAW,IAAI,CAAC,cAAc,EACzDzF,EAAAA,EAAAA,CAAAA,IAAW,CAAC,CAAC,EAAE60B,cAAc,IAAI,CAAC,OAAO,CAAC,CAC9C,CAEiB,oBAAsB,AAACv9B,IACpCA,EAAE,cAAc,GAChB,IAAIwiB,EAAS,IAAI,CAAC,GAAG,EAAE,YAAY,UAAU,OACzCmD,EAAO,IAAI,CAAC,GAAG,EAAE,WACjBA,GAAQnD,IACRA,EAAO,YAAY,CAAC,OAAO,CAACmD,EAAM3lB,GAClCwiB,EAAO,WAAW,CAAC,OAAO,CAACmD,EAAM3lB,GAC7B,IAAI,CAAC,GAAG,CAAE,gBAAgB,EAAEA,EAAE,wBAAwB,GAElE,CAAE,AAEe,gBAAiB,AAACA,IAC/BA,EAAE,cAAc,GAChB,IAAIqQ,EAAU,IAAI,CAAC,UAAU,CAACrQ,EAC1BqQ,AAAYvL,MAAAA,IAAZuL,GACA1C,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,iBAAkB0C,EAE7C,CAAE,AAEF,QAAO3F,CAAU,CAAU,CACvB,IAAInK,EAAMmK,EAAK,GAAG,CAIlB,OAHIA,EAAK,OAAO,EAAEnK,CAAAA,EAAM,QAAUA,CAAE,EAChCmK,EAAK,QAAQ,EAAEnK,CAAAA,EAAM,SAAWA,CAAE,EAClCmK,EAAK,MAAM,EAAEnK,CAAAA,EAAM,OAASA,CAAE,EAC3BA,CACX,CAEA,IAAI8P,CAAoB,CAAE3F,CAAU,CAAE,CAClC,IAAInK,EAAM,IAAI,CAAC,MAAM,CAACmK,GACtB,IAAI,CAAC,OAAO,CAAC,GAAG,CAACnK,EAAK8P,EAC1B,CAEA,WAAW3F,CAAU,CAA2B,CAC5C,IAAInK,EAAM,IAAI,CAAC,MAAM,CAACmK,GACtB,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAACnK,EAC5B,CAEA,OAAO0L,CAAc,CAAE,CAEnBvB,AADWgB,OAAO,IAAI,CAACO,GAClB,OAAO,CAAC,AAAC1L,IACV,IAAI,CAAC,OAAO,CAAC,GAAG,CAACA,EAAK0L,CAAG,CAAC1L,EAAI,CAClC,EACJ,CACJ,C,k1LC9EA,eAAei9B,WAAWv9B,CAAmB,CAAEsP,CAAU,EACrD,IAAM2F,EAAQjV,EAAS,WAAW,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC,MAAMsP,EAAK,IAAI,WACzF,AAAK2F,EAAM,IAAI,CAGRvV,EAAAA,EAAAA,CAAAA,EAAS,CAAC,IAAIskB,EAAAA,EAAiBA,CAAChkB,EAAUsP,EAAK,IAAI,CAAE2F,EAAM,KAAK,GAF5DvV,EAAAA,EAAAA,CAAAA,GAAU,CAACuV,EAAM,KAAK,CAGrC,CAEA,eAAeuoB,WAAWx9B,CAAmB,CAAE6jB,CAAgB,EAC3D,IAAM4Z,EAAOz9B,EAAS,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC6jB,UACvD,AAAK4Z,EAAK,IAAI,CAGPz9B,EAAS,WAAW,CAAC,YAAY,CAAC,SAAS,CAAC,aAAa,CAACy9B,EAAK,KAAK,EAFhE/9B,EAAAA,EAAAA,CAAAA,GAAU,CAAC+9B,EAAK,KAAK,CAGpC,CAEO,IAAMC,oBAAN,MAAMA,oBACT,eAA0B,CACtB,MAAO,CAAC,QAAS,OAAQ,QAAS,OAAQ,QAAQ,AACtD,CAEA,eAA0B,CACtB,MAAO,CAAC,QAAS,QAAS,QAAQ,AACtC,CAEA,MAAM,OAAO19B,CAAmB,CAAEoP,CAAwB,CAAiB,CACvE,IAAK,IAAME,KAAQF,EACf,MAAM,IAAI,CAAC,sBAAsB,CAACpP,EAAUsP,EAEpD,CAEA,MAAc,uBAAuBtP,CAAmB,CAAEsP,CAAU,CAAE,CAClE,IAAMquB,EAAaruB,EAAK,IAAI,CAAC,QAAQ,CAAC,SAChC,MAAMiuB,WAAWv9B,EAAUsP,GAC3B,MAAM,IAAI,CAAC,oBAAoB,CAACtP,EAAUsP,GAEhD,GAAI,CAACquB,GAAY,KAAM,OAEvB,IAAMx5B,EAAOw5B,EAAW,KAAK,AAC7Bx5B,CAAAA,EAAK,IAAI,CAAGmL,EAAK,IAAI,CACrBtP,EAAS,OAAO,CAACmE,GACjBnE,EAAS,MAAM,CAAC,MAAM,EAC1B,CAEA,MAAc,qBAAqBA,CAAmB,CAAEsP,CAAU,CAAE,CAChE,IAAMsuB,EAAU,IAAIC,WAAW,MAAMvuB,EAAK,WAAW,WAErD,AAAI,IAAI,CAAC,UAAU,CAACA,EAAK,IAAI,EAClBtP,EAAS,WAAW,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAACA,EAAU49B,GAG7E,IAAI,CAAC,UAAU,CAACtuB,EAAK,IAAI,EAClBtP,EAAS,WAAW,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAACA,EAAU49B,QAGjFzT,MAAM1Y,EAAAA,EAAAA,CAAAA,SAAc,CAAC,uCAAwCnC,EAAK,IAAI,EAE1E,CAEA,MAAM,OAAOvD,CAAY,CAAE3H,CAAmB,CAAmC,CAC7E,GAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC2H,GAAO,OAEpC,IAAM8X,EAAS,IAAI,CAAC,eAAe,CAACzf,GACpC,GAAI,CAACyf,EAAO,MAAM,CAAE,OAEpB,IAAMia,EAAc,MAAM,IAAI,CAAC,aAAa,CAAC/xB,EAAM3H,CAAK,CAAC,EAAE,CAAC,QAAQ,CAAEyf,GAGtE,OAFAA,EAAO,OAAO,CAAC,AAACnhB,GAAMA,EAAE,OAAO,IAExB,IAAI,CAAC,kBAAkB,CAACo7B,EACnC,CAEQ,mBAAmB/xB,CAAY,CAAW,CAC9C,IAAMgyB,EAAU,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAChyB,GAE9C,OADA,AAACgyB,GAAWrwB,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,uCAAwC3B,GAC7EgyB,CACX,CAEQ,gBAAgB35B,CAAmB,CAAY,CACnD,IAAMyf,EAASzf,EACV,MAAM,CAAC,AAAC1B,GAAsBA,aAAa6gB,EAAAA,EAASA,EACpD,GAAG,CAAC,AAAC7gB,GAAMA,EAAE,KAAK,CAAC,KAAK,CAAC,cAAc,CAACA,EAAE,cAAc,KAG7D,OADA,AAACmhB,EAAO,MAAM,EAAInW,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,oCAC3CmW,CACX,CAEA,MAAc,cAAc9X,CAAY,CAAEiyB,CAAc,CAAEna,CAAgB,CAAE,OACxE,AAAI9X,AAAS,UAATA,EAAyB,IAAI,CAAC,gBAAgB,CAACiyB,EAAKna,GACpD9X,AAAS,UAATA,EAAyB,IAAI,CAAC,gBAAgB,CAACiyB,EAAKna,GACjD2Z,WAAWQ,EAAKna,EAC3B,CAEQ,iBAAiBma,CAAc,CAAEna,CAAgB,CAAE,CACvD,OAAOma,EAAI,WAAW,CAAC,YAAY,CAAC,SAAS,CAAC,aAAa,IAAIna,EACnE,CAEQ,iBAAiBma,CAAc,CAAEna,CAAgB,CAAE,CACvD,OAAOma,EAAI,WAAW,CAAC,YAAY,CAAC,SAAS,CAAC,aAAa,IAAIna,EACnE,CAEQ,mBAAmB1gB,CAAkC,CAAE,QAC3D,AAAKA,GAAQ,KAIN,CAACA,EAAO,KAAK,CAAC,MAHjBuK,EAAAA,EAAAA,CAAAA,OAAAA,CAAAA,GAAkB,CAAC,YAAa,oBAAqBvK,GAAQ,MAIrE,CAEQ,WAAW86B,CAAgB,CAAE,CACjC,OAAOA,EAAS,QAAQ,CAAC,UAAYA,EAAS,QAAQ,CAAC,OAC3D,CAEQ,WAAWA,CAAgB,CAAE,CACjC,OAAOA,EAAS,QAAQ,CAAC,UAAYA,EAAS,QAAQ,CAAC,OAC3D,CACJ,EC/GO,IAAMC,WAAN,MAAMA,WACU,OAAkC,EAAE,AAAC,AACrC,oBAA0C,EAAE,AAAC,AACtD,SAAoB,AACpB,eAAgC,AAChC,cAA8B,AAC9B,QAAkB,AAE5B,eAAe,CAOX,OANA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UACbz1B,EAAAA,EAAAA,CAAAA,IAAW,CAAC,iCAEZ,IAAI01B,EAAK,MAAM,qFACf,KAAI,CAAC,QAAQ,CAAG,IAAIA,EAAG,gBAAgB,AAC3C,GACO,IAAI,AACf,CAEA,YAAa,CAQT,OAPA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UACb11B,EAAAA,EAAAA,CAAAA,IAAW,CAAC,yBAEZ,IAAI21B,EAAO,MAAM,mFACjB,OAAMA,EAAK,QAAQ,GACnB,IAAI,CAAC,aAAa,CAAG,IAAIA,EAAK,YAAY,AAC9C,GACO,IAAI,AACf,CAEA,UAAiB,CAOb,OANA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UACb31B,EAAAA,EAAAA,CAAAA,IAAW,CAAC,sBAEZ,IAAI41B,EAAQ,MAAM,iIAClB,KAAI,CAAC,cAAc,CAAG,IAAIA,EAAM,iBAAiB,AACrD,GACO,IAAI,AACf,CAEA,OAAc,CASV,OARA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UACb51B,EAAAA,EAAAA,CAAAA,IAAW,CAAC,2BAEZ,IAAI,CAAC,kBAAkB,GAEvB,IAAI61B,EAAK,MAAM,qFACf,KAAI,CAAC,OAAO,CAAG,IAAIA,EAAG,UAAU,CAAC,MAAM,IAAI,CAAC,aAAa,GAC7D,GACO,IAAI,AACf,CAEA,qBAAqB,GAAGC,CAA4B,CAAQ,CAExD,OADA,IAAI,CAAC,kBAAkB,CAAC,IAAI,IAAIA,GACzB,IAAI,AACf,CAEA,MAAM,eAAgB,CAElB,MAAOC,AADa,OAAM,uFACL,aAAa,AACtC,CAEA,MAAM,OAAuB,CACzB,IAAK,IAAMC,KAAQ,IAAI,CAAC,MAAM,CAC1B,MAAMA,IAEV,IAAI,CAAC,eAAe,GAEpB,IAAIxV,EAAM,IAAI,CAAC,SAAS,EACxB,KAAI,CAAC,OAAO,EAAE,KAAKA,GAEnB,IAAI,CAAC,sBAAsB,GAE3BxgB,EAAAA,EAAAA,CAAAA,IAAW,CAAC,8BAChB,CAEA,WAAY,CACR,OAAO,IAAI8hB,EAAAA,EAAWA,CAAC,CACnB,QAAS,IAAI,CAAC,QAAQ,CACtB,aAAc,IAAI,CAAC,aAAa,CAChC,cAAe,IAAI,CAAC,cAAc,CAClC,SAAU,IAAI,CAAC,WAAW,GAC1B,WAAY,IAAI,CAAC,OAAO,CACxB,aAAc,IAAI,CAAC,gBAAgB,EACvC,EACJ,CAEA,kBAAkC,CAC9B,OAAO,IAAImT,mBACf,CAEQ,iBAAkB,CACtB,GAAI,AAAuB74B,KAAAA,IAAvB,IAAI,CAAC,aAAa,CAClB,MAAM,AAAIxC,MAAM,wBAEpB,GAAI,AAAwBwC,KAAAA,IAAxB,IAAI,CAAC,cAAc,CACnB,MAAM,AAAIxC,MAAM,yBAEpB,GAAI,AAAkBwC,KAAAA,IAAlB,IAAI,CAAC,QAAQ,CACb,MAAM,AAAIxC,MAAM,mCAExB,CAEQ,oBAAqB,CACzB,IAAK,IAAMq8B,KAAU,IAAI,CAAC,kBAAkB,CACxCA,EAAO,IAAI,GAAG,OAAO,CAAC,AAAC1sB,IACnBP,EAAAA,EAAAA,CAAAA,kBAAuB,CAACO,EAAM,IAAI,CAAEA,EAAM,WAAW,CACzD,EAER,CAEQ,wBAAyB,CAC7B,IAAK,IAAM0sB,KAAU,IAAI,CAAC,kBAAkB,CACpC,IAAI,CAAC,OAAO,EACZA,EAAO,cAAc,GAAG,OAAO,CAAC,AAACtuB,IAC7B,IAAI,CAAC,OAAO,CAAE,qBAAqB,CAACA,EAAQ,OAAO,CAAEA,EAAQ,SAAS,CAAEA,EAAQ,OAAO,CAC3F,EAGZ,CAEU,aAA0B,CAChC,MAAO,CACH,IAAI2sB,EAAAA,EAAcA,CAClB,IAAIO,EAAAA,EAAaA,CACjB,IAAIJ,EAAAA,EAAaA,CAAC,CAACl9B,EAAqB4pB,IAC7B,IAAIgT,EAAAA,EAAgBA,CAAC58B,EAAU4pB,IAE7C,AACL,CACJ,ECjJO,IAAM+U,QAAN,MAAMA,gBAAgB18B,YACzB,aAAc,CACV,KAAK,GACL,IAAI,CAAC,WAAW,GAChB,IAAI,CAAC,SAAS,GACd,IAAI,CAAC,aAAa,GAClB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAG;;;;;;;;;QASrB,CAAC,AACL,CAEQ,aAAc,CAClB,IAAIiC,EAAOlE,SAAS,aAAa,CAAC,MAClCkE,CAAAA,EAAK,KAAK,CAAC,OAAO,CAAG;;;;;;;;;;;QAWrB,CAAC,CACD,IAAI,CAAC,WAAW,CAACA,EACrB,CAEQ,eAAgB,CACpB,IAAI06B,EAAa5+B,SAAS,aAAa,CAAC,QACxC4+B,CAAAA,EAAW,SAAS,CAAG;;;;;QAKvB,CAAC,CACD5+B,SAAS,IAAI,CAAC,WAAW,CAAC4+B,EAC9B,CAEQ,WAAY,CAChB,IAAI16B,EAAOlE,SAAS,aAAa,CAAC,MAClCkE,CAAAA,EAAK,SAAS,CAAG,aACjBA,EAAK,KAAK,CAAC,OAAO,CAAG;;;;;;;;;QASrB,CAAC,CACD,IAAI,CAAC,WAAW,CAACA,EACrB,CACJ,EAEAjB,eAAe,MAAM,CAAC,gBAAiB07B,SC3DvC,IAAIE,EAAU,IAAIF,QAClB3+B,SAAS,IAAI,CAAC,WAAW,CAAC6+B,GAG1B,IAAIX,aACC,YAAY,GACZ,UAAU,GACV,QAAQ,GACR,KAAK,GACL,KAAK,GACL,IAAI,CAACx7B,AAAAA,IACF1C,SAAS,IAAI,CAAC,WAAW,CAAC6+B,EAC9B,GACC,KAAK,CAAC,AAAC5B,IACJx0B,EAAAA,EAAAA,CAAAA,KAAY,CAACw0B,EACjB,E"}